
<html>
<head>
	<title>CSV Sample</title>
	<style>
body {
	font-family: arial;
}

p {
	line-height: 1.5;
}

#page {
	max-width: 1080px;
	margin: auto;
}

.trial {
	margin-bottom: 40px;
}

.trial h4 {
	margin-bottom: 5px;
}

.trial code {
	display: block;
	margin-bottom: 10px;
}

.trial .status {
	margin-left: 10px;
}
	</style>
</head>
<body>
	<div id="page">
		<h2>CSV Proxy Sample</h2>
		<div id="instructions-container">
			<p>We'll try loading CSVs with the JS API's CSVLayer class to see if the proxy (www.arcgis.com/sharing/proxy) can load them. These CSV files both exist. We'll also try them on both http and https.</p>
			<p>All four CSVs should say "loaded" when checked, but both of the http URLS will say "error" instead and fail to load.</p>
			<p>Additionally, all four will fail when this page is https.</p>
		</div>
		<div id="action-container">
			<div class="trial">
				<h4>AGOL CSV, http</h4>
				<code>http://sk1tterm.maps.arcgis.com/sharing/rest/content/items/865d96048ff54bff999e987707704015/data</code>
				<button data-url="http://sk1tterm.maps.arcgis.com/sharing/rest/content/items/865d96048ff54bff999e987707704015/data">Check</button>
				<span class="status"></span>
			</div>
			<div class="trial">
				<h4>External CSV, http</h4>
				<code>http://storymaps.esri.com/stories/2014/ecosystems/Ecophysical_points.txt</code>
				<button data-url="http://storymaps.esri.com/stories/2014/ecosystems/Ecophysical_points.txt">Check</button>
				<span class="status"></span>
			</div>
			<div class="trial">
				<h4>AGOL CSV, https</h4>
				<code>https://sk1tterm.maps.arcgis.com/sharing/rest/content/items/865d96048ff54bff999e987707704015/data</code>
				<button data-url="https://sk1tterm.maps.arcgis.com/sharing/rest/content/items/865d96048ff54bff999e987707704015/data">Check</button>
				<span class="status"></span>
			</div>
			<div class="trial">
				<h4>External CSV, https</h4>
				<code>https://storymaps.esri.com/stories/2014/ecosystems/Ecophysical_points.txt</code>
				<button data-url="https://storymaps.esri.com/stories/2014/ecosystems/Ecophysical_points.txt">Check</button>
				<span class="status"></span>
			</div>
		</div>
	</div>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<script src="//js.arcgis.com/3.14/"></script>
	<script>
		require(['esri/config', 'esri/layers/CSVLayer', 'dojo/domReady!'], function(EsriConfig, CSVLayer) {
			var buttons = $('.trial button');
			
			var baseUrl = window.location.href.slice(0, window.location.href.indexOf(/apps/));
			EsriConfig.defaults.io.proxyUrl = baseUrl + '/sharing/proxy';


			buttons.on('click', function() {
				var csvURL = $(this).data('url'),
					status = $(this).siblings('.status'),
					csvLayer = new CSVLayer(csvURL);

				csvLayer.on('load', function() {
					status.html('loaded');

					setTimeout(function(){
						status.html('');
					}, 2000);
				});
				csvLayer.on('error', function() {
					status.html('error');

					setTimeout(function(){
						status.html('');
					}, 2000);
				});
			});
		});
	</script>
</body>
</html>