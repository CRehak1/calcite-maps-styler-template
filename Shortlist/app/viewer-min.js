/*! Storymaps-Shortlist - v2.0.0 - 2016-08-22, 04:26:08 PM - This application is released under the Apache License V2.0 by Esri http://www.esri.com/ - https://github.com/Esri/map-series-storytelling-template-js */define("lib-build/css",[],function(){if(typeof window=="undefined")return{load:function(e,t,n){n()}};var e=document.getElementsByTagName("head")[0],t=window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)/)||0,n=!1,r=!0;t[1]||t[7]?n=parseInt(t[1])<6||parseInt(t[7])<=9:t[2]?r=!1:t[4]&&(n=parseInt(t[4])<18);var i={};i.pluginBuilder="./css-builder";var s,o=function(){s=document.createElement("style"),e.appendChild(s)},u=function(e,t){o();var n=s.styleSheet||s.sheet;if(n&&n.addImport)n.addImport(e),s.onload=t;else{s.textContent='@import "'+e+'";';var r=setInterval(function(){try{s.sheet.cssRules,clearInterval(r),t()}catch(e){}},10)}},a=function(t,n){var i=document.createElement("link");i.type="text/css",i.rel="stylesheet";if(r)i.onload=function(){i.onload=function(){},setTimeout(n,7)};else var s=setInterval(function(){for(var e=0;e<document.styleSheets.length;e++){var t=document.styleSheets[e];if(t.href==i.href)return clearInterval(s),n()}},10);i.href=t,e.appendChild(i)};return i.normalize=function(e,t){return e.substr(e.length-4,4)==".css"&&(e=e.substr(0,e.length-4)),t(e)},i.load=function(e,t,r,i){(n?u:a)(t.toUrl(e+".css"),r)},i}),define("lib-build/css!lib-app/bootstrap/css/bootstrap.min",[],function(){}),define("lib-build/css!storymaps/common/ui/Modal",[],function(){}),define("lib-build/css!storymaps/common/Core",[],function(){}),define("storymaps/common/utils/Polyfills",[],function(){return{apply:function(){typeof String.prototype.trim!="function"&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Date.now||(Date.now=function(){return(new Date).valueOf()}),Object.keys=Object.keys||function(e,t,n){n=[];for(t in e)n.hasOwnProperty.call(e,t)&&n.push(t);return n},function(){function n(e){this.message=e}var e=typeof exports!="undefined"?exports:this,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.prototype=new Error,n.prototype.name="InvalidCharacterError",e.btoa||(e.btoa=function(e){var r=String(e);for(var i,s,o=0,u=t,a="";r.charAt(o|0)||(u="=",o%1);a+=u.charAt(63&i>>8-o%1*8)){s=r.charCodeAt(o+=.75);if(s>255)throw new n("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");i=i<<8|s}return a}),e.atob||(e.atob=function(e){var r=String(e).replace(/=+$/,"");if(r.length%4==1)throw new n("'atob' failed: The string to be decoded is not correctly encoded.");for(var i=0,s,o,u=0,a="";o=r.charAt(u++);~o&&(s=i%4?s*64+o:o,i++%4)?a+=String.fromCharCode(255&s>>(-2*i&6)):0)o=t.indexOf(o);return a})}()}}}),define("storymaps/common/utils/CommonHelper",["dojo/cookie","dojo/has","esri/urlUtils","esri/arcgis/utils","esri/geometry/webMercatorUtils","esri/geometry/Point","esri/geometry/Extent","esri/geometry/Polygon","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/OpenStreetMapLayer"],function(e,t,n,r,i,s,o,u,a,f,l){return{isMobile:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)||navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/IEMobile/i)},switchToBuilder:function(){document.location.search.match(/appid/)?document.location=document.location.protocol+"//"+document.location.host+document.location.pathname+document.location.search+"&edit"+document.location.hash:document.location.search.slice(-1)=="?"?document.location=document.location.protocol+"//"+document.location.host+document.location.pathname+"edit"+document.location.hash:document.location=document.location.protocol+"//"+document.location.host+document.location.pathname+"?edit"+document.location.hash},isArcGISHosted:function(){return/(\/)([a-zA-Z0-9]+(\/))*(apps\/|home\/)([a-zA-Z0-9\-\_]+\/)/.test(document.location.pathname)},browserSupportHistory:function(){return!!window.history&&!!history.pushState},getUrlParams:function(){var e=n.urlToObject(document.location.search).query;return e?e:!this.browserSupportHistory()&&!e?n.urlToObject(document.location.hash).query||{}:{}},getWebmapID:function(e){var t=this.getUrlParams();if(app.indexCfg&&app.indexCfg.webmap)return app.indexCfg.webmap;if(this.isArcGISHosted()||!e)return t.webmap;if(app.indexCfg.authorizedOwners&&app.indexCfg.authorizedOwners.length>0&&app.indexCfg.authorizedOwners[0])return t.webmap},getAppID:function(e){var t=this.getUrlParams();if(app.indexCfg&&app.indexCfg.appid)return app.indexCfg.appid;if(this.isArcGISHosted()||!e)return t.appid;if(app.indexCfg.authorizedOwners&&app.indexCfg.authorizedOwners.length>0&&app.indexCfg.authorizedOwners[0])return t.appid},getGraphicsLayerByName:function(e,t){var n;for(var r=0;r<e.graphicsLayerIds.length;r++){n=e.getLayer(e.graphicsLayerIds[r]);if(n.name==t)return n}return null},getWebMapExtentFromItem:function(e){if(!e.extent||e.extent.length!=2)return null;var t=i.geographicToWebMercator(new s(e.extent[0][0],e.extent[0][1])),n=i.geographicToWebMercator(new s(e.extent[1][0],e.extent[1][1]));return new o({xmax:n.x,xmin:t.x,ymax:n.y,ymin:t.y,spatialReference:{wkid:102100}})},serializeExtentToItem:function(e){if(!e||!e.spatialReference)return null;var t=e.spatialReference.wkid==4326?e:i.webMercatorToGeographic(e);return[[Math.round(t.xmin*1e4)/1e4,Math.round(t.ymin*1e4)/1e4],[Math.round(t.xmax*1e4)/1e4,Math.round(t.ymax*1e4)/1e4]]},serializedExtentEquals:function(e,t){return e&&t&&e.length==t.length&&e.length==2&&e[0][0]==t[0][0]&&e[0][1]==t[0][1]&&e[1][0]==t[1][0]&&e[1][1]==t[1][1]},cloneLayer:function(e){return e.url&&e.url.match(/virtualearth\./)?new f("http://services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer"):e instanceof f?new f(e.url):e instanceof a?new a(e.url):e.id=="OpenStreetMap"?new l:new f("http://services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer")},extentToPolygon:function(e){var t=new u(e.spatialReference);return t.addRing([[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]),t},getFirstLevelWhereExtentFit:function(e,t){var n=t.width,r=t.height,i=t._params.lods;if(!i)return-1;for(var s=i.length-1;s>=0;s--)if(n*t._params.lods[s].resolution>e.getWidth()&&r*t._params.lods[s].resolution>e.getHeight())return s;return-1},getPortalUser:function(){var t=e("esri_auth");if(!t)return;t=JSON.parse(t.replace('"ssl":undefined','"ssl":""'));if(t.urlKey&&t.customBaseUrl&&(t.urlKey+"."+t.customBaseUrl).toLowerCase()!=document.location.hostname.toLowerCase())return;return t?t.email:null},getPortalRole:function(){var t=e("esri_auth");if(!t)return;t=JSON.parse(t.replace('"ssl":undefined','"ssl":""'));if(t.urlKey&&t.customBaseUrl&&(t.urlKey+"."+t.customBaseUrl).toLowerCase()!=document.location.hostname.toLowerCase())return;return t?t.role:null},getAppViewModeURL:function(){return document.location.protocol+"//"+document.location.host+document.location.pathname+"?appid="+app.data.getWebAppItem().id},getWebmapViewerLinkFromSharingURL:function(e){var t=e.split("/sharing/")[0];return t+"/home/webmap/viewer.html"},getPortalURL:function(){return r.arcgisUrl.split("/sharing/")[0]},getItemURL:function(e){return this.getPortalURL()+"/home/item.html?id="+e},getMyContentURL:function(){return this.getPortalURL()+"/home/content.html"},getMyStoriesURL:function(){return app.isPortal?this.getPortalURL()+"/apps/MyStories/":"//storymaps.arcgis.com/en/my-stories/"},browserSupportAttachementUsingFileReader:function(){return!!window.FileReader&&!!window.FormData&&!!this.browserSupportCanvas()&&!!window.Blob},browserSupportCanvas:function(){var e=document.createElement("canvas");return!!e.getContext&&!!e.getContext("2d")},browserSupportFileReaderBinaryString:function(){if(!window.FileReader)return!1;var e=new window.FileReader;return"readAsArrayBuffer"in e},getBinaryStringFromArrayBuffer:function(e){var t=new Uint8Array(e),n="";for(var r=0;r<t.length;r++)n+=String.fromCharCode(t[r]);return n},addCSSRule:function(e,n,r){var i="head";if(t("ie")<=8)return;r&&(i=r.contents().find("head"));if(n){var s=$(i).find("#"+n).eq(0);if(s.length){s.html(e);return}}$("<style>").prop("type","text/css").attr("id",n).html(e).appendTo(i)},hex2rgba:function(e,t){if(!e||e==="")return"";var n=e.replace("#","").match(/../g),r=[],i;for(i in n)r.push(parseInt(n[i],16));return r.push(t),"rgba("+r.join()+")"},prependURLHTTP:function(e){return!e||e===""||e.match(/^mailto:/)?e:/^(https?:\/\/)|^(\/\/)/i.test(e)?e:"http://"+e},checkImageURL:function(e){return e&&e.match(/((\.png)|(\.jp(e)?g))$/i)},createGeocoderOptions:function(){var e=!1,t=dojo.clone(app.indexCfg.geocodeServices);dojo.forEach(t,function(t){t.url.indexOf(".arcgis.com/arcgis/rest/services/World/GeocodeServer")>-1&&(e=!0,t.name="Esri World Geocoder",t.outFields="Match_addr, stAddr, City",t.singleLineFieldName="SingleLine",t.esri=t.placefinding=!0)}),t=dojo.filter(t,function(e){return esri.isDefined(e.singleLineFieldName)&&esri.isDefined(e.placefinding)&&e.placefinding});var n;if(e)for(var r=0;r<t.length;r++)if(esri.isDefined(t[r].esri)&&t[r].esri===!0){n=r;break}var i={autoNavigate:!0,autoComplete:e,theme:"simpleGeocoder"};return e&&(i.minCharacters=0,i.maxLocations=5,i.searchDelay=100),e&&n===0?(i.arcgisGeocoder=t.splice(0,1)[0],t.length>0&&(i.geocoders=t)):(i.arcgisGeocoder=!1,i.geocoders=t),i},debounce:function(e,t,n){var r;return function(){var i=this,s=arguments;clearTimeout(r),r=setTimeout(function(){r=null,n||e.apply(i,s)},t),n&&!r&&e.apply(i,s)}},findDifferences:function(e,t){var n=[],r=["this"];return function(e,t){if(e.constructor==Array)if(!t||t.constructor!=Array||t.length!=e.length)n.push({Property:r.join(""),ObjectA:e,ObjectB:t});else for(var i=0;i<e.length;i++)r.push("["+i.toString()+"]"),arguments.callee(e[i],t[i]),r.pop();else if(e.constructor==Object||e.constructor!=Number&&e.constructor!=String&&e.constructor!=Date&&e.constructor!=RegExp&&e.constructor!=Function&&e.constructor!=Boolean)for(var s in e)r.push("."+s),t[s]?e[s]&&e[s].constructor!=Function&&arguments.callee(e[s],t[s]):n.push({Property:r.join(""),ObjectA:e[s],ObjectB:null}),r.pop();else e.constructor!=Function&&e!=t&&n.push({Property:r.join(""),ObjectA:e,ObjectB:t})}(e,t),n}}}),define("storymaps/common/builder/PortalVersionTest",["esri/arcgis/utils","dojo/Deferred"],function(e,t){function n(){return e.arcgisUrl.split("/sharing/")[0]}return{run:function(){var e=new t,r=null;app.portal.hasMyStories=null;var i=new Image,s=app.isProduction?n()+"/apps/":"../";return i.src=s+"MyStories/assets/my-stories-portal-detector.png",i.onload=function(){app.portal.hasMyStories=!0,r&&clearTimeout(r),e.resolve()},i.onerror=i.onabort=function(){app.portal.hasMyStories=!1,r&&clearTimeout(r),e.reject()},r=setTimeout(function(){e.reject()},2e3),e}}}),define("storymaps/common/builder/MyStoriesWrapper",["./PortalVersionTest","esri/IdentityManager","storymaps/common/utils/CommonHelper","dojo/topic"],function(e,t,n,r){function i(){e.run().then(function(){app.isProduction&&!f()?s():o()},s)}function s(){$(".check-story").hide()}function o(){window.myStoriesInit=u,r.publish("MYSTORIES_SCAN","start");var e="../MyStories/index.html?fromBuilder";e+="&locale="+dojo.locale,setTimeout(function(){$("#my-stories-frame").attr("src",e)},1e3)}function u(){var e=$("#my-stories-frame")[0].contentWindow;if(!e||!e.init||!e.check||!e.share){console.error("Failed to load My Stories");return}if(!app.data.getStoryLength()){console.log("Skipping the initialization of My Stories until the story has content");return}app.mystories={init:e.init,check:e.check,share:e.share,isChecking:!1,hasCheckErrors:!1,hasScanErrors:!1},app.mystories.init(app.isInBuilder?t.toJson():null,app.isDirectCreationFirstSave||app.isGalleryCreation?null:app.data.getWebAppItem(),app.cfg.TPL_ID,function(e,t,n){r.publish("MY-STORIES-EDIT-MEDIA",{index:e,type:t,actionId:n})},function(e){r.publish("MY-STORIES-EDIT-MAP",{id:e})},function(){app.mystories.hasCheckErrors=!1,r.publish("MY-STORIES-REFRESH")},function(e){e=e||{completed:!1,ignoreAllIssues:!1},app.mystories.hasCheckErrors=!e.ignoreAllIssues,app.mystories.forcedIgnoreIssues=e.ignoreAllIssues,r.publish("MY-STORIES-REFRESH")}).then(a,function(){console.error("Failed to initialize My Stories")})}function a(){if(!app.mystories)return;app.mystories.isChecking=!0,app.mystories.hasCheckErrors=!1,r.publish("MYSTORIES_SCAN","start"),app.mystories.check(app.data.getWebAppData().get()).then(function(e){e=e||{ignoreAllIssues:!1},app.mystories.isChecking=!1,app.mystories.hasCheckErrors=!1,app.mystories.forcedIgnoreIssues=e.ignoreAllIssues,r.publish("MYSTORIES_SCAN","success"),$("#sharePopup").is(":visible")&&app.builder.openSharePopup()},function(e){e=e||{completed:!1,ignoreAllIssues:!1},app.mystories.isChecking=!1,app.mystories.hasCheckErrors=!0,app.mystories.forcedIgnoreIssues=e.ignoreAllIssues,r.publish("MYSTORIES_SCAN","error"),$("#sharePopup").is(":visible")&&app.builder.openSharePopup()})}function f(){var e=n.getPortalURL().split("//").slice(-1)[0],t=e.split("."),r=document.location.host,i=r.split(".");return e==r||e.split("/").length>1&&e.split("/")[0]==r?!0:i.length<3?r==e:i.slice(1).join(".")==t.slice(-2).join(".")}return{loadMyStories:i,scanStory:a,myStoriesIsSameDomain:f}});if("undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");+function(e){"use strict";var t=e.fn.jquery.split(" ")[0].split(".");if(t[0]<2&&t[1]<9||1==t[0]&&9==t[1]&&t[2]<1)throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher")}(jQuery),+function(e){"use strict";function t(t){var n=t.attr("data-target");n||(n=t.attr("href"),n=n&&/#[A-Za-z]/.test(n)&&n.replace(/.*(?=#[^\s]*$)/,""));var r=n&&e(n);return r&&r.length?r:t.parent()}function n(n){n&&3===n.which||(e(i).remove(),e(s).each(function(){var r=e(this),i=t(r),s={relatedTarget:this};i.hasClass("open")&&(n&&"click"==n.type&&/input|textarea/i.test(n.target.tagName)&&e.contains(i[0],n.target)||(i.trigger(n=e.Event("hide.bs.dropdown",s)),n.isDefaultPrevented()||(r.attr("aria-expanded","false"),i.removeClass("open").trigger("hidden.bs.dropdown",s))))}))}function r(t){return this.each(function(){var n=e(this),r=n.data("bs.dropdown");r||n.data("bs.dropdown",r=new o(this)),"string"==typeof t&&r[t].call(n)})}var i=".dropdown-backdrop",s='[data-toggle="dropdown"]',o=function(t){e(t).on("click.bs.dropdown",this.toggle)};o.VERSION="3.3.5",o.prototype.toggle=function(r){var i=e(this);if(!i.is(".disabled, :disabled")){var s=t(i),o=s.hasClass("open");if(n(),!o){"ontouchstart"in document.documentElement&&!s.closest(".navbar-nav").length&&e(document.createElement("div")).addClass("dropdown-backdrop").insertAfter(e(this)).on("click",n);var u={relatedTarget:this};if(s.trigger(r=e.Event("show.bs.dropdown",u)),r.isDefaultPrevented())return;i.trigger("focus").attr("aria-expanded","true"),s.toggleClass("open").trigger("shown.bs.dropdown",u)}return!1}},o.prototype.keydown=function(n){if(/(38|40|27|32)/.test(n.which)&&!/input|textarea/i.test(n.target.tagName)){var r=e(this);if(n.preventDefault(),n.stopPropagation(),!r.is(".disabled, :disabled")){var i=t(r),o=i.hasClass("open");if(!o&&27!=n.which||o&&27==n.which)return 27==n.which&&i.find(s).trigger("focus"),r.trigger("click");var u=" li:not(.disabled):visible a",a=i.find(".dropdown-menu"+u);if(a.length){var f=a.index(n.target);38==n.which&&f>0&&f--,40==n.which&&f<a.length-1&&f++,~f||(f=0),a.eq(f).trigger("focus")}}}};var u=e.fn.dropdown;e.fn.dropdown=r,e.fn.dropdown.Constructor=o,e.fn.dropdown.noConflict=function(){return e.fn.dropdown=u,this},e(document).on("click.bs.dropdown.data-api",n).on("click.bs.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.bs.dropdown.data-api",s,o.prototype.toggle).on("keydown.bs.dropdown.data-api",s,o.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",o.prototype.keydown)}(jQuery),+function(e){"use strict";function t(t,r){return this.each(function(){var s=e(this),u=s.data("bs.modal"),a=e.extend({},n.DEFAULTS,s.data(),"object"==typeof t&&t);u||s.data("bs.modal",u=new n(this,a)),"string"==typeof t?u[t](r):a.show&&u.show(r)})}var n=function(t,n){this.options=n,this.$body=e(document.body),this.$element=e(t),this.$dialog=this.$element.find(".modal-dialog"),this.$backdrop=null,this.isShown=null,this.originalBodyPad=null,this.scrollbarWidth=0,this.ignoreBackdropClick=!1,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,e.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};n.VERSION="3.3.5",n.TRANSITION_DURATION=300,n.BACKDROP_TRANSITION_DURATION=150,n.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},n.prototype.toggle=function(e){return this.isShown?this.hide():this.show(e)},n.prototype.show=function(t){var r=this,s=e.Event("show.bs.modal",{relatedTarget:t});this.$element.trigger(s),this.isShown||s.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',e.proxy(this.hide,this)),this.$dialog.on("mousedown.dismiss.bs.modal",function(){r.$element.one("mouseup.dismiss.bs.modal",function(t){e(t.target).is(r.$element)&&(r.ignoreBackdropClick=!0)})}),this.backdrop(function(){var s=e.support.transition&&r.$element.hasClass("fade");r.$element.parent().length||r.$element.appendTo(r.$body),r.$element.show().scrollTop(0),r.adjustDialog(),s&&r.$element[0].offsetWidth,r.$element.addClass("in"),r.enforceFocus();var u=e.Event("shown.bs.modal",{relatedTarget:t});s?r.$dialog.one("bsTransitionEnd",function(){r.$element.trigger("focus").trigger(u)}).emulateTransitionEnd(n.TRANSITION_DURATION):r.$element.trigger("focus").trigger(u)}))},n.prototype.hide=function(t){t&&t.preventDefault(),t=e.Event("hide.bs.modal"),this.$element.trigger(t),this.isShown&&!t.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),e(document).off("focusin.bs.modal"),this.$element.removeClass("in").off("click.dismiss.bs.modal").off("mouseup.dismiss.bs.modal"),this.$dialog.off("mousedown.dismiss.bs.modal"),e.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",e.proxy(this.hideModal,this)).emulateTransitionEnd(n.TRANSITION_DURATION):this.hideModal())},n.prototype.enforceFocus=function(){e(document).off("focusin.bs.modal").on("focusin.bs.modal",e.proxy(function(e){this.$element[0]===e.target||this.$element.has(e.target).length||this.$element.trigger("focus")},this))},n.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",e.proxy(function(e){27==e.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},n.prototype.resize=function(){this.isShown?e(window).on("resize.bs.modal",e.proxy(this.handleUpdate,this)):e(window).off("resize.bs.modal")},n.prototype.hideModal=function(){var e=this;this.$element.hide(),this.backdrop(function(){e.$body.removeClass("modal-open"),e.resetAdjustments(),e.resetScrollbar(),e.$element.trigger("hidden.bs.modal")})},n.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},n.prototype.backdrop=function(t){var r=this,s=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var o=e.support.transition&&s;if(this.$backdrop=e(document.createElement("div")).addClass("modal-backdrop "+s).appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",e.proxy(function(e){return this.ignoreBackdropClick?void (this.ignoreBackdropClick=!1):void (e.target===e.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus():this.hide()))},this)),o&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!t)return;o?this.$backdrop.one("bsTransitionEnd",t).emulateTransitionEnd(n.BACKDROP_TRANSITION_DURATION):t()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var u=function(){r.removeBackdrop(),t&&t()};e.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",u).emulateTransitionEnd(n.BACKDROP_TRANSITION_DURATION):u()}else t&&t()},n.prototype.handleUpdate=function(){this.adjustDialog()},n.prototype.adjustDialog=function(){var e=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&e?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!e?this.scrollbarWidth:""})},n.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},n.prototype.checkScrollbar=function(){var e=window.innerWidth;if(!e){var t=document.documentElement.getBoundingClientRect();e=t.right-Math.abs(t.left)}this.bodyIsOverflowing=document.body.clientWidth<e,this.scrollbarWidth=this.measureScrollbar()},n.prototype.setScrollbar=function(){var e=parseInt(this.$body.css("padding-right")||0,10);this.originalBodyPad=document.body.style.paddingRight||"",this.bodyIsOverflowing&&this.$body.css("padding-right",e+this.scrollbarWidth)},n.prototype.resetScrollbar=function(){this.$body.css("padding-right",this.originalBodyPad)},n.prototype.measureScrollbar=function(){var e=document.createElement("div");e.className="modal-scrollbar-measure",this.$body.append(e);var t=e.offsetWidth-e.clientWidth;return this.$body[0].removeChild(e),t};var r=e.fn.modal;e.fn.modal=t,e.fn.modal.Constructor=n,e.fn.modal.noConflict=function(){return e.fn.modal=r,this},e(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(n){var r=e(this),i=r.attr("href"),s=e(r.attr("data-target")||i&&i.replace(/.*(?=#[^\s]+$)/,"")),o=s.data("bs.modal")?"toggle":e.extend({remote:!/#/.test(i)&&i},s.data(),r.data());r.is("a")&&n.preventDefault(),s.one("show.bs.modal",function(e){e.isDefaultPrevented()||s.one("hidden.bs.modal",function(){r.is(":visible")&&r.trigger("focus")})}),t.call(s,o,this)})}(jQuery),+function(e){"use strict";function t(t){return this.each(function(){var r=e(this),s=r.data("bs.tooltip"),o="object"==typeof t&&t;(s||!/destroy|hide/.test(t))&&(s||r.data("bs.tooltip",s=new n(this,o)),"string"==typeof t&&s[t]())})}var n=function(e,t){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.inState=null,this.init("tooltip",e,t)};n.VERSION="3.3.5",n.TRANSITION_DURATION=150,n.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},n.prototype.init=function(t,n,r){if(this.enabled=!0,this.type=t,this.$element=e(n),this.options=this.getOptions(r),this.$viewport=this.options.viewport&&e(e.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport),this.inState={click:!1,hover:!1,focus:!1},this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!");for(var i=this.options.trigger.split(" "),s=i.length;s--;){var o=i[s];if("click"==o)this.$element.on("click."+this.type,this.options.selector,e.proxy(this.toggle,this));else if("manual"!=o){var u="hover"==o?"mouseenter":"focusin",a="hover"==o?"mouseleave":"focusout";this.$element.on(u+"."+this.type,this.options.selector,e.proxy(this.enter,this)),this.$element.on(a+"."+this.type,this.options.selector,e.proxy(this.leave,this))}}this.options.selector?this._options=e.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},n.prototype.getDefaults=function(){return n.DEFAULTS},n.prototype.getOptions=function(t){return t=e.extend({},this.getDefaults(),this.$element.data(),t),t.delay&&"number"==typeof t.delay&&(t.delay={show:t.delay,hide:t.delay}),t},n.prototype.getDelegateOptions=function(){var t={},n=this.getDefaults();return this._options&&e.each(this._options,function(e,r){n[e]!=r&&(t[e]=r)}),t},n.prototype.enter=function(t){var n=t instanceof this.constructor?t:e(t.currentTarget).data("bs."+this.type);return n||(n=new this.constructor(t.currentTarget,this.getDelegateOptions()),e(t.currentTarget).data("bs."+this.type,n)),t instanceof e.Event&&(n.inState["focusin"==t.type?"focus":"hover"]=!0),n.tip().hasClass("in")||"in"==n.hoverState?void (n.hoverState="in"):(clearTimeout(n.timeout),n.hoverState="in",n.options.delay&&n.options.delay.show?void (n.timeout=setTimeout(function(){"in"==n.hoverState&&n.show()},n.options.delay.show)):n.show())},n.prototype.isInStateTrue=function(){for(var e in this.inState)if(this.inState[e])return!0;return!1},n.prototype.leave=function(t){var n=t instanceof this.constructor?t:e(t.currentTarget).data("bs."+this.type);return n||(n=new this.constructor(t.currentTarget,this.getDelegateOptions()),e(t.currentTarget).data("bs."+this.type,n)),t instanceof e.Event&&(n.inState["focusout"==t.type?"focus":"hover"]=!1),n.isInStateTrue()?void 0:(clearTimeout(n.timeout),n.hoverState="out",n.options.delay&&n.options.delay.hide?void (n.timeout=setTimeout(function(){"out"==n.hoverState&&n.hide()},n.options.delay.hide)):n.hide())},n.prototype.show=function(){var t=e.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(t);var r=e.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(t.isDefaultPrevented()||!r)return;var s=this,o=this.tip(),u=this.getUID(this.type);this.setContent(),o.attr("id",u),this.$element.attr("aria-describedby",u),this.options.animation&&o.addClass("fade");var a="function"==typeof this.options.placement?this.options.placement.call(this,o[0],this.$element[0]):this.options.placement,f=/\s?auto?\s?/i,l=f.test(a);l&&(a=a.replace(f,"")||"top"),o.detach().css({top:0,left:0,display:"block"}).addClass(a).data("bs."+this.type,this),this.options.container?o.appendTo(this.options.container):o.insertAfter(this.$element),this.$element.trigger("inserted.bs."+this.type);var c=this.getPosition(),h=o[0].offsetWidth,p=o[0].offsetHeight;if(l){var d=a,v=this.getPosition(this.$viewport);a="bottom"==a&&c.bottom+p>v.bottom?"top":"top"==a&&c.top-p<v.top?"bottom":"right"==a&&c.right+h>v.width?"left":"left"==a&&c.left-h<v.left?"right":a,o.removeClass(d).addClass(a)}var m=this.getCalculatedOffset(a,c,h,p);this.applyPlacement(m,a);var g=function(){var e=s.hoverState;s.$element.trigger("shown.bs."+s.type),s.hoverState=null,"out"==e&&s.leave(s)};e.support.transition&&this.$tip.hasClass("fade")?o.one("bsTransitionEnd",g).emulateTransitionEnd(n.TRANSITION_DURATION):g()}},n.prototype.applyPlacement=function(t,n){var r=this.tip(),i=r[0].offsetWidth,s=r[0].offsetHeight,o=parseInt(r.css("margin-top"),10),u=parseInt(r.css("margin-left"),10);isNaN(o)&&(o=0),isNaN(u)&&(u=0),t.top+=o,t.left+=u,e.offset.setOffset(r[0],e.extend({using:function(e){r.css({top:Math.round(e.top),left:Math.round(e.left)})}},t),0),r.addClass("in");var a=r[0].offsetWidth,f=r[0].offsetHeight;"top"==n&&f!=s&&(t.top=t.top+s-f);var l=this.getViewportAdjustedDelta(n,t,a,f);l.left?t.left+=l.left:t.top+=l.top;var c=/top|bottom/.test(n),h=c?2*l.left-i+a:2*l.top-s+f,p=c?"offsetWidth":"offsetHeight";r.offset(t),this.replaceArrow(h,r[0][p],c)},n.prototype.replaceArrow=function(e,t,n){this.arrow().css(n?"left":"top",50*(1-e/t)+"%").css(n?"top":"left","")},n.prototype.setContent=function(){var e=this.tip(),t=this.getTitle();e.find(".tooltip-inner")[this.options.html?"html":"text"](t),e.removeClass("fade in top bottom left right")},n.prototype.hide=function(t){function r(){"in"!=s.hoverState&&o.detach(),s.$element.removeAttr("aria-describedby").trigger("hidden.bs."+s.type),t&&t()}var s=this,o=e(this.$tip),u=e.Event("hide.bs."+this.type);return this.$element.trigger(u),u.isDefaultPrevented()?void 0:(o.removeClass("in"),e.support.transition&&o.hasClass("fade")?o.one("bsTransitionEnd",r).emulateTransitionEnd(n.TRANSITION_DURATION):r(),this.hoverState=null,this)},n.prototype.fixTitle=function(){var e=this.$element;(e.attr("title")||"string"!=typeof e.attr("data-original-title"))&&e.attr("data-original-title",e.attr("title")||"").attr("title","")},n.prototype.hasContent=function(){return this.getTitle()},n.prototype.getPosition=function(t){t=t||this.$element;var n=t[0],r="BODY"==n.tagName,i=n.getBoundingClientRect();null==i.width&&(i=e.extend({},i,{width:i.right-i.left,height:i.bottom-i.top}));var s=r?{top:0,left:0}:t.offset(),o={scroll:r?document.documentElement.scrollTop||document.body.scrollTop:t.scrollTop()},u=r?{width:e(window).width(),height:e(window).height()}:null;return e.extend({},i,o,u,s)},n.prototype.getCalculatedOffset=function(e,t,n,r){return"bottom"==e?{top:t.top+t.height,left:t.left+t.width/2-n/2}:"top"==e?{top:t.top-r,left:t.left+t.width/2-n/2}:"left"==e?{top:t.top+t.height/2-r/2,left:t.left-n}:{top:t.top+t.height/2-r/2,left:t.left+t.width}},n.prototype.getViewportAdjustedDelta=function(e,t,n,r){var i={top:0,left:0};if(!this.$viewport)return i;var s=this.options.viewport&&this.options.viewport.padding||0,o=this.getPosition(this.$viewport);if(/right|left/.test(e)){var u=t.top-s-o.scroll,a=t.top+s-o.scroll+r;u<o.top?i.top=o.top-u:a>o.top+o.height&&(i.top=o.top+o.height-a)}else{var f=t.left-s,l=t.left+s+n;f<o.left?i.left=o.left-f:l>o.right&&(i.left=o.left+o.width-l)}return i},n.prototype.getTitle=function(){var e,t=this.$element,n=this.options;return e=t.attr("data-original-title")||("function"==typeof n.title?n.title.call(t[0]):n.title)},n.prototype.getUID=function(e){do e+=~~(1e6*Math.random());while(document.getElementById(e));return e},n.prototype.tip=function(){if(!this.$tip&&(this.$tip=e(this.options.template),1!=this.$tip.length))throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!");return this.$tip},n.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},n.prototype.enable=function(){this.enabled=!0},n.prototype.disable=function(){this.enabled=!1},n.prototype.toggleEnabled=function(){this.enabled=!this.enabled},n.prototype.toggle=function(t){var n=this;t&&(n=e(t.currentTarget).data("bs."+this.type),n||(n=new this.constructor(t.currentTarget,this.getDelegateOptions()),e(t.currentTarget).data("bs."+this.type,n))),t?(n.inState.click=!n.inState.click,n.isInStateTrue()?n.enter(n):n.leave(n)):n.tip().hasClass("in")?n.leave(n):n.enter(n)},n.prototype.destroy=function(){var e=this;clearTimeout(this.timeout),this.hide(function(){e.$element.off("."+e.type).removeData("bs."+e.type),e.$tip&&e.$tip.detach(),e.$tip=null,e.$arrow=null,e.$viewport=null})};var r=e.fn.tooltip;e.fn.tooltip=t,e.fn.tooltip.Constructor=n,e.fn.tooltip.noConflict=function(){return e.fn.tooltip=r,this}}(jQuery),+function(e){"use strict";function t(t){return this.each(function(){var r=e(this),s=r.data("bs.popover"),o="object"==typeof t&&t;(s||!/destroy|hide/.test(t))&&(s||r.data("bs.popover",s=new n(this,o)),"string"==typeof t&&s[t]())})}var n=function(e,t){this.init("popover",e,t)};if(!e.fn.tooltip)throw new Error("Popover requires tooltip.js");n.VERSION="3.3.5",n.DEFAULTS=e.extend({},e.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),n.prototype=e.extend({},e.fn.tooltip.Constructor.prototype),n.prototype.constructor=n,n.prototype.getDefaults=function(){return n.DEFAULTS},n.prototype.setContent=function(){var e=this.tip(),t=this.getTitle(),n=this.getContent();e.find(".popover-title")[this.options.html?"html":"text"](t),e.find(".popover-content").children().detach().end()[this.options.html?"string"==typeof n?"html":"append":"text"](n),e.removeClass("fade top bottom left right in"),e.find(".popover-title").html()||e.find(".popover-title").hide()},n.prototype.hasContent=function(){return this.getTitle()||this.getContent()},n.prototype.getContent=function(){var e=this.$element,t=this.options;return e.attr("data-content")||("function"==typeof t.content?t.content.call(e[0]):t.content)},n.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")};var r=e.fn.popover;e.fn.popover=t,e.fn.popover.Constructor=n,e.fn.popover.noConflict=function(){return e.fn.popover=r,this}}(jQuery),+function(e){"use strict";function t(t){return this.each(function(){var r=e(this),i=r.data("bs.tab");i||r.data("bs.tab",i=new n(this)),"string"==typeof t&&i[t]()})}var n=function(t){this.element=e(t)};n.VERSION="3.3.5",n.TRANSITION_DURATION=150,n.prototype.show=function(){var t=this.element,n=t.closest("ul:not(.dropdown-menu)"),r=t.data("target");if(r||(r=t.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,"")),!t.parent("li").hasClass("active")){var i=n.find(".active:last a"),s=e.Event("hide.bs.tab",{relatedTarget:t[0]}),o=e.Event("show.bs.tab",{relatedTarget:i[0]});if(i.trigger(s),t.trigger(o),!o.isDefaultPrevented()&&!s.isDefaultPrevented()){var u=e(r);this.activate(t.closest("li"),n),this.activate(u,u.parent(),function(){i.trigger({type:"hidden.bs.tab",relatedTarget:t[0]}),t.trigger({type:"shown.bs.tab",relatedTarget:i[0]})})}}},n.prototype.activate=function(t,r,i){function s(){o.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!1),t.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",!0),u?(t[0].offsetWidth,t.addClass("in")):t.removeClass("fade"),t.parent(".dropdown-menu").length&&t.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!0),i&&i()}var o=r.find("> .active"),u=i&&e.support.transition&&(o.length&&o.hasClass("fade")||!!r.find("> .fade").length);o.length&&u?o.one("bsTransitionEnd",s).emulateTransitionEnd(n.TRANSITION_DURATION):s(),o.removeClass("in")};var r=e.fn.tab;e.fn.tab=t,e.fn.tab.Constructor=n,e.fn.tab.noConflict=function(){return e.fn.tab=r,this};var i=function(n){n.preventDefault(),t.call(e(this),"show")};e(document).on("click.bs.tab.data-api",'[data-toggle="tab"]',i).on("click.bs.tab.data-api",'[data-toggle="pill"]',i)}(jQuery),+function(e){"use strict";function t(t){var n,r=t.attr("data-target")||(n=t.attr("href"))&&n.replace(/.*(?=#[^\s]+$)/,"");return e(r)}function n(t){return this.each(function(){var n=e(this),i=n.data("bs.collapse"),s=e.extend({},r.DEFAULTS,n.data(),"object"==typeof t&&t);!i&&s.toggle&&/show|hide/.test(t)&&(s.toggle=!1),i||n.data("bs.collapse",i=new r(this,s)),"string"==typeof t&&i[t]()})}var r=function(t,n){this.$element=e(t),this.options=e.extend({},r.DEFAULTS,n),this.$trigger=e('[data-toggle="collapse"][href="#'+t.id+'"],[data-toggle="collapse"][data-target="#'+t.id+'"]'),this.transitioning=null,this.options.parent?this.$parent=this.getParent():this.addAriaAndCollapsedClass(this.$element,this.$trigger),this.options.toggle&&this.toggle()};r.VERSION="3.3.5",r.TRANSITION_DURATION=350,r.DEFAULTS={toggle:!0},r.prototype.dimension=function(){var e=this.$element.hasClass("width");return e?"width":"height"},r.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var t,i=this.$parent&&this.$parent.children(".panel").children(".in, .collapsing");if(!(i&&i.length&&(t=i.data("bs.collapse"),t&&t.transitioning))){var s=e.Event("show.bs.collapse");if(this.$element.trigger(s),!s.isDefaultPrevented()){i&&i.length&&(n.call(i,"hide"),t||i.data("bs.collapse",null));var u=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[u](0).attr("aria-expanded",!0),this.$trigger.removeClass("collapsed").attr("aria-expanded",!0),this.transitioning=1;var a=function(){this.$element.removeClass("collapsing").addClass("collapse in")[u](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!e.support.transition)return a.call(this);var f=e.camelCase(["scroll",u].join("-"));this.$element.one("bsTransitionEnd",e.proxy(a,this)).emulateTransitionEnd(r.TRANSITION_DURATION)[u](this.$element[0][f])}}}},r.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var t=e.Event("hide.bs.collapse");if(this.$element.trigger(t),!t.isDefaultPrevented()){var n=this.dimension();this.$element[n](this.$element[n]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded",!1),this.$trigger.addClass("collapsed").attr("aria-expanded",!1),this.transitioning=1;var i=function(){this.transitioning=0,this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")};return e.support.transition?void this.$element[n](0).one("bsTransitionEnd",e.proxy(i,this)).emulateTransitionEnd(r.TRANSITION_DURATION):i.call(this)}}},r.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()},r.prototype.getParent=function(){return e(this.options.parent).find('[data-toggle="collapse"][data-parent="'+this.options.parent+'"]').each(e.proxy(function(n,r){var i=e(r);this.addAriaAndCollapsedClass(t(i),i)},this)).end()},r.prototype.addAriaAndCollapsedClass=function(e,t){var n=e.hasClass("in");e.attr("aria-expanded",n),t.toggleClass("collapsed",!n).attr("aria-expanded",n)};var i=e.fn.collapse;e.fn.collapse=n,e.fn.collapse.Constructor=r,e.fn.collapse.noConflict=function(){return e.fn.collapse=i,this},e(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(r){var i=e(this);i.attr("data-target")||r.preventDefault();var s=t(i),o=s.data("bs.collapse"),u=o?"toggle":i.data();n.call(s,u)})}(jQuery),+function(e){"use strict";function t(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var n in t)if(void 0!==e.style[n])return{end:t[n]};return!1}e.fn.emulateTransitionEnd=function(t){var n=!1,r=this;e(this).one("bsTransitionEnd",function(){n=!0});var i=function(){n||e(r).trigger(e.support.transition.end)};return setTimeout(i,t),this},e(function(){e.support.transition=t(),e.support.transition&&(e.event.special.bsTransitionEnd={bindType:e.support.transition.end,delegateType:e.support.transition.end,handle:function(t){return e(t.target).is(this)?t.handleObj.handler.apply(this,arguments):void 0}})})}(jQuery),define("lib-app/bootstrap/js/bootstrap.min",function(){}),typeof JSON!="object"&&(JSON={}),function(){"use strict";function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a&&typeof a=="object"&&typeof a.toJSON=="function"&&(a=a.toJSON(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1)u[n]=str(n,a)||"null";return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1)typeof rep[n]=="string"&&(r=rep[n],i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(e,t){"use strict";var n=e.History=e.History||{};if(typeof n.Adapter!="undefined")throw new Error("History.js Adapter has already been loaded...");n.Adapter={handlers:{},_uid:1,uid:function(e){return e._uid||(e._uid=n.Adapter._uid++)},bind:function(e,t,r){var i=n.Adapter.uid(e);n.Adapter.handlers[i]=n.Adapter.handlers[i]||{},n.Adapter.handlers[i][t]=n.Adapter.handlers[i][t]||[],n.Adapter.handlers[i][t].push(r),e["on"+t]=function(e,t){return function(r){n.Adapter.trigger(e,t,r)}}(e,t)},trigger:function(e,t,r){r=r||{};var i=n.Adapter.uid(e),s,o;n.Adapter.handlers[i]=n.Adapter.handlers[i]||{},n.Adapter.handlers[i][t]=n.Adapter.handlers[i][t]||[];for(s=0,o=n.Adapter.handlers[i][t].length;s<o;++s)n.Adapter.handlers[i][t][s].apply(this,[r])},extractEventData:function(e,n){var r=n&&n[e]||t;return r},onDomLoad:function(t){var n=e.setTimeout(function(){t()},2e3);e.onload=function(){clearTimeout(n),t()}}},typeof n.init!="undefined"&&n.init()}(window),function(e,t){"use strict";var n=e.document,r=e.setTimeout||r,i=e.clearTimeout||i,s=e.setInterval||s,o=e.History=e.History||{};if(typeof o.initHtml4!="undefined")throw new Error("History.js HTML4 Support has already been loaded...");o.initHtml4=function(){if(typeof o.initHtml4.initialized!="undefined")return!1;o.initHtml4.initialized=!0,o.enabled=!0,o.savedHashes=[],o.isLastHash=function(e){var t=o.getHashByIndex(),n;return n=e===t,n},o.isHashEqual=function(e,t){return e=encodeURIComponent(e).replace(/%25/g,"%"),t=encodeURIComponent(t).replace(/%25/g,"%"),e===t},o.saveHash=function(e){return o.isLastHash(e)?!1:(o.savedHashes.push(e),!0)},o.getHashByIndex=function(e){var t=null;return typeof e=="undefined"?t=o.savedHashes[o.savedHashes.length-1]:e<0?t=o.savedHashes[o.savedHashes.length+e]:t=o.savedHashes[e],t},o.discardedHashes={},o.discardedStates={},o.discardState=function(e,t,n){var r=o.getHashByState(e),i;return i={discardedState:e,backState:n,forwardState:t},o.discardedStates[r]=i,!0},o.discardHash=function(e,t,n){var r={discardedHash:e,backState:n,forwardState:t};return o.discardedHashes[e]=r,!0},o.discardedState=function(e){var t=o.getHashByState(e),n;return n=o.discardedStates[t]||!1,n},o.discardedHash=function(e){var t=o.discardedHashes[e]||!1;return t},o.recycleState=function(e){var t=o.getHashByState(e);return o.discardedState(e)&&delete o.discardedStates[t],!0},o.emulated.hashChange&&(o.hashChangeInit=function(){o.checkerFunction=null;var t="",r,i,u,a,f=Boolean(o.getHash());return o.isInternetExplorer()?(r="historyjs-iframe",i=n.createElement("iframe"),i.setAttribute("id",r),i.setAttribute("src","#"),i.style.display="none",n.body.appendChild(i),i.contentWindow.document.open(),i.contentWindow.document.close(),u="",a=!1,o.checkerFunction=function(){if(a)return!1;a=!0;var n=o.getHash(),r=o.getHash(i.contentWindow.document);return n!==t?(t=n,r!==n&&(u=r=n,i.contentWindow.document.open(),i.contentWindow.document.close(),i.contentWindow.document.location.hash=o.escapeHash(n)),o.Adapter.trigger(e,"hashchange")):r!==u&&(u=r,f&&r===""?o.back():o.setHash(r,!1)),a=!1,!0}):o.checkerFunction=function(){var n=o.getHash()||"";return n!==t&&(t=n,o.Adapter.trigger(e,"hashchange")),!0},o.intervalList.push(s(o.checkerFunction,o.options.hashChangeInterval)),!0},o.Adapter.onDomLoad(o.hashChangeInit)),o.emulated.pushState&&(o.onHashChange=function(t){var n=t&&t.newURL||o.getLocationHref(),r=o.getHashByUrl(n),i=null,s=null,u=null,a;return o.isLastHash(r)?(o.busy(!1),!1):(o.doubleCheckComplete(),o.saveHash(r),r&&o.isTraditionalAnchor(r)?(o.Adapter.trigger(e,"anchorchange"),o.busy(!1),!1):(i=o.extractState(o.getFullUrl(r||o.getLocationHref()),!0),o.isLastSavedState(i)?(o.busy(!1),!1):(s=o.getHashByState(i),a=o.discardedState(i),a?(o.getHashByIndex(-2)===o.getHashByState(a.forwardState)?o.back(!1):o.forward(!1),!1):(o.pushState(i.data,i.title,encodeURI(i.url),!1),!0))))},o.Adapter.bind(e,"hashchange",o.onHashChange),o.pushState=function(t,n,r,i){r=encodeURI(r).replace(/%25/g,"%");if(o.getHashByUrl(r))throw new Error("History.js does not support states with fragment-identifiers (hashes/anchors).");if(i!==!1&&o.busy())return o.pushQueue({scope:o,callback:o.pushState,args:arguments,queue:i}),!1;o.busy(!0);var s=o.createStateObject(t,n,r),u=o.getHashByState(s),a=o.getState(!1),f=o.getHashByState(a),l=o.getHash(),c=o.expectedStateId==s.id;return o.storeState(s),o.expectedStateId=s.id,o.recycleState(s),o.setTitle(s),u===f?(o.busy(!1),!1):(o.saveState(s),c||o.Adapter.trigger(e,"statechange"),!o.isHashEqual(u,l)&&!o.isHashEqual(u,o.getShortUrl(o.getLocationHref()))&&o.setHash(u,!1),o.busy(!1),!0)},o.replaceState=function(t,n,r,i){r=encodeURI(r).replace(/%25/g,"%");if(o.getHashByUrl(r))throw new Error("History.js does not support states with fragment-identifiers (hashes/anchors).");if(i!==!1&&o.busy())return o.pushQueue({scope:o,callback:o.replaceState,args:arguments,queue:i}),!1;o.busy(!0);var s=o.createStateObject(t,n,r),u=o.getHashByState(s),a=o.getState(!1),f=o.getHashByState(a),l=o.getStateByIndex(-2);return o.discardState(a,s,l),u===f?(o.storeState(s),o.expectedStateId=s.id,o.recycleState(s),o.setTitle(s),o.saveState(s),o.Adapter.trigger(e,"statechange"),o.busy(!1)):o.pushState(s.data,s.title,s.url,!1),!0}),o.emulated.pushState&&o.getHash()&&!o.emulated.hashChange&&o.Adapter.onDomLoad(function(){o.Adapter.trigger(e,"hashchange")})},typeof o.init!="undefined"&&o.init()}(window),function(e,t){"use strict";var n=e.console||t,r=e.document,i=e.navigator,s=!1,o=e.setTimeout,u=e.clearTimeout,a=e.setInterval,f=e.clearInterval,l=e.JSON,c=e.alert,h=e.History=e.History||{},p=e.history;try{s=e.sessionStorage,s.setItem("TEST","1"),s.removeItem("TEST")}catch(d){s=!1}l.stringify=l.stringify||l.encode,l.parse=l.parse||l.decode;if(typeof h.init!="undefined")throw new Error("History.js Core has already been loaded...");h.init=function(e){return typeof h.Adapter=="undefined"?!1:(typeof h.initCore!="undefined"&&h.initCore(),typeof h.initHtml4!="undefined"&&h.initHtml4(),!0)},h.initCore=function(d){if(typeof h.initCore.initialized!="undefined")return!1;h.initCore.initialized=!0,h.options=h.options||{},h.options.hashChangeInterval=h.options.hashChangeInterval||100,h.options.safariPollInterval=h.options.safariPollInterval||500,h.options.doubleCheckInterval=h.options.doubleCheckInterval||500,h.options.disableSuid=h.options.disableSuid||!1,h.options.storeInterval=h.options.storeInterval||1e3,h.options.busyDelay=h.options.busyDelay||250,h.options.debug=h.options.debug||!1,h.options.initialTitle=h.options.initialTitle||r.title,h.options.html4Mode=h.options.html4Mode||!1,h.options.delayInit=h.options.delayInit||!1,h.intervalList=[],h.clearAllIntervals=function(){var e,t=h.intervalList;if(typeof t!="undefined"&&t!==null){for(e=0;e<t.length;e++)f(t[e]);h.intervalList=null}},h.debug=function(){(h.options.debug||!1)&&h.log.apply(h,arguments)},h.log=function(){var e=typeof n!="undefined"&&typeof n.log!="undefined"&&typeof n.log.apply!="undefined",t=r.getElementById("log"),i,s,o,u,a;e?(u=Array.prototype.slice.call(arguments),i=u.shift(),typeof n.debug!="undefined"?n.debug.apply(n,[i,u]):n.log.apply(n,[i,u])):i="\n"+arguments[0]+"\n";for(s=1,o=arguments.length;s<o;++s){a=arguments[s];if(typeof a=="object"&&typeof l!="undefined")try{a=l.stringify(a)}catch(f){}i+="\n"+a+"\n"}return t?(t.value+=i+"\n-----\n",t.scrollTop=t.scrollHeight-t.clientHeight):e||c(i),!0},h.getInternetExplorerMajorVersion=function(){var e=h.getInternetExplorerMajorVersion.cached=typeof h.getInternetExplorerMajorVersion.cached!="undefined"?h.getInternetExplorerMajorVersion.cached:function(){var e=3,t=r.createElement("div"),n=t.getElementsByTagName("i");while((t.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->")&&n[0]);return e>4?e:!1}();return e},h.isInternetExplorer=function(){var e=h.isInternetExplorer.cached=typeof h.isInternetExplorer.cached!="undefined"?h.isInternetExplorer.cached:Boolean(h.getInternetExplorerMajorVersion());return e},h.options.html4Mode?h.emulated={pushState:!0,hashChange:!0}:h.emulated={pushState:!Boolean(e.history&&e.history.pushState&&e.history.replaceState&&!/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i.test(i.userAgent)&&!/AppleWebKit\/5([0-2]|3[0-2])/i.test(i.userAgent)),hashChange:Boolean(!("onhashchange"in e||"onhashchange"in r)||h.isInternetExplorer()&&h.getInternetExplorerMajorVersion()<8)},h.enabled=!h.emulated.pushState,h.bugs={setHash:Boolean(!h.emulated.pushState&&i.vendor==="Apple Computer, Inc."&&/AppleWebKit\/5([0-2]|3[0-3])/.test(i.userAgent)),safariPoll:Boolean(!h.emulated.pushState&&i.vendor==="Apple Computer, Inc."&&/AppleWebKit\/5([0-2]|3[0-3])/.test(i.userAgent)),ieDoubleCheck:Boolean(h.isInternetExplorer()&&h.getInternetExplorerMajorVersion()<8),hashEscape:Boolean(h.isInternetExplorer()&&h.getInternetExplorerMajorVersion()<7)},h.isEmptyObject=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},h.cloneObject=function(e){var t,n;return e?(t=l.stringify(e),n=l.parse(t)):n={},n},h.getRootUrl=function(){var e=r.location.protocol+"//"+(r.location.hostname||r.location.host);if(r.location.port||!1)e+=":"+r.location.port;return e+="/",e},h.getBaseHref=function(){var e=r.getElementsByTagName("base"),t=null,n="";return e.length===1&&(t=e[0],n=t.href.replace(/[^\/]+$/,"")),n=n.replace(/\/+$/,""),n&&(n+="/"),n},h.getBaseUrl=function(){var e=h.getBaseHref()||h.getBasePageUrl()||h.getRootUrl();return e},h.getPageUrl=function(){var e=h.getState(!1,!1),t=(e||{}).url||h.getLocationHref(),n;return n=t.replace(/\/+$/,"").replace(/[^\/]+$/,function(e,t,n){return/\./.test(e)?e:e+"/"}),n},h.getBasePageUrl=function(){var e=h.getLocationHref().replace(/[#\?].*/,"").replace(/[^\/]+$/,function(e,t,n){return/[^\/]$/.test(e)?"":e}).replace(/\/+$/,"")+"/";return e},h.getFullUrl=function(e,t){var n=e,r=e.substring(0,1);return t=typeof t=="undefined"?!0:t,/[a-z]+\:\/\//.test(e)||(r==="/"?n=h.getRootUrl()+e.replace(/^\/+/,""):r==="#"?n=h.getPageUrl().replace(/#.*/,"")+e:r==="?"?n=h.getPageUrl().replace(/[\?#].*/,"")+e:t?n=h.getBaseUrl()+e.replace(/^(\.\/)+/,""):n=h.getBasePageUrl()+e.replace(/^(\.\/)+/,"")),n.replace(/\#$/,"")},h.getShortUrl=function(e){var t=e,n=h.getBaseUrl(),r=h.getRootUrl();return h.emulated.pushState&&(t=t.replace(n,"")),t=t.replace(r,"/"),h.isTraditionalAnchor(t)&&(t="./"+t),t=t.replace(/^(\.\/)+/g,"./").replace(/\#$/,""),t},h.getLocationHref=function(e){return e=e||r,e.URL===e.location.href?e.location.href:e.location.href===decodeURIComponent(e.URL)?e.URL:e.location.hash&&decodeURIComponent(e.location.href.replace(/^[^#]+/,""))===e.location.hash?e.location.href:e.URL.indexOf("#")==-1&&e.location.href.indexOf("#")!=-1?e.location.href:e.URL||e.location.href},h.store={},h.idToState=h.idToState||{},h.stateToId=h.stateToId||{},h.urlToId=h.urlToId||{},h.storedStates=h.storedStates||[],h.savedStates=h.savedStates||[],h.normalizeStore=function(){h.store.idToState=h.store.idToState||{},h.store.urlToId=h.store.urlToId||{},h.store.stateToId=h.store.stateToId||{}},h.getState=function(e,t){typeof e=="undefined"&&(e=!0),typeof t=="undefined"&&(t=!0);var n=h.getLastSavedState();return!n&&t&&(n=h.createStateObject()),e&&(n=h.cloneObject(n),n.url=n.cleanUrl||n.url),n},h.getIdByState=function(e){var t=h.extractId(e.url),n;if(!t){n=h.getStateString(e);if(typeof h.stateToId[n]!="undefined")t=h.stateToId[n];else if(typeof h.store.stateToId[n]!="undefined")t=h.store.stateToId[n];else{for(;;){t=(new Date).getTime()+String(Math.random()).replace(/\D/g,"");if(typeof h.idToState[t]=="undefined"&&typeof h.store.idToState[t]=="undefined")break}h.stateToId[n]=t,h.idToState[t]=e}}return t},h.normalizeState=function(e){var t,n;if(!e||typeof e!="object")e={};if(typeof e.normalized!="undefined")return e;if(!e.data||typeof e.data!="object")e.data={};return t={},t.normalized=!0,t.title=e.title||"",t.url=h.getFullUrl(e.url?e.url:h.getLocationHref()),t.hash=h.getShortUrl(t.url),t.data=h.cloneObject(e.data),t.id=h.getIdByState(t),t.cleanUrl=t.url.replace(/\??\&_suid.*/,""),t.url=t.cleanUrl,n=!h.isEmptyObject(t.data),(t.title||n)&&h.options.disableSuid!==!0&&(t.hash=h.getShortUrl(t.url).replace(/\??\&_suid.*/,""),/\?/.test(t.hash)||(t.hash+="?"),t.hash+="&_suid="+t.id),t.hashedUrl=h.getFullUrl(t.hash),(h.emulated.pushState||h.bugs.safariPoll)&&h.hasUrlDuplicate(t)&&(t.url=t.hashedUrl),t},h.createStateObject=function(e,t,n){var r={data:e,title:t,url:n};return r=h.normalizeState(r),r},h.getStateById=function(e){e=String(e);var n=h.idToState[e]||h.store.idToState[e]||t;return n},h.getStateString=function(e){var t,n,r;return t=h.normalizeState(e),n={data:t.data,title:e.title,url:e.url},r=l.stringify(n),r},h.getStateId=function(e){var t,n;return t=h.normalizeState(e),n=t.id,n},h.getHashByState=function(e){var t,n;return t=h.normalizeState(e),n=t.hash,n},h.extractId=function(e){var t,n,r,i;return e.indexOf("#")!=-1?i=e.split("#")[0]:i=e,n=/(.*)\&_suid=([0-9]+)$/.exec(i),r=n?n[1]||e:e,t=n?String(n[2]||""):"",t||!1},h.isTraditionalAnchor=function(e){var t=!/[\/\?\.]/.test(e);return t},h.extractState=function(e,t){var n=null,r,i;return t=t||!1,r=h.extractId(e),r&&(n=h.getStateById(r)),n||(i=h.getFullUrl(e),r=h.getIdByUrl(i)||!1,r&&(n=h.getStateById(r)),!n&&t&&!h.isTraditionalAnchor(e)&&(n=h.createStateObject(null,null,i))),n},h.getIdByUrl=function(e){var n=h.urlToId[e]||h.store.urlToId[e]||t;return n},h.getLastSavedState=function(){return h.savedStates[h.savedStates.length-1]||t},h.getLastStoredState=function(){return h.storedStates[h.storedStates.length-1]||t},h.hasUrlDuplicate=function(e){var t=!1,n;return n=h.extractState(e.url),t=n&&n.id!==e.id,t},h.storeState=function(e){return h.urlToId[e.url]=e.id,h.storedStates.push(h.cloneObject(e)),e},h.isLastSavedState=function(e){var t=!1,n,r,i;return h.savedStates.length&&(n=e.id,r=h.getLastSavedState(),i=r.id,t=n===i),t},h.saveState=function(e){return h.isLastSavedState(e)?!1:(h.savedStates.push(h.cloneObject(e)),!0)},h.getStateByIndex=function(e){var t=null;return typeof e=="undefined"?t=h.savedStates[h.savedStates.length-1]:e<0?t=h.savedStates[h.savedStates.length+e]:t=h.savedStates[e],t},h.getCurrentIndex=function(){var e=null;return h.savedStates.length<1?e=0:e=h.savedStates.length-1,e},h.getHash=function(e){var t=h.getLocationHref(e),n;return n=h.getHashByUrl(t),n},h.unescapeHash=function(e){var t=h.normalizeHash(e);return t=decodeURIComponent(t),t},h.normalizeHash=function(e){var t=e.replace(/[^#]*#/,"").replace(/#.*/,"");return t},h.setHash=function(e,t){var n,i;return t!==!1&&h.busy()?(h.pushQueue({scope:h,callback:h.setHash,args:arguments,queue:t}),!1):(h.busy(!0),n=h.extractState(e,!0),n&&!h.emulated.pushState?h.pushState(n.data,n.title,n.url,!1):h.getHash()!==e&&(h.bugs.setHash?(i=h.getPageUrl(),h.pushState(null,null,i+"#"+e,!1)):r.location.hash=e),h)},h.escapeHash=function(t){var n=h.normalizeHash(t);return n=e.encodeURIComponent(n),h.bugs.hashEscape||(n=n.replace(/\%21/g,"!").replace(/\%26/g,"&").replace(/\%3D/g,"=").replace(/\%3F/g,"?")),n},h.getHashByUrl=function(e){var t=String(e).replace(/([^#]*)#?([^#]*)#?(.*)/,"$2");return t=h.unescapeHash(t),t},h.setTitle=function(e){var t=e.title,n;t||(n=h.getStateByIndex(0),n&&n.url===e.url&&(t=n.title||h.options.initialTitle));try{r.getElementsByTagName("title")[0].innerHTML=t.replace("<","&lt;").replace(">","&gt;").replace(" & "," &amp; ")}catch(i){}return r.title=t,h},h.queues=[],h.busy=function(e){typeof e!="undefined"?h.busy.flag=e:typeof h.busy.flag=="undefined"&&(h.busy.flag=!1);if(!h.busy.flag){u(h.busy.timeout);var t=function(){var e,n,r;if(h.busy.flag)return;for(e=h.queues.length-1;e>=0;--e){n=h.queues[e];if(n.length===0)continue;r=n.shift(),h.fireQueueItem(r),h.busy.timeout=o(t,h.options.busyDelay)}};h.busy.timeout=o(t,h.options.busyDelay)}return h.busy.flag},h.busy.flag=!1,h.fireQueueItem=function(e){return e.callback.apply(e.scope||h,e.args||[])},h.pushQueue=function(e){return h.queues[e.queue||0]=h.queues[e.queue||0]||[],h.queues[e.queue||0].push(e),h},h.queue=function(e,t){return typeof e=="function"&&(e={callback:e}),typeof t!="undefined"&&(e.queue=t),h.busy()?h.pushQueue(e):h.fireQueueItem(e),h},h.clearQueue=function(){return h.busy.flag=!1,h.queues=[],h},h.stateChanged=!1,h.doubleChecker=!1,h.doubleCheckComplete=function(){return h.stateChanged=!0,h.doubleCheckClear(),h},h.doubleCheckClear=function(){return h.doubleChecker&&(u(h.doubleChecker),h.doubleChecker=!1),h},h.doubleCheck=function(e){return h.stateChanged=!1,h.doubleCheckClear(),h.bugs.ieDoubleCheck&&(h.doubleChecker=o(function(){return h.doubleCheckClear(),h.stateChanged||e(),!0},h.options.doubleCheckInterval)),h},h.safariStatePoll=function(){var t=h.extractState(h.getLocationHref()),n;if(!h.isLastSavedState(t))return n=t,n||(n=h.createStateObject()),h.Adapter.trigger(e,"popstate"),h;return},h.back=function(e){return e!==!1&&h.busy()?(h.pushQueue({scope:h,callback:h.back,args:arguments,queue:e}),!1):(h.busy(!0),h.doubleCheck(function(){h.back(!1)}),p.go(-1),!0)},h.forward=function(e){return e!==!1&&h.busy()?(h.pushQueue({scope:h,callback:h.forward,args:arguments,queue:e}),!1):(h.busy(!0),h.doubleCheck(function(){h.forward(!1)}),p.go(1),!0)},h.go=function(e,t){var n;if(e>0)for(n=1;n<=e;++n)h.forward(t);else{if(!(e<0))throw new Error("History.go: History.go requires a positive or negative integer passed.");for(n=-1;n>=e;--n)h.back(t)}return h};if(h.emulated.pushState){var v=function(){};h.pushState=h.pushState||v,h.replaceState=h.replaceState||v}else h.onPopState=function(t,n){var r=!1,i=!1,s,o;return h.doubleCheckComplete(),s=h.getHash(),s?(o=h.extractState(s||h.getLocationHref(),!0),o?h.replaceState(o.data,o.title,o.url,!1):(h.Adapter.trigger(e,"anchorchange"),h.busy(!1)),h.expectedStateId=!1,!1):(r=h.Adapter.extractEventData("state",t,n)||!1,r?i=h.getStateById(r):h.expectedStateId?i=h.getStateById(h.expectedStateId):i=h.extractState(h.getLocationHref()),i||(i=h.createStateObject(null,null,h.getLocationHref())),h.expectedStateId=!1,h.isLastSavedState(i)?(h.busy(!1),!1):(h.storeState(i),h.saveState(i),h.setTitle(i),h.Adapter.trigger(e,"statechange"),h.busy(!1),!0))},h.Adapter.bind(e,"popstate",h.onPopState),h.pushState=function(t,n,r,i){if(h.getHashByUrl(r)&&h.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(i!==!1&&h.busy())return h.pushQueue({scope:h,callback:h.pushState,args:arguments,queue:i}),!1;h.busy(!0);var s=h.createStateObject(t,n,r);return h.isLastSavedState(s)?h.busy(!1):(h.storeState(s),h.expectedStateId=s.id,p.pushState(s.id,s.title,s.url),h.Adapter.trigger(e,"popstate")),!0},h.replaceState=function(t,n,r,i){if(h.getHashByUrl(r)&&h.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(i!==!1&&h.busy())return h.pushQueue({scope:h,callback:h.replaceState,args:arguments,queue:i}),!1;h.busy(!0);var s=h.createStateObject(t,n,r);return h.isLastSavedState(s)?h.busy(!1):(h.storeState(s),h.expectedStateId=s.id,p.replaceState(s.id,s.title,s.url),h.Adapter.trigger(e,"popstate")),!0};if(s){try{h.store=l.parse(s.getItem("History.store"))||{}}catch(m){h.store={}}h.normalizeStore()}else h.store={},h.normalizeStore();h.Adapter.bind(e,"unload",h.clearAllIntervals),h.saveState(h.storeState(h.extractState(h.getLocationHref(),!0))),s&&(h.onUnload=function(){var e,t,n;try{e=l.parse(s.getItem("History.store"))||{}}catch(r){e={}}e.idToState=e.idToState||{},e.urlToId=e.urlToId||{},e.stateToId=e.stateToId||{};for(t in h.idToState){if(!h.idToState.hasOwnProperty(t))continue;e.idToState[t]=h.idToState[t]}for(t in h.urlToId){if(!h.urlToId.hasOwnProperty(t))continue;e.urlToId[t]=h.urlToId[t]}for(t in h.stateToId){if(!h.stateToId.hasOwnProperty(t))continue;e.stateToId[t]=h.stateToId[t]}h.store=e,h.normalizeStore(),n=l.stringify(e);try{s.setItem("History.store",n)}catch(i){if(i.code!==DOMException.QUOTA_EXCEEDED_ERR)throw i;s.length&&(s.removeItem("History.store"),s.setItem("History.store",n))}},h.intervalList.push(a(h.onUnload,h.options.storeInterval)),h.Adapter.bind(e,"beforeunload",h.onUnload),h.Adapter.bind(e,"unload",h.onUnload));if(!h.emulated.pushState){h.bugs.safariPoll&&h.intervalList.push(a(h.safariStatePoll,h.options.safariPollInterval));if(i.vendor==="Apple Computer, Inc."||(i.appCodeName||"")==="Mozilla")h.Adapter.bind(e,"hashchange",function(){h.Adapter.trigger(e,"popstate")}),h.getHash()&&h.Adapter.onDomLoad(function(){h.Adapter.trigger(e,"hashchange")})}},(!h.options||!h.options.delayInit)&&h.init()}(window),define("lib-app/history.min",function(){}),define("storymaps/common/Core",["lib-build/css!lib-app/bootstrap/css/bootstrap.min","lib-build/css!storymaps/common/ui/Modal.css","lib-build/css!./Core","./utils/Polyfills","esri/map","esri/arcgis/Portal","esri/arcgis/utils","./utils/CommonHelper","esri/urlUtils","./builder/MyStoriesWrapper","dojo/has","esri/IdentityManager","esri/arcgis/OAuthInfo","esri/config","esri/tasks/GeometryService","esri/request","dojo/topic","dojo/on","dojo/_base/lang","dojo/_base/array","dojo/Deferred","dojo/DeferredList","dojo/query","lib-app/bootstrap/js/bootstrap.min","lib-app/history.min"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S){function C(e,t){var n=!1,r=!1;console.log("common.core.Core - init",t),T=e,Z(),t!=null&&(n=N.fromScratch!=null||N.fromscratch!=null,r=N.fromGallery!=null),!u.browserSupportHistory()&&(n||r)&&N.ieredirected==null&&(window.location=document.location.protocol+"//"+document.location.host+document.location.pathname+"#"+document.location.search+"&ieredirected"),u.isArcGISHosted()?app.indexCfg={}:!et();if(!T.checkConfigFileIsOK()){j("invalidConfig");return}document.title=app.cfg.TPL_NAME,l("touch")&&$("body").addClass("hasTouch"),window!=window.top&&$("body").addClass("isEmbed"),y.mixin(app,{map:null,maps:{},portal:null,builder:t,isDirectCreation:n,isGalleryCreation:r,isDirectCreationFirstSave:n,isLoading:!0,loadingTimeout:null,ui:{}}),app.appCfg.useStandardHeader&&require(["storymaps/common/ui/header/Desktop"],function(e){app.ui.headerDesktop=new e($("#headerDesktop"),app.isInBuilder)});if(!T.init(this))return;!et()&&app.indexCfg.username&&app.indexCfg.password&&g(c,"dialog-create",function(){g(c.dialog,"show",function(){c.dialog.txtUser_.set("value",app.indexCfg.username),c.dialog.txtPwd_.set("value",app.indexCfg.password),c.dialog.btnSubmit_.onClick()})}),Q();if(!app.indexCfg.sharingurl){var i=document.location.pathname.indexOf("/apps/");i==-1&&(i=document.location.pathname.indexOf("/home/"));if(i!=-1){var a=location.pathname.substr(0,i);app.indexCfg.sharingurl="//"+location.host+a+"/sharing/content/items",app.indexCfg.proxyurl="//"+location.host+a+"/sharing/proxy"}else app.indexCfg.sharingurl=app.cfg.DEFAULT_SHARING_URL}app.indexCfg.sharingurl.match(/^http/)?o.arcgisUrl=app.indexCfg.sharingurl:o.arcgisUrl=location.protocol+app.indexCfg.sharingurl,app.indexCfg.proxyurl||(app.indexCfg.proxyurl=app.cfg.DEFAULT_PROXY_URL),p.defaults.io.proxyUrl=location.protocol+app.indexCfg.proxyurl,c&&c.setProtocolErrorHandler(function(){return!0}),app.isInBuilder&&app.cfg.CORS_SERVER&&$.each(app.cfg.CORS_SERVER,function(e,t){p.defaults.io.corsEnabledServers.push(t)}),p.defaults.io.timeout=app.isInBuilder?app.cfg.TIMEOUT_BUILDER_REQUEST:app.cfg.TIMEOUT_VIEWER_REQUEST,$.fn.modal.Constructor.prototype.enforceFocus=function(){},T.initLocalization(),$(window).resize(z),$("form").bind("keydown",function(e){if(e.keyCode==13)return!1}),g(c,"dialog-create",X),m.subscribe("CORE_UPDATE_UI",R),m.subscribe("CORE_RESIZE",z),m.subscribe("CORE_UPDATE_EXTENT",I),app.portal=new s.Portal(app.indexCfg.sharingurl.split("/sharing/")[0]),app.portal.on("load",function(){tt();if(app.indexCfg.oAuthAppId){var e=new h({appId:app.indexCfg.oAuthAppId,popup:!1});c.registerOAuthInfos([e]),c.checkSignInStatus(e.portalUrl).then(function(){t?O().then(k):O().then(k)},function(){c.getCredential(e.portalUrl)})}else k()})}function k(){console.log("common.core.Core - initStep2");var e=u.getAppID(et()),t=u.getWebmapID(et()),n=app.appCfg?!!app.appCfg.supportWebmapPreviewAGOL:!0;if(e){L(e);return}var r=u.getUrlParams().webmap;if(app.isDirectCreation&&(t||r)){O().then(function(){P(),app.isInitializing=!1;var e={title:"",creaDate:Date.now(),status:"PUBLISHED",media:{type:"webmap",webmap:{id:t||r,extent:null,layers:null,popup:null,legend:{enable:!1,openByDefault:!1}}},description:""};app.data.setStoryStorage("WEBAPP"),app.data.addStorySection(e),app.data.getWebAppData().setLayout({id:"tab"}),app.data.getWebAppData().setDefaultLayoutOptions(),app.data.setCurrentSectionIndex(0),m.publish("story-update-entries"),m.publish("BUILDER_INCREMENT_COUNTER",1);var n=m.subscribe("story-loaded-map",function(t){var r=app.maps[t.id].response.itemInfo.item;n.remove(),app.data.getWebAppData().setTitle(r.title),e.title=r.title,e.description=r.description,app.data.editSection(0,e),H(),m.publish("CORE_UPDATE_UI"),m.publish("story-update-entries"),B()})});return}if(t&&!n){u.isArcGISHosted()?D():M(t);return}if(app.isDirectCreation){O().then(function(){P(),T.startFromScratch()});return}u.isArcGISHosted()?D():N.appid||N.webmap&&(!app.indexCfg.authorizedOwners||!app.indexCfg.authorizedOwners[0])?j("unspecifiedConfigOwner"):j("invalidConfigNoApp")}function L(e){console.log("common.core.Core - loadWebMappingApp - appId:",e);var t=N.forceLogin!==undefined;t||app.isInBuilder?O().then(function(){A(e)},function(){j("notAuthorized")}):A(e)}function A(e){o.getItem(e).then(function(e){if(!e){j("appLoadingFail");return}var t=e.item,n={values:e.itemData.values};app.data.getWebAppItem().id||app.data.setWebAppItem(t),app.data.getWebAppData().set(n);if(app.indexCfg.authorizedOwners&&app.indexCfg.authorizedOwners.length>0&&app.indexCfg.authorizedOwners[0]){var r=t.owner,i=!1;r&&(i=$.inArray(r,app.indexCfg.authorizedOwners)!=-1),!i&&app.indexCfg.authorizedOwners[0]=="*"&&(i=!0);if(!i){j("invalidConfigOwner");return}}if(t&&t.appProxies){var s=b.map(t.appProxies,function(e){return{url:e.sourceUrl,mixin:{url:e.proxyUrl}}});app.data.setAppProxies(s)}if(app.isInBuilder&&et()&&!app.data.userIsAppOwner()){j("notAuthorized");return}T.webAppConfigLoaded();var o=app.appCfg?!!app.appCfg.useWebmapInApp:!0,a=app.data.getWebAppData().getWebmap()||u.getWebmapID(et());a&&o&&!app.data.getWebAppData().isBlank()?M(a):app.data.getWebAppData().isBlank()?(P(),T.loadWebmapFromData()):u.getPortalUser()||!et()&&app.data.getWebAppData().isBlank()?redirectToBuilderFromGallery():app.data.getWebAppData().isBlank()?j("appLoadingFail"):M(app.data.getWebAppData().getViews()[0].cfg.webmap.id)},function(e){e&&e.httpCode==400?j("invalidApp"):e&&e.httpCode==403?j("notAuthorized"):j("appLoadingFail")})}function O(){var e=new w;return g(c,"dialog-create",V),app.portal.signIn().then(function(){tt(),e.resolve()},function(){e.reject()}),e}function M(e){T.loadFirstWebmap(e).then(y.hitch(this,function(e){_(e)}),y.hitch(this,function(){j("createMap")}))}function _(e){console.log("common.core.Core - webMapInitCallback",e,"TEST"),app.maps[e.itemInfo.item.id]=T.getMapConfig(e),app.map=e.map,app.data.setWebMap(e.itemInfo),app.data.setResponse(e),app.map.disableKeyboardNavigation(),P(),T.firstWebmapLoaded()}function D(){window.location=app.isPortal&&app.cfg.HELP_URL_PORTAL?app.cfg.HELP_URL_PORTAL:app.cfg.HELP_URL}function P(){var e=app.indexCfg.title||app.data.getWebAppData().getTitle(),t=app.indexCfg.subtitle||app.data.getWebAppData().getSubtitle(),n=app.data.getWebAppData().getColors();app.ui.headerDesktop&&app.ui.headerDesktop.init(!app.isInBuilder&&(app.cfg.EMBED||N.embed||N.embed===""),e,t,U(),n,W(),app.appCfg.headerCompactByDefault),app.appCfg.useAppTitleAsPageTitle&&(document.title=e?$("<div>"+e+"</div>").text():app.cfg.TPL_NAME)}function H(e){console.log("common.core.Core - initApp"),z(),location.hash&&u.browserSupportHistory()&&(location.hash="map"),window.onhashchange=function(){T.prepareMobileViewSwitch(),T.onHashChange()},T.appInitComplete(),app.builder&&app.builder.appInitComplete(e);if(app.isInBuilder||app.data.userIsAppOwner())l("ff")&&$(".builderShare #my-stories-frame").remove(),(l("ff")||!app.isInBuilder)&&$("body").append('<div id="my-stories-hidden-container"><iframe id="my-stories-frame"></iframe></div>'),f.loadMyStories()}function B(){app.isLoading=!1,$("#headerDesktop").removeAttr("aria-hidden"),$("#loadingIndicator, #loadingMessage").addClass("fadeOut").fadeOut(400),$("#loadingOverlay").fadeOut(800)}function j(e,t,n){var r=i18n.viewer.errors[e];G(),$("#loadingIndicator").hide(),r=r.replace(/%TPL_NAME%/g,app.cfg.TPL_NAME),e=="notAuthorized"&&app.indexCfg.oAuthAppId&&(r+='<div><button class="btn btn-sm btn-default" onclick="esri.id.destroyCredentials(); window.location.reload();">'+i18n.viewer.errors.signOut+"</button></div>"),e=="appLoadingFail"?$("#loadingMessage").html('<div id="loadingRetry"> <button type="button" class="btn btn-naked btn-sm" onclick="document.location.reload()">'+i18n.viewer.loading.failButton+" </button>"+"</div>").hide().fadeIn(1200,function(){$("#loadingMessage").addClass("loaded")}):$("#loadingMessage").hide(),l("ie")==8&&($("#fatalError-icon").css({filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='_resources/icons/warning-icon.png', sizingMethod='scale')",backgroundPosition:"2px 3px",width:78}),$("#fatalError-msg").css({paddingLeft:5})),$("#fatalError .error-msg").html(r),n||$("#fatalError").show()}function F(e){$("#fatalError .error-msg").html(i18n.viewer.errors[e])}function I(e,t){t=t||app.map;if(!e||!e.spatialReference||!t||!t.extent.spatialReference||!t.spatialReference){var n=new w;return n.resolve(),n}if(t.spatialReference.wkid==e.spatialReference.wkid)return t.setExtent(T.getLayoutExtent(e,!1));var r=new w;return p.defaults.geometryService.project([e],t.spatialReference,function(e){if(!e||!e[0])return;t.setExtent(T.getLayoutExtent(e[0],!1)),r.resolve()}),r}function q(e,t){e?app.map.spatialReference.wkid!=102100&&app.map.spatialReference.wkid!=4326?p.defaults.geometryService.project([t],app.map.spatialReference,function(e){if(!e||!e[0])return;app.map.extent.contains(e[0])||app.map.centerAt(e[0])}):app.map.extent.contains(t)||app.map.centerAt(t):($(".mainMediaContainer.active .mapLocationMsg").html(i18n.viewer.locatorFromCommon.error),$(".mainMediaContainer.active .mapLocationError").fadeIn(),setTimeout(function(){$(".mainMediaContainer.active .mapLocationError").fadeOut()},5e3))}function R(){console.log("common.core.Core - updateUI");var e=app.data.getWebAppData().getColors();app.ui.headerDesktop&&(app.ui.headerDesktop.setTitleAndSubtitle(app.data.getWebAppData().getTitle()||(app.data.getWebMap()?app.data.getWebMap().item.title:""),app.data.getWebAppData().getSubtitle()||(app.data.getWebMap()?app.data.getWebMap().item.snippet:"")),app.ui.headerDesktop.update(U(),e,app.appCfg.headerCompactByDefault)),T.updateUI(),z()}function U(e){return{logoURL:app.data.getWebAppData().getLogoURL(e&&e.useMobileLogo),logoTarget:app.data.getWebAppData().getLogoTarget(),linkText:app.data.getWebAppData().getHeaderLinkText(),linkURL:app.data.getWebAppData().getHeaderLinkURL(),socialBtn:app.data.getWebAppData().getSocial(),compactSize:app.data.getWebAppData().getHeaderCompactSize()}}function z(){var e=$("body").width(),t=$("body").height(),n=0,r=0,i=N.forceDesktop!==undefined||app.indexCfg.forceDesktop,s=N.forceMobile!==undefined||app.indexCfg.forceMobile,o=e<=768||s,u=$(".centerLink").length?$(".centerLink").hasClass("current"):!0;i&&(o=!1),o?$("body").addClass("mobile-view"):$("body").removeClass("mobile-view"),$(".mainViewAboveMap, .mainViewBelowMap").each(function(e,t){var r=$(t);n+=r.is(":visible")?r.outerHeight():0}),$(".mainViewSideMap").each(function(e,t){var n=$(t);r+=n.is(":visible")?n.outerWidth():0}),app.ui.headerDesktop&&app.ui.headerDesktop.resize(e),app.initScreenIsOpen&&($("#header").css("display",o?"none":"block"),$("#fatalError").css("display",o?"block":"none")),app.initScreenIsOpen||$("#contentPanel").height(t-n),T.resize({isMobileView:o,isOnMobileMapView:u,width:e,height:t-n}),app.isInBuilder&&app.builder.resize({isMobileView:o});if(app.map&&(!o||o&&u))try{app.map.resize(!!app.appCfg.mapsImmediateResize)}catch(a){}o?$(".mapContainer .esriControlsBR > div").first().removeClass("logo-med").addClass("logo-sm"):$(".mapContainer .esriControlsBR > div").first().removeClass("logo-sm").addClass("logo-med")}function W(){return!app.isInBuilder&&(!et()&&!!u.getAppID(et())||et()&&app.data.userIsAppOwner())}function X(){$(".esriSignInDialog td label").siblings("br").css("display","none"),$(".esriSignInDialog .dijitDialogPaneContentArea div:nth(1)").css("display","none"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("padding","0px"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("margin-bottom","0px"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("border","none"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("border-radius","0px"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("-webkit-border-radius","0px"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("-moz-border-radius","0px"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("box-shadow","none"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("-webkit-box-shadow","none"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("-moz-box-shadow","none"),$(".esriSignInDialog .dijitReset.dijitValidationContainer").css("display","none"),$(".esriSignInDialog .esriErrorMsg").css("margin-top","10px"),$(".esriSignInDialog").find(".dijitDialogTitleBar").find(".dijitDialogTitle").first().html(i18n.viewer.signin.title),c._arcgisUrl&&($(".esriSignInDialog").find(".dijitDialogPaneContentArea:first-child").find(":first-child").first().css("display","none"),$(".esriSignInDialog").find(".dijitDialogPaneContentArea:first-child").find(":first-child").first().after("<div id='dijitDialogPaneContentAreaLoginText'>"+i18n.viewer.signin.explainViewer.replace("%PORTAL_LINK%","<a href='http://"+c._arcgisUrl+"' title='"+c._arcgisUrl+"' target='_blank'>"+c._arcgisUrl+"</a>")+"</div>"))}function V(){c._arcgisUrl&&$(".esriSignInDialog").find("#dijitDialogPaneContentAreaLoginText").html(i18n.viewer.signin.explainBuilder.replace("%PORTAL_LINK%","<a href='http://"+c._arcgisUrl+"' title='"+c._arcgisUrl+"' target='_blank'>"+c._arcgisUrl+"</a>"))}function J(){$("#header").css("display","inherit"),$(".mobileView").css("display","inherit"),$("#fatalError").css("display","none"),$("#loadingOverlay").css("top","0px"),Q(),z()}function K(){console.log("REDIRECT ",o.arcgisUrl.split("/sharing/")[0]+"/home/signin.html?returnUrl="+encodeURIComponent(document.location.href)),window.location=o.arcgisUrl.split("/sharing/")[0]+"/home/signin.html?returnUrl="+encodeURIComponent(document.location.href)}function Q(){app.loadingTimeout=setTimeout(Y,app.cfg.TIMEOUT_VIEWER_LOAD)}function G(){typeof app!="undefined"&&app.loadingTimeout&&(clearTimeout(app.loadingTimeout),app.loadingTimeout=null)}function Y(){if(c&&c.dialog&&c.dialog._alreadyInitialized&&!c.loadingTimeoutAlreadyFired){clearTimeout(app.loadingTimeout),Q(),c._busy||(c.loadingTimeoutAlreadyFired=!0);return}$("#loadingMessage").html('<div class="mainMessage">'+i18n.viewer.loading.long+"<br />"+i18n.viewer.loading.long2+"</div>").fadeIn("slow",function(){$("#loadingMessage").addClass("loaded")})}function Z(){S("#fatalError .error-title")[0].innerHTML=i18n.viewer.errors.boxTitle}function et(){return x.environment!=["TPL","ENV","DEV"].join("_")}function tt(){console.log("common.core.Core - parsePortalConfig");if(!app.portal)return;var e,t;commonConfig&&commonConfig.CommonHelperServices&&(commonConfig.CommonHelperServices.geometry&&commonConfig.CommonHelperServices.geometry&&(e=location.protocol+commonConfig.CommonHelperServices.geometry.url),commonConfig.CommonHelperServices.geocode&&commonConfig.CommonHelperServices.geocode.length&&commonConfig.CommonHelperServices.geocode[0].url?t=commonConfig.CommonHelperServices.geocode:commonConfig.CommonHelperServices.geocode&&commonConfig.CommonHelperServices.geocode&&commonConfig.CommonHelperServices.geocode.url&&(t=[{name:"myGeocoder",url:commonConfig.CommonHelperServices.geocode.url}])),app.portal.helperServices&&(app.portal.helperServices.geometry&&app.portal.helperServices.geometry.url&&(e=app.portal.helperServices.geometry.url),app.portal.helperServices.geocode&&app.portal.helperServices.geocode.length&&app.portal.helperServices.geocode[0].url&&(t=app.portal.helperServices.geocode)),p.defaults.geometryService=new d(e),app.indexCfg.geocodeServices=t,app.portal.bingKey&&(commonConfig.bingMapsKey=app.portal.bingKey),app.portal.isPortal&&app.cfg&&app.cfg.AUTHORIZED_IMPORT_SOURCE&&(app.cfg.AUTHORIZED_IMPORT_SOURCE.featureService=!1),app.isPortal=!!app.portal.isPortal;if(app.isPortal&&app.portal.helpBase&&app.portal.portalHostname&&!app.cfg.HELP_URL_PORTAL.match("^//")){var n=app.portal.portalHostname.split("/")[0];app.cfg.HELP_URL_PORTAL="//"+n+app.portal.helpBase+app.cfg.HELP_URL_PORTAL}}function nt(){G(),app.isInitializing=!0,app.initScreenIsOpen=!0,j("notConfiguredMobile",null,!0),setTimeout(z,50)}function rt(){$("#initPopup").modal("hide"),app.initScreenIsOpen=!1}function it(){F("notConfiguredDesktop"),$("#loadingOverlay").css("top","0px"),$("#header").css("display","inherit"),$("#fatalError").css("display","block"),app.initScreenIsOpen=!1,z()}var x={environment:"TPL_ENV_PRODUCTION"},T=null,N=u.getUrlParams();return r.apply(),{init:C,isProd:et,appInitComplete:H,displayApp:B,loadWebMap:M,handleWindowResize:z,hasSwitchBuilderButton:W,initPopupPrepare:nt,initPopupComplete:rt,initPopupFail:it,setMapExtent:I,zoomToDeviceLocation:q,getHeaderUserCfg:U,cleanLoadingTimeout:G,initError:j,prepareAppForWebmapReload:J,replaceInitErrorMessage:F,portalLogin:O}}),define("lib-build/css!storymaps/common/ui/header/Desktop",[],function(){}),define("storymaps/common/utils/SocialSharing",["dojo/Deferred","esri/urlUtils"],function(e,t){return{shareFacebook:function(e,t,n,r){var i="&p[title]="+encodeURIComponent(e||"")+"&p[summary]="+t+"&p[url]="+this.cleanURL(r||document.location.href);n?i+="&p[images][0]="+encodeURIComponent(n):i+="&p[images][0]="+encodeURIComponent($("meta[property='og:image']").attr("content")),window.open("http://www.facebook.com/sharer.php?s=100"+i,"","toolbar=0,status=0,width=626,height=436")},shareTwitter:function(e,t){var n="text="+encodeURIComponent(e||"")+"&url="+this.cleanURL(t||document.location.href)+"&related=EsriStoryMaps"+"&hashtags=storymap";window.open("https://twitter.com/intent/tweet?"+n,"","toolbar=0,status=0,width=626,height=436")},requestBitly:function(t){var n=["http://api.bitly.com/v3/shorten?callback=?","https://api-ssl.bitly.com/v3/shorten?callback=?"],r=location.protocol=="http:"?n[0]:n[1],i=this.cleanURL(t||document.location.href,!0),s=new e;return $.getJSON(r,{format:"json",apiKey:app.cfg.HEADER_SOCIAL.bitly.key,login:app.cfg.HEADER_SOCIAL.bitly.login,longUrl:i},function(e){!e||!e||!e.data.url?s.reject():s.resolve(e.data.url)}),s},cleanURL:function(e,n){var r=t.urlToObject(e),i=r.path;return r.query&&(delete r.query.edit,delete r.query.locale,delete r.query.folderId,$.each(Object.keys(r.query),function(e,t){e===0?i+="?":i+="&",i+=t+"="+r.query[t]})),n?i:encodeURIComponent(i)}}}),define("text",{}),define("lib-build/tpl",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),define("lib-build/tpl!storymaps/common/ui/share/ShareDialog",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="modal-dialog">\r\n	<div class="modal-content">\r\n		<div class="modal-logo"></div>\r\n		<div class="modal-header">\r\n			<h4 class="modal-title"></h4>\r\n		</div>\r\n\r\n		<div class="modal-body">\r\n			<div class="social-container">\r\n				<i class="shareIcon blackHover share_facebook icon-facebook-squared"></i>\r\n				<i class="shareIcon blackHover share_twitter icon-twitter"></i>\r\n			</div>\r\n			\r\n			<div class="share-url-panel"></div>\r\n			\r\n			<div class="embed-title"></div>\r\n			<div class="share-embed-panel"></div>\r\n		</div>\r\n\r\n		<div class="modal-footer">\r\n			<button type="button" class="btn btnCancel btn-naked btn-close" data-dismiss="modal"></button>\r\n		</div>\r\n	</div>\r\n</div>';return __p}}),define("lib-build/css!storymaps/common/ui/share/ShareDialog",[],function(){}),define("lib-build/tpl!storymaps/common/ui/share/ShareURLPanel",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="share-url-container">\r\n	<span class="share-btn share-clipboard"></span>\r\n	<input type="text" class="form-control bitlylink" readonly="true"/>\r\n	<a class="btn btn-primary btn-bitlylink-open" target="_blank"></a>\r\n	<div class="share-status-wrapper"><span class="share-status"></span></div>\r\n</div>';return __p}}),define("lib-build/css!storymaps/common/ui/share/ShareURLPanel",[],function(){}),function(e,t){"use strict";var n=e,r=n.document,i=n.navigator,s=n.setTimeout,o=n.encodeURIComponent,u=n.ActiveXObject,a=n.Error,f=n.Number.parseInt||n.parseInt,l=n.Number.parseFloat||n.parseFloat,c=n.Number.isNaN||n.isNaN,h=n.Math.round,p=n.Date.now,d=n.Object.keys,v=n.Object.defineProperty,m=n.Object.prototype.hasOwnProperty,g=n.Array.prototype.slice,y=function(e){return g.call(e,0)},b=function(){var e,n,r,i,s,o,u=y(arguments),a=u[0]||{};for(e=1,n=u.length;e<n;e++)if((r=u[e])!=null)for(i in r)m.call(r,i)&&(s=a[i],o=r[i],a!==o&&o!==t&&(a[i]=o));return a},w=function(e){var t,n,r,i;if(typeof e!="object"||e==null)t=e;else if(typeof e.length=="number"){t=[];for(n=0,r=e.length;n<r;n++)m.call(e,n)&&(t[n]=w(e[n]))}else{t={};for(i in e)m.call(e,i)&&(t[i]=w(e[i]))}return t},E=function(e,t){var n={};for(var r=0,i=t.length;r<i;r++)t[r]in e&&(n[t[r]]=e[t[r]]);return n},S=function(e,t){var n={};for(var r in e)t.indexOf(r)===-1&&(n[r]=e[r]);return n},x=function(e){if(e)for(var t in e)m.call(e,t)&&delete e[t];return e},T=function(e,t){if(e&&e.nodeType===1&&e.ownerDocument&&t&&(t.nodeType===1&&t.ownerDocument&&t.ownerDocument===e.ownerDocument||t.nodeType===9&&!t.ownerDocument&&t===e.ownerDocument))do{if(e===t)return!0;e=e.parentNode}while(e);return!1},N=function(e){var t;return typeof e=="string"&&e&&(t=e.split("#")[0].split("?")[0],t=e.slice(0,e.lastIndexOf("/")+1)),t},C=function(e){var t,n;return typeof e=="string"&&e&&(n=e.match(/^(?:|[^:@]*@|.+\)@(?=http[s]?|file)|.+?\s+(?: at |@)(?:[^:\(]+ )*[\(]?)((?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/),n&&n[1]?t=n[1]:(n=e.match(/\)@((?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/),n&&n[1]&&(t=n[1]))),t},k=function(){var e,t;try{throw new a}catch(n){t=n}return t&&(e=t.sourceURL||t.fileName||C(t.stack)),e},L=function(){var e,n,i;if(r.currentScript&&(e=r.currentScript.src))return e;n=r.getElementsByTagName("script");if(n.length===1)return n[0].src||t;if("readyState"in n[0])for(i=n.length;i--;)if(n[i].readyState==="interactive"&&(e=n[i].src))return e;return r.readyState==="loading"&&(e=n[n.length-1].src)?e:(e=k())?e:t},A=function(){var e,n,i,s=r.getElementsByTagName("script");for(e=s.length;e--;){if(!(i=s[e].src)){n=null;break}i=N(i);if(n==null)n=i;else if(n!==i){n=null;break}}return n||t},O=function(){var e=N(L())||A()||"";return e+"ZeroClipboard.swf"},M={bridge:null,version:"0.0.0",pluginType:"unknown",disabled:null,outdated:null,unavailable:null,deactivated:null,overdue:null,ready:null},_="11.0.0",D={},P,H={},B=null,j={ready:"Flash communication is established",error:{"flash-disabled":"Flash is disabled or not installed","flash-outdated":"Flash is too outdated to support ZeroClipboard","flash-unavailable":"Flash is unable to communicate bidirectionally with JavaScript","flash-deactivated":"Flash is too outdated for your browser and/or is configured as click-to-activate","flash-overdue":"Flash communication was established but NOT within the acceptable time limit"}},F={swfPath:O(),trustedDomains:e.location.host?[e.location.host]:[],cacheBust:!0,forceEnhancedClipboard:!1,flashLoadTimeout:3e4,autoActivate:!0,bubbleEvents:!0,containerId:"global-zeroclipboard-html-bridge",containerClass:"global-zeroclipboard-container",swfObjectId:"global-zeroclipboard-flash-bridge",hoverClass:"zeroclipboard-is-hover",activeClass:"zeroclipboard-is-active",forceHandCursor:!1,title:null,zIndex:999999999},I=function(e){if(typeof e=="object"&&e!==null)for(var t in e)if(m.call(e,t))if(/^(?:forceHandCursor|title|zIndex|bubbleEvents)$/.test(t))F[t]=e[t];else if(M.bridge==null)if(t==="containerId"||t==="swfObjectId"){if(!et(e[t]))throw new Error("The specified `"+t+"` value is not valid as an HTML4 Element ID");F[t]=e[t]}else F[t]=e[t];if(typeof e=="string"&&e){if(m.call(F,e))return F[e];return}return w(F)},q=function(){return{browser:E(i,["userAgent","platform","appName"]),flash:S(M,["bridge"]),zeroclipboard:{version:At.version,config:At.config()}}},R=function(){return!!(M.disabled||M.outdated||M.unavailable||M.deactivated)},U=function(e,t){var n,r,i,s={};if(typeof e=="string"&&e)i=e.toLowerCase().split(/\s+/);else if(typeof e=="object"&&e&&typeof t=="undefined")for(n in e)m.call(e,n)&&typeof n=="string"&&n&&typeof e[n]=="function"&&At.on(n,e[n]);if(i&&i.length){for(n=0,r=i.length;n<r;n++)e=i[n].replace(/^on/,""),s[e]=!0,D[e]||(D[e]=[]),D[e].push(t);s.ready&&M.ready&&At.emit({type:"ready"});if(s.error){var o=["disabled","outdated","unavailable","deactivated","overdue"];for(n=0,r=o.length;n<r;n++)if(M[o[n]]===!0){At.emit({type:"error",name:"flash-"+o[n]});break}}}return At},z=function(e,t){var n,r,i,s,o;if(arguments.length===0)s=d(D);else if(typeof e=="string"&&e)s=e.split(/\s+/);else if(typeof e=="object"&&e&&typeof t=="undefined")for(n in e)m.call(e,n)&&typeof n=="string"&&n&&typeof e[n]=="function"&&At.off(n,e[n]);if(s&&s.length)for(n=0,r=s.length;n<r;n++){e=s[n].toLowerCase().replace(/^on/,""),o=D[e];if(o&&o.length)if(t){i=o.indexOf(t);while(i!==-1)o.splice(i,1),i=o.indexOf(t,i)}else o.length=0}return At},W=function(e){var t;return typeof e=="string"&&e?t=w(D[e])||null:t=w(D),t},X=function(e){var t,n,r;e=tt(e);if(!e)return;if(ut(e))return;return e.type==="ready"&&M.overdue===!0?At.emit({type:"error",name:"flash-overdue"}):(t=b({},e),ot.call(this,t),e.type==="copy"&&(r=pt(H),n=r.data,B=r.formatMap),n)},V=function(){typeof M.ready!="boolean"&&(M.ready=!1);if(!At.isFlashUnusable()&&M.bridge===null){var e=F.flashLoadTimeout;typeof e=="number"&&e>=0&&s(function(){typeof M.deactivated!="boolean"&&(M.deactivated=!0),M.deactivated===!0&&At.emit({type:"error",name:"flash-deactivated"})},e),M.overdue=!1,ct()}},$=function(){At.clearData(),At.blur(),At.emit("destroy"),ht(),At.off()},J=function(e,t){var n;if(typeof e=="object"&&e&&typeof t=="undefined")n=e,At.clearData();else{if(typeof e!="string"||!e)return;n={},n[e]=t}for(var r in n)typeof r=="string"&&r&&m.call(n,r)&&typeof n[r]=="string"&&n[r]&&(H[r]=n[r])},K=function(e){typeof e=="undefined"?(x(H),B=null):typeof e=="string"&&m.call(H,e)&&delete H[e]},Q=function(e){if(typeof e=="undefined")return w(H);if(typeof e=="string"&&m.call(H,e))return H[e]},G=function(e){if(!e||e.nodeType!==1)return;P&&(Et(P,F.activeClass),P!==e&&Et(P,F.hoverClass)),P=e,wt(e,F.hoverClass);var t=e.getAttribute("title")||F.title;if(typeof t=="string"&&t){var n=lt(M.bridge);n&&n.setAttribute("title",t)}var r=F.forceHandCursor===!0||St(e,"cursor")==="pointer";Ct(r),Nt()},Y=function(){var e=lt(M.bridge);e&&(e.removeAttribute("title"),e.style.left="0px",e.style.top="-9999px",e.style.width="1px",e.style.top="1px"),P&&(Et(P,F.hoverClass),Et(P,F.activeClass),P=null)},Z=function(){return P||null},et=function(e){return typeof e=="string"&&e&&/^[A-Za-z][A-Za-z0-9_:\-\.]*$/.test(e)},tt=function(e){var t;typeof e=="string"&&e?(t=e,e={}):typeof e=="object"&&e&&typeof e.type=="string"&&e.type&&(t=e.type);if(!t)return;b(e,{type:t.toLowerCase(),target:e.target||P||null,relatedTarget:e.relatedTarget||null,currentTarget:M&&M.bridge||null,timeStamp:e.timeStamp||p()||null});var n=j[e.type];return e.type==="error"&&e.name&&n&&(n=n[e.name]),n&&(e.message=n),e.type==="ready"&&b(e,{target:null,version:M.version}),e.type==="error"&&(/^flash-(disabled|outdated|unavailable|deactivated|overdue)$/.test(e.name)&&b(e,{target:null,minimumVersion:_}),/^flash-(outdated|unavailable|deactivated|overdue)$/.test(e.name)&&b(e,{version:M.version})),e.type==="copy"&&(e.clipboardData={setData:At.setData,clearData:At.clearData}),e.type==="aftercopy"&&(e=dt(e,B)),e.target&&!e.relatedTarget&&(e.relatedTarget=nt(e.target)),e=rt(e),e},nt=function(e){var t=e&&e.getAttribute&&e.getAttribute("data-clipboard-target");return t?r.getElementById(t):null},rt=function(e){if(e&&/^_(?:click|mouse(?:over|out|down|up|move))$/.test(e.type)){var i=e.target,s=e.type==="_mouseover"&&e.relatedTarget?e.relatedTarget:t,o=e.type==="_mouseout"&&e.relatedTarget?e.relatedTarget:t,u=Tt(i),a=n.screenLeft||n.screenX||0,f=n.screenTop||n.screenY||0,l=r.body.scrollLeft+r.documentElement.scrollLeft,c=r.body.scrollTop+r.documentElement.scrollTop,h=u.left+(typeof e._stageX=="number"?e._stageX:0),p=u.top+(typeof e._stageY=="number"?e._stageY:0),d=h-l,v=p-c,m=a+d,g=f+v,y=typeof e.movementX=="number"?e.movementX:0,w=typeof e.movementY=="number"?e.movementY:0;delete e._stageX,delete e._stageY,b(e,{srcElement:i,fromElement:s,toElement:o,screenX:m,screenY:g,pageX:h,pageY:p,clientX:d,clientY:v,x:d,y:v,movementX:y,movementY:w,offsetX:0,offsetY:0,layerX:0,layerY:0})}return e},it=function(e){var t=e&&typeof e.type=="string"&&e.type||"";return!/^(?:(?:before)?copy|destroy)$/.test(t)},st=function(e,t,n,r){r?s(function(){e.apply(t,n)},0):e.apply(t,n)},ot=function(e){if(typeof e!="object"||!e||!e.type)return;var t=it(e),r=D["*"]||[],i=D[e.type]||[],s=r.concat(i);if(s&&s.length){var o,u,a,f,l,c=this;for(o=0,u=s.length;o<u;o++)a=s[o],f=c,typeof a=="string"&&typeof n[a]=="function"&&(a=n[a]),typeof a=="object"&&a&&typeof a.handleEvent=="function"&&(f=a,a=a.handleEvent),typeof a=="function"&&(l=b({},e),st(a,f,[l],t))}return this},ut=function(e){var t=e.target||P||null,n=e._source==="swf";delete e._source;var r=["flash-disabled","flash-outdated","flash-unavailable","flash-deactivated","flash-overdue"];switch(e.type){case"error":r.indexOf(e.name)!==-1&&b(M,{disabled:e.name==="flash-disabled",outdated:e.name==="flash-outdated",unavailable:e.name==="flash-unavailable",deactivated:e.name==="flash-deactivated",overdue:e.name==="flash-overdue",ready:!1});break;case"ready":var i=M.deactivated===!0;b(M,{disabled:!1,outdated:!1,unavailable:!1,deactivated:!1,overdue:i,ready:!i});break;case"copy":var s,o,u=e.relatedTarget;!H["text/html"]&&!H["text/plain"]&&u&&(o=u.value||u.outerHTML||u.innerHTML)&&(s=u.value||u.textContent||u.innerText)?(e.clipboardData.clearData(),e.clipboardData.setData("text/plain",s),o!==s&&e.clipboardData.setData("text/html",o)):!H["text/plain"]&&e.target&&(s=e.target.getAttribute("data-clipboard-text"))&&(e.clipboardData.clearData(),e.clipboardData.setData("text/plain",s));break;case"aftercopy":At.clearData(),t&&t!==bt()&&t.focus&&t.focus();break;case"_mouseover":At.focus(t),F.bubbleEvents===!0&&n&&(t&&t!==e.relatedTarget&&!T(e.relatedTarget,t)&&at(b({},e,{type:"mouseenter",bubbles:!1,cancelable:!1})),at(b({},e,{type:"mouseover"})));break;case"_mouseout":At.blur(),F.bubbleEvents===!0&&n&&(t&&t!==e.relatedTarget&&!T(e.relatedTarget,t)&&at(b({},e,{type:"mouseleave",bubbles:!1,cancelable:!1})),at(b({},e,{type:"mouseout"})));break;case"_mousedown":wt(t,F.activeClass),F.bubbleEvents===!0&&n&&at(b({},e,{type:e.type.slice(1)}));break;case"_mouseup":Et(t,F.activeClass),F.bubbleEvents===!0&&n&&at(b({},e,{type:e.type.slice(1)}));break;case"_click":case"_mousemove":F.bubbleEvents===!0&&n&&at(b({},e,{type:e.type.slice(1)}))}if(/^_(?:click|mouse(?:over|out|down|up|move))$/.test(e.type))return!0},at=function(e){if(!e||typeof e.type!="string"||!e)return;var t,i=e.target||null,s=i&&i.ownerDocument||r,o={view:s.defaultView||n,canBubble:!0,cancelable:!0,detail:e.type==="click"?1:0,button:typeof e.which=="number"?e.which-1:typeof e.button=="number"?e.button:s.createEvent?0:1},u=b(o,e);if(!i)return;s.createEvent&&i.dispatchEvent&&(u=[u.type,u.canBubble,u.cancelable,u.view,u.detail,u.screenX,u.screenY,u.clientX,u.clientY,u.ctrlKey,u.altKey,u.shiftKey,u.metaKey,u.button,u.relatedTarget],t=s.createEvent("MouseEvents"),t.initMouseEvent&&(t.initMouseEvent.apply(t,u),t._source="js",i.dispatchEvent(t)))},ft=function(){var e=r.createElement("div");return e.id=F.containerId,e.className=F.containerClass,e.style.position="absolute",e.style.left="0px",e.style.top="-9999px",e.style.width="1px",e.style.height="1px",e.style.zIndex=""+kt(F.zIndex),e},lt=function(e){var t=e&&e.parentNode;while(t&&t.nodeName==="OBJECT"&&t.parentNode)t=t.parentNode;return t||null},ct=function(){var e,t=M.bridge,i=lt(t);if(!t){var s=yt(n.location.host,F),o=s==="never"?"none":"all",u=mt(F),a=F.swfPath+vt(F.swfPath,F);i=ft();var f=r.createElement("div");i.appendChild(f),r.body.appendChild(i);var l=r.createElement("div"),c=M.pluginType==="activex";l.innerHTML='<object id="'+F.swfObjectId+'" name="'+F.swfObjectId+'" '+'width="100%" height="100%" '+(c?'classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"':'type="application/x-shockwave-flash" data="'+a+'"')+">"+(c?'<param name="movie" value="'+a+'"/>':"")+'<param name="allowScriptAccess" value="'+s+'"/>'+'<param name="allowNetworking" value="'+o+'"/>'+'<param name="menu" value="false"/>'+'<param name="wmode" value="transparent"/>'+'<param name="flashvars" value="'+u+'"/>'+"</object>",t=l.firstChild,l=null,t.ZeroClipboard=At,i.replaceChild(t,f)}return t||(t=r[F.swfObjectId],t&&(e=t.length)&&(t=t[e-1]),!t&&i&&(t=i.firstChild)),M.bridge=t||null,t},ht=function(){var e=M.bridge;if(e){var t=lt(e);t&&(M.pluginType==="activex"&&"readyState"in e?(e.style.display="none",function n(){if(e.readyState===4){for(var r in e)typeof e[r]=="function"&&(e[r]=null);e.parentNode&&e.parentNode.removeChild(e),t.parentNode&&t.parentNode.removeChild(t)}else s(n,10)}()):(e.parentNode&&e.parentNode.removeChild(e),t.parentNode&&t.parentNode.removeChild(t))),M.ready=null,M.bridge=null,M.deactivated=null}},pt=function(e){var t={},n={};if(typeof e!="object"||!e)return;for(var r in e)if(r&&m.call(e,r)&&typeof e[r]=="string"&&e[r])switch(r.toLowerCase()){case"text/plain":case"text":case"air:text":case"flash:text":t.text=e[r],n.text=r;break;case"text/html":case"html":case"air:html":case"flash:html":t.html=e[r],n.html=r;break;case"application/rtf":case"text/rtf":case"rtf":case"richtext":case"air:rtf":case"flash:rtf":t.rtf=e[r],n.rtf=r;break;default:}return{data:t,formatMap:n}},dt=function(e,t){if(typeof e!="object"||!e||typeof t!="object"||!t)return e;var n={};for(var r in e)if(m.call(e,r)){if(r!=="success"&&r!=="data"){n[r]=e[r];continue}n[r]={};var i=e[r];for(var s in i)s&&m.call(i,s)&&m.call(t,s)&&(n[r][t[s]]=i[s])}return n},vt=function(e,t){var n=t==null||t&&t.cacheBust===!0;return n?(e.indexOf("?")===-1?"?":"&")+"noCache="+p():""},mt=function(e){var t,r,i,s,u="",a=[];e.trustedDomains&&(typeof e.trustedDomains=="string"?s=[e.trustedDomains]:typeof e.trustedDomains=="object"&&"length"in e.trustedDomains&&(s=e.trustedDomains));if(s&&s.length)for(t=0,r=s.length;t<r;t++)if(m.call(s,t)&&s[t]&&typeof s[t]=="string"){i=gt(s[t]);if(!i)continue;if(i==="*"){a.length=0,a.push(i);break}a.push.apply(a,[i,"//"+i,n.location.protocol+"//"+i])}return a.length&&(u+="trustedOrigins="+o(a.join(","))),e.forceEnhancedClipboard===!0&&(u+=(u?"&":"")+"forceEnhancedClipboard=true"),typeof e.swfObjectId=="string"&&e.swfObjectId&&(u+=(u?"&":"")+"swfObjectId="+o(e.swfObjectId)),u},gt=function(e){if(e==null||e==="")return null;e=e.replace(/^\s+|\s+$/g,"");if(e==="")return null;var t=e.indexOf("//");e=t===-1?e:e.slice(t+2);var n=e.indexOf("/");return e=n===-1?e:t===-1||n===0?null:e.slice(0,n),e&&e.slice(-4).toLowerCase()===".swf"?null:e||null},yt=function(){var e=function(e){var t,n,r,i=[];typeof e=="string"&&(e=[e]);if(typeof e!="object"||!e||typeof e.length!="number")return i;for(t=0,n=e.length;t<n;t++)if(m.call(e,t)&&(r=gt(e[t]))){if(r==="*"){i.length=0,i.push("*");break}i.indexOf(r)===-1&&i.push(r)}return i};return function(t,n){var r=gt(n.swfPath);r===null&&(r=t);var i=e(n.trustedDomains),s=i.length;if(s>0){if(s===1&&i[0]==="*")return"always";if(i.indexOf(t)!==-1)return s===1&&t===r?"sameDomain":"always"}return"never"}}(),bt=function(){try{return r.activeElement}catch(e){return null}},wt=function(e,t){if(!e||e.nodeType!==1)return e;if(e.classList)return e.classList.contains(t)||e.classList.add(t),e;if(t&&typeof t=="string"){var n=(t||"").split(/\s+/);if(e.nodeType===1)if(!e.className)e.className=t;else{var r=" "+e.className+" ",i=e.className;for(var s=0,o=n.length;s<o;s++)r.indexOf(" "+n[s]+" ")<0&&(i+=" "+n[s]);e.className=i.replace(/^\s+|\s+$/g,"")}}return e},Et=function(e,t){if(!e||e.nodeType!==1)return e;if(e.classList)return e.classList.contains(t)&&e.classList.remove(t),e;if(typeof t=="string"&&t){var n=t.split(/\s+/);if(e.nodeType===1&&e.className){var r=(" "+e.className+" ").replace(/[\n\t]/g," ");for(var i=0,s=n.length;i<s;i++)r=r.replace(" "+n[i]+" "," ");e.className=r.replace(/^\s+|\s+$/g,"")}}return e},St=function(e,t){var r=n.getComputedStyle(e,null).getPropertyValue(t);return t!=="cursor"||!!r&&r!=="auto"||e.nodeName!=="A"?r:"pointer"},xt=function(){var e,t,n,i=1;return typeof r.body.getBoundingClientRect=="function"&&(e=r.body.getBoundingClientRect(),t=e.right-e.left,n=r.body.offsetWidth,i=h(t/n*100)/100),i},Tt=function(e){var t={left:0,top:0,width:0,height:0};if(e.getBoundingClientRect){var i=e.getBoundingClientRect(),s,o,u;"pageXOffset"in n&&"pageYOffset"in n?(s=n.pageXOffset,o=n.pageYOffset):(u=xt(),s=h(r.documentElement.scrollLeft/u),o=h(r.documentElement.scrollTop/u));var a=r.documentElement.clientLeft||0,f=r.documentElement.clientTop||0;t.left=i.left+s-a,t.top=i.top+o-f,t.width="width"in i?i.width:i.right-i.left,t.height="height"in i?i.height:i.bottom-i.top}return t},Nt=function(){var e;if(P&&(e=lt(M.bridge))){var t=Tt(P);b(e.style,{width:t.width+"px",height:t.height+"px",top:t.top+"px",left:t.left+"px",zIndex:""+kt(F.zIndex)})}},Ct=function(e){M.ready===!0&&(M.bridge&&typeof M.bridge.setHandCursor=="function"?M.bridge.setHandCursor(e):M.ready=!1)},kt=function(e){if(/^(?:auto|inherit)$/.test(e))return e;var t;return typeof e=="number"&&!c(e)?t=e:typeof e=="string"&&(t=kt(f(e,10))),typeof t=="number"?t:"auto"},Lt=function(e){function f(e){var t=e.match(/[\d]+/g);return t.length=3,t.join(".")}function c(e){return!!e&&(e=e.toLowerCase())&&(/^(pepflashplayer\.dll|libpepflashplayer\.so|pepperflashplayer\.plugin)$/.test(e)||e.slice(-13)==="chrome.plugin")}function h(e){e&&(s=!0,e.version&&(a=f(e.version)),!a&&e.description&&(a=f(e.description)),e.filename&&(u=c(e.filename)))}var t,n,r,s=!1,o=!1,u=!1,a="";if(i.plugins&&i.plugins.length)t=i.plugins["Shockwave Flash"],h(t),i.plugins["Shockwave Flash 2.0"]&&(s=!0,a="2.0.0.11");else if(i.mimeTypes&&i.mimeTypes.length)r=i.mimeTypes["application/x-shockwave-flash"],t=r&&r.enabledPlugin,h(t);else if(typeof e!="undefined"){o=!0;try{n=new e("ShockwaveFlash.ShockwaveFlash.7"),s=!0,a=f(n.GetVariable("$version"))}catch(p){try{n=new e("ShockwaveFlash.ShockwaveFlash.6"),s=!0,a="6.0.21"}catch(d){try{n=new e("ShockwaveFlash.ShockwaveFlash"),s=!0,a=f(n.GetVariable("$version"))}catch(v){o=!1}}}}M.disabled=s!==!0,M.outdated=a&&l(a)<l(_),M.version=a||"0.0.0",M.pluginType=u?"pepper":o?"activex":s?"netscape":"unknown"};Lt(u);var At=function(){if(!(this instanceof At))return new At;typeof At._createClient=="function"&&At._createClient.apply(this,y(arguments))};try{v(At,"version",{value:"2.1.3",writable:!1,configurable:!0,enumerable:!0})}catch(Ot){}At.config=function(){return I.apply(this,y(arguments))},At.state=function(){return q.apply(this,y(arguments))},At.isFlashUnusable=function(){return R.apply(this,y(arguments))},At.on=function(){return U.apply(this,y(arguments))},At.off=function(){return z.apply(this,y(arguments))},At.handlers=function(){return W.apply(this,y(arguments))},At.emit=function(){return X.apply(this,y(arguments))},At.create=function(){return V.apply(this,y(arguments))},At.destroy=function(){return $.apply(this,y(arguments))},At.setData=function(){return J.apply(this,y(arguments))},At.clearData=function(){return K.apply(this,y(arguments))},At.getData=function(){return Q.apply(this,y(arguments))},At.focus=At.activate=function(){return G.apply(this,y(arguments))},At.blur=At.deactivate=function(){return Y.apply(this,y(arguments))},At.activeElement=function(){return Z.apply(this,y(arguments))};var Mt=0,_t={},Dt=0,Pt={},Ht={};b(F,{autoActivate:!0});var Bt=function(e){var t=this;t.id=""+Mt++,_t[t.id]={instance:t,elements:[],handlers:{}},e&&t.clip(e),At.on("*",function(e){return t.emit(e)}),At.on("destroy",function(){t.destroy()}),At.create()},jt=function(e,t){var n,r,i,s={},o=_t[this.id]&&_t[this.id].handlers;if(typeof e=="string"&&e)i=e.toLowerCase().split(/\s+/);else if(typeof e=="object"&&e&&typeof t=="undefined")for(n in e)m.call(e,n)&&typeof n=="string"&&n&&typeof e[n]=="function"&&this.on(n,e[n]);if(i&&i.length){for(n=0,r=i.length;n<r;n++)e=i[n].replace(/^on/,""),s[e]=!0,o[e]||(o[e]=[]),o[e].push(t);s.ready&&M.ready&&this.emit({type:"ready",client:this});if(s.error){var u=["disabled","outdated","unavailable","deactivated","overdue"];for(n=0,r=u.length;n<r;n++)if(M[u[n]]){this.emit({type:"error",name:"flash-"+u[n],client:this});break}}}return this},Ft=function(e,t){var n,r,i,s,o,u=_t[this.id]&&_t[this.id].handlers;if(arguments.length===0)s=d(u);else if(typeof e=="string"&&e)s=e.split(/\s+/);else if(typeof e=="object"&&e&&typeof t=="undefined")for(n in e)m.call(e,n)&&typeof n=="string"&&n&&typeof e[n]=="function"&&this.off(n,e[n]);if(s&&s.length)for(n=0,r=s.length;n<r;n++){e=s[n].toLowerCase().replace(/^on/,""),o=u[e];if(o&&o.length)if(t){i=o.indexOf(t);while(i!==-1)o.splice(i,1),i=o.indexOf(t,i)}else o.length=0}return this},It=function(e){var t=null,n=_t[this.id]&&_t[this.id].handlers;return n&&(typeof e=="string"&&e?t=n[e]?n[e].slice(0):[]:t=w(n)),t},qt=function(e){if(Xt.call(this,e)){typeof e=="object"&&e&&typeof e.type=="string"&&e.type&&(e=b({},e));var t=b({},tt(e),{client:this});Vt.call(this,t)}return this},Rt=function(e){e=$t(e);for(var t=0;t<e.length;t++)if(m.call(e,t)&&e[t]&&e[t].nodeType===1){e[t].zcClippingId?Pt[e[t].zcClippingId].indexOf(this.id)===-1&&Pt[e[t].zcClippingId].push(this.id):(e[t].zcClippingId="zcClippingId_"+Dt++,Pt[e[t].zcClippingId]=[this.id],F.autoActivate===!0&&Jt(e[t]));var n=_t[this.id]&&_t[this.id].elements;n.indexOf(e[t])===-1&&n.push(e[t])}return this},Ut=function(e){var t=_t[this.id];if(!t)return this;var n=t.elements,r;typeof e=="undefined"?e=n.slice(0):e=$t(e);for(var i=e.length;i--;)if(m.call(e,i)&&e[i]&&e[i].nodeType===1){r=0;while((r=n.indexOf(e[i],r))!==-1)n.splice(r,1);var s=Pt[e[i].zcClippingId];if(s){r=0;while((r=s.indexOf(this.id,r))!==-1)s.splice(r,1);s.length===0&&(F.autoActivate===!0&&Kt(e[i]),delete e[i].zcClippingId)}}return this},zt=function(){var e=_t[this.id];return e&&e.elements?e.elements.slice(0):[]},Wt=function(){this.unclip(),this.off(),delete _t[this.id]},Xt=function(e){if(!e||!e.type)return!1;if(e.client&&e.client!==this)return!1;var t=_t[this.id]&&_t[this.id].elements,n=!!t&&t.length>0,r=!e.target||n&&t.indexOf(e.target)!==-1,i=e.relatedTarget&&n&&t.indexOf(e.relatedTarget)!==-1,s=e.client&&e.client===this;return r||i||s?!0:!1},Vt=function(e){if(typeof e!="object"||!e||!e.type)return;var t=it(e),r=_t[this.id]&&_t[this.id].handlers["*"]||[],i=_t[this.id]&&_t[this.id].handlers[e.type]||[],s=r.concat(i);if(s&&s.length){var o,u,a,f,l,c=this;for(o=0,u=s.length;o<u;o++)a=s[o],f=c,typeof a=="string"&&typeof n[a]=="function"&&(a=n[a]),typeof a=="object"&&a&&typeof a.handleEvent=="function"&&(f=a,a=a.handleEvent),typeof a=="function"&&(l=b({},e),st(a,f,[l],t))}return this},$t=function(e){return typeof e=="string"&&(e=[]),typeof e.length!="number"?[e]:e},Jt=function(e){if(!e||e.nodeType!==1)return;var t=function(e){if(!e&&!(e=n.event))return;e._source!=="js"&&(e.stopImmediatePropagation(),e.preventDefault()),delete e._source},r=function(r){if(!r&&!(r=n.event))return;t(r),At.focus(e)};e.addEventListener("mouseover",r,!1),e.addEventListener("mouseout",t,!1),e.addEventListener("mouseenter",t,!1),e.addEventListener("mouseleave",t,!1),e.addEventListener("mousemove",t,!1),Ht[e.zcClippingId]={mouseover:r,mouseout:t,mouseenter:t,mouseleave:t,mousemove:t}},Kt=function(e){if(!e||e.nodeType!==1)return;var t=Ht[e.zcClippingId];if(typeof t!="object"||!t)return;var n,r,i=["move","leave","enter","out","over"];for(var s=0,o=i.length;s<o;s++)n="mouse"+i[s],r=t[n],typeof r=="function"&&e.removeEventListener(n,r,!1);delete Ht[e.zcClippingId]};At._createClient=function(){Bt.apply(this,y(arguments))},At.prototype.on=function(){return jt.apply(this,y(arguments))},At.prototype.off=function(){return Ft.apply(this,y(arguments))},At.prototype.handlers=function(){return It.apply(this,y(arguments))},At.prototype.emit=function(){return qt.apply(this,y(arguments))},At.prototype.clip=function(){return Rt.apply(this,y(arguments))},At.prototype.unclip=function(){return Ut.apply(this,y(arguments))},At.prototype.elements=function(){return zt.apply(this,y(arguments))},At.prototype.destroy=function(){return Wt.apply(this,y(arguments))},At.prototype.setText=function(e){return At.setData("text/plain",e),this},At.prototype.setHtml=function(e){return At.setData("text/html",e),this},At.prototype.setRichText=function(e){return At.setData("application/rtf",e),this},At.prototype.setData=function(){return At.setData.apply(this,y(arguments)),this},At.prototype.clearData=function(){return At.clearData.apply(this,y(arguments)),this},At.prototype.getData=function(){return At.getData.apply(this,y(arguments))},typeof define=="function"&&define.amd?define("lib-app/ZeroClipboard/ZeroClipboard.min",[],function(){return At}):typeof module=="object"&&module&&typeof module.exports=="object"&&module.exports?module.exports=At:e.ZeroClipboard=At}(function(){return this||window}()),define("lib-build/css!storymaps/common/_resources/font/builder-share/css/share-font",[],function(){}),define("storymaps/common/ui/share/ShareURLPanel",["lib-build/tpl!./ShareURLPanel","lib-build/css!./ShareURLPanel","../../utils/SocialSharing","dojo/has","lib-app/ZeroClipboard/ZeroClipboard.min","lib-build/css!storymaps/common/_resources/font/builder-share/css/share-font.css"],function(e,t,n,r,i){return function(s){function u(e,t){o.val(e),s.find(".btn-bitlylink-open").attr("href",e),n.requestBitly(e).then(function(e){o.val(e),(t===undefined||t===!0)&&o.select()}),i.config({swfPath:(app.isProduction?"resources/lib/":"lib-app")+"/ZeroClipboard/ZeroClipboard.swf"});var r=new i(s.find(".share-btn"));r.on("copy",function(e){var t=e.clipboardData;t.setData("text/plain",s.find(".bitlylink").val()),s.find(".share-btn").removeClass("share-clipboard").addClass("share-ok"),s.find(".share-status").show(),s.find(".bitlylink")[0].selectionStart=s.find(".bitlylink")[0].selectionEnd=-1,s.find(".bitlylink").focus(),setTimeout(function(){s.find(".share-btn").addClass("share-clipboard").removeClass("share-ok"),s.find(".share-status").hide()},2e3)})}function a(){s.find(".bitlylink").click(function(){this.setSelectionRange(0,this.value.length)})}s.append(e({}));var o=s.find(".bitlylink");a(),this.present=function(e,t){u(e,t),s.find(".btn-bitlylink-open").html(i18n.viewer.shareFromCommon.open),s.find(".share-url-container").toggleClass("touch",!!r("touch")),s.find(".share-btn").attr("title",i18n.viewer.shareFromCommon.copy),s.find(".share-status").html(i18n.viewer.shareFromCommon.copied)},this.focus=function(){o.select()}}}),define("lib-build/tpl!storymaps/common/ui/share/ShareEmbedPanel",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="share-embed-container">\r\n	<div class="embed-explain"></div>\r\n\r\n	<div class="share-embed-wrapper">\r\n		<div class="share-btn share-clipboard"></div>	\r\n		<textarea class="form-control embedTextarea" readonly="true"></textarea>\r\n	</div>\r\n	<div class="share-status-wrapper"><span class="share-status"></span></div>\r\n	\r\n	<div>\r\n		<span class="embed-lbl-size"></span>\r\n		<div class="btn-group">\r\n			<button class="btn btn-default btn-sm dropdown-toggle" type="button" data-toggle="dropdown">\r\n				<span class="embed-sizes-btn"></span>&nbsp;<span class="caret"></span>\r\n			</button>\r\n			<ul class="dropdown-menu embed-sizes" role="menu"></ul>\r\n		</div>\r\n	</div>\r\n</div>\r\n';return __p}}),define("lib-build/css!storymaps/common/ui/share/ShareEmbedPanel",[],function(){}),define("storymaps/common/ui/share/ShareEmbedPanel",["lib-build/tpl!./ShareEmbedPanel","lib-build/css!./ShareEmbedPanel","dojo/has","lib-app/ZeroClipboard/ZeroClipboard.min","lib-build/css!storymaps/common/_resources/font/builder-share/css/share-font.css"],function(e,t,n,r){return function(i){function a(){$.each(o,function(e,t){i.find(".embed-sizes").append('<li><a data-width="'+t.width+'" data-height="'+t.height+'">'+t.width+" / "+t.height+"</a></li>")}),i.find(".embed-sizes a").click(function(){var e=$(this);e.parents(".btn-group").find(".embed-sizes-btn").text(e.text()),f(e.data("width"),e.data("height"))})}function f(e,t){i.find(".embedTextarea").val(s.replace("%URL%",u).replace("%WIDTH%",e).replace("%HEIGHT%",t)),r.config({swfPath:(app.isProduction?"resources/lib/":"lib-app")+"/ZeroClipboard/ZeroClipboard.swf"});var n=new r(i.find(".share-btn"));n.on("copy",function(e){var t=e.clipboardData;t.setData("text/plain",i.find(".embedTextarea").val()),i.find(".share-btn").removeClass("share-clipboard").addClass("share-ok"),i.find(".share-status").show(),i.find(".embedTextarea")[0].selectionStart=i.find(".embedTextarea")[0].selectionEnd=-1,i.find(".bitlylink").focus(),setTimeout(function(){i.find(".share-btn").addClass("share-clipboard").removeClass("share-ok"),i.find(".share-status").hide()},2e3)})}function l(){i.find(".embedTextarea").click(function(){this.setSelectionRange(0,this.value.length)})}var s='<iframe width="%WIDTH%" height="%HEIGHT%" src="%URL%" frameborder="0" scrolling="no"></iframe>',o=[{width:"100%",height:"800px"},{width:"100%",height:"640px"},{width:"800px",height:"600px"},{width:"640px",height:"480px"}],u=null;i.append(e({})),a(),l(),this.present=function(e){u=e,i.find(".embed-explain").html(i18n.viewer.shareFromCommon.embedExplain),i.find(".embed-lbl-size").html(i18n.viewer.shareFromCommon.size),i.find(".embed-sizes a").eq(0).click(),i.find(".share-embed-wrapper").toggleClass("touch",!!n("touch")),i.find(".share-clipboard").attr("title",i18n.viewer.shareFromCommon.copy),i.find(".share-status").html(i18n.viewer.shareFromCommon.copied)}}}),define("storymaps/common/ui/share/ShareDialog",["lib-build/tpl!./ShareDialog","lib-build/css!./ShareDialog","./ShareURLPanel","./ShareEmbedPanel","../../utils/SocialSharing"],function(e,t,n,r,i){return function(s){function a(e){var t=$("<div>"+app.data.getWebAppData().getTitle()+"</div>").text();s.find(".share_facebook").toggle(e.facebook),e.facebook&&s.find(".share_facebook").off("click").click(function(){i.shareFacebook("","",null,$(this).data("url"))}),s.find(".share_twitter").toggle(e.twitter),e.twitter&&s.find(".share_twitter").off("click").click(function(){i.shareTwitter(t,$(this).data("url"))})}s.append(e({}));var o=new n(s.find(".share-url-panel")),u=new r(s.find(".share-embed-panel"));s.on("shown.bs.modal",function(){o.focus()}),this.present=function(e,t){t=t||{facebook:!1,twitter:!1},s.find(".social-container").toggle(t.facebook||t.twitter),a(t),o.present(e),u.present(e),s.find(".modal-title").html(i18n.viewer.headerFromCommon.share),s.find(".embed-title").html(i18n.viewer.shareFromCommon.embed),s.find(".btn-close").html(i18n.viewer.common.close),s.modal({keyboard:!0})}}}),define("storymaps/common/utils/HeaderHelper",["./SocialSharing","../ui/share/ShareDialog"],function(e,t){function r(e){e.find(".linkContainer").parent().length&&e.find(".linkContainer").css("width",(e.find(".logoContainer").position()||{left:186}).left-e.find(".linkContainer").parent().position().left-e.find(".shareBtns").outerWidth()-($(".logoContainer").width()>1?14:4))}var n=new t($("#shareDialog"));return{setLogo:function(e,t,n){!t.logoURL||t.logoURL=="NO_LOGO"?(e.find(".logoImg").hide(),r(e)):(e.find(".logoLink").css("cursor",t.logoTarget?"pointer":"default"),t.logoTarget&&e.find(".logoLink").attr("href",t.logoTarget),r(e),e.find(".logoImg")[0].onload=function(){r(e),n&&typeof n=="function"&&n()},e.find(".logoImg")[0].onerror=function(){r(e)},e.find(".logoImg").attr("src",t.logoURL).show())},setLink:function(e,t){t.linkURL&&t.linkText?e.find(".linkContainer").html('<a href="'+t.linkURL+'" class="link" target="_blank" tabindex="-1">'+t.linkText+"</a>"):e.find(".linkContainer").html(t.linkText)},setSocial:function(e,t){var n=app.cfg.HEADER_SOCIAL,r=t.socialBtn,i=n&&n.facebook&&(!r||r.facebook),s=n&&n.twitter&&(!r||r.twitter),o=n&&n.bitly&&n.bitly.enable&&n.bitly.login&&n.bitly.key&&(!r||r.bitly);e.find(".share_facebook").toggleClass("active",i),e.find(".share_twitter").toggleClass("active",s),e.find(".share_bitly").toggleClass("active",o),e.find(".share-all").data("share-facebook",i).data("share-twitter",s).toggleClass("active",i||s||o)},toggleSocialBtnAppSharing:function(e,t){t&&e.find(".shareIcon").attr("title",""),e.find(".shareIcon").toggleClass("disabled",!!t).tooltip(t?{title:i18n.commonCore?i18n.commonCore.builderPanel.tooltipNotShared:"",container:"body"}:"destroy")},initEvents:function(t){t.find(".share_facebook").off("click").click(function(){if($(this).hasClass("disabled"))return;var t=$("<div>"+(app.data.getWebAppData().getTitle()||"")+"</div>").text(),n=$("<div>"+(app.data.getWebAppData().getSubtitle()||"")+"</div>").text();e.shareFacebook(t,n,null,$(this).data("url"))}),t.find(".share_twitter").off("click").click(function(){if($(this).hasClass("disabled"))return;var t=$("<div>"+(app.data.getWebAppData().getTitle()||app.data.getWebMap().item.title||"")+"</div>").text();e.shareTwitter(t,$(this).data("url"))}),t.find(".share_bitly").off("click").click(function(){if($(this).hasClass("disabled"))return;var t=$(this).data("url")||document.location.href;n.present(e.cleanURL(t,!0))}),t.find(".share-all").off("click").click(function(){if($(this).hasClass("disabled"))return;var t=$(this).data("url")||document.location.href;n.present(e.cleanURL(t,!0),{facebook:!!$(this).data("share-facebook"),twitter:!!$(this).data("share-twitter")})}),t.find(".shareIcon, .share-all").off("keypress").keypress(function(e){if(e.which==13)return $(this).click(),!1}),t.find(".share_facebook").attr("title",i18n.viewer.headerFromCommon.facebookTooltip),t.find(".share_twitter").attr("title",i18n.viewer.headerFromCommon.twitterTooltip),t.find(".share_bitly").attr("title",i18n.viewer.headerFromCommon.bitlyTooltip),$(window).resize(function(){r(t)})}}}),define("lib-build/css!storymaps/common/builder/InlineFieldEdit",[],function(){}),define("storymaps/common/builder/InlineFieldEdit",["lib-build/css!./InlineFieldEdit","dojo/has"],function(e,t){return function(n,r,i){function o(e,t,n){if(!e||!t||!n)return;typeof r=="function"&&r(),s=n,t.parent().parent().addClass("isEditing"),t.hide(),e.hide(),n.val(t.html()),n.show(),n.select()}function u(e){if(!e||!e.get(0))return;s=null;var n=e.get(0).value,r=e.parent().find(".text_edit_label"),o=e.parent().find(".text_edit_icon"),u=r.parent().first();n===""&&(n=i18n.commonCore.inlineFieldEdit.editMe),n=n.replace(/<\/?script>/g,""),r.parent().parent().removeClass("isEditing"),r.html(n),r.show(),e.hide(),o.css("display","inline-block"),t("ios")&&document.activeElement.blur(),typeof i=="function"&&i(u,n)}var s=null;n.find(".text_edit_icon").click(function(){o($(this),$(this).parent().find(".text_edit_label"),$(this).parent().find(".text_edit_input"))}),n.find(".text_edit_label").click(function(){o($(this).parent().find(".text_edit_icon"),$(this),$(this).parent().find(".text_edit_input"))}),n.find(".text_edit_input").blur(function(){u($(this))}),t("ios")&&$("body").bind("touchstart",function(e){s&&e.target!=s.get(0)&&u(s)}),n.find(".text_edit_input").keypress(function(e){var t=e.keyCode?e.keyCode:e.which;t=="13"&&u($(this))})}}),define("storymaps/common/ui/header/Desktop",["lib-build/css!./Desktop","../../utils/HeaderHelper","../../builder/InlineFieldEdit","../../utils/CommonHelper","dojo/has","dojo/topic"],function(e,t,n,r,i,s){return function(o,u){function f(){$("#headerDesktop .subtitle:visible").length?$("#headerDesktop .subtitle")[0].focus():$("#headerDesktop .title")[0].focus()}function l(e){o.css("background-color",e.header),o.find(".textArea").css("color",e.headerTitle),o.find(".rightArea").css("color",e.headerText)}function c(e,n){var r=e.compactSize===undefined?n:e.compactSize;t.setLogo(o,e,a.resize),t.setLink(o,e),t.setSocial(o,e),t.initEvents(o,"bottom"),o.toggleClass("compact",r),r&&(o.find(".rightArea").hide(),setTimeout(function(){o.find(".rightArea").show()},0))}function h(e){var t=o.find(".check-story");e=="start"?t.html('<span class="small-loader"></span>'+i18n.viewer.headerFromCommon.checking).css("cursor","default"):e=="error"?t.html(i18n.viewer.headerFromCommon.fix).css("cursor","pointer").click(r.switchToBuilder).show().removeClass("btn-warning").addClass("btn-danger"):t.html(i18n.viewer.headerFromCommon.noerrors).removeClass("btn-warning").addClass("btn-success")}function p(){}function d(e,t){setTimeout(function(){s.publish("HEADER_EDITED",{src:$(e).attr("class").split(" ")[0],value:t}),$(e).removeClass("error")},i("ios")||i("ie")>=10?700:0),app.builder.hideSaveConfirmation()}var a=this;this.init=function(e,t,i,a,f,v,m){l(f);if(e){o.addClass("hideDesktop");return}u&&(o.addClass("isBuilder"),t="<div class='text_edit_label'>"+(t||i18n.commonCore.inlineFieldEdit.editMe)+"</div>",t+="<div class='text_edit_icon' title='"+i18n.commonCore.header.title.replace("%TPL_NAME%",app.cfg.TPL_NAME)+"'></div>",t+="<textarea rows='1' class='text_edit_input form-control' type='text' spellcheck='true'></textarea>",i="<span class='text_edit_label'>"+(i||i18n.commonCore.inlineFieldEdit.editMe)+"</span>",i+="<div class='text_edit_icon' title='"+i18n.commonCore.header.subtitle.replace("%TPL_NAME%",app.cfg.TPL_NAME)+"'></div>",i+="<textarea rows='3' class='text_edit_input form-control' type='text' spellcheck='true'></textarea>"),o.find(".title").html(t),o.find(".subtitle").html(i),u&&new n(o,p,d);if(!u&&!i){var g=a.compactSize===undefined?m:a.compactSize;g||(o.find(".title").css({paddingTop:30,height:90}),o.find(".subtitle").css("height",32).attr("tabindex","-1"))}v&&o.find(".switchBuilder").html('<span class="glyphicon glyphicon-cog"></span>'+i18n.viewer.headerFromCommon.builderButton).click(r.switchToBuilder).show(),!app.isInBuilder&&app.data.userIsAppOwner()&&(o.find(".error-status").addClass("enabled"),s.subscribe("MYSTORIES_SCAN",h)),c(a,m)},this.resize=function(e){e||(e=$(document).width());var t=Math.max(o.find(".logoImg").outerWidth()+50,o.find(".rightArea").outerWidth()+20);o.find(".textArea").width(e-t-15)},this.update=function(e,t,n){l(t),c(e,n)},this.getTitle=function(){return u?o.find(".title .text_edit_label").html():o.find(".title").html()},this.getSubtitle=function(){return u?o.find(".subtitle .text_edit_label").html():o.find(".subtitle").html()},this.setTitleAndSubtitle=function(e,t){e&&app.data.getWebAppData().setTitle(e),t&&app.data.getWebAppData().setSubtitle(t);var n=u?i18n.commonCore.inlineFieldEdit.editMe:"";o.find(".title"+(u?" .text_edit_label":"")).html(e||n),o.find(".subtitle"+(u?" .text_edit_label":"")).html(t||n)},this.toggleSocialBtnAppSharing=function(e){t.toggleSocialBtnAppSharing(o,e)},this.focus=function(e){!e||e.area=="social"?($("#headerDesktop .shareIcon").attr("tabindex","0"),$("#headerDesktop .linkContainer a").length?$("#headerDesktop .linkContainer a").attr("tabindex","0")[0].focus():$("#headerDesktop .linkContainer").length?$("#headerDesktop .linkContainer").attr("tabindex","0")[0].focus():$("#headerDesktop .shareIcon:visible").length?$("#headerDesktop .shareIcon")[0].focus():f()):f()},this.setTitleError=function(){o.find(".title").addClass("error")},this.initLocalization=function(){}}}),define("lib-build/css!storymaps/tpl/core/MainView",[],function(){}),define("storymaps/tpl/core/Config",[],function(){var e="resources/tpl/viewer/icons/esri-logo-white.png",t="http://www.esri.com",n="A story map",r="http://storymaps.arcgis.com";return app.appCfg={supportWebmapPreviewAGOL:!1,useWebmapInApp:!0,useStandardHeader:!0,useAppTitleAsPageTitle:!0,headerCompactOpt:!0,headerCompactByDefault:!1,mapsImmediateResize:!0,mapCommandLargerTouch:!1},{checkConfigFileIsOK:function(){return app.cfg.HEADER_LOGO_URL=e,app.cfg.HEADER_LOGO_TARGET=t,app.cfg.HEADER_LINK_TEXT=n,app.cfg.HEADER_LINK_URL=r,app.cfg&&app.cfg.HEADER_LOGO_URL!==undefined&&app.cfg.HEADER_LOGO_TARGET!==undefined&&app.cfg.HEADER_LINK_TEXT!==undefined&&app.cfg.HEADER_LINK_URL!==undefined&&app.cfg.HEADER_SOCIAL&&app.cfg.TIMEOUT_VIEWER_LOAD&&app.cfg.TIMEOUT_VIEWER_REQUEST&&app.cfg.TIMEOUT_BUILDER_REQUEST&&app.cfg.HELP_URL&&app.cfg.HELP_URL_PORTAL&&app.cfg.TPL_NAME&&app.cfg.WEBAPP_TAG&&app.cfg.WEBAPP_KEYWORD_GENERIC&&app.cfg.WEBAPP_KEYWORD_APP&&app.cfg.AUTHORIZED_IMPORT_SOURCE&&app.cfg.FLICKR_API_KEY&&app.cfg.FACEBOOK_APP_ID&&app.cfg.YOUTUBE_DISABLE_ON_PORTAL!==undefined&&app.cfg.YOUTUBE_API_KEY&&app.cfg.CORS_SERVER&&app.cfg.DEFAULT_SHARING_URL&&app.cfg.DEFAULT_PROXY_URL}}}),define("storymaps/tpl/core/WebApplicationData",["dojo/_base/lang"],function(e){var t={},n={values:{tabs:[]}};return{set:function(r){t=e.clone(r);if(!r||!r.values)return;n=r},get:function(){var t=e.clone(n);return t.values.template=t.values.template||{},t.values.template={name:t.values.template.name||app.cfg.TPL_NAME,createdWith:t.values.template.createdWith||app.version,editedWith:app.version},t},getOriginalData:function(){return t},isBlank:function(){return Object.keys(n.values).length<=2},getBlank:function(){return{values:{webmap:t.values.webmap}}},getSourceWebmap:function(){return t&&t.values?t.values.webmap:null},cleanWebAppAfterInitialization:function(){return!1},restoreOriginalData:function(){this.set(t)},updateAfterSave:function(){t=e.clone(n)},getTemplateVersion:function(){return n.values.template?n.values.template.editedWith:null},getTemplateCreation:function(){return n.values.template?n.values.template.creaedWith:null},getDoNotWarnTitle:function(){return n.values.doNotWarnTitle||!1},setDoNotWarnTitle:function(e){n.values.doNotWarnTitle=e},getWebmap:function(){return n.values.webmap},setWebmap:function(e){n.values.webmap=e},getResponse:function(){return n.values.response},setResponse:function(e){n.values.response=e},getOriginalWebmap:function(){return n.values.originalWebmap},setOriginalWebmap:function(e){n.values.originalWebmap=e},getTitle:function(){return n.values.title},setTitle:function(e){n.values.title=e},getSubtitle:function(){return n.values.subtitle},setSubtitle:function(e){n.values.subtitle=e},getSettings:function(){return n.values.settings||{}},getLayoutId:function(){return"shortlist-classic"},getLayers:function(){return n.values.layers},setLayers:function(e){n.values.layers||(n.values.layers=[]),n.values.layers.push(e)},getShortlistLayerId:function(){return n.values.shortlistLayerId},setShortlistLayerId:function(e){n.values.shortlistLayerId=e},getTabs:function(){return n.values.tabs},setTabs:function(e){n.values.tabs=e},clearLayers:function(){n.values.layers=[]},reverseContentLayers:function(){n.values.contentLayers.reverse()},getSupportLayers:function(){return n.values.supportLayers},setSupportLayers:function(e){n.values.supportLayers||(n.values.supportLayers=[]),n.values.supportLayers.push(e)},getStoryTestPanel:function(){return n.values.testPanel},setStoryTestPanel:function(e){n.values.testPanel=e},getLocateBtn:function(){return!0},getGeneralOptions:function(){var t=e.clone(this.getSettings().generalOptions)||{};return t},setGeneralOptions:function(e){n.values.settings=n.values.settings||{},n.values.settings.generalOptions=e},setDefaultGeneralOptions:function(){this.setGeneralOptions({numberedIcons:!1,mapsSync:!1,filterByExtent:!0,moreInfoLink:!1,moreInfoLinkAlias:"More info"})},getMapOptions:function(){var t=e.clone(this.getSettings().mapOptions)||{};return t},setMapOptions:function(e){n.values.settings=n.values.settings||{},n.values.settings.mapOptions=e},setDefaultMapOptions:function(){this.setMapOptions({locateBtn:!1,geocoder:!1,bookmarks:!1})},getLayoutOptions:function(){var t=e.clone(this.getSettings().layoutOptions)||{};return t},setLayoutOptions:function(e){n.values.settings=n.values.settings||{},n.values.settings.layoutOptions=e},setDefaultLayoutOptions:function(){this.setLayoutOptions({description:!0})},getColors:function(){return{}},getHeader:function(){return this.getSettings().header||{}},setHeader:function(e){n.values.settings=n.values.settings||{},n.values.settings.header=e},getHeaderLinkText:function(){return this.getHeader().linkText===undefined?app.cfg.HEADER_LINK_TEXT:this.getHeader().linkText},getHeaderLinkURL:function(){return this.getHeader().linkURL===undefined?app.cfg.HEADER_LINK_URL:this.getHeader().linkURL},getLogoURL:function(e){var t=this.getHeader().logoURL?this.getHeader().logoURL:app.cfg.HEADER_LOGO_URL;return t==app.cfg.HEADER_LOGO_URL&&this.getColors()&&(e?this.getColors().esriLogoMobile=="white"&&(t="resources/tpl/viewer/icons/esri-logo-white.png"):this.getColors().esriLogo=="white"&&(t="resources/tpl/viewer/icons/esri-logo-white.png")),t},getLogoTarget:function(){return!this.getHeader().logoURL||this.getHeader().logoURL==app.cfg.HEADER_LOGO_URL?app.cfg.HEADER_LOGO_TARGET:this.getHeader().logoTarget},getSocial:function(){return this.getHeader().social},getHeaderCompactSize:function(){return this.getHeader().compactSize}}}),define("storymaps/tpl/core/Data",["./WebApplicationData","storymaps/common/utils/CommonHelper"],function(e,t){return function(){var r=null,i=null,s=null,o=null,u={};this.getWebMap=function(){return r},this.setWebMap=function(e){r=e},this.getShortlistLayerId=function(){return o},this.setShortlistLayerId=function(e){o=e},this.getWebAppItem=function(){return i||{}},this.setWebAppItem=function(e){i=e},this.getResponse=function(){return s},this.setResponse=function(e){s=e},this.getWebAppData=function(){return e},this.updateAfterSave=function(){e.updateAfterSave()},this.userIsAppOwner=function(){return app.portal&&app.portal.getPortalUser()&&app.portal.getPortalUser().username==this.getWebAppItem().owner||t.getPortalUser()!=null&&t.getPortalUser()==this.getWebAppItem().owner},this.userIsOrgaPublisher=function(){var e=app.portal?app.portal.getPortalUser():null;return e&&e.orgId&&(e.role=="org_admin"||e.role=="org_publisher")},this.isOrga=function(){return!app.portal||!app.portal.getPortalUser()?!1:!!app.portal.getPortalUser().orgId},this.debug=function(){},this.getStory=function(){return u},this.setStory=function(e,t,n,r){e in u||(u[e]={title:"",id:e,color:null,extent:null}),t&&(u[e].title=t),n&&(u[e].color=n),r&&(u[e].extent=r)},this.clearStory=function(){u={}},this.getStoryByIndex=function(e){return u[e]},this.getStoryLength=function(){return app.data.getShortlistLayerId()&&app.map.getLayer(app.data.getShortlistLayerId())&&app.map.getLayer(app.data.getShortlistLayerId()).graphics.length?!!app.map.getLayer(app.data.getShortlistLayerId()).graphics.length:!1}}}),define("storymaps/tpl/core/Helper",[],function(){return function(){this.isMobile=function(){var e=navigator.userAgent.match(/Android/i)?!0:!1,t=navigator.userAgent.match(/BlackBerry/i)?!0:!1,n=navigator.userAgent.match(/iPhone|iPad|iPod/i)?!0:!1,r=navigator.userAgent.match(/IEMobile/i)?!0:!1;return e||t||n||r},this.isIE=function(){return navigator.appVersion.indexOf("MSIE")>-1||navigator.userAgent.match(/Trident.*rv\:11\./)},this.isIE8=function(){return parseInt(navigator.userAgent.toLowerCase().split("msie")[1])<9},this.getValueCI=function(e){var t,n;return $.each(this,function(n){if(e.length>1){if(n.toUpperCase()==e[0].toUpperCase()||n.toUpperCase()==e[1].toUpperCase())return t=n,!1}else if(n.toUpperCase()==e[0].toUpperCase())return t=n,!1}),n=this[t],$.trim(n).length===0&&(n=null),n},this.prependURLHTTP=function(e){return!e||e===""||e.match(/^mailto:/)?e:/^(https?:\/\/)|^(\/\/)/i.test(e)?e:"http://"+e}}}),define("lib-build/tpl!storymaps/tpl/ui/desktop/TestPanel",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="userInput"></div>';return __p}}),define("lib-build/css!storymaps/tpl/ui/desktop/TestPanel",[],function(){}),define("lib-build/css!storymaps/tpl/ui/desktop/Common",[],function(){}),define("storymaps/tpl/ui/desktop/TestPanel",["lib-build/tpl!./TestPanel","lib-build/css!./TestPanel","lib-build/css!./Common"],function(e){return function(n,r,i){function s(){n.find(".userInput").attr("contenteditable","true")}function o(){r&&n.find(".userInput").blur(function(){i($(this).html())})}this.init=function(t){t=t||{},n.html(e({})),n.show(),r&&s(),o()},this.update=function(e){e=e||{},n.find(".userInput").html(e.data)},this.resize=function(){},this.showEntryIndex=function(){},this.destroy=function(){}}}),define("lib-build/tpl!storymaps/tpl/ui/desktop/TilePanel",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div id="paneLeft">\r\n	<ul id="myList" class="tilelist"></ul>\r\n	<div class="noFeature">\r\n		<span class="noFeatureText">\r\n			None of these places are in your current map extent.\r\n			Zoom out to see places.\r\n		</span>\r\n	</div>\r\n</div>\r\n';return __p}}),define("lib-build/css!storymaps/tpl/ui/desktop/TilePanel",[],function(){}),define("storymaps/tpl/ui/desktop/TilePanel",["esri/geometry/screenUtils","../../core/Helper","lib-build/tpl!./TilePanel","lib-build/css!./TilePanel","../../core/WebApplicationData"],function(e,t,n,r){return function(r,i,s,o){function l(e){if($("body").hasClass("organizeFeatures"))return;e.which==1||e.which==2||e.which==3?u.tileClick=!0:u.tileClick=!1;var t=$(this).data("shortlist-id");a.preSelection(),a.selected=$.grep(app.layerCurrent.graphics,function(e){return e.attributes.getValueCI(app.cfg.FIELDNAME_ID)==t})[0],a.postSelection(),$("#mobileTitlePage").css("display","none"),a.themeSelected||app.ui.mobileFeatureList.selectTheme(0),a.themeSelected=!0}var u=this,a=i,f=new t;this.tileClick=!0,$(document).bind("cbox_complete",function(){$(".details .rightDiv").height($(".details").height()-$(".detailsTitle").height()-20)}),this.init=function(){$(r).prepend(n({}))},this.resize=function(e){$("#paneLeft").width(e),$(".tilelist").width(e)},this.createTab=function(e,t){$("#tabs").append('<div class="tab" tabindex="0">'+t.title+"</div>")},this.setTabClick=function(){$.each($(".entry"),function(e){$(this).click(function(){a.selected=null,a.activateLayer(e),$(".detailContainer").hide(),app.mapTips&&app.mapTips.clean()})})},this.clearTilePanel=function(){$("#myList").empty()},this.buildTilePanel=function(){u.clearTilePanel();var e,t,n,r,i,o,a=!1;if(!app.layerCurrent||!app.layerCurrent.graphics)return;app.layerCurrent.graphics.sort(function(e,t){return parseInt(e.attributes.number)-parseInt(t.attributes.number)}),$.each(app.layerCurrent.graphics,function(u,f){app.map.extent.contains(f.geometry)?(e="block",a=!0):app.data.getWebAppData().getGeneralOptions().filterByExtent&&!app.isInBuilder&&(e="none"),t=$('<li tabindex="0" id="item'+f.attributes.getValueCI(app.cfg.FIELDNAME_ID)+'" style="display:'+e+'">'),n=$('<div class="tileImage"></div>'),f.attributes.getValueCI(app.cfg.FIELDNAME_THUMBURL)?$(n).css("background-image","url("+f.attributes.getValueCI(app.cfg.FIELDNAME_THUMBURL)+")"):$(n).css("background-image","url("+f.attributes.getValueCI(app.cfg.FIELDNAME_IMAGEURL)+")"),r=$('<div class="footer"></div>');var l=f.attributes.getValueCI(app.cfg.FIELDNAME_TITLE)||"Place Name";o=$('<div class="blurb">'+l+"</div>"),s.getMapOptions().numberedIcons&&(f.attributes.getValueCI(app.cfg.FIELDNAME_NUMBER)<100?i=$('<div class="num" style="background-color:'+app.layerCurrent.color+'">'+f.attributes.getValueCI(app.cfg.FIELDNAME_NUMBER)+"</div>"):(i=$('<div class="num longNum" style="background-color:'+app.layerCurrent.color+'">'+f.attributes.getValueCI(app.cfg.FIELDNAME_NUMBER)+"</div>"),o=$('<div class="blurb longNumBlurb">'+f.attributes.getValueCI(app.cfg.FIELDNAME_TITLE)+"</div>")),$(r).append(i)),$(r).append(o),$(t).append(r),$(t).data("shortlist-id",f.attributes.getValueCI(app.cfg.FIELDNAME_ID)),app.ui.mobileFeatureList.buildList(u,f,t),$(t).append(n),app.isInBuilder&&(f.attributes.locationSet?$(t).addClass("located"):$(t).find(".tileImage").append('<div class="unlocated" style="outline: none;"></div>')),$("#myList").append(t)}),u.setTileEvents(),$("ul.tilelist").animate({scrollTop:0},{duration:200}),!a&&app.data.getWebAppData().getGeneralOptions().filterByExtent&&!app.isInBuilder?$(".noFeature").css("display","block"):$(".noFeature").css("display","none"),s.getMapOptions().numberedIcons||$("ul.tilelist .blurb").addClass("unNumBlurb")},this.findTile=function(e){return $.grep($(r).find($("ul.tilelist li")),function(t){return t.id=="item"+e})[0]},this.findMobileTile=function(e){return $.grep($("ul.mobileTileList li"),function(t){return t.id=="item"+e})[0]},this.setTileEvents=function(){console.log("SET TILE EVENTS"),$("ul.tilelist li").mouseover(u.tile_onMouseOver),$("ul.tilelist li").mouseout(u.tile_onMouseOut),$("ul.tilelist li").click(l),$("#mobilePaneList ul.mobileTileList li").on("tap",l),$("#mobilePaneList ul.mobileTileList li").on("click",l)},this.refreshList=function(){var e,t,n=!1;app.layerCurrent&&app.layerCurrent.graphics.length&&setTimeout(function(){$.each(app.layerCurrent.graphics,function(r,i){e=u.findTile(i.attributes.getValueCI(app.cfg.FIELDNAME_ID)),t=u.findMobileTile(i.attributes.getValueCI(app.cfg.FIELDNAME_ID)),app.data.getWebAppData().getGeneralOptions().filterByExtent&&!app.isInBuilder&&(app.map.extent.contains(i.geometry)?($(e).css("display")=="none"&&$(e).stop().fadeIn(),n=!0):$(e).css("display")!="none"&&$(e).stop().fadeOut(1e3))}),!n&&app.data.getWebAppData().getGeneralOptions().filterByExtent&&!app.isInBuilder?$(".noFeature").css("display","block"):$(".noFeature").css("display","none")},100)},this.initSortable=function(){$("#myList").sortable({update:function(){app.addFeatureBar.updateNumber()}}),$("#myList").addClass("organize")},this.destroySortable=function(){$("#myList").sortable("destroy"),$("#myList").css("background-color","#C7C7C7"),$("body").removeClass("organizeFeatures"),$("#myList").removeClass("organize")},this.tile_onMouseOver=function(){var e=this,t=$.grep(app.layerCurrent.graphics,function(t){return t.attributes.getValueCI(app.cfg.FIELDNAME_ID)==$(e).data("shortlist-id")});t[0].symbol.setWidth(app.cfg.lutIconSpecs.medium.getWidth()),t[0].symbol.setHeight(app.cfg.lutIconSpecs.medium.getHeight()),t[0].symbol.setOffset(app.cfg.lutIconSpecs.medium.getOffsetX(),app.cfg.lutIconSpecs.medium.getOffsetY()),t[0].draw(),f.isIE()||a.moveGraphicToFront(t[0]),a.buildMapHoverTips(t[0].attributes.getValueCI(app.cfg.FIELDNAME_TITLE),t[0])},this.tile_onMouseOut=function(){if(a.selected!=null){var e=parseInt($(this).attr("id").substring(4));if(a.selected.attributes.getValueCI(app.cfg.FIELDNAME_ID)==e)return}var t=this,n=$.grep(app.layerCurrent.graphics,function(e){return e.attributes.getValueCI(app.cfg.FIELDNAME_ID)==$(t).data("shortlist-id")});n[0].symbol.setWidth(app.cfg.lutIconSpecs.tiny.getWidth()),n[0].symbol.setHeight(app.cfg.lutIconSpecs.tiny.getHeight()),n[0].symbol.setOffset(app.cfg.lutIconSpecs.tiny.getOffsetX(),app.cfg.lutIconSpecs.tiny.getOffsetY()),n[0].draw(),app.mapTips&&app.mapTips.clean(!0)}}}),define("lib-build/tpl!storymaps/tpl/ui/desktop/DetailPanel",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="detailContainer swiper-container">\r\n	<button type="button" class=\'detailClose ion-android-close\' style=""></button>\r\n	<div class="detail-btn-container detail-btn-left">\r\n		<div class="detail-btn ion-chevron-left" style="outline: none;"></div>\r\n	</div>\r\n	<div class="detail-btn-container detail-btn-right">\r\n		<div class="detail-btn ion-chevron-right" style="outline: none;"></div>\r\n	</div>\r\n	<div class="detailView swiper-wrapper"></div>\r\n</div>\r\n';return __p}}),define("lib-build/css!storymaps/tpl/ui/desktop/DetailPanel",[],function(){}),define("storymaps/tpl/ui/desktop/DetailPanel",["../../core/Helper","lib-build/tpl!./DetailPanel","lib-build/css!./DetailPanel"],function(e,t){return function(r,i,s,o,u){function y(){var e=$(".entry.active").index();e<0&&(e=0),setTimeout(function(){$(".detailContainer").show(),d[e].slideNext(),d[e].slidePrev(),l.resize(),$(".detailContainer").hide()},0)}function b(){r.find(".userInput").attr("contenteditable","true")}function w(){i&&r.find(".userInput").blur(function(){s($(this).html())})}var a=o,f,l=this,c=new e,h=0,p=!1,d=[],v={},m=!1,g=u;l.loaded=!1,l.viewed=!1,this.init=function(e){e=e||{},$(r).show(),i&&b(),w()},this.buildFeatureViews=function(){var e=$(".entry.active").index();e<0&&(e=0);var n=[],i=app.map.getLayer(app.data.getShortlistLayerId());$.each(i.graphics,function(e,t){t.attributes.getValueCI=c.getValueCI;if(!n[t.attributes.tab_id]){var r={title:"tab "+(n.length+1),features:[]};n.push(r)}t.attributes.locationSet&&n[t.attributes.tab_id].features.push(t)}),p||$.each(n,function(e){if(e===0)$(r).prepend(t({}));else{var n=$(r).find(" .detailContainer")[e-1];$(n).after(t({}))}var i=$(".detailView")[e];$(i).attr("id","detailView"+e),d[e]={},v[String(e)]=[]}),p=!0;if(v[String(e)].length)return;$(".detailContainer").css("z-index","0");var s=$(".detailContainer")[e];$(s).css("z-index","99"),h=0,l.buildSlides(n)},this.buildSlides=function(e){l.loaded=!1,f=e;var t=$(".entry.active").index();t<0&&(t=0);var n=f[t],i=n.features,s=app.cfg.COLOR_ORDER.split(","),o=$("<div></div");for(;h<i.length;h++){var u=i[h].attributes;u.getValueCI||(u.getValueCI=c.getValueCI);var p=u.getValueCI(app.cfg.FIELDNAME_TITLE),b=u.getValueCI(app.cfg.FIELDNAME_SHORTDESC),w=u.getValueCI(app.cfg.FIELDNAME_IMAGEURL),E=c.prependURLHTTP(u.getValueCI(app.cfg.FIELDNAME_WEBSITE)),S=$("<div class='swiper-slide'></div>"),x,T=$("<div class='detailHeader'></div>");if(g.getMapOptions().numberedIcons){var N=$('<div class="detailFeatureNum" style="background-color:'+app.layerCurrent.color+'">'+u.getValueCI(app.cfg.FIELDNAME_NUMBER)+"</div>");$(T).append(N)}else $(".detailFeatureTitle").addClass("notNumbered");p&&$(T).append($("<div class='detailFeatureTitle'></div>").html(p)),$(S).append(T);var C=$('<div class="detailTextContainer"</div>');w&&(x=$("<div></div>").addClass("detailPictureDiv"),$(x).append("<img data-src="+w+' class="swiper-lazy"/>'),$(C).append(x)),b&&$(C).append($("<div class='detailFeatureSubtitle'></div>").html(b));if(!app.cfg.DETAILS_PANEL){var k=u.getValueCI(app.cfg.FIELDNAME_DESC1);k&&$(C).append($("<div class='detailFeatureDesc'></div>").html(k)),E&&$(C).append($('<div class="detailFeatureDesc website"><a class="website" href="'+E+'" target="_blank">'+app.data.getWebAppData().getGeneralOptions().moreInfoLinkAlias+"</a></div>").css("padding-top",10))}else{var L=[app.cfg.FIELDNAME_DESC1,app.cfg.FIELDNAME_DESC2,app.cfg.FIELDNAME_DESC3,app.cfg.FIELDNAME_DESC4,app.cfg.FIELDNAME_DESC5],A;$.each(L,function(e,t){A=u.getValueCI(t),A&&($(C).append('<div class="detailFeatureDesc">'+A+"</div>"),$(C).children().length>0)});var O=u.getValueCI(app.cfg.FIELDNAME_ADDRESS);O&&$(C).append($('<div class="detailFeatureAddress">'+O+"</div>"));var M=u.getValueCI(app.cfg.FIELDNAME_HOURS);M&&$(C).append($('<div class="detailFeatureAddress">'+M+"</div>")),E&&($(C).append('<div class="detailFeatureAddress"><a class="website" href="'+E+'" target="_blank">'+app.data.getWebAppData().getGeneralOptions().moreInfoLinkAlias+"</a></div>"),$(".website").show()),$(C).append('<div style="margin-bottom: 20px;"></div>')}$(S).append(C),$(S).data("shortlist-id",u.getValueCI(app.cfg.FIELDNAME_NUMBER)),$("#detailView"+t).append(S),v[String(t)].push(S);if(h%10===0&&h+1<i.length)return setTimeout(function(){h++,l.buildSlides(e)},0),!1;if(h+1==i.length){var _=new Swiper($(".detailContainer")[t],{speed:0,setWrapperSize:!0,lazyLoading:!0,lazyLoadingInPrevNext:!0});d[t]=_,_.init(),_.update(),_.on("onSlideChangeEnd",function(e){m||a.preSelection();var t=$(".entry.active").index();t<0&&(t=0);if(l.viewed){var n=_.slides[_.activeIndex],r=$(n).data("shortlist-id"),i=$.grep(app.layerCurrent.graphics,function(e){return e.attributes.getValueCI(app.cfg.FIELDNAME_ID)==r})[0];a.selected=i,(!app.map.extent.contains(a.selected.geometry)&&!app.data.getWebAppData().getGeneralOptions().filterByExtent||app.isInBuilder)&&app.map.centerAt(a.selected.geometry)}var s=!0;setTimeout(function(){a.buildMapTips()},0);if($(".showOnce").length){var o=$(".showOnce")[0];$(o).hasClass("swiper-slide-active")||($(".swiper-slide").removeClass("showOnce"),d[t].removeSlide(d[t].previousIndex),d[t].update())}d[t].slides.length==1?$(".detail-btn-container").hide():$(".detail-btn-container").show(),l.resize(),_.update()}),r.find(".detail-btn-left").mouseover(function(){$(".detail-btn-left").css("opacity",1),$(".detail-btn-right").css("opacity",.8)}),r.find(".detail-btn-right").mouseover(function(){$(".detail-btn-right").css("opacity",1),$(".detail-btn-left").css("opacity",.8)}),r.find(".detail-btn-left").mouseout(function(){$(".detail-btn-left").css("opacity",.8)}),r.find(".detail-btn-right").mouseout(function(){$(".detail-btn-right").css("opacity",.8)}),r.find(".detailClose").click(function(){r.find(".detailContainer").hide(),app.ui.mobileIntro.screenSize=="small"&&app.ui.mobileFeatureList.showMobileList(),a.unselect()}),r.find($(".detail-btn-left")[t]).click(function(){d[t].activeIndex===0?d[t].slideTo(d[t].slides.length-1,0):d[t].slidePrev()}),r.find($(".detail-btn-right")[t]).click(function(){d[t].activeIndex==d[t].slides.length-1?d[t].slideTo(0,0):d[t].slideNext()});var D=$.grep(app.cfg.COLOR_SCHEMES,function(e){return e.name==s[t]});$(".detailHeader").css("border-top-color",D[0].color),r.find(".detailPictureDiv img").click(function(){d[t].activeIndex==d[t].slides.length-1?d[t].slideTo(0,0):d[t].slideNext()}),l.refreshSlides(),d[t].update(),y(),l.resize()}}l.loaded=!0,l.viewed=!1},this.showDetails=function(e){l.resize();if(e==null)return;var t=$(".entry.active").index();t<0&&(t=0);var n=$(".detailContainer")[t];$(n).show(),$("#mobilePaneList").css("visibility","hidden");var r;$.each($("#detailView"+t).find($(".swiper-slide")),function(t,n){parseInt($(n).data("shortlist-id"))==e.attributes.getValueCI(app.cfg.FIELDNAME_NUMBER)&&(r=t)}),g.getMapOptions().numberedIcons||$(".detailFeatureTitle").addClass("notNumbered"),r>-1&&setTimeout(function(){d[t].slideTo(r,0),$(n).css("z-index",99)},0),d[t].slides.length==1?$(".detail-btn-container").hide():$(".detail-btn-container").show(),d[t].update();if($(".swiper-slide-active img").width()==0){var i=$(".swiper-slide-active img")[0],s=$(i).attr("data-src");$(i).attr("src",s)}l.viewed=!0},this.refreshSlides=function(){m=!0;if(!app.data.getWebAppData().getGeneralOptions().filterByExtent&&!app.isInBuilder)return;var e=$(".entry.active").index();e<0&&(e=0),$(".detailContainer").css("z-index","0");var t=$(".detailContainer")[e];$(t).css("z-index","99");if(!f)return;var n=f[e],r=n.graphics,i=null;d[e].removeAllSlides(),$.each(r,function(t,n){app.map.extent.contains(n.geometry)&&$.each(v[String(e)],function(t,r){parseInt($(r).data("shortlist-id"))==n.attributes.getValueCI(app.cfg.FIELDNAME_NUMBER)&&(d[e].appendSlide($(r)[0]),a.selected&&parseInt($(r).data("shortlist-id"))==a.selected.attributes.getValueCI(app.cfg.FIELDNAME_NUMBER)&&(i=parseInt(t)))}),a.selected&&!app.map.extent.contains(a.selected.geometry)&&$.each(v[String(e)],function(t,n){parseInt($(n).data("shortlist-id"))==a.selected.attributes.getValueCI(app.cfg.FIELDNAME_NUMBER)&&(d[e].appendSlide($(n)[0]),$(n).addClass("showOnce"))})}),a.selected&&$.each($("#detailView"+e).find($(".swiper-slide")),function(e,t){parseInt($(t).data("shortlist-id"))==a.selected.attributes.getValueCI(app.cfg.FIELDNAME_NUMBER)&&(i=parseInt(e))}),d[e].update(),i!=null&&d[e].slideTo(i,0),d[e].slides.length==1?$(".detail-btn-container").hide():$(".detail-btn-container").show(),m=!1},this.update=function(e){e=e||{},r.find(".detailContainer").html(e.data)},this.resize=function(){setTimeout(function(){var e=35;app.ui.mobileIntro.screenSize=="small"&&($("#paneLeft").css("height",$("#contentPanel").height()-$("#map").height()+10),$("#paneLeft").css("width","100%"),$("#paneLeft").css({top:$("#map").height()-10}),e=20);var t=$(".entry.active").index();t<0&&(t=0);if(!$.isEmptyObject(d[t]))var n=d[t],r=n.slides[n.activeIndex];$(r).height($("#paneLeft").outerHeight()-5);var i=$(r).find(".detailHeader").outerHeight();$(".detailTextContainer").css({"margin-top":"10px"}),$(".detailTextContainer").height($("#paneLeft").outerHeight()-i-e+"px"),$(".detailPictureDiv img").css("max-width",$("#paneLeft").outerWidth());var s=$("#paneLeft").outerHeight()-i-60<$("#paneLeft").outerHeight()*.6?$("#paneLeft").outerHeight()-i-60:$("#paneLeft").outerHeight()*.6;$(".detailPictureDiv img").css("max-height",parseInt(s)+"px"),$(".detailContainer").width($("#paneLeft").outerWidth()),$(".detailContainer").height($("#paneLeft").outerHeight())},0)},this.showEntryIndex=function(){},this.destroy=function(){}}}),define("lib-build/tpl!storymaps/tpl/ui/desktop/NavBar",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="nav-bar">\r\n	<div class="entries">\r\n		<ul class="nav nav-tabs">\r\n			<!--\r\n				tabs and the more button are injected here\r\n			-->\r\n		</ul>\r\n	</div>\r\n	<div class="builder-content-panel inline">\r\n		<span class="builder-content-panel-group builder-edit btn btn-sm btn-default">\r\n			<div class="builder-btn"></div>\r\n			<div class="builder-lbl"></div>\r\n		</span>\r\n\r\n		<span class="builder-content-panel-group builder-add btn btn-sm btn-default">\r\n			<div class="builder-btn"></div>\r\n			<div class="builder-lbl"></div>\r\n		</span>\r\n		<span class="builder-content-panel-group builder-organize btn btn-sm btn-default">\r\n			<div class="builder-btn"></div>\r\n			<div class="builder-lbl"></div>\r\n		</span>\r\n	</div>\r\n	<div class="builder-mask"></div>\r\n	<div id="bookmarksCon">\r\n		<div id="bookmarksButton"></div>\r\n		<div id="bookmarksToggle"> <!--tabindex="0"-->\r\n			<span id="bookmarksTogText"></span>\r\n		</div>\r\n		<div id="bookmarksDiv"></div>\r\n	</div>\r\n</div>\r\n';return __p}}),define("lib-build/css!storymaps/tpl/ui/desktop/NavBar",[],function(){}),define("lib-build/tpl!storymaps/tpl/ui/desktop/NavBarEntry",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<li class="entry '+((__t=optHtmlClass)==null?"":__t)+'" data-title="'+((__t=tooltip)==null?"":__t)+'">\r\n	<a class="entryLbl" tabindex="0">'+((__t=value)==null?"":__t)+"</a>\r\n</li>\r\n";return __p}}),define("lib-build/tpl!storymaps/tpl/ui/desktop/NavBarEntryMore",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<li class="dropdown pull-right"> <!-- tabindex="0" -->\r\n	<a class="dropdown-toggle" data-toggle="dropdown">\r\n		<span class="glyphicon glyphicon-th-list"></span> <span class="caret"></span>\r\n	</a>\r\n	<ul class="dropdown-menu">\r\n		<!--\r\n			tabs are injected here a second time\r\n			that way they are just toggled and not moved around\r\n		-->\r\n		'+((__t=entries)==null?"":__t)+"\r\n	</ul>\r\n</li>\r\n";return __p}}),define("storymaps/tpl/ui/desktop/NavBar",["lib-build/tpl!./NavBar","lib-build/css!./NavBar","lib-build/tpl!./NavBarEntry","lib-build/tpl!./NavBarEntryMore","storymaps/common/utils/CommonHelper","dojo/topic","dojo/has"],function(e,t,n,r,i,s,o){return function(o,u,a){function p(e,t){l=l||[],d(e),$(".nav-bar").addClass("isTab");var i=l.length,u="";$.each(l,function(e,t){var r=t.title;u+=n({value:r,tooltip:"",optHtmlClass:""})}),o.find(".nav-tabs").html(u+r({entries:u})),o.find(".entry").click(v),o.find(".entryLbl").on("keydown",function(e){if(e.keyCode===9)return s.publish("story-tab-navigation",{from:"nav",direction:e.shiftKey?"backward":"forward"}),!1}),o.find(".entryLbl").eq(0).focus(function(){!$(this).data("mouseDown")&&!$(this).parent(".entry").hasClass("active")&&$(this).parent(".entry").click()}).mousedown(function(){$(this).data("mouseDown",!0)}).mouseup(function(){$(this).removeData("mouseDown")}),$("#nav-bar").show(),app.isInBuilder&&app.addFeatureBar.updateLocatedFeatures(t),f.resize()}function d(e){o.css("background-color",e.header),i.addCSSRule(".nav-bar .nav > .entry .entryLbl, 					.nav-bar .dropdown-toggle { 						color: "+e.tabText+"; 						background-color: "+e.tab+" !important; 					}","NavBarTab"),i.addCSSRule(".nav-bar .entry.active > .entryLbl, 					.nav-bar .dropdown.active .dropdown-toggle { 						color: "+e.tabTextActive+"; 						background-color: "+e.tabActive+" !important; 					}","NavBarActive"),i.addCSSRule(".nav-bar .dropdown:not(.active):hover .dropdown-toggle, 					.nav-bar li:not(.active) .entryLbl:hover { 						color: "+e.tabTextHover+"; 						background-color: "+e.tabHover+" !important; 					}","NavBarHover"),i.addCSSRule(".nav-bar .dropdown-menu, 					.nav-bar .dropdown-menu .entryLbl { 						color: "+e.tabText+" !important; 						background-color: "+e.header+" !important; 					}","NavBarMore")}function v(){if($("body").hasClass("organizeFeatures"))return;var e=$(this).index();a(e),app.isInBuilder&&(app.addFeatureBar.updateLocatedFeatures(),app.addFeatureBar.exitOrganizeMode())}function m(){o.find(".builder-content-panel").css("display","inline-block"),o.find(".builder-edit").off("click").click(g).find(".builder-lbl").html("Edit Tab"),o.find(".builder-add").off("click").click(f.onClickAdd).find(".builder-lbl").html("Add tab")}function g(){if($("body").hasClass("organizeFeatures"))return;app.builder.openEditPopup({entryIndex:f.getEntryIndex()})}function y(e,t,n){return e.hasOwnProperty(t)&&e[t]===n}function b(){}var f=this,l=null,c=null,h=null;o.html(e({})),this.init=function(e,t,n,r){l=e,c=null,h=r,p(n,t),this.showEntryIndex(t),b(),u&&m()},this.update=function(e){p(e),this.showEntryIndex(c)},this.resize=function(){o.find(".nav-tabs > li").addClass("visible"),o.find(".nav-tabs .dropdown").removeClass("visible"),o.find(".nav-tabs .dropdown-menu li").removeClass("visible");var e=0,t=0,n=!1,r=o.find(".nav-tabs > li:not(.dropdown)"),i=o.find("li.dropdown").outerWidth(),s=o.width()-o.find(".builder-content-panel:visible").outerWidth()-30-4;r.each(function(){t++,e+=$(this).outerWidth();if(e>s||e+i>s&&t<r.length)n=!0,$(this).removeClass("visible"),o.find(".nav-tabs .dropdown-menu li").eq($(this).index()).addClass("visible")});var u=o.find(".nav-tabs > .entry.active"),a=o.find(".nav-tabs .dropdown-menu li.active");u.length&&!u.hasClass("visible")?(u.removeClass("active"),o.find(".nav-tabs .dropdown-menu li").eq(u.index()).addClass("active"),o.find(".nav-tabs > .dropdown").addClass("active")):a.length&&!a.hasClass("visible")&&(a.removeClass("active"),o.find(".nav-tabs > .entry").eq(a.index()).addClass("active"),o.find(".nav-tabs > .dropdown").removeClass("active")),n&&o.find(".nav-tabs .dropdown").addClass("visible")},this.showEntryIndex=function(e){var t=o.find(".nav-tabs > .entry.visible").length;o.find("li").removeClass("active"),e<t?(o.find(".entry").eq(e).addClass("active"),app.isLoading||(o.find(".entry").eq(e).find(".entryLbl").focus(),o.find(".dropdown").hasClass("open")&&o.find(".dropdown-toggle").click())):(o.find(".dropdown").addClass("active"),o.find(".dropdown .entry").eq(e).addClass("active"),app.isLoading||(o.find(".dropdown").hasClass("open")||o.find(".dropdown-toggle").click(),o.find(".dropdown .entry").eq(e).focus())),app.isInBuilder&&setTimeout(function(){f.resize()},50),c=e},this.getEntryIndex=function(){return c},this.destroy=function(){o.hide()},this.initBookmarks=function(){app.data.getResponse().itemInfo.itemData.bookmarks&&(app.cfg.BOOKMARKS=!0,$("#bookmarksCon").show(),$("#bookmarksTogText").html(app.cfg.BOOKMARKS_ALIAS+" &#x25BC;"),$("#mobileBookmarksTogText").html(app.cfg.BOOKMARKS_ALIAS+" &#x25BC;"),$("#bookmarksToggle").addClass("closed"),$("#mobileBookmarksToggle").addClass("closed"),$("#bookmarksToggle").click(function(){$("#bookmarksDiv").css("display")=="none"?($("#bookmarksTogText").html(app.cfg.BOOKMARKS_ALIAS+" &#x25B2;"),$("#bookmarksDiv").css("display","inline-block"),$("#bookmarksToggle").removeClass("closed"),$("#bookmarksToggle").addClass("open")):($("#bookmarksTogText").html(app.cfg.BOOKMARKS_ALIAS+" &#x25BC;"),$("#bookmarksDiv").css("display","none"),$("#bookmarksToggle").removeClass("open"),$("#bookmarksToggle").addClass("closed")),$("#mobileBookmarksTogText").html(app.cfg.BOOKMARKS_ALIAS+" &#x25BC;")}),$("#mobileBookmarksToggle").click(function(){$("#mobileBookmarksDiv").css("display")=="none"?($("#mobileBookmarksDiv").css("display","inline-block"),$("#mobileBookmarksTogText").html(app.cfg.BOOKMARKS_ALIAS+" &#x25B2;"),$("#mobileBookmarksToggle").removeClass("closed"),$("#mobileBookmarksToggle").addClass("open")):($("#mobileBookmarksDiv").css("display","none"),$("#mobileBookmarksTogText").html(app.cfg.BOOKMARKS_ALIAS+" &#x25BC;"),$("#mobileBookmarksToggle").removeClass("open"),$("#mobileBookmarksToggle").addClass("closed"))}),$.each(app.data.getResponse().itemInfo.itemData.bookmarks,function(e,t){$("#bookmarksDiv").append("<p><a tabindex='0'>"+t.name+"</a></p>"),$("#mobileBookmarksDiv").append("<p><a>"+t.name+"</a></p>")}),$("#bookmarksDiv a").click(function(){var e=$(this).html(),t=new esri.geometry.Extent($.grep(app.data.getResponse().itemInfo.itemData.bookmarks,function(t){return t.name==e})[0].extent);app.map.setExtent(t),$("#bookmarksTogText").html(app.cfg.BOOKMARKS_ALIAS+" &#x25BC;"),$("#bookmarksDiv").css("display","none"),$("#bookmarksToggle").removeClass("open"),$("#bookmarksToggle").addClass("closed")}),$("#mobileBookmarksDiv a").click(function(){var e=$(this).html(),t=new esri.geometry.Extent($.grep(app.data.getResponse().itemInfo.itemData.bookmarks,function(t){return t.name==e})[0].extent);app.map.setExtent(t),$("#mobileBookmarksTogText").html(app.cfg.BOOKMARKS_ALIAS+" &#x25BC;"),$("#mobileBookmarksToggle").removeClass("open"),$("#mobileBookmarksToggle").addClass("closed"),$("#mobileBookmarksDiv").css("display","none")}))},this.onClickAdd=function(e){if($("body").hasClass("organizeFeatures"))return;app.detailPanelBuilder.hideSearch();var t=o.find(".nav-tabs .entry.visible").length,n={id:t,title:e?e:"Tab "+(t+1),features:[]};y(l,"id",t)||(l[t]=n);var r=app.cfg.COLOR_ORDER.split(","),i=$.grep(app.cfg.COLOR_SCHEMES,function(e){return e.name==r[t]});n.color=i,$("#paneLeft").css("border-top-color",i[0].color),app.ui.tilePanel.clearTilePanel();var u={header:"#444",tabText:"#d8d8d8",tab:"#666",tabTextActive:"#fff",tabActive:i[0].color,tabTextHover:"#fff",tabHover:"#666"};app.migration&&app.data.getStory()[0].title&&(l[0].title=app.data.getStory()[0].title),f.init(l,o.find(".nav-tabs .entry.visible").length,u,h);var c=app.map.getLayer(app.data.getShortlistLayerId());$.each(c.graphics,function(e,t){t.hide()});var p=new esri.layers.GraphicsLayer,d=i[0].color;p.color=d,app.layerCurrent=p,app.detailPanelBuilder.addDetailPanelSwiper(t),app.addFeatureBar.exitOrganizeMode();var v=h.getMapOptions().mapsSync?app.data.getStory()[0].extent:null;app.data.setStory(t,n.title,d,v),a(t),h.getTitle()&&s.publish("INCREMENT_SAVE_COUNTER")}}}),define("storymaps/tpl/ui/desktop/MultiTips",["dojo/dom-style","dojo/dom-construct","dojo/_base/lang","dojo/on","dojo/_base/array","dojo/query","dojo/dom","dojo/has"],function(e,t,n,r,i,s,o,u){return function(f){function p(e){l=n.mixin({pointArray:[],map:null,attributeLabelField:"",content:"",selected:!1,zoomToPoints:!1,backgroundColor:"#000000",borderColor:"#000000",pointerColor:"#000000",textColor:"#ffffff",minWidth:"",labelDirection:"auto",offsetTop:8,offsetSide:3,offsetBottom:8,mapAuthorizedMinWidth:-1,mapAuthorizedWidth:-1,mapAuthorizedHeight:-1,visible:!0},e),e.mapAuthorizedWidth==-1&&(l.mapAuthorizedWidth=l.map.width),e.mapAuthorizedHeight==-1&&(l.mapAuthorizedHeight=l.map.height),d(e.map.container)}function d(n,o){v();var u=r(l.map,"zoom-start",function(){y()}),a=r(l.map,"zoom-end",function(e){c||m(e.extent,!0)}),f=r(l.map,"pan",function(e){if(!e||!e.delta.x&&!e.delta.y)return;c||g(e.extent,e.delta)}),p=r(l.map,"extent-change",function(e){if(e&&e.delta&&e.delta.x===0&&e.delta.y===0)return;c||m(e.extent,!0)});o&&(l.visible=!0),l.selected&&(l.pointArray.push(l.selected),l.pointArray.reverse(),l.selected.geometry.x==l.pointArray[1].geometry.x&&l.selected.geometry.y==l.pointArray[1].geometry.y&&l.pointArray.splice(1,1)),i.forEach(l.pointArray,function(r,i){t.place("<div id='arrow"+i+"' class='mtArrow'></div><div id='multiTip"+i+"' class='multiTip'></div>",n,"last"),s("#multiTip"+i)[0].innerHTML=i===0&&l.selected?l.selected.attributes.getValueCI(app.cfg.FIELDNAME_TITLE):l.content;var o=$("#multiTip"+i),u=$("#arrow"+i);i===0&&l.selected?$(o).addClass("selected"):null,i===0&&l.selected?$(u).addClass("selected"):null,e.set("multiTip"+i,{backgroundColor:i===0&&l.selected?app.cfg.SELECTED_POPUP_BACKGROUND_COLOR:l.backgroundColor,borderColor:i===0&&l.selected?app.cfg.SELECTED_POPUP_BORDER_COLOR:l.borderColor,color:l.textColor,padding:"5px",position:"absolute"}),l.minWidth&&e.set("multiTip"+i,"minWidth",l.minWidth+"px"),e.set("arrow"+i,{pointerColor:i===0&&l.selected?app.cfg.SELECTED_POPUP_ARROW_COLOR:l.pointerColor,position:"absolute",width:"0px",height:"0px"});if(l.map.extent.contains(r.geometry)){var a=l.map.toScreen(r.geometry);E(a,i,l)}}),h=[u,a,f,p]}function v(e){c=!1,i.forEach(h,function(e){e.remove()}),e?(s(".multiTip").forEach(function(e){$(e).remove()}),s(".mtArrow").forEach(function(e){$(e).remove()}),c=!0):(s(".multiTip").forEach(function(e){$(e).hasClass("selected")||$(e).remove()}),s(".mtArrow").forEach(function(e){$(e).hasClass("selected")||$(e).remove()}))}function m(e,t){i.forEach(l.pointArray,function(n,r){e.contains(n.geometry)&&(w(r)||t)?E(l.map.toScreen(n.geometry),r,l):b(r)})}function g(e,t){i.forEach(l.pointArray,function(n,r){if(e.contains(n.geometry)){var i=l.map.toScreen(n.geometry);i.x+=t.x,i.y+=t.y,E(i,r,l)}else b(r)})}function y(){s(".multiTip, .mtArrow").forEach(function(e){$(e).hasClass("selected")||(e.style.display="none")})}function b(t){if(!o.byId("multiTip"+t))return;if(e.get(o.byId("multiTip"+t),"display")=="none")return;e.set(o.byId("multiTip"+t),"display","none"),e.set(o.byId("arrow"+t),"display","none")}function w(t){if(o.byId("multiTip"+t))return e.get(o.byId("multiTip"+t),"display")=="block"}function E(t,n,r){if(!o.byId("multiTip"+n))return;if(t.x>r.mapAuthorizedWidth||t.y>r.mapAuthorizedHeight){b(n);return}var i=n===0&&r.selected?44:r.offsetTop;if(u("ie")>0||/Trident\/7\./.test(navigator.userAgent))i+=10;var s=e.get("multiTip"+n,"width"),a=e.get("multiTip"+n,"height");u("ie")==8&&(s-=7,a-=14);if(!s||!a)e.set(o.byId("multiTip"+n),"display",r.visible?"block":"none"),e.set(o.byId("arrow"+n),"display",r.visible?"block":"none"),s=e.get("multiTip"+n,"width"),a=e.get("multiTip"+n,"height");r.minWidth&&s<r.minWidth&&(s=r.minWidth);if(r.labelDirection!="auto")r.labelDirection=="left"?N(t,n,r,s,a):r.labelDirection=="right"?T(t,n,r,s,a):r.labelDirection=="down"?S(t,n,r,s,a):x(t,n,r,s,a,i);else if(t.x<s/2+25+r.offsetSide+r.topLeftNotAuthorizedArea[0]&&t.y<r.topLeftNotAuthorizedArea[1]+a){if(t.y<a-15||t.x<35+r.topLeftNotAuthorizedArea[0]&&t.y<r.topLeftNotAuthorizedArea[1]){b(n);return}T(t,n,r,s,a)}else if(t.x<s/2+25+r.offsetSide){if(t.y<a-15||t.y>r.mapAuthorizedHeight-a/2-10){b(n);return}T(t,n,r,s,a)}else if(t.x>r.mapAuthorizedWidth-s/2-10){if(t.y<a-15||t.y>r.mapAuthorizedHeight-a/2-10){b(n);return}N(t,n,r,s,a)}else if(t.x<r.mapAuthorizedMinWidth+s/2){if(t.y<a-15||t.y>r.mapAuthorizedHeight-a/2-10||t.x<r.mapAuthorizedMinWidth){b(n);return}T(t,n,r,s,a)}else t.y>a+25+i?x(t,n,r,s,a,i):S(t,n,r,s,a);e.set(o.byId("multiTip"+n),"display",r.visible?"block":"none"),e.set(o.byId("arrow"+n),"display",r.visible?"block":"none")}function S(t,n,r,i){e.set("multiTip"+n,{top:t.y+3+r.offsetBottom+"px",left:t.x-i/2-5+"px"}),e.set("arrow"+n,{left:t.x-10+"px",top:t.y+r.offsetBottom-5+"px",borderLeft:"10px solid transparent",borderRight:"10px solid transparent",borderBottom:"10px solid",borderBottomColor:n===0&&r.selected?app.cfg.SELECTED_POPUP_ARROW_COLOR:r.pointerColor,borderTop:"none"})}function x(t,n,r,i,s,o){e.set("multiTip"+n,{top:t.y-s-10-o+"px",left:t.x-i/2+0+"px"});if(u("ie")>0||/Trident\/7\./.test(navigator.userAgent))o-=10;e.set("arrow"+n,{left:t.x-10+"px",top:t.y-10-o+"px",borderLeft:"10px solid transparent",borderRight:"10px solid transparent",borderTop:"10px solid",borderTopColor:n===0&&r.selected?app.cfg.SELECTED_POPUP_ARROW_COLOR:r.pointerColor,borderBottom:"none"})}function T(t,n,r,i,s){var o=n===0&&r.selected?5:0;e.set("multiTip"+n,{top:t.y-22-o-(s-10)/2+"px",left:t.x+17+r.offsetSide+"px"}),e.set("arrow"+n,{left:t.x+8+r.offsetSide+"px",top:t.y-26-o+"px",borderTop:"10px solid transparent",borderBottom:"10px solid transparent",borderRight:"10px solid",borderRightColor:n===0&&r.selected?app.cfg.SELECTED_POPUP_ARROW_COLOR:r.pointerColor,borderLeft:"none"})}function N(t,n,r,i,s){var o=n===0&&r.selected?5:0;e.set("multiTip"+n,{top:t.y-22-o-(s-10)/2+"px",left:t.x-18-i-r.offsetSide+"px"}),e.set("arrow"+n,{left:t.x-18-r.offsetSide+"px",top:t.y-26-o+"px",borderTop:"10px solid transparent",borderBottom:"10px solid transparent",borderLeft:"10px solid",borderLeftColor:n===0&&r.selected?app.cfg.SELECTED_POPUP_ARROW_COLOR:r.pointerColor,borderRight:"none"})}var l=null,c=!1,h=[];p(f),this.current=function(){return l.pointArray},this.clean=function(e){l=null,v(e)},this.hide=function(){c=!0,y()},this.show=function(){if(!l)return;c=!1,l.visible=!0,m(l.map.extent,!0)}}}),define("lib-build/css!storymaps/tpl/ui/mobile/Header",[],function(){}),define("storymaps/tpl/ui/mobile/Header",["lib-build/css!./Header"],function(){return function(t){function n(){}this.init=function(e){e=e||{},t.find(".title").html(e.title)},this.update=function(){},n()}}),define("lib-build/tpl!storymaps/tpl/ui/mobile/MobileIntro",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div id="mobileIntro"></div>\r\n';return __p}}),define("lib-build/css!storymaps/tpl/ui/mobile/MobileIntro",[],function(){}),define("storymaps/tpl/ui/mobile/MobileIntro",["lib-build/tpl!./MobileIntro","lib-build/css!./MobileIntro","dojo/on"],function(e){return function(n,r,i,s){function a(){app.map.on("click",function(){$("#mobileIntro").css("display","none")})}var o=s,u=this;this.screenSize="desktop",this.init=function(){$(n).prepend(e({}))},this.hide=function(){$("#mobileIntro").hide()},this.setTitle=function(){var e=app.data.getResponse().itemInfo.item;$("#mobileIntro").append('<div class="mobileTitle">'+e.title+"</div>"),$("#mobileIntro").append('<div class="mobileSnippet"></div>'),e.snippet&&$(".mobileSnippet").html(e.snippet),a()},this.fillList=function(e,t,n){e===0&&$("#mobileIntro").append('<ul id="mobileThemeList" style=" height: 80px; line-height: 80px;" class="mobileTileList introList">');var r=$('<li class="mobileTitleThemes">').append('<span style="width: 100%;margin-left: 30px; margin-right: 30px; vertical-align: middle; line-height: 20px; display: inline-block;">'+t.title+"</span>");r.on("click",function(){u.selectMobileTheme(e,n)}),e===0&&$(r).css("border-width","2px 0px 1px 0px"),e==n.length-1&&$(r).css("border-width","1px 0px 2px 0px"),$("#mobileThemeList").append(r)},this.resizeMobileElements=function(){u.screenSize=="desktop"&&!o.selected&&app.ui.mobileFeatureList.showMobileList(),$("#mobilePaneList").css("height","52%").css("height","-=20px"),$("#mobileThemeBar").css("top","48%").css("top",$("#mobileThemeBar").position().top-20+"px");var e=$(".mobileThemeTitle").length;$("#mobileThemeBarSlider").width($(window).width()*e),$("#returnHiddenBar").css("width","100%").css("width","-=80px"),$("#mobilePaneList").css("height","52%").css("height","-=20px"),$(".mobileTileList.blurb").css("width","100%").css("width","-=125px"),$("#map").css("height","100%").css("height","48%").css("height","-=20px"),$("#map").css("width","100%"),$("#mainStage").height($("#map").height()),$("#map").css({top:0}),$("#map").css({left:0}),u.screenSize="small",setTimeout(function(){app.ui.detailPanel.resize()},0)},this.selectMobileTheme=function(e,t){e!==0&&o.activateLayer(e),$("#contentPanel").css("display","block"),$("#mobileIntro").css("display","none"),$(window).resize(),app.ui.mobileFeatureList.selectTheme(e),o.themeSelected=!0}}}),define("lib-build/css!storymaps/tpl/ui/mobile/MobileFeatureList",[],function(){}),define("storymaps/tpl/ui/mobile/MobileFeatureList",["../../core/WebApplicationData","dojo/on","lib-build/css!./MobileFeatureList"],function(e){return function(t,n,r,i){function f(){$("#navThemeRight").on("click",function(){u.slideNext()}),$("#navThemeLeft").on("click",function(){u.slidePrev()})}function l(e){e===0&&u.slides.length>1?($("#navThemeLeft").css("display","none"),$("#navThemeRight").css("display","block")):e==u.slides.length-1?($("#navThemeRight").css("display","none"),$("#navThemeLeft").css("display","block")):($("#navThemeLeft").css("display","block"),$("#navThemeRight").css("display","block"))}function c(e){return $.grep($("ul.mobileTileList li"),function(t,n){return t.id=="item"+e})[0]}var s=i,o=!0,u=null,a=$("#mobileThemeBarSlider");app.scrollList,this.init=function(){u=new Swiper("#mobileThemeSliderContainer",{speed:0,direction:"horizontal"}),u.on("onSlideChangeEnd",function(e){$("#mobileThemeBar").css("visibility")=="visible"&&s.activateLayer(u.activeIndex),l(u.activeIndex),$("#mobileThemeBar").css("background-color",app.layerCurrent.color)}),f()},this.addTheme=function(e,t){var n='<div class="mobileThemeTitle swiper-slide"><p style="margin-top: 7px;">'+e.title+"</p></div>";$(a).append(n),u.update(),t&&($("#mobileThemeBar .swiper-container").css("display","none"),$("#navThemeLeft").css("display","none"),$("#navThemeRight").css("display","none"))},this.showMobileList=function(){$("#mobileFeature").css("visibility","hidden"),$("#mobileSupportedLayersView").css("visibility","hidden"),$("#mobileThemeBarSlider").css("display","block"),$("#mobilePaneList").css("visibility","visible"),$("#returnIcon").css("display","none"),$("#returnHiddenBar").css("display","none"),$("#centerMapIconContainer").css("display","none"),$("#navThemeLeft").css("visibility","visible"),$("#navThemeRight").css("visibility","visible"),s.selected&&(s.selected.symbol.setWidth(app.cfg.lutIconSpecs.tiny.getWidth()),s.selected.symbol.setHeight(app.cfg.lutIconSpecs.tiny.getHeight()),s.selected.symbol.setOffset(app.cfg.lutIconSpecs.tiny.getOffsetX(),app.cfg.lutIconSpecs.tiny.getOffsetY()),s.selected.draw()),s.selected=null,app.mapTips&&app.mapTips.clean(!0),$(".detailContainer").hide(),u.update()},this.selectTheme=function(e){o?u.slideTo(e,0):(u.slideTo(e,0),$("#mobileTitlePage").css("display","none")),o=!1,$("#mobileThemeBar").css("background-color",app.layerCurrent.color),l(e)},this.buildList=function(e,t,n){e===0&&$("#mobileList").empty();var r=$(n).clone(),i=t.attributes.getValueCI(app.cfg.FIELDNAME_THUMBURL)?t.attributes.getValueCI(app.cfg.FIELDNAME_THUMBURL):t.attributes.getValueCI(app.cfg.FIELDNAME_IMAGEURL),s=$('<div style="height: 75px; margin-bottom: 8px;"><img src="'+i+'"></div>');$(r).append(s),$("#mobileList").append(r)},this.setColor=function(){if(app.isInBuilder)return;$("#mobileThemeBar").css("background-color",app.layerCurrent.color)},this.refreshMobileList=function(){var e,t=!1;app.layerCurrent&&app.layerCurrent.graphics.length&&setTimeout(function(){$.each(app.layerCurrent.graphics,function(n,r){e=c(r.attributes.getValueCI(app.cfg.FIELDNAME_ID)),app.map.extent.contains(r.geometry)?($(e).css("display")=="none"&&$(e).css("display","block"),t=!0):$(e).css("display")!="none"&&$(e).css("display","none")}),$("#mobilePaneList").scrollTop(0),t?$(".noFeature").css("display","none"):$(".noFeature").css("display","block")},100)}}}),define("lib-build/css!storymaps/common/mapcontrols/command/MapCommand",[],function(){}),define("storymaps/common/mapcontrols/command/MapCommand",["lib-build/css!./MapCommand","dojo/has","esri/geometry/Point","dojo/on","esri/symbols/PictureMarkerSymbol","esri/layers/GraphicsLayer","esri/graphic","esri/config"],function(e,t,n,r,i,s,o,u){return function(a,f,l,c){function m(e){if(e)$(a.container).find(".mapCommandHomeBtn").addClass("loading"),h=Date.now();else{var t=Date.now()-h,n=0;t<450&&(n=450-t),setTimeout(function(){$(a.container).find(".mapCommandHomeBtn").removeClass("loading"),h=0},n)}}function g(){console.log("getDeviceLocation");var e=1e4,t=!1;setTimeout(function(){t||$(a.container).find(".mapCommandLocation").addClass("loading")},300),navigator.geolocation.getCurrentPosition(function(e){t=!0,$(a.container).find(".mapCommandLocation").removeClass("loading");var r=new n(e.coords.longitude,e.coords.latitude);l&&typeof l=="function"&&l(!0,r,e);if(a.spatialReference.wkid!=102100&&a.spatialReference.wkid!=4326){u.defaults.geometryService.project([r],a.spatialReference,function(e){if(!e||!e[0])return;y(e[0])});return}y(r)},function(e){t=!0,b(e)},{enableHighAccuracy:!0,maximumAge:12e4,timeout:e}),setTimeout(function(){t||b()},e)}function y(e){v.clear(),v.add(new o(e,d)),setTimeout(function(){$("#locateLayer_layer image").fadeOut({duration:800})},1e4)}function b(e){console.log("getDeviceLocationError",e),$(a.container).find(".mapCommandLocation").removeClass("loading"),l(!1,null)}var h=0,p=$('<div class="esriSimpleSliderIncrementButton"><div class="mapCommandHomeBtn"></div></div>'),d=new i("resources/common/icons/mapcommand-location-marker.png",21,21),v=new s({id:"locateLayer"});p.click(function(){if(h!==0&&$("body").hasClass("mobile-view"))return;f&&typeof f=="function"?f(a._params.extent):a.setExtent(a._params.extent)}),$(a.container).find(".esriSimpleSlider div:nth-child(1)").after(p),r(a,"update-start",function(){h===0&&m(!0)}),r(a,"update-end",function(){m(!1)}),this.setMobile=function(e){$(".esriSimpleSlider, .mapCommandHomeBtn",a.container).toggleClass("touch",!!e)},this.destroy=function(){$(a.container).find(".esriSimpleSliderIncrementButton").remove(),$(a.container).find(".mapCommandLocation").remove()},this.startLoading=function(){m(!0)},this.stopLoading=function(){m(!1)},this.enableLocationButton=function(e){$(a.container).toggleClass("has-locator",e),$(".mapCommandLocation",a.container).toggleClass("hidden",!e)},navigator&&navigator.geolocation&&app.cfg.GEOLOCATOR&&($(".esriSimpleSlider",a.container).after('<div class="esriSimpleSlider esriSimpleSliderVertical mapCommandLocation"></div>'),$(".mapCommandLocation",a.container).click(g),this.enableLocationButton(c),a.addLayer(v)),this.setMobile(app.appCfg.mapCommandLargerTouch||app.appCfg.mapCommandLargerTouch===undefined&&t("touch"))}}),define("lib-build/tpl!storymaps/common/mapcontrols/legend/Legend",[],function(){return function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="legendContainer mapControls">\r\n	<div class="titleBtn">\r\n		<span class="collapseBtn">\r\n			<div class="glyphicon glyphicon-chevron-down"></div>\r\n			<div class="glyphicon glyphicon-chevron-up"></div>\r\n		</span>\r\n		'+((__t=title)==null?"":__t)+'\r\n	</div>\r\n	\r\n	<div class="content">\r\n		<div class="legendDijitContainer"></div>\r\n		',isInBuilder&&(__p+='\r\n			<div class="settingsGear glyphicon glyphicon-wrench"></div>\r\n			<div class="settingsOverlay">\r\n				<div class="settings-title">'+((__t=settings)==null?"":__t)+'</div>\r\n				<div class="settings-content">\r\n					<!-- Open by default -->\r\n					<div class="checkbox">\r\n						<label>\r\n							<input type="checkbox" class="expandStartup" />\r\n							'+((__t=openDefault)==null?"":__t)+"\r\n						</label>\r\n					</div>\r\n				</div>\r\n			</div>\r\n		"),__p+="\r\n	</div>\r\n</div>";return __p}}),define("lib-build/css!storymaps/common/mapcontrols/legend/Legend",[],function(){}),define("lib-build/css!storymaps/common/mapcontrols/Common",[],function(){}),define("storymaps/common/mapcontrols/legend/Legend",["lib-build/tpl!./Legend","lib-build/css!./Legend","lib-build/css!../Common","storymaps/common/utils/CommonHelper","esri/dijit/Legend","esri/arcgis/utils","dojo/topic"],function(e,t,n,r,i,s,o){return function(n,u,a){function d(){h.find(".legendDijitContainer").html('<div class="legendDijit"></div>'),l=new i({map:n.map,layerInfos:s.getLegendLayers(n)},h.find(".legendDijit")[0]),l.startup()}function v(){l&&l.destroy(),l=null}function m(){h.find(".legendContainer").toggleClass("collapsed"),h.find(".settingsOverlay").hide()}function g(){h.find(".titleBtn").click(m),h.find(".settingsGear").click(function(){h.find(".settingsOverlay").is(":visible")?h.off("mouseleave"):h.mouseleave(function(){h.find(".settingsOverlay").toggle(),h.off("mouseleave"),h.find(".content").removeClass("settingsOpen")}),h.find(".settingsOverlay").toggle(),h.find(".content").toggleClass("settingsOpen")}),h.find(".expandStartup").change(y),f.updatePlacementSettings(a)}function y(){c.openByDefault=h.find(".expandStartup").prop("checked"),o.publish("BUILDER_INCREMENT_COUNTER",1)}var f=this,l=null,c=null,h=a.container,p={isInBuilder:u,title:i18n.viewer.legendFromCommon.title};u&&(p.settings=i18n.commonMapControls.common.settings,p.openDefault=i18n.commonMapControls.common.openDefault),h.html(e(p)),this.toggle=function(e){h.toggle(!!e),e&&!l?d():e||v()},this.toggleExpanded=function(e){h.find(".legendContainer").toggleClass("collapsed",!e)},this.setColors=function(e){h.find(".legendContainer").css({backgroundColor:e.dotNav||e.mapControls,color:e.text}),h.find(".titleBtn").css("color",e.softText),h.find(".settingsGear, .collapseBtn").css("color",e.softBtn),r.addCSSRule(".mainMediaContainer .legendContainer ::-webkit-scrollbar-thumb { background-color:"+e.header+"; }","MapControlLegendDropdownScrollbar")},this.updatePlacementSettings=function(e){h.find(".legendContainer").toggleClass("isInlined",e.mode=="panel"),e.container[0]!=h[0]&&(e.container.html(h.find(".legendContainer")),h=e.container)},this.setSettings=function(e){c=e,h.find(".expandStartup").prop("checked",c.openByDefault)},g()}}),define("lib-build/tpl!storymaps/common/mapcontrols/overview/Overview",[],function(){return function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="overviewContainer mapControls">\r\n	<div class="titleBtn">\r\n		<span class="collapseBtn">\r\n			<div class="glyphicon glyphicon-chevron-down"></div>\r\n			<div class="glyphicon glyphicon-chevron-up"></div>\r\n		</span>\r\n		'+((__t=title)==null?"":__t)+'\r\n	</div>\r\n	\r\n	<div class="content">\r\n		<div class="overviewMapContainer">\r\n			<!-- Map is injected here -->\r\n		</div>\r\n		',isInBuilder&&(__p+='\r\n			<div class="settingsGear glyphicon glyphicon-wrench"></div>\r\n			<div class="settingsOverlay">\r\n				<div class="settings-title">'+((__t=settings)==null?"":__t)+'</div>\r\n				<div class="settings-content">\r\n					<!-- Open by default -->\r\n					<div class="checkbox">\r\n						<label>\r\n							<input type="checkbox" class="expandStartup" />\r\n							'+((__t=openDefault)==null?"":__t)+'\r\n						</label>\r\n					</div>\r\n					\r\n					<!-- Basemap -->\r\n					<div class="btn-group dropup basemap-dropdown">\r\n						<button type="button" class="btn btn-default btn-sm dropdown-toggle basemapBtn" data-toggle="dropdown">\r\n							'+((__t=basemapGalleryBtnLabel)==null?"":__t)+' <span class="caret"></span>\r\n						</button>\r\n						<ul class="dropdown-menu basemaps dropdown-menu-form pull-right" role="menu"></ul>\r\n					</div>\r\n					<div id="basemapGallery"></div>\r\n			\r\n					<!-- Expand factor -->\r\n					<div class="spinnerLabel">\r\n						<label for="expandFactorSpinner">'+((__t=expandFactorLabel)==null?"":__t)+'</label>\r\n						<a class="locateBtnHelp" data-original-title="" title="">\r\n							<img src="resources/tpl/builder/icons/builder-help.png" style="vertical-align: -5px;">\r\n						</a>\r\n					</div>\r\n					\r\n					<div class="input-group expandFactorSpinner">\r\n						<input type="text" class="form-control input-small input-xs" id="expandFactorSpinner" value="2">\r\n						<div class="input-group-btn-vertical">\r\n							<button class="btn btn-default btn-xs"><i class="glyphicon glyphicon-chevron-up"></i></button>\r\n							<button class="btn btn-default btn-xs"><i class="glyphicon glyphicon-chevron-down"></i></button>\r\n						</div>\r\n					</div>\r\n				</div>\r\n			</div>\r\n		'),__p+="\r\n	</div>\r\n</div>";return __p}}),define("lib-build/css!storymaps/common/mapcontrols/overview/Overview",[],function(){}),define("storymaps/common/mapcontrols/overview/Overview",["lib-build/tpl!./Overview","lib-build/css!./Overview","lib-build/css!../Common","esri/dijit/OverviewMap","esri/dijit/BasemapGallery","esri/layers/ArcGISTiledMapServiceLayer","esri/arcgis/utils","dojo/Deferred","dojo/dom","dojo/on","dojo/topic"],function(e,t,n,r,i,s,o,u,a,f,l){return function(n,i,s){function c(e){i.find(".overviewMapContainer").html('<div class="overviewMap"></div>'),o=new r({map:n,visible:!0,color:"transparent",opacity:1},i.find(".overviewMap")[0]),o.startup();var t=e?e.dotNav||e.header:a;t&&i.find(".ovwHighlight").css("border","3px solid "+t)}function h(){o&&o.destroy(),o=null}function p(){i.find(".overviewContainer").toggleClass("collapsed"),i.find(".settingsOverlay").hide()}function d(){i.find(".titleBtn").click(p),i.find(".settingsGear").click(function(){i.find(".settingsOverlay").is(":visible")?i.off("mouseleave"):i.mouseleave(function(){i.find(".settingsOverlay").toggle(),i.off("mouseleave")}),i.find(".settingsOverlay").toggle()}),i.find(".expandStartup").change(v)}function v(){u.openByDefault=i.find(".expandStartup").prop("checked"),l.publish("BUILDER_INCREMENT_COUNTER",1)}var o=null,u=null,a=null,f={isInBuilder:s,title:i18n.viewer.overviewFromCommon.title,overlayHeader:"",basemapGalleryBtnLabel:"",expandFactorLabel:""};s&&(f.settings=i18n.commonMapControls.common.settings,f.openDefault=i18n.commonMapControls.common.openDefault,f.basemapGalleryBtnLabel=i18n.commonMapControls.overview.basemapGalleryBtnLabel,f.expandFactorLabel=i18n.commonMapControls.overview.expandFactorLabel),i.append(e(f)),this.toggle=function(e,t){i.toggle(!!e),e&&!o?c(t):e||h()},this.toggleExpanded=function(e){i.find(".overviewContainer").toggleClass("collapsed",!e)},this.setColors=function(e){a=e.dotNav||e.mapControls,i.find(".overviewContainer").css({backgroundColor:a,color:e.text}),i.find(".titleBtn").css("color",e.softText),i.find(".settingsGear, .collapseBtn").css("color",e.softBtn),i.find(".ovwHighlight").css("border","3px solid "+a)},this.setSettings=function(e){u=e,i.find(".expandStartup").prop("checked",u.openByDefault)},d()}}),define("lib-build/tpl!storymaps/common/mapcontrols/geocoder/Geocoder",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="geocoderBtn">\r\n	<div class="geocoderContainer"></div>\r\n</div>';return __p}}),define("lib-build/css!storymaps/common/mapcontrols/geocoder/Geocoder",[],function(){}),define("storymaps/common/mapcontrols/geocoder/Geocoder",["lib-build/tpl!./Geocoder","lib-build/css!./Geocoder","esri/dijit/Geocoder","../../utils/CommonHelper","dojo/_base/lang"],function(e,t,n,r,i){return function(s,o,u){function l(){$(s.container).find(".esriSimpleSlider").last().after(e({})),a.toggle(u)}var a=this,f=null;this.toggle=function(e){var t=$(s.container).find(".geocoderBtn");f||(f=new n(i.mixin({map:s},r.createGeocoderOptions()),t.find(".geocoderContainer")[0]),t.find(".esriGeocoderContainer input, .esriGeocoderSearch").attr("tabindex","-1")),$(s.container).toggleClass("has-geocoder",e),t.toggle(e)},l()}}),define("lib-build/css!storymaps/common/utils/SocialSharing",[],function(){}),define("lib-build/css!storymaps/common/ui/loadingIndicator/LoadingIndicator",[],function(){}),define("lib-build/css!storymaps/tpl/ui/Common",[],function(){}),define("lib-build/css!storymaps/tpl/ui/mobile/Common",[],function(){}),define("lib-build/css!storymaps/tpl/ui/Responsive",[],function(){}),define("lib-build/css!storymaps/tpl/ui/desktop/MultiTips",[],function(){}),define("storymaps/tpl/core/MainView",["lib-build/css!./MainView","./Config","./Data","./WebApplicationData","./Helper","../ui/desktop/TestPanel","../ui/desktop/TilePanel","../ui/desktop/DetailPanel","../ui/desktop/NavBar","../ui/desktop/MultiTips","../ui/mobile/Header","../ui/mobile/MobileIntro","../ui/mobile/MobileFeatureList","storymaps/common/mapcontrols/command/MapCommand","storymaps/common/mapcontrols/legend/Legend","storymaps/common/mapcontrols/overview/Overview","storymaps/common/mapcontrols/geocoder/Geocoder","lib-build/css!storymaps/common/ui/Modal.css","lib-build/css!storymaps/common/utils/SocialSharing.css","lib-build/css!storymaps/common/ui/loadingIndicator/LoadingIndicator.css","storymaps/common/utils/CommonHelper","dojo/has","dojo/topic","dojo/on","dojo/dom","dojo/DeferredList","dojo/_base/lang","esri/arcgis/utils","esri/geometry/Point","esri/geometry/screenUtils","esri/geometry/Extent","lib-build/css!../ui/Common","lib-build/css!../ui/mobile/Common","lib-build/css!../ui/Responsive","lib-build/css!../ui/desktop/MultiTips"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O){return function(s){function N(){I();if(!app.map)return;r.getTabs()&&$.each(r.getTabs(),function(e,t){app.data.setStory(e,t.title,t.color,t.extent)});var e=$.grep(app.map.graphicsLayerIds,function(e){return e.split("_").slice(0,-1).join("_")==r.getShortlistLayerId()?e:e==r.getShortlistLayerId()?e:!1});app.data.setShortlistLayerId(e[0]),app.map||setTimeout(function(){},500),app.map.loaded?L():app.map.on("load",function(){L()})}function L(){app.map.resize(),app.map.on("click",function(e){app.mapTips&&(e.graphic?m.selected&&(m.selected.hidden=!1):(app.mapTips.clean(!0),m.selected&&(m.selected.hidden=!0)))});var e=[];$.each(r.getTabs(),function(t,n){e.push({features:[],title:n.title,color:n.color,extent:n.extent})});var t=app.map.getLayer(app.data.getShortlistLayerId());$.each(t.graphics,function(t,n){n.attributes.getValueCI||(n.attributes.getValueCI=v.getValueCI),n.attributes.locationSet&&!app.isInBuilder?e[n.attributes.tab_id].features.push(n):app.isInBuilder&&e[n.attributes.tab_id].features.push(n)}),t.on("mouse-over",m.layer_onMouseOver),t.on("mouse-out",m.layer_onMouseOut),t.on("click",m.layer_onClick);if(e.length>1||app.isInBuilder&&!app.isDirectCreationFirstSave){$("#divStrip").height("35px"),$.each(e,function(e,t){app.ui.tilePanel.createTab(e,t),app.ui.mobileFeatureList.addTheme(t);var n=app.cfg.COLOR_ORDER.split(","),r=$.grep(app.cfg.COLOR_SCHEMES,function(t){return t.name.toLowerCase()==$.trim(n[e].toLowerCase())})[0],i=t.color||r.color;m.buildLayer(t.features.sort(z),i);if(app.isInBuilder){app.data.setStory(e,t.title,r.color,t.extent);var s=C.clone(app.data.getStory());$.each(s,function(e,n){n.title=t.title,n.color=i}),app.detailPanelBuilder.addDetailPanelSwiper(e)}app.data.setStory(e,t.title,t.color)});if(!app.isDirectCreationFirstSave){var n={header:"#444",tabText:"#d8d8d8",tab:"#666",tabTextActive:"#fff",tabActive:"#999",tabTextHover:"#fff",tabHover:"#666"},i=0;app.ui.navBar.init(e,i,n,r),app.ui.tilePanel.setTabClick()}}else{if(e.length<1)return!1;$.each(e,function(e,t){app.ui.tilePanel.createTab(e,t),app.ui.mobileFeatureList.addTheme(t);var n=app.cfg.COLOR_ORDER.split(","),r=$.grep(app.cfg.COLOR_SCHEMES,function(t){return t.name.toLowerCase()==$.trim(n[e].toLowerCase())})[0],i=t.color||r.color;m.buildLayer(t.features.sort(z),i);if(app.isInBuilder){app.data.setStory(e,t.title,r.color,t.index);var s=C.clone(app.data.getStory());$.each(s,function(e,n){n.title=t.title,n.color=i}),app.detailPanelBuilder.addDetailPanelSwiper(e)}}),$(".tab").css("display","none"),$("#mobileIntro").append("<br><hr></hr>"),$("#mobileIntro").append('<ul id="mobileThemeList" class="mobileTileList">');var s=$('<li class="mobileTitleTheme" onclick="app.ui.mobileIntro.selectMobileTheme(0)">').append('<div class="startButton"> Start </div>');$("#mobileThemeList").append(s),$("#navThemeLeft").addClass("hideButtons"),$("#navThemeRight").addClass("hideButtons"),$("#nav-bar").show(),$("#nav-bar .entries").hide(),$("#bookmarksCon").css({top:0})}d.handleWindowResize(),m.activateLayer(0),app.isInBuilder&&app.detailPanelBuilder.buildSlides(),$(".entryLbl").css("outline-style","none"),$("#zoomToggle").css("visibility","visible"),$("#whiteOut").fadeOut("slow"),$("body").width()>768?($("#paneLeft").height($("#contentPanel").height()-$("#tabs").height()),$("#paneLeft").css("top",$("#divStrip").height()),$("#map").height($("#contentPanel").height()),$("#map").css("top",0),$(".tilelist").height($("#paneLeft").height()-25)):app.ui.mobileIntro.resizeMobileElements(),d.appInitComplete(r),$("body").on("mousedown","*",function(e){($(this).is(":focus")||$(this).is(e.target))&&$(this).css("outline-style")=="none"&&($(this).css("outline","none").on("blur",function(){$(this).off("blur").css("outline","")}),$(this).parents("#bookmarksToggle").length&&$(this).parents("#bookmarksToggle").css("outline","none").on("blur",function(){$(this).off("blur").css("outline","")}))}),app.map.disableKeyboardNavigation(),$("body").keypress(function(e){e.which==13&&$(document.activeElement).click(),e.which==43&&(app.map.setLevel(app.map.getLevel()+1),$("#zoomIn").focus(),m.hideBookmarks()),e.which==45&&(app.map.setLevel(app.map.getLevel()-1),$("#zoomOut").focus(),m.hideBookmarks())})}function M(){if(m.selected.symbol.width==app.cfg.lutIconSpecs.large.getWidth())return;m.selected.symbol.setWidth(app.cfg.lutIconSpecs.large.getWidth()),m.selected.symbol.setHeight(app.cfg.lutIconSpecs.large.getHeight()),m.selected.symbol.setOffset(app.cfg.lutIconSpecs.large.getOffsetX(),app.cfg.lutIconSpecs.large.getOffsetY()),m.selected.draw(),setTimeout(function(){try{m.selected.getShape().moveToFront()}catch(e){console.log("problem with 'moveToFront()'...")}},10)}function _(e,t){var n=t*4,r=e.data;return[r[n],r[n+1],r[n+2],r[n+3]]}function D(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,n,r){return t+t+n+n+r+r});var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:null}function P(e,t,n){var r=(new esri.symbol.PictureMarkerSymbol(t.toDataURL(),n.getWidth(),n.getHeight())).setOffset(n.getOffsetX(),n.getOffsetY());return r}function H(e){if(v.isMobile())return;app.map.setMapCursor("pointer");var t=e.graphic;t.attributes.getValueCI||(t.attributes.getValueCI=getValueCI);var n={};n.geometry=A.toMapPoint(app.map.extent,app.map.width,app.map.height,e.screenPoint),m.buildMapSupportHoverTips(t.attributes.getValueCI(app.cfg.FIELDNAME_TITLE),n)}function B(){if(v.isMobile())return;app.map.setMapCursor("default"),app.mapTips.clean()}function j(e){m.selected=null,$("#mobileTitlePage").css("display","none");var t=$(".esriPopup")[0];if(app.ui.mobileIntro.screenSize!="small")$(t).show(),app.mapTips.clean();else{$(t).hide();var n=e.graphic;n.attributes.getValueCI||(n.attributes.getValueCI=getValueCI);var r={};r.geometry=A.toMapPoint(app.map.extent,app.map.width,app.map.height,e.screenPoint),m.buildMapSupportHoverTips(n.attributes.getValueCI(app.cfg.FIELDNAME_TITLE),r)}}function F(){var e=[],t=[];$.each(app.map.graphicsLayerIds,function(t,n){e.push(app.map.getLayer(n))});var n=[],i=[],o,u=null,a;$.each(e,function(e,r){r.layerType?a=r.layerType:a=r.type,r.geometryType=="esriGeometryPoint"&&t.push(r),r.url&&(a==="ArcGISFeatureLayer"||a==="Feature Layer")&&!r.id.match(/^csv_/)&&(o=!0,u=r,n.push(r.url),i.push(e))}),t.length?($.each(t,function(t,n){var r=e.indexOf(n);e.splice(r,1)}),s.openMigrationPopup(t,e),$("#loadingIndicator").hide(),clearTimeout(app.loadingTimeout),app.loadingTimeout=null):d.appInitComplete(r)}function I(){if(!r.isBlank())d.appInitComplete(r);else if(app.isInBuilder&&app.data.getWebAppData().getWebmap()){var e=m.loadWebmap(app.data.getWebAppData().getWebmap(),"map");e.then(function(t){app.data.setResponse(t),app.map=e.results[0].map,app.data.setWebMap(e.results[0].itemInfo),s.updateUI(),F()}),d.isProd()||d.portalLogin().then()}else w.getAppID(d.isProd())&&(app.data.userIsAppOwner()?w.switchToBuilder():d.initError("notConfiguredDesktop"));if(s&&!app.data.getWebAppData().getWebmap()){var e=m.loadWebmap(s.buildWebMap(),"map");e.then(function(){app.map=e.results[0].map,app.data.setWebMap(e.results[0].itemInfo),s.updateUI(),d.appInitComplete(r)})}}function q(e){var t={objectIdField:"__OBJECTID",geometryType:"esriGeometryPoint",drawingInfo:{renderer:{type:"simple",symbol:{type:"esriPMS",url:"http://static.arcgis.com/images/Symbols/Shapes/GreenDiamondLargeB.png",width:15,height:15}}},fields:e};return t}function R(e){return e.url?e.featureCollection.featureSet:e.featureCollection.layers[0].featureSet}function U(e){return e.url?e.id:e.id}function z(e,t){var n=e.attributes.getValueCI(app.cfg.FIELDNAME_NUMBER)||e.attributes.shortlist_id,r=t.attributes.getValueCI(app.cfg.FIELDNAME_NUMBER)||t.attributes.shortlist_id;return n<r?-1:n>r?1:0}function W(){S.publish("CORE_UPDATE_EXTENT",app.map._params.extent)}var d=null,v=new i,m=this,g=!1,y,b,x,T=0;this.init=function(e){d=e;if(app.isInBuilder&&E("ie")&&E("ie")<10)return i18n.viewer.errors.noBuilderIE=i18n.viewer.errors.noBuilderIE.replace("%VERSION%",10).replace("%UPGRADE%",i18n.viewer.errors.upgradeBrowser),d.initError("noBuilderIE"),!1;if(E("ie")&&E("ie")<=8)return i18n.viewer.errors.noViewerIE=i18n.viewer.errors.noViewerIE.replace("%VERSION%",9).replace("%UPGRADE%",i18n.viewer.errors.upgradeBrowser),d.initError("noViewerIE"),!1;app.data=new n,x=document.createElement("canvas"),y=x.getContext("2d"),b=new Image,b.src=app.cfg.ICON_SRC,b.onload=function(){y.drawImage(b,0,0),y.font=x.width/2+"pt Calibri"},m.themeSelected=!1,app.ui.tilePanel=new o($("#contentPanel"),m,r,app.isInBuilder),setTimeout(function(){app.ui.detailPanel=new u($("#paneLeft"),app.isInBuilder,r,m,r),app.ui.detailPanel.init()},100),app.ui.navBar=new a($("#nav-bar"),app.isInBuilder,m.activateLayer),app.ui.tilePanel.init(),app.ui.mobileHeader=new l($("#headerMobile"),app.isInBuilder,function(){}),app.ui.mobileIntro=new c($("body"),app.isInBuilder,function(){},m),app.ui.mobileFeatureList=new h($("#contentPanel"),app.isInBuilder,function(){},m),app.ui.mobileIntro.init(),app.ui.mobileFeatureList.init();var t={},i=esri.urlToObject(document.location.href).query;return i&&$.each(i,function(e,n){t[e.toLowerCase()]=n}),$("body").on("mousedown","*",function(e){($(this).is(":focus")||$(this).is(e.target))&&$(this).css("outline-style")=="none"&&$(this).css("outline","none").on("blur",function(){$(this).off("blur").css("outline","")})}),!0},this.webAppConfigLoaded=function(){app.isGalleryCreation=!app.data.getWebAppData().getOriginalData()||!Object.keys(app.data.getWebAppData().getOriginalData().values).length},this.loadFirstWebmap=function(e){return this.loadWebmap(e,$("#map")[0])},this.loadWebmapFromData=function(){N()},this.loadWebmap=function(e,t,n){console.log("tpl.core.MainView - loadWebMap - webmapId:",e);var r=new esri.dijit.Popup({highlight:!1},dojo.create("div"));return k.createMap(e,t,{mapOptions:{slider:!0,autoResize:!1,showAttribution:!0,infoWindow:r,extent:n,wrapAround180:!1},usePopupManager:!0,bingMapsKey:commonConfig.bingMapsKey,editable:!1})},this.firstWebmapLoaded=function(){N()},this.startFromScratch=function(){I()},this.getMapConfig=function(e){return{response:e,mapCommand:new p(e.map,W,d.zoomToDeviceLocation,app.data.getWebAppData().getLocateBtn())}},this.activateLayer=function(e){var t=[];app.data.getStory()[e]&&app.data.getStory()[e].extent&&app.map.setExtent(new O(app.data.getStory()[e].extent));var n=app.map.getLayer(app.data.getShortlistLayerId());$.each(n.graphics,function(n,r){r.attributes.tab_id==e?r.attributes.locationSet?(r.show(),t.push(r)):(app.isInBuilder&&t.push(r),r.hide()):r.hide()});var i=new esri.layers.GraphicsLayer;i.graphics=t;var s=app.data.getStory()[e].color;i.color=s,app.layerCurrent=i,app.layerCurrent.color=app.data.getStory()[e].color,n.redraw(),app.ui.mobileFeatureList.setColor(),app.mapTips&&app.mapTips.clean(!0),m.preSelection(),m.selected=null,m.postSelection();if(!$.isEmptyObject(app.cfg.TAB_SPECIFIC_SUPPORT_LAYERS)){var o=r.getSupportLayers(),u="tab"+String(e+1),a=app.cfg.TAB_SPECIFIC_SUPPORT_LAYERS[u];$.each(o,function(e,t){a&&a.indexOf(t.name)>-1?t.setVisibility(!0):t.setVisibility(!1)})}$(".detailContainer").hide(),app.ui.tilePanel.buildTilePanel(),app.ui.navBar.showEntryIndex(e),w.addCSSRule(".nav-bar .entry.active > .entryLbl, 					.nav-bar .dropdown.active .dropdown-toggle { 						background-color: "+app.data.getStory()[e].color+" !important; 					}","NavBarActive"),$("#paneLeft").css("border-top-color",app.data.getStory()[e].color),$(".detailHeader").css("border-top-color",app.data.getStory()[e].color);var f=e==0?500:100;setTimeout(function(){app.isInBuilder||app.ui.detailPanel.buildFeatureViews()},f),app.isInBuilder&&app.addFeatureBar.updateLocatedFeatures()},this.unselect=function(){m.preSelection(),m.selected=null,m.postSelection()},this.preSelection=function(){m.selected&&m.selected.symbol&&m.selected.symbol.setWidth&&(m.selected.symbol.setWidth(app.cfg.lutIconSpecs.tiny.getWidth()),m.selected.symbol.setHeight(app.cfg.lutIconSpecs.tiny.getHeight()),m.selected.symbol.setOffset(app.cfg.lutIconSpecs.tiny.getOffsetX(),app.cfg.lutIconSpecs.tiny.getOffsetY()),m.selected.draw(),app.mapTips&&app.mapTips.clean(!0))},this.postSelection=function(){if(m.selected==null)app.map.infoWindow.hide();else{if(!m.selected.attributes.locationSet&&!app.isInBuilder)return;!app.map.extent.contains(m.selected.geometry)&&m.selected.attributes.locationSet&&app.map.centerAt(m.selected.geometry),setTimeout(function(){m.buildMapTips()},250),app.isInBuilder?app.detailPanelBuilder.showSlide(m.selected.attributes.getValueCI(app.cfg.FIELDNAME_ID)):app.ui.detailPanel.showDetails(m.selected),app.ui.mobileIntro.hide(),app.ui.mobileFeatureList.setColor()}},this.buildMapTips=function(e){setTimeout(function(){if(!m.selected||!m.selected.attributes||m.selected.hidden||!m.selected.attributes.locationSet){app.mapTips&&app.mapTips.clean(!0);return}if(app.mapTips&&!app.map.extent.contains(m.selected.geometry)&&app.data.getWebAppData().getGeneralOptions().filterByExtent&&!app.isInBuilder){app.mapTips.clean(!0);return}if($("body").hasClass("mobile-view")){app.mapTips&&app.mapTips.clean(!0),m.selected&&M();return}e&&app.mapTips.clean(!0);var t=e?e:m.selected.attributes.getValueCI(app.cfg.FIELDNAME_TITLE);app.mapTips=new f({map:app.map,content:t,selected:m.selected&&m.selected.hidden!==!0?m.selected:null,pointArray:[m.selected],labelDirection:"auto",backgroundColor:app.cfg.SELECTED_POPUP_BACKGROUND_COLOR,borderColor:app.cfg.SELECTED_POPUP_BORDER_COLOR,pointerColor:app.cfg.SELECTED_POPUP_ARROW_COLOR,textColor:"#ffffff",offsetTop:44,topLeftNotAuthorizedArea:[40,180],mapAuthorizedMinWidth:-1,mapAuthorizedWidth:-1,mapAuthorizedHeight:-1,visible:!0}),M()},100)},this.buildMapHoverTips=function(e,t){if(app.mapTips&&($("body").hasClass("mobile-view")||!t.attributes.locationSet)){app.mapTips.clean(!0);return}var n=t==m.selected?44:33;app.mapTips=new f({map:app.map,content:e,selected:m.selected&&m.selected.hidden!==!0?m.selected:null,pointArray:[t],labelDirection:"auto",backgroundColor:app.cfg.POPUP_BACKGROUND_COLOR,borderColor:app.cfg.POPUP_BORDER_COLOR,pointerColor:app.cfg.POPUP_ARROW_COLOR,textColor:"#ffffff",offsetTop:n,topLeftNotAuthorizedArea:[40,180],mapAuthorizedMinWidth:-1,mapAuthorizedWidth:-1,mapAuthorizedHeight:-1,visible:!0})},this.buildMapSupportHoverTips=function(e,t){if(app.mapTips&&$("body").hasClass("mobile-view")){app.mapTips.clean(!0);return}app.mapTips=new f({map:app.map,content:e,selected:m.selected&&m.selected.hidden!==!0?m.selected:null,pointArray:[t],labelDirection:"auto",backgroundColor:app.cfg.POPUP_BACKGROUND_COLOR,borderColor:app.cfg.POPUP_BORDER_COLOR,pointerColor:app.cfg.POPUP_ARROW_COLOR,textColor:"#ffffff",offsetTop:5,topLeftNotAuthorizedArea:[40,180],mapAuthorizedMinWidth:-1,mapAuthorizedWidth:-1,mapAuthorizedHeight:-1,visible:!0})},this.moveGraphicToFront=function(e){var t=e.getDojoShape();t&&t.moveToFront()},this.buildLayer=function(e,t){var n=app.cfg.lutIconSpecs.tiny,i;$.each(e,function(e,s){var o=document.createElement("canvas");o.width=b.width,o.height=b.height;var u=o.getContext("2d");u.font="bold "+o.width/3.8+"pt Calibri",u.drawImage(x,0,0);var a=t;if(!i){var f=u.getImageData(0,0,x.width,x.height),l=_(f,4804);if(l[0]!=D(a).r&&l[1]!=D(a).g&&l[1]!=D(a).b){for(var c=0;c<f.data.length;c+=4)f.data[c]==l[0]&&f.data[c+1]==l[1]&&f.data[c+2]==l[2]&&(f.data[c]=D(a).r,f.data[c+1]=D(a).g,f.data[c+2]=D(a).b);u.putImageData(f,0,0)}i=f}e>0&&u.putImageData(i,0,0);if(r.getMapOptions().numberedIcons){var h=s.attributes.getValueCI(app.cfg.FIELDNAME_NUMBER);u.textAlign="center",u.fillStyle="white",u.fillText(h,o.width/3.2,o.height/2)}s.setSymbol(P(e,o,n))})},this.layer_onClick=function(e){if($("body").hasClass("pickLocation"))return;g=!0,m.preSelection(),m.selected=null,m.selected=e.graphic,m.postSelection(),$("#mobileTitlePage").css("display","none");var t=$(".esriPopup")[0];$(t).hide(),setTimeout(function(){g=!1},500),m.themeSelected||app.ui.mobileFeatureList.selectTheme(0),m.themeSelected=!0},this.layer_onMouseOver=function(e){if(g||$("body").hasClass("pickLocation"))return;if(v.isMobile())return;app.map.setMapCursor("pointer");var t=e.graphic,n=app.map.toScreen(t.geometry);if(t==m.selected&&m.selected.hidden!==!0&&$("#header").css("display")=="block")return;t.attributes.getValueCI||(t.attributes.getValueCI=getValueCI);if(t!=m.selected||m.selected.hidden!==!0)t.symbol.setWidth(app.cfg.lutIconSpecs.medium.getWidth()),t.symbol.setHeight(app.cfg.lutIconSpecs.medium.getHeight()),t.symbol.setOffset(app.cfg.lutIconSpecs.medium.getOffsetX(),app.cfg.lutIconSpecs.medium.getOffsetY()),t.draw(),v.isIE()||m.moveGraphicToFront(t);m.buildMapHoverTips(t.attributes.getValueCI(app.cfg.FIELDNAME_TITLE),t)},this.layer_onMouseOut=function(e){if($("body").hasClass("pickLocation"))return;if(v.isMobile())return;app.map.setMapCursor("default");var t=e.graphic;t!=m.selected&&(t.symbol.setWidth(app.cfg.lutIconSpecs.tiny.getWidth()),t.symbol.setHeight(app.cfg.lutIconSpecs.tiny.getHeight()),t.symbol.setOffset(app.cfg.lutIconSpecs.tiny.getOffsetX(),app.cfg.lutIconSpecs.tiny.getOffsetY()),t.draw()),app.mapTips&&app.mapTips.clean()},this.updateUI=function(){},this.resize=function(e){e.isMobileView?(app.ui.mobileIntro.resizeMobileElements(),app.cfg.BOOKMARKS&&$("#mobileBookmarksCon").show(),$("#header").height("0"),app.mapTips&&app.mapTips.hide(),(T<2||$("#mobileIntro").css("display")=="block")&&W()):(app.ui.mobileIntro.screenSize="desktop",$("#navThemeLeft").css("visibility","hidden"),$("#navThemeRight").css("visibility","hidden"),$("#mobileBookmarksCon").hide(),$("#paneLeft").height($("#contentPanel").height()-$("#tabs").height()),$("#header").height("110px"),$(".tilelist").height($("#paneLeft").height()-(app.isInBuilder?60:25)),$(".tilelist").css("top",app.isInBuilder?60:38),$("#paneLeft .noFeature").width($("#paneLeft").width()),$("#paneLeft").width()==app.cfg.LEFT_PANE_WIDTH_TWO_COLUMN?$("#paneLeft .noFeatureText").css("margin-left","50px"):$("#paneLeft .noFeatureText").css("margin-left","150px"),$("#map").height(e.height),$("#map").css("top",0),app.ui.navBar.resize(),e.width<=app.cfg.TWO_COLUMN_THRESHOLD||e.width<=1024&&e.height<=768?(setTimeout(function(){$("#map").width(e.width-(app.cfg.LEFT_PANE_WIDTH_TWO_COLUMN+16)),$("#map").css("left",app.cfg.LEFT_PANE_WIDTH_TWO_COLUMN+16),app.map&&app.map.resize(),m.selected&&!app.map.extent.contains(m.selected.geometry)&&app.mapTips.clean(!0)},0),app.ui.tilePanel.resize(app.cfg.LEFT_PANE_WIDTH_TWO_COLUMN),app.ui.detailPanel.resize(),app.isInBuilder&&app.detailPanelBuilder.resize()):e.width<=app.cfg.THREE_COLUMN_THRESHOLD&&e.width>=app.cfg.TWO_COLUMN_THRESHOLD?(setTimeout(function(){$("#map").width(e.width-(app.cfg.LEFT_PANE_WIDTH_THREE_COLUMN+16)),$("#map").css("left",app.cfg.LEFT_PANE_WIDTH_THREE_COLUMN+16),app.map&&app.map.resize()},0),app.ui.tilePanel.resize(app.cfg.LEFT_PANE_WIDTH_THREE_COLUMN),app.ui.detailPanel.resize(),app.isInBuilder&&app.detailPanelBuilder.resize()):(setTimeout(function(){$("#map").width(e.width-(app.cfg.LEFT_PANE_WIDTH_FOUR_COLUMN+16)),$("#map").css("left",app.cfg.LEFT_PANE_WIDTH_FOUR_COLUMN+16),app.map&&app.map.resize()},0),app.ui.tilePanel.resize(app.cfg.LEFT_PANE_WIDTH_FOUR_COLUMN),app.ui.detailPanel.resize(),app.isInBuilder&&app.detailPanelBuilder.resize())),T++},this.setMapExtent=function(e,t){return d.setMapExtent(e,t)},this.getLayoutExtent=function(e){return e},this.checkConfigFileIsOK=function(){return t.checkConfigFileIsOK()},this.appInitComplete=function(){this.updateUI(),d.cleanLoadingTimeout(),$(window).resize();var e=app.data.getWebAppData().isBlank()||app.data.getWebAppItem().access=="private";app.ui.headerDesktop&&app.ui.headerDesktop.toggleSocialBtnAppSharing(e),setTimeout(function(){if(app.data.getWebAppData().getTabs()&&app.data.getWebAppData().getTabs()[0]&&app.data.getWebAppData().getTabs()[0].extent){var e=new O(app.data.getWebAppData().getTabs()[0].extent);app.map.setExtent(e)}app.isDirectCreationFirstSave&&app.map.centerAndZoom([0,0],3),app.map.on("extent-change",function(){setTimeout(function(){app.data.getWebAppData().getGeneralOptions().filterByExtent&&!app.isInBuilder?(app.ui.tilePanel.refreshList(),app.ui.mobileFeatureList.refreshMobileList(),app.ui.detailPanel.loaded&&(app.ui.detailPanel.refreshSlides(),m.selected&&setTimeout(function(){app.ui.detailPanel.loaded&&app.ui.detailPanel.showDetails(m.selected)},0))):app.ui.detailPanel.loaded&&m.selected&&setTimeout(function(){app.ui.detailPanel.loaded&&app.ui.detailPanel.showDetails(m.selected)},0)},0)}),app.isDirectCreation||setTimeout(function(){d.displayApp()},500)},750),S.publish("tpl-ready")},this.onHashChange=function(){},this.prepareMobileViewSwitch=function(){},this.initLocalization=function(){}}}),require(["storymaps/common/Core","storymaps/common/ui/header/Desktop","storymaps/tpl/core/MainView"],function(){}),define("storymaps/tpl/BuildConfigViewer",function(){});