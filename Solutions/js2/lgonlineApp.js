/* 
This source is a compressed form of part of the git commit 
07f089b7a0ec9ed1 2014-06-10 15:28:16 -0700
Uncompressed source is available from https://github.com/Esri/local-government-online-apps 
*/ 
/*

 | Copyright 2012 Esri
 |
 | Licensed under the Apache License, Version 2.0 (the "License");
 | you may not use this file except in compliance with the License.
 | You may obtain a copy of the License at
 |
 |    http://www.apache.org/licenses/LICENSE-2.0
 |
 | Unless required by applicable law or agreed to in writing, software
 | distributed under the License is distributed on an "AS IS" BASIS,
 | WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 | See the License for the specific language governing permissions and
 | limitations under the License.
*/
define("js/lgonlineApp","js/lgonlineBase js/lgonlineCommand js/lgonlineDijit js/lgonlineDrawing js/lgonlineEditing js/lgonlineFrame js/lgonlineMap js/lgonlineOutput".split(" "),function(){return{}});
require({cache:{"js/lgonlineBase":function(){define("js/lgonlineBase","dojo/dom-construct dojo/dom dojo/on dojo/dom-style dojo/dom-class dojo/_base/array dojo/topic dojo/_base/lang".split(" "),function(h,s,l,n,r,a,e,f){dojo.declare("js.LGObject",null,{constructor:function(d){var c,a,e=this;void 0!==d&&dojo.safeMixin(this,d);this.checkPrerequisites&&this.checkPrerequisites();d={};this.rootId&&(d.id=this.rootId);this.rootClass?d.className=this.rootClass:d.style="display:none";void 0!==this.parentDiv?
(c=this.parentDiv,(a=s.byId(c))||(c=null)):c=null;a&&a.getLGObject&&a.getLGObject().addItem?(this.rootDiv=h.create("div",d),a.getLGObject().addItem(this.rootDiv)):this.rootDiv=h.create("div",d,c);this.rootDiv.getLGObject=function(){return e}},getRootDiv:function(){return this.rootDiv},lgById:function(d){var c=null;(d=s.byId(d))&&d.getLGObject&&(c=d.getLGObject());return c},deleteDivFromDom:function(){this.rootDiv&&this.rootDiv.parentNode.removeChild(this.rootDiv)},injectCSS:function(d){var c;c=document.createElement("style");
c.setAttribute("type","text/css");c.styleSheet?c.styleSheet.cssText=d:(d=document.createTextNode(d),c.appendChild(d));document.body.appendChild(c);return c},checkForSubstitution:function(d){var c,a=d;d&&1<d.length&&(c=d.substring(0,1),"@"===c?this.appConfig.i18n&&(a=this.followAttributePath(this.appConfig.i18n,d.substring(1))):"!"===c?window.jsapi_i18n&&(a=this.followAttributePath(window.jsapi_i18n,d.substring(1))):"."===c&&(a=this.followAttributePath(null,d.substring(1))));return a},followAttributePath:function(d,
c){var a,e=d,k;try{k=c.split(".");for(a=0;a<k.length;a+=1)e=null===e?this.lgById(k[a]):e[k[a]]}catch(m){e=null}return e},toBoolean:function(d,a){var e;if(!0===d)return!0;if(!1===d)return!1;if("string"===typeof d){e=d.toLowerCase();if("true"===e)return!0;if("false"===e)return!1}return void 0===a?!0:a},toNumber:function(d,a){if("number"===typeof d)return d;d=parseFloat(d);return!isNaN(d)?d:void 0===a?0:a},log:function(d,a){console&&console.log(d);a&&this.publishMessage(this.appConfig.errorPublishingFlag,
d);window.gLogMessageBox&&window.gLogMessageBox.append(d)},publishMessage:function(d,a){e.publish("publish",{id:this.rootId,tag:d,data:a});e.publish(d,a)},subscribeToMessage:function(d,a){var f=this;e.subscribe(d,function(a){e.publish("receive",{id:f.rootId,tag:d,data:a})});e.subscribe(d,a)}});dojo.declare("js.LGGraphic",js.LGObject,{constructor:function(){l(window,"resize",f.hitch(this,this.handleWindowResize));this.handleWindowResize()},setIsVisible:function(d,a){a?(n.set(this.getRootDiv(),"display",
"block"),n.set(this.getRootDiv(),"visibility",d?"visible":"hidden")):(d?this.show():this.hide(),n.set(this.getRootDiv(),"visibility","visible"))},getIsVisible:function(){return"none"!==n.get(this.getRootDiv(),"display")},toggleVisibility:function(){this.getIsVisible()?this.hide():this.show()},show:function(){n.set(this.getRootDiv(),"display","block")},hide:function(){n.set(this.getRootDiv(),"display","none")},handleWindowResize:function(){void 0!==this.fill&&!0===this.fill?this.fillParentDiv():void 0!==
this.horizOffset&&void 0!==this.vertOffset&&this.alignOver(this.rootDiv,this.rootDiv.parentNode,this.horizOffset,this.vertOffset)},fillParentDiv:function(){var a;this.rootDiv.parentNode&&(a={left:"0px",top:"0px",width:this.rootDiv.parentNode.clientWidth+"px",height:this.rootDiv.parentNode.clientHeight+"px"},dojo.style(this.rootDiv,a))},alignOver:function(d,c,e,f){var k,m,p,h=this;d&&c&&(k=dojo.marginBox(d),m=dojo.marginBox(c),p={},"number"===typeof e?p=this.insertHorizPositioningStyle(p,e,k,m):"object"===
typeof e&&a.forEach(e,function(a){p=h.insertHorizPositioningStyle(p,a,k,m)}),"number"===typeof f?p=this.insertVertPositioningStyle(p,f,k,m):"object"===typeof f&&a.forEach(f,function(a){p=h.insertVertPositioningStyle(p,a,k,m)}),dojo.style(d,p))},insertHorizPositioningStyle:function(a,c,e,f){0<c?a.left=c+"px":0===c?a.left=Math.round((f.w-e.w)/2)+"px":a.right=-c+"px";return a},insertVertPositioningStyle:function(a,c,e,f){0<c?a.top=c+"px":0===c?a.top=Math.round((f.h-e.h)/2)+"px":a.bottom=-c+"px";return a},
applyTheme:function(a,c){r.remove(c||this.rootDiv,"appTheme2");r.add(c||this.rootDiv,"appTheme");a&&r.add(c||this.rootDiv,"appThemeHover")},applyThemeAltBkgd:function(a,c){r.remove(c||this.rootDiv,"appTheme");r.add(c||this.rootDiv,"appTheme2");a&&r.add(c||this.rootDiv,"appThemeHover")}});dojo.declare("js.LGDependency",null,{setUpWaitForDependency:function(a){var c=this;this.dependencyId&&this.declaredClass===a&&(a=this.lgById(this.dependencyId),this.onDependencyPrep(a),a.ready.then(function(){c.onDependencyReady()}))},
onDependencyPrep:function(){return null},onDependencyReady:function(){return null}});dojo.declare("js.LGDefaults",null,{constructor:function(){this.defaultValues={};this.listenForDefaultsTrigger&&this.listenForDefaultsUpdate()},listenForDefaultsUpdate:function(){var a=this;this.subscribeToMessage(this.listenForDefaultsTrigger,function(c){a.defaultValues=c;a.onDefaultsUpdate()})},onDefaultsUpdate:function(){return null},changeDefaults:function(){this.broadcastDefaultsUpdate()},broadcastDefaultsUpdate:function(){this.broadcastDefaultsPublish&&
this.publishMessage(this.broadcastDefaultsPublish,this.defaultValues)}})})},"js/lgonlineCommand":function(){define("js/lgonlineCommand","dojo/dom-construct dojo/dom dojo/on dojo/Deferred dojo/DeferredList dojo/dom-style dojo/dom-class dojo/_base/array dojo/_base/lang dojo/request/xhr dojo/string dijit/form/TextBox dijit/layout/ContentPane dojox/gfx dojox/gfx/utils esri/dijit/Legend esri/dijit/BasemapGallery esri/dijit/Basemap esri/tasks/locator esri/tasks/PrintTask esri/tasks/PrintParameters esri/tasks/PrintTemplate esri/tasks/LegendLayer esri/tasks/query esri/tasks/QueryTask esri/dijit/PopupTemplate js/lgonlineBase js/lgonlineMap".split(" "),
function(h,s,l,n,r,a,e,f,d,c,v,u,k,m,p,q,x,y,z,A,B,C,D,w,E,F){dojo.declare("js.LGDropdownBox",js.LGGraphic,{constructor:function(){var b=this;this.applyTheme(!1);this.isShowable=!0;this.trigger&&(this.setUpListeningForCommands(),this.subscribeToMessage(this.trigger,function(a){b.handleTrigger(a)}))},setUpListeningForCommands:function(){var b=this;this.subscribeToMessage("command",function(a){a!==b.trigger&&b.setIsVisible(!1)})},setShowable:function(b){this.isShowable=b;!this.isShowable&&this.getIsVisible()&&
this.toggleVisibility()},handleTrigger:function(){this.isShowable&&this.toggleVisibility()}});dojo.declare("js.LGMapBasedMenuBox",[js.LGDropdownBox,js.LGMapDependency],{constructor:function(){this.ready=new n;this.setUpWaitForDependency("js.LGMapBasedMenuBox")},onDependencyReady:function(){this.ready.resolve(this);this.inherited(arguments)}});dojo.declare("js.LGBasemapBox",js.LGMapBasedMenuBox,{constructor:function(){this.setUpWaitForDependency("js.LGBasemapBox")},onDependencyReady:function(){var b,
a,g,G=this.getBasemapGroup(),e,m,f;b=this.rootId+"_gallery";a=(new k({id:b,className:this.galleryClass})).placeAt(this.rootDiv);touchScroll(b);e=this.webmapThumbnail||"images/webmap.png";f=new n;try{this.appConfig.proxyurl&&this.appConfig.itemInfo.item.thumbnail?(m=this.appConfig.sharinghost+"/sharing/rest/content/items/"+this.appConfig.itemInfo.item.id+"/info/"+this.appConfig.itemInfo.item.thumbnail,c(this.appConfig.proxyurl+"?"+m).then(function(){e=m;f.resolve()},function(b){f.resolve()})):f.resolve()}catch(p){f.resolve()}f.then(d.hitch(this,
function(){g=(new x({basemaps:[new y({layers:this.appConfig.itemInfo.itemData.baseMap.baseMapLayers,title:this.appConfig.itemInfo.itemData.baseMap.title,thumbnailUrl:e})],showArcGISBasemaps:!0,basemapsGroup:G,bingMapsKey:this.appConfig.bingKey,map:this.appConfig.map},h.create("div"))).placeAt(this.rootDiv);a.set("content",g.domNode);g.startup()}));this.inherited(arguments)},getBasemapGroup:function(){var b=null;this.basemapgroupTitle&&(this.basemapgroupOwner&&0<this.basemapgroupTitle.length&&0<this.basemapgroupOwner.length)&&
(b={title:this.basemapgroupTitle,owner:this.basemapgroupOwner});return b}});dojo.declare("js.LGDijitLegendBox",js.LGMapBasedMenuBox,{constructor:function(){this.setUpWaitForDependency("js.LGDijitLegendBox")},onDependencyReady:function(){try{var b,a,g,d=this.rootId+"_legend";b=(new k({id:d,className:this.dijitLegendClass})).placeAt(this.rootDiv);touchScroll(d);a=esri.arcgis.utils.getLegendLayers({map:this.appConfig.map,itemInfo:this.appConfig.itemInfo});g=(new q({map:this.appConfig.map,layerInfos:a},
h.create("legendDiv"))).placeAt(this.rootDiv);b.set("content",g.domNode);g.startup();this.inherited(arguments)}catch(c){this.log("LGDijitLegendBox_1: "+c.toString())}}});dojo.declare("js.LGCallMethods",js.LGObject,{constructor:function(){var b,a=this;this.todo&&f.forEach(this.todo,function(g){try{if(b=s.byId(g.rootId))if(b=b.getLGObject())b[g.method](g.arg)}catch(d){a.log("LGCallMethods_1: "+d.toString())}})}});dojo.declare("js.LGButton",js.LGGraphic,{constructor:function(){var b;if(this.iconJson){this.foregroundColor=
"#000";this.hoverColor="#00f";if(this.iconColorizerId&&(b=s.byId(this.iconColorizerId)))b=b.getLGObject(),this.foregroundColor=b.foregroundColor(),this.hoverColor=b.hoverColor();this.applyTheme(!1);this.rootDiv.surface=this.createSVGIcon(this.iconJson);l(this.rootDiv,"mouseover",d.hitch(this,function(b){this.onMouseOver(b)}));l(this.rootDiv,"mouseout",d.hitch(this,function(b){if(this.mouseOut(b))this.onMouseOut(b)}))}else this.applyTheme(!0),this.iconUrl&&(b={src:this.iconUrl},this.iconClass&&(b.className=
this.iconClass),this.iconImg=h.create("img",b,this.rootDiv));this.displayText&&(b={innerHTML:this.checkForSubstitution(this.displayText)},this.displayTextClass&&(b.className=this.displayTextClass),h.create("div",b,this.rootDiv));this.tooltip&&(this.rootDiv.title=this.checkForSubstitution(this.tooltip))},createSVGIcon:function(b,a){var g;g=m.createSurface(this.rootDiv,32,32);p.fromJson(g,b);a||(a=this.foregroundColor);this.changeColor(g,a);this.iconClass&&g.rawNode.setAttribute("class",this.iconClass);
return g},onMouseOver:function(b){this.changeColor(b.currentTarget.surface,this.hoverColor)},onMouseOut:function(b){this.changeColor(b.currentTarget.surface,this.foregroundColor)},mouseOut:function(b){var a;a=b.currentTarget||b.srcElement;b=b.relatedTarget||b.toElement;if(!b)return!0;for(;b.parentElement;){if(a===b)return!1;b=b.parentElement}return!0},changeColor:function(b,a){f.forEach(b.children,function(b){if("text"===b.shape.type)b.setFill(a);else{var d=b.getStroke();d.color=a;b.setStroke(d)}})}});
dojo.declare("js.LGRadioButton",js.LGButton,{constructor:function(){this.isOn=this.toBoolean(this.isOn,!1);this.setIsOn(this.isOn);this.controller=null;l(this.rootDiv,"click",this.handleClick)},setController:function(b){this.controller=b},setIsOn:function(b){this.isOn=b;this.rootDiv.surface?this.isOn?this.changeColor(this.rootDiv.surface,this.hoverColor):this.changeColor(this.rootDiv.surface,this.foregroundColor):this.isOn?this.applyThemeAltBkgd(!0):this.applyTheme(!0)},onMouseOver:function(b){this.rootDiv.surface?
this.isOn||this.changeColor(this.rootDiv.surface,this.hoverColor):this.inherited(arguments)},onMouseOut:function(b){this.rootDiv.surface?this.isOn||this.changeColor(this.rootDiv.surface,this.foregroundColor):this.inherited(arguments)},handleClick:function(b){b=b.currentTarget.getLGObject();b.controller&&b.controller.selectMember(b)}});dojo.declare("js.LGRadioButtonController",js.LGObject,{constructor:function(){this.members=[];this.currentMember=null},addMember:function(b){this.members.push(b);b.setController(this)},
selectMember:function(b){var a,g=this;this.currentMember&&(this.currentMember.setIsOn(!1),this.currentMember=null);"number"===typeof b?0<this.members.length&&(b=Math.max(0,Math.min(b,g.members.length-1)),g.currentMember=g.members[b],g.currentMember.setIsOn(!0)):"string"===typeof b?f.some(this.members,function(a){return a.value===b?(g.currentMember=a,g.currentMember.setIsOn(!0),!0):!1}):b&&(a=b.rootId,f.some(this.members,function(b){return b.rootId===a?(g.currentMember=b,g.currentMember.setIsOn(!0),
!0):!1}))},getCurrentMember:function(){return this.currentMember}});dojo.declare("js.LGCommand",[js.LGButton,js.LGDependency],{constructor:function(){this.publish&&(this.clickHandler=l(this.rootDiv,"click",this.handleClick));this.setUpWaitForDependency("js.LGCommand")},onDependencyPrep:function(){this.setIsVisible(!1);this.inherited(arguments)},onDependencyReady:function(){this.setIsVisible(!0);this.inherited(arguments)},handleClick:function(b){b=b.currentTarget.getLGObject();b.publishMessage("command",
b.publish);b.publishMessage(b.publish,b.publishArg)}});dojo.declare("js.LGCommandToggle",js.LGCommand,{constructor:function(){var b=this;this.rootDiv.surface?e.contains(document.body,"okIE")&&(this.iconDisabledJson=this.iconDisabledJson||this.iconJson,this.rootDiv.surface2=this.createSVGIcon(this.iconDisabledJson)):this.iconDisabledUrl=this.iconDisabledUrl||this.iconUrl;this.isEnabled=this.toBoolean(this.isEnabled,!0);b.setIsEnabled(this.isEnabled);this.isVisible=this.toBoolean(this.isVisible,!0);
b.setIsVisible(this.isVisible);this.triggerEnable&&this.subscribeToMessage(this.triggerEnable,function(){b.isEnabled=!0;b.setIsEnabled(b.isEnabled)});this.triggerDisable&&this.subscribeToMessage(this.triggerDisable,function(){b.isEnabled=!1;b.setIsEnabled(b.isEnabled)});this.triggerVisible&&this.subscribeToMessage(this.triggerVisible,function(){b.isVisible=!0;b.setIsVisible(b.isVisible)});this.triggerInvisible&&this.subscribeToMessage(this.triggerInvisible,function(){b.isVisible=!1;b.setIsVisible(b.isVisible)});
this.setUpWaitForDependency("js.LGCommandToggle")},setIsEnabled:function(b){this.isEnabled=b;this.rootDiv.surface?e.contains(document.body,"okIE")&&(this.isEnabled?(a.set(this.rootDiv.surface.rawNode,"display","inline-block"),a.set(this.rootDiv.surface2.rawNode,"display","none")):(a.set(this.rootDiv.surface.rawNode,"display","none"),a.set(this.rootDiv.surface2.rawNode,"display","inline-block"))):this.isEnabled?(this.iconImg.src=this.iconUrl,e.add(this.rootDiv,"appThemeHover")):(this.iconImg.src=this.iconDisabledUrl,
e.remove(this.rootDiv,"appThemeHover"))},handleClick:function(b){var a=b.currentTarget.getLGObject();a.isEnabled&&a.inherited("handleClick",arguments)}});dojo.declare("js.LGLaunchUrl",js.LGObject,{constructor:function(){this.subscribeToMessage(this.sameWinTrigger,function(b){b&&window.open(b,"_parent")});this.subscribeToMessage(this.newWinTrigger,function(b){b&&window.open(b,"_blank")})}});dojo.declare("js.LGPrintMap",js.LGMapBasedMenuBox,{constructor:function(){var b,t=this;this.radioButtonController=
new js.LGRadioButtonController;b=new js.LGRadioButton({rootId:this.rootId+"_landscape",parentDiv:this.rootId,iconUrl:this.landscapeButtonIconUrl,iconJson:this.landscapeButtonIconJson,iconColorizerId:this.iconColorizerId,rootClass:this.orientationButtonClass,iconClass:this.orientationButtonIconClass,tooltip:this.checkForSubstitution(this.landscapeButtonTooltip),value:this.landscapeServerSpec});b.setIsVisible(!0);this.radioButtonController.addMember(b);a.set(b.rootDiv,"display","inline-block");b=new js.LGRadioButton({rootId:this.rootId+
"_portrait",parentDiv:this.rootId,iconUrl:this.portraitButtonIconUrl,iconJson:this.portraitButtonIconJson,iconColorizerId:this.iconColorizerId,rootClass:this.orientationButtonClass,iconClass:this.orientationButtonIconClass,tooltip:this.checkForSubstitution(this.portraitButtonTooltip),value:this.portraitServerSpec});b.setIsVisible(!0);this.radioButtonController.addMember(b);a.set(b.rootDiv,"display","inline-block");this.titleEntryTextBox=(new u({id:this.rootId+"_titleEntry",value:this.title,trim:!0,
placeHolder:this.titleHint||this.checkForSubstitution(this.titleHintDefault)||""})).placeAt(this.rootId);a.set(this.titleEntryTextBox.domNode,"width","97%");e.add(this.titleEntryTextBox.domNode,this.titleClass);this.authorEntryTextBox=(new u({id:this.rootId+"_authorEntry",value:this.author,trim:!0,placeHolder:this.authorHint||this.checkForSubstitution(this.authorHintDefault)||""})).placeAt(this.rootId);a.set(this.authorEntryTextBox.domNode,"width","97%");e.add(this.authorEntryTextBox.domNode,this.authorClass);
b=new js.LGButton({rootId:this.rootId+"_doPrint",parentDiv:this.rootId,iconUrl:this.printButtonIconUrl,iconJson:this.printButtonIconJson,iconColorizerId:this.iconColorizerId,rootClass:this.printButtonClass,iconClass:this.printButtonIconClass,tooltip:this.checkForSubstitution(this.printButtonTooltip)});b.setIsVisible(!0);a.set(b.rootDiv,"display","inline-block");this.radioButtonController.selectMember(0);l(b.rootDiv,"click",function(){var b,a,d=[],c;t.publishMessage(t.publishWorking);t.setIsVisible(!1);
b=t.mapObj.getOperationalLayers();f.forEach(b,function(b){a=new D;a.layerId=b.id;d.push(a)});b=(b=t.radioButtonController.getCurrentMember())?b.value:null;c=new B;c.map=t.appConfig.map;c.outSpatialReference=t.appConfig.map.spatialReference;c.template=new C;c.template.format=t.format||"PDF";c.template.layout=b||t.layout||"Letter ANSI A Landscape";c.template.layoutOptions={titleText:t.titleEntryTextBox.value,authorText:t.authorEntryTextBox.value,copyrightText:t.copyrightText,legendLayers:d};c.template.preserveScale=
t.toBoolean(t.preserveScale,!1);c.template.showAttribution=!0;t.printTask.execute(c,function(b){t.publishMessage(t.publishPrintUrl,b.url);t.publishMessage(t.publishReady)},function(b){t.publishMessage(t.publishReady);t.log("Print failed: "+b.message,!0)})});this.setUpWaitForDependency("js.LGPrintMap")},checkPrerequisites:function(){if(this.appConfig.helperServices&&this.appConfig.helperServices.printTask&&this.appConfig.helperServices.printTask.url)this.printTask=new A(this.appConfig.helperServices.printTask.url,
{async:!1});else throw this.log("no print task configured"),"no print task configured";}});dojo.declare("js.LGFetchPrintedMap",[js.LGObject,js.LGMapDependency],{constructor:function(){this.fetchPrintUrl=null;this.printAvailabilityTimeoutMinutes=this.toNumber(this.printAvailabilityTimeoutMinutes,10);this.printTimeouter=null;this.setUpWaitForDependency("js.LGFetchPrintedMap")},onDependencyReady:function(){var b=this;this.subscribeToMessage(this.triggerPrintUrl,function(a){clearTimeout(b.printTimeouter);
b.fetchPrintUrl=a;b.publishMessage(b.publishPrintAvailable);0<b.printAvailabilityTimeoutMinutes&&(b.printTimeouter=setTimeout(function(){b.publishMessage(b.publishPrintNotAvailable)},6E4*b.printAvailabilityTimeoutMinutes))});this.subscribeToMessage(this.trigger,function(){null!==b.fetchPrintUrl&&b.publishMessage(b.publish,b.fetchPrintUrl)})}});dojo.declare("js.LGLocate",js.LGObject,{constructor:function(){var b=this,a;this.ready=new n;Modernizr.geolocation?(this.subscribeToMessage(this.trigger,function(){a=
setTimeout(function(){alert(b.checkForSubstitution("@messages.geolocationTimeout"))},16E3);navigator.geolocation.getCurrentPosition(function(g){clearTimeout(a);b.log("go to "+g.coords.latitude+" "+g.coords.longitude);b.publishMessage(b.publish,new esri.geometry.Point(g.coords.longitude,g.coords.latitude,new esri.SpatialReference({wkid:4326})))},function(g){clearTimeout(a);switch(g.code){case g.PERMISSION_DENIED:g=b.checkForSubstitution("@messages.geolocationDenied");break;case g.TIMEOUT:g=b.checkForSubstitution("@messages.geolocationTimeout");
break;default:g=b.checkForSubstitution("@messages.geolocationUnavailable")}alert(g)},{timeout:8E3})}),this.ready.resolve(b)):this.ready.reject(b)}});dojo.declare("js.LGSearch",js.LGObject,{constructor:function(){this.busyIndicator&&(this.busyIndicator=this.lgById(this.busyIndicator))},search:function(){return null},toList:function(){return[]},publish:function(b,a){this.publishMessage(b,a)},sortByLabel:function(b,a){var g=0;b&&(a&&b.label&&a.label)&&(g=b.label.localeCompare(a.label));return g},getRepresentativePoint:function(b){var a;
"point"===b.type?a=b:"polygon"===b.type?(a=b.getExtent().getCenter(),b.contains(a)||(a=b.getPoint(0,0))):"polyline"===b.type&&(a=b.getPoint(0,0));return a}});dojo.declare("js.LGSearchAddress",[js.LGSearch,js.LGMapDependency],{constructor:function(){this.searcher=new z(this.searchUrl);this.searcher.outSpatialReference=new esri.SpatialReference({wkid:this.outWkid});this.params={};this.params.outFields=this.outFields;this.ready=new n;this.setUpWaitForDependency("js.LGSearchAddress")},onDependencyReady:function(){this.params.searchExtent=
this.appConfig.map.extent;this.ready.resolve(this);this.inherited(arguments)},search:function(b,a,g){this.params.address={};this.params.address[this.addressParamName]=b;this.searcher.addressToLocations(this.params,a,g)},toList:function(b){var a,g=this,d=[];b&&f.forEach(b,function(b){a=!1;b.score>=g.minimumScore&&(g.validLocators?f.some(g.validLocators,function(g){if(b.attributes.Loc_name===g)return a=!0}):a=!0);a&&d.push({label:b.address,data:new esri.geometry.Point(b.location.x,b.location.y,new esri.SpatialReference({wkid:102100}))})});
return d},publish:function(b,a){this.publishMessage(b,a)}});dojo.declare("js.LGSearchFeatureLayer",[js.LGSearch,js.LGMapDependency],{constructor:function(){if(!this.searchPattern||0>this.searchPattern.indexOf("${1}"))this.searchPattern="%${1}%";this.caseInsensitiveSearch=this.toBoolean(this.caseInsensitiveSearch,!0);this.ready=new n;this.displayField=this.displayField?this.displayField.split(",")[0].trim():"";this.setUpWaitForDependency("js.LGSearchFeatureLayer")},onDependencyReady:function(){var b,
a,g,d=",",c,e=this,m=[],k;if(this.searchLayerName)try{if((b=this.mapObj.getLayer(this.searchLayerName))&&b.url){this.searchURL=b.url;f.forEach(b.fields,function(b){d+=b.name+","});this.searchFields&&0<this.searchFields.length?(g=this.searchFields.split(","),this.searchFields=[],f.forEach(g,function(b){e.searchFields.push(b.trim())}),f.forEach(this.searchFields,function(b){0<=d.indexOf(","+b+",")&&m.push(b)})):this.searchFields=[];if(0===m.length){this.showSearchLayerFieldError(this.searchFields,this.searchLayerName,
b);this.ready.reject(this);this.inherited(arguments);return}""!==this.displayField&&0>d.indexOf(","+this.displayField+",")&&(this.showSearchLayerFieldError([this.displayField],this.searchLayerName,b),this.displayField="");this.searchFields=m;this.objectIdField=b.objectIdField;this.publishPointsOnly="boolean"===typeof this.publishPointsOnly?this.publishPointsOnly:!0;this.searcher=new E(this.searchURL);this.generalSearchParams=new w;this.generalSearchParams.returnGeometry=!1;this.generalSearchParams.outSpatialReference=
this.appConfig.map.spatialReference;k=[b.objectIdField];""!==this.displayField&&(k=k.concat(this.displayField));this.generalSearchParams.outFields=k.concat(this.searchFields);this.objectSearchParams=new w;this.objectSearchParams.returnGeometry=!0;this.objectSearchParams.outSpatialReference=this.appConfig.map.spatialReference;this.objectSearchParams.outFields=["*"];c=this.appConfig.itemInfo.itemData.operationalLayers;f.some(c,function(b){return b.title===e.searchLayerName?(e.layer=b,e.popupTemplate=
new F(b.popupInfo),!0):!1});this.log("Search layer "+this.searchLayerName+" set up for queries");this.ready.resolve(this);this.inherited(arguments);return}}catch(p){a=p.toString()}this.showSearchLayerError(this.searchLayerName,a);this.ready.reject(this);this.inherited(arguments)},showSearchLayerError:function(b,a){var g;a||(a=this.checkForSubstitution("@messages.searchLayerMissing"));g='"'+(b||"")+'"<br>';g+=a+"<br><hr>";g+=this.checkForSubstitution("@prompts.mapLayers")+"<br><ul>";f.forEach(this.mapObj.getLayerNameList(),
function(b){g+='<li>"'+b+'"</li>'});g+="</ul>";this.log(g,!0)},showSearchLayerFieldError:function(b,a,g){var d="",c;g.fields?(f.forEach(b,function(b){0<d.length&&(d+=",");d+=b}),c='"'+d+'"<br>',c=1<b.length?c+this.checkForSubstitution("@messages.allSearchFieldsMissing"):c+this.checkForSubstitution("@messages.searchFieldMissing"),c+='<br><hr>"'+a+'"<br>',c+=this.checkForSubstitution("@prompts.layerFields")+"<br><ul>",f.forEach(g.fields,function(b){c+='<li>"'+b.name+'"</li>'}),c+="</ul>"):(c='"'+a+
'"<br>',c+=this.checkForSubstitution("@messages.searchLayerNotSearchable"));this.log(c,!0)},search:function(b,a,d){var c,e="",m,k="";!0===this.caseInsensitiveSearch?(c=b.toUpperCase(),m="UPPER(${0}) LIKE '"+this.searchPattern+"'"):(c=b,m="${0} LIKE '"+this.searchPattern+"'");c=c.replace(/'/g,"''");f.forEach(this.searchFields,function(b){e=e+k+dojo.string.substitute(m,[b,c]);k="  OR  "});0<e.length&&(this.generalSearchParams.where=e,this.searcher.execute(this.generalSearchParams,a,d))},toList:function(b,
a){var c=this,d=[],e,m,k=a.toUpperCase();b&&(b.features&&0<b.features.length)&&(f.forEach(b.features,function(b){m="";b.attributes[c.displayField]?m=b.attributes[c.displayField].toString():f.some(c.searchFields,function(a){return b.attributes[a]&&(e=b.attributes[a].toString(),0<=e.toUpperCase().indexOf(k))?(m=e,!0):!1});""===m&&(m="result");d.push({label:m,data:b.attributes[c.objectIdField]})}),d.sort(c.sortByLabel));return d},publish:function(b,a){var c,d,e=this;this.busyIndicator&&this.busyIndicator.setIsVisible(!0);
this.objectSearchParams.where=this.objectIdField+"="+a;this.searcher.execute(this.objectSearchParams,function(a){a&&a.features&&0<a.features.length?(c=a.features[0],c.infoTemplate=e.popupTemplate,c._graphicsLayer=e.layer.layerObject,d=e.publishPointsOnly?e.getRepresentativePoint(c.geometry):c,e.publishMessage(b,d)):e.log("LGSearchFeatureLayer_1: no results");e.busyIndicator&&e.busyIndicator.setIsVisible(!1)},function(b){e.log("LGSearchFeatureLayer_2: "+b.message);e.busyIndicator&&e.busyIndicator.setIsVisible(!1)})}});
dojo.declare("js.LGSearchMultiplexer",js.LGSearch,{constructor:function(){var b=this,a;this.ready=new n;a=this.createSearchersList();(new r(a)).then(function(a){f.every(a,function(b){return b[0]})?b.ready.resolve(b):b.ready.reject(b)})},createSearchersList:function(){var b=this,a=[];this.searchers=[];this.searchers=[];this.searcherNames&&f.forEach(this.searcherNames,function(c){if(c=b.lgById(c))b.searchers.push(c),a.push(c.ready)});return a},search:function(b,a,c){var d=[],e=[];f.forEach(this.searchers,
function(a,c){var g=new n;e.push(g);a.search(b,function(e){e=a.toList(e,b);e=f.map(e,function(b){return{data:{iSearcher:c,itemData:b.data},label:b.label}});d=d.concat(e);g.resolve()},function(b){g.reject(b)})});(new r(e)).then(function(b){var e=!0;c&&(e=!f.some(b,function(b){return!b[0]?(c(b[1]),!0):!1}));e&&a&&a(d)})},toList:function(b){return b},publish:function(b,a){this.searchers[a.iSearcher].publish(b,a.itemData)}});dojo.declare("js.LGSearchFeatureLayerMultiplexer",[js.LGSearchMultiplexer,js.LGMapDependency],
{constructor:function(){this.setUpWaitForDependency("js.LGSearchFeatureLayerMultiplexer")},createSearchersList:function(){var b=[],a=[],c=[],d,e;this.searchers=[];this.searchLayerName&&(a=this.searchLayerName.split(","));this.displayFields&&(c=this.displayFields.split(","));for(d=0;d<a.length;d+=1)e=this.rootId+"_"+this.searchers.length,e=new js.LGSearchFeatureLayer({appConfig:this.appConfig,rootId:e,parentDiv:this.parentDiv,dependencyId:this.dependencyId,busyIndicator:this.busyIndicator,publishPointsOnly:this.publishPointsOnly,
searchPattern:this.searchPattern,caseInsensitiveSearch:this.caseInsensitiveSearch,searchLayerName:a[d].trim(),searchFields:this.searchFields,displayField:c[d]}),this.searchers.push(e),b.push(e.ready);return b},onDependencyReady:function(){0===this.searchers.length&&this.showSearchLayerError("")},showSearchLayerError:function(b,a){var c;a||(a=this.checkForSubstitution("@messages.searchLayerMissing"));c='"'+(b||"")+'"<br>';c+=a+"<br><hr>";c+=this.checkForSubstitution("@prompts.mapLayers")+"<br><ul>";
f.forEach(this.mapObj.getLayerNameList(),function(b){c+='<li>"'+b+'"</li>'});c+="</ul>";this.log(c,!0)}});dojo.declare("js.LGSearchBoxByText",js.LGDropdownBox,{constructor:function(){var b=this,c,d,e,m,k,p,q;c=this.rootId+"_entry";h.create("label",{"for":c,innerHTML:this.checkForSubstitution(this.showPrompt)},this.rootId);this.searchEntryTextBox=(new u({id:c,value:"",trim:!0,placeHolder:this.hint,intermediateChanges:!0})).placeAt(this.rootId);a.set(this.searchEntryTextBox.domNode,"width","99%");c=
h.create("div",{className:this.resultsListBoxClass},this.rootId);d=h.create("table",{className:this.resultsListTableClass},c);e=h.create("tbody",{className:this.resultsListBodyClass},d);touchScroll(c);m=this.lgById(this.searcher);k="";p=0;q=null;l(this.searchEntryTextBox,"change",function(){var a=b.searchEntryTextBox.get("value");k!==a&&(k=a,h.empty(e),clearTimeout(q),0<a.length&&(q=setTimeout(function(){var c,d,g;c=h.create("tr",null,e);h.create("td",{className:b.resultsListSearchingClass},c);d=
p=(new Date).getTime();m.search(a,function(c){d<p||(h.empty(e),c=m.toList(c,a),g=(new Date).getTime(),b.log("retd "+c.length+" items in "+(g-d)/1E3+" secs"),0<c.length&&f.forEach(c,function(a){var c;c=h.create("tr",null,e);c=h.create("td",{className:b.resultsListEntryClass,innerHTML:a.label},c);b.applyTheme(!0,c);l(c,"click",function(){m.publish(b.publish,a.data)})}))},function(a){b.log("LGSearchBoxByText_1: "+a.message);k="";h.empty(e)})},1E3)))})},toggleVisibility:function(){this.inherited(arguments);
this.getIsVisible()&&this.searchEntryTextBox.focus()}});dojo.declare("js.LGShare",js.LGObject,{constructor:function(){var b=this;this.busyIndicator&&(this.busyIndicator=this.lgById(this.busyIndicator));this.subscribeToMessage(this.trigger,function(){b.share()})},share:function(){var b=this,a,c;a=encodeURIComponent(this.getSubject());c=encodeURIComponent(this.getUrlToShare());this.tinyURLServiceURL&&0<this.tinyURLServiceURL.length?(this.busyIndicator&&this.busyIndicator.setIsVisible(!0),c=esri.substitute({url:c},
this.tinyURLServiceURL),esri.request({url:c,handleAs:"json"},{useProxy:!1}).then(function(c){var d,e;try{if(d=b.followAttributePath(c,b.tinyURLResponseAttribute))e=esri.substitute({subject:a,url:d},b.shareUrl),b.publishMessage(b.publish,e)}catch(m){b.log("LGShare_1: "+m.toString())}b.busyIndicator&&b.busyIndicator.setIsVisible(!1)},function(a){b.log("LGShare_2: "+a.toString());b.busyIndicator&&b.busyIndicator.setIsVisible(!1)})):(c=esri.substitute({subject:a,url:c},this.shareUrl),this.publishMessage(this.publish,
c))},getSubject:function(){return""},getUrlToShare:function(){return this.getAppUrl()},getAppUrl:function(){return window.location.toString()}});dojo.declare("js.LGShareAppExtents",[js.LGShare,js.LGMapDependency],{constructor:function(){this.setUpWaitForDependency("js.LGShareAppExtents")},getSubject:function(){var b="";this.subject&&(b=this.checkForSubstitution(this.subject));return b},getUrlToShare:function(){var b=this.getAppUrl();return b+(0>b.indexOf("?")?"?":"&")+this.getMapExtentsArg()},getMapExtentsArg:function(){return"ex="+
this.mapObj.getMapExtentsAsString()}});dojo.declare("js.LGFilterLayers1",js.LGMapBasedMenuBox,{constructor:function(){this.layers=[];this.switchDelayTimer=null;this.busyIndicator&&(this.busyIndicator=this.lgById(this.busyIndicator));this.switchDelayTimer=null;this.switchDelaySecs=1E3*this.toNumber(this.nonieSwitchDelaySecs,1.5);this.switchDelayMultiplier=1;this.setUpWaitForDependency("js.LGFilterLayers1")},onDependencyReady:function(){var b;this.fieldname1&&(f.forEach(this.appConfig.itemInfo.itemData.operationalLayers,
d.hitch(this,function(b){var a;if(b.layerObject&&"Feature Layer"===b.layerObject.type)for(a=0;a<b.layerObject.fields.length;a+=1)if(b.layerObject.fields[a].name===this.fieldname1){b={layerObject:b.layerObject,fieldType:b.layerObject.fields[a].type};this.layers.push(b);break}})),h.create("label",{innerHTML:this.hint1},h.create("div",{},this.rootId)),b=(new u({id:this.rootId+"_field1",value:this.value1,trim:!0,placeHolder:this.hint1,intermediateChanges:!0})).placeAt(this.rootId),a.set(b.domNode,"width",
"99%"),this.tooltip&&b.set("title",this.checkForSubstitution(this.tooltip)),l(b,"change",d.hitch(this,function(){this.value1=b.value;this.onValueChanged()})));0===this.layers.length?(this.setShowable(!1),this.showFieldError(this.fieldname1)):this.applyFilter()},showFieldError:function(b){var a;a='"'+b+'"<br>';a+=this.checkForSubstitution("@messages.fieldNotFound")+"<br><hr>";a+=this.checkForSubstitution("@prompts.mapLayers")+"<br><ul>";f.forEach(this.appConfig.itemInfo.itemData.operationalLayers,
d.hitch(this,function(b){var c;if(b.layerObject&&"Feature Layer"===b.layerObject.type){a+='<li>"'+b.title+'"<ul>';for(c=0;c<b.layerObject.fields.length;c+=1)a+='<li>"'+b.layerObject.fields[c].name+'"</li>';a+="</ul></li>"}}));a+="</ul>";this.log(a,!0)},onValueChanged:function(){this.applyFilter()},applyFilter:function(){var b=this;this.busyIndicator&&this.busyIndicator.setIsVisible(!0);null!==this.switchDelayTimer&&clearTimeout(this.switchDelayTimer);this.switchDelayTimer=setTimeout(function(){b.switchDelayTimer=
null;b.applyFilterCore();b.busyIndicator&&b.busyIndicator.setIsVisible(!1)},this.switchDelaySecs*this.switchDelayMultiplier);this.switchDelayMultiplier=1},applyFilterCore:function(){f.forEach(this.layers,d.hitch(this,function(b){this.setLayerDefinitionExpression(b.layerObject,b.fieldType);b.layerObject.clearSelection()}))},setLayerDefinitionExpression:function(b,a){var c=b.defaultDefinitionExpression;try{this.value1&&""!==this.value1&&("esriFieldTypeString"===a?c=v.substitute(this.defnExpression,
{fieldname1:this.fieldname1,value1:"'"+this.value1+"'"}):"esriFieldTypeInteger"===a&&(c=v.substitute(this.defnExpression,{fieldname1:this.fieldname1,value1:this.value1}))),b.setDefinitionExpression(c)}catch(d){}}});dojo.declare("js.LGFilterLayers1WithDefaults",[js.LGFilterLayers1,js.LGDefaults],{constructor:function(){this.changeDefaults();this.setUpWaitForDependency("js.LGFilterLayers1WithDefaults")},onValueChanged:function(){this.inherited(arguments);this.changeDefaults()},changeDefaults:function(){this.defaultValues.value1=
this.value1;this.defaultValues.fieldname1=this.fieldname1;this.inherited(arguments)}})})},"js/lgonlineDijit":function(){define("js/lgonlineDijit",["dojo/Deferred","dojo/dom-construct","js/lgonlineMap"],function(h,s){dojo.declare("js.LGMapDijitContainer",[js.LGGraphic,js.LGMapDependency],{constructor:function(){this.ready=new h;this.setUpWaitForDependency("js.LGMapDijitContainer")},onDependencyReady:function(){this.createDijit()},createDijit:function(){var h=this;require([this.dijitAmd],function(n){h.dijit=
(new n({map:h.appConfig.map},s.create("div",null,h.rootDiv))).startup();h.ready.resolve(h)})}})})},"js/lgonlineDrawing":function(){define("js/lgonlineDrawing","dojo/Deferred dojo/_base/Color dojo/on esri/lang esri/graphic esri/symbols/SimpleLineSymbol esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleFillSymbol js/lgonlineMap".split(" "),function(h,s,l,n,r,a,e,f){dojo.declare("js.LGHighlighter",[js.LGObject,js.LGMapDependency],{constructor:function(){this.showFeaturePopup=this.toBoolean(this.showFeaturePopup,
!0);this.setUpWaitForDependency("js.LGHighlighter")},onDependencyReady:function(){var a=this;this.highlighterLayer=a.mapObj.createGraphicsLayer("highlighterLayer");this.lineHiliteColor=new s(this.lineHiliteColor||"#0000ff");this.fillHiliteColor=new s(this.fillHiliteColor||[0,0,255,0.1]);this.concentricCircleFillColor=new s([0,0,0,0]);this.intervalID=this.intervalTerminator=null;this.subscribeToMessage("highlightItem",function(c){var e,f;c&&(f=c.geometry||c,e=(e=f.getExtent())?e.getCenter():f,f=a.createHighlightGraphics(f,
c.attributes,c.infoTemplate),0<f.length&&a.showHighlight(f,e,a.highlightZoomLevel,n.isDefined(c.attributes)&&n.isDefined(c.infoTemplate)&&a.showFeaturePopup,c))});this.appConfig.map.infoWindow&&l(this.appConfig.map.infoWindow,"hide",function(){a.highlighterLayer.clear()});this.showFeaturePopup||this.appConfig.map.infoWindow&&l(this.appConfig.map.infoWindow,"show",function(){a.highlighterLayer.clear()})},createHighlightGraphics:function(d,c,h){var n,k=[];if("polyline"===d.type)k.push(new r(d,new a(esri.symbol.SimpleLineSymbol.STYLE_SOLID,
this.lineHiliteColor,3),c,h));else if("point"===d.type){if(!d.x||!d.y||isNaN(d.x)||isNaN(d.y))return k;for(n=0;4>=n;++n)k.push(new r(d,new e(e.STYLE_CIRCLE,2.5*(n+16),new a(a.STYLE_SOLID,this.lineHiliteColor,3),this.concentricCircleFillColor),c,h))}else d.type&&k.push(new esri.Graphic(d,new f(f.STYLE_SOLID,new a(a.STYLE_SOLID,this.lineHiliteColor,3),this.fillHiliteColor),c,h));return k},showHighlight:function(a,c,e,f,k){var m,p,q,n,l=this;c?m=this.mapObj.centerAt(c):(m=new h,m.resolve());m.then(function(){e?
p=l.mapObj.setZoom(e):(p=new h,p.resolve());p.then(function(){l.intervalTerminator&&(clearTimeout(l.intervalTerminator),clearInterval(l.intervalID));l.mapObj.hidePopup();1<a.length?(q=0,n=!0,l.intervalID=setInterval(function(){l.highlighterLayer.clear();l.highlighterLayer.add(a[q]);n?++q:--q;q===a.length?(n=!1,--q):0>q&&(n=!0,q=0)},120),l.intervalTerminator=setTimeout(function(){clearInterval(l.intervalID);l.intervalTerminator=null;l.intervalID=null;l.highlighterLayer.clear()},5E3)):l.highlighterLayer.add(a[0]);
f&&l.mapObj.showPopupWithFeature(c,k)})})}})})},"js/lgonlineEditing":function(){define("js/lgonlineEditing","dojo/dom-construct dojo/_base/array dojo/_base/lang dojo/_base/Color dojo/aspect esri/dijit/editing/TemplatePicker esri/dijit/editing/Editor esri/toolbars/draw esri/graphic js/lgonlineBase js/lgonlineMap js/lgonlineCommand".split(" "),function(h,s,l,n,r,a,e,f,d){dojo.declare("js.LGEditTemplatePicker",js.LGMapBasedMenuBox,{constructor:function(){var a;a=dojo.byId(this.colorizerId).getLGObject();
a=".templatePicker{border:1px solid transparent!important;}.templatePicker .dojoxGrid{background-color:transparent;}.templatePicker .dojoxGrid .dojoxGridScrollbox{background-color:transparent;}.templatePicker .dojoxGrid .dojoxGridRow{background-color:transparent;}.templatePicker .dojoxGrid .dojoxGridCell{border:1px solid transparent}.templatePicker .dojoxGrid .dojoxGridRow{border:1px solid transparent}.templatePicker .grid .dojoxGridRowOver{background-color:transparent;color:inherit;}.templatePicker .grid .dojoxGridRowOver .dojoxGridCell{background-color:transparent;color:inherit;}.templatePicker .dojoxGrid .dojoxGridCellFocus{border:1px solid transparent!important;}.templatePicker .dojoxGrid .dojoxGridRowOdd{background-color:transparent;}.templatePicker .dojoxGrid .selectedItem{border:1px solid transparent!important;color:"+
a.foregroundColor()+"!important;background-color:"+a.alternateBackgroundColor()+"!important}";this.injectCSS(a);this.setUpWaitForDependency("js.LGEditTemplatePicker")},onDependencyReady:function(){var a,d,e,k=!0;this.appConfig.userPrivileges&&(k=!1,s.some(this.appConfig.userPrivileges,function(a){return"features:user:edit"===a?k=!0:!1}));k?(a=this.appConfig.itemInfo.itemData.operationalLayers,this.layerInfos=[],this.layers=[],s.forEach(a,l.hitch(this,function(a){var c,k=a.layerObject;if(k instanceof
esri.layers.FeatureLayer&&k.isEditable()&&(null===a.capabilities||"Query"!==a.capabilities)&&(null===k.capabilities||"Query"!==k.capabilities))e={featureLayer:k},d=null,a.popupInfo&&a.popupInfo.fieldInfos?d=a.popupInfo.fieldInfos:k.infoTemplate&&(k.infoTemplate.info&&k.infoTemplate.info.fieldInfos)&&(d=k.infoTemplate.info.fieldInfos),d&&(c=[],s.forEach(d,function(a){a.visible&&c.push(a)}),e.fieldInfos=c),this.layerInfos.push(e),this.layers.push(k)})),0===this.layers.length?this.setShowable(!1):(this.templatePickerHolder=
h.create("div",{className:this.templatePickerHolderClass}),h.place(this.templatePickerHolder,this.rootId),touchScroll(this.templatePickerHolder))):this.setShowable(!1);this.inherited(arguments)},createEditor:function(){var c=this,d,f;this.templatePickerHolder&&(this.setIsVisible(!1,!0),d=h.create("div"),h.place(d,this.templatePickerHolder),f=new a({featureLayers:this.layers,rows:"auto",columns:2,grouping:!0},d),f.startup(),this.setIsVisible(!1,!1),d=h.create("div"),h.place(d,this.templatePickerHolder),
f={map:this.appConfig.map,templatePicker:f,toolbarVisible:!1,layerInfos:this.layerInfos},this.editor=new e({settings:f},d),this.editor.startup(),r.before(this.editor,"_applyEdits",function(a){s.forEach(a,function(a){a.adds&&c.preprocessEditAdds(a);a.updates&&c.preprocessEditUpdates(a);a.deletes&&c.preprocessEditDeletes(a)})}),this.mapObj.disablePopups())},destroyEditor:function(){this.editor&&(this.editor.destroy(),this.editor=null,this.mapObj.enablePopups())},show:function(){this.createEditor();
this.inherited(arguments)},hide:function(){this.destroyEditor();this.inherited(arguments)},preprocessEditAdds:function(a){return a},preprocessEditUpdates:function(a){return a},preprocessEditDeletes:function(a){return a}});dojo.declare("js.LGEditTemplatePickerWithDefaults",[js.LGEditTemplatePicker,js.LGDefaults],{constructor:function(){this.changeDefaults();this.setUpWaitForDependency("js.LGEditTemplatePickerWithDefaults")},preprocessEditAdds:function(a){a.adds[0].attributes[this.defaultValues.fieldname1]=
this.defaultValues.value1;return a}});dojo.declare("js.LGFeatureByClick",[js.LGObject,js.LGMapDependency],{constructor:function(){this.setUpWaitForDependency("js.LGFeatureByClick")},onDependencyReady:function(){var a=this;this.inherited(arguments);this.clickHandle=this.subscribeToMessage("mapClick",function(d){a.handleClick(d)})},handleClick:function(){return null}});dojo.declare("js.LGAddFeatureByClick",js.LGFeatureByClick,{constructor:function(){this.setUpWaitForDependency("js.LGAddFeatureByClick")},
onDependencyReady:function(){this.inherited(arguments);esri.bundle.toolbars.draw.addPoint=this.checkForSubstitution("@tooltips.collect");this.drawingToolbar=new f(this.appConfig.map,{});this.drawingToolbarActive=!1;this.drawingToolbar.on("draw-end",l.hitch(this,this.handleDrawEnd))},handleClick:function(a){this.drawingToolbarActive||(this.drawingToolbarActive=!0,this.drawingToolbar.activate(f.POINT),this.drawingToolbar._updateTooltip(a))},handleDrawEnd:function(a){var e=this,f;this.drawingToolbarActive=
!1;this.drawingToolbar.deactivate();f=new d(a.geometry,new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_SQUARE,10,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new n([255,0,0]),1),new n([0,255,0,0.25])));this.appConfig.map.graphics.add(f);setTimeout(function(){alert(e.checkForSubstitution("@messages.yourContentSubmitted"));e.appConfig.map.graphics.remove(f)},2E3)}})})},"js/lgonlineFrame":function(){define("js/lgonlineFrame","dojo/dom-construct dojo/on dojo/dom-style dojo/_base/array dojo/_base/lang js/lgonlineBase".split(" "),
function(h,s,l,n,r){dojo.declare("js.LGColorizer",js.LGObject,{constructor:function(){var a,e="",f=this,d=["#fff","#333333","#5d5d5d","#5d5d5d"];this.colors=[];n.some(this.colorTable,function(a){return f.theme===a.theme?(f.colors=a.colors,!0):!1});if(this.colors.length<d.length)for(a=this.colors.length;a<d.length;a+=1)this.colors.push(d[a]);e+=".appTheme{color:"+this.colors[0]+";background-color:"+this.colors[1]+"}";e+=".appTheme2{color:"+this.colors[0]+";background-color:"+this.colors[3]+"}";e+=
".appThemeHover:hover{background-color:"+this.colors[2]+"}";this.injectCSS(e)},foregroundColor:function(){return this.colors[0]},backgroundColor:function(){return this.colors[1]},hoverColor:function(){return this.colors[2]},alternateBackgroundColor:function(){return this.colors[3]}});dojo.declare("js.LGFrame",js.LGGraphic,{constructor:function(){var a;a={};this.headerDivId&&(a.id=this.headerDivId);this.headerDivClass&&(a.className=this.headerDivClass);this.headerDiv=h.create("div",a,this.rootDiv);
this.applyTheme(!1,this.headerDiv);a={};this.contentDivId&&(a.id=this.contentDivId);this.contentDivClass&&(a.className=this.contentDivClass);this.contentDiv=h.create("div",a,this.rootDiv);this.handleWindowResize()},handleWindowResize:function(){this.inherited(arguments);this.resizeContentDiv()},resizeContentDiv:function(){var a,e,f;this.headerDiv&&this.contentDiv&&(a=dojo.marginBox(this.rootDiv),e=dojo.marginBox(this.headerDiv),f=a.h-e.h,0<f&&(f={},f.top=e.h+"px",f.height=a.h-e.h+"px",l.set(this.contentDiv,
f)))}});dojo.declare("js.LGGallery",js.LGGraphic,{constructor:function(){var a,e=this;a=h.create("table",null,this.rootDiv);this.applyTheme(!1,a);s(window,"resize",r.hitch(this,this.handleParentResize));this.rootDiv.getContentDiv=function(){return e.addItem()};a=h.create("tbody",null,a);this.galleryRow=h.create("tr",null,a);a={innerHTML:"&lt;",style:{visibility:"hidden"}};this.arrowClass&&(a.className=this.arrowClass);this.leftArrow=h.create("td",a,this.galleryRow);this.applyTheme(!0,this.leftArrow);
s(this.leftArrow,"click",r.hitch(this,this.shiftLeft));a.innerHTML="&gt;";this.rightArrow=h.create("td",a,this.galleryRow);this.applyTheme(!0,this.rightArrow);s(this.rightArrow,"click",r.hitch(this,this.shiftRight));this.zeroItemWidth=dojo.marginBox(this.rootDiv).w;this.numItemsToDisplay=this.iFirstItem=this.numItems=this.itemWidth=0;this.firstItem=null;this.handleParentResize()},addItem:function(a){var e;e={};"string"===typeof a&&(e.innerHTML=a);this.itemClass&&(e.className=this.itemClass);e=h.create("td",
e);"string"!==typeof a&&e.appendChild(a);this.galleryRow.insertBefore(e,this.rightArrow);this.numItems+=1;this.firstItem||(this.firstItem=e,this.itemWidth=dojo.marginBox(e).w);this.handleParentResize();return e},clearItems:function(){for(;2<this.galleryRow.childNodes.length;)this.galleryRow.removeChild(this.galleryRow.childNodes[1]);this.numItemsToDisplay=this.iFirstItem=this.numItems=0;this.firstItem=null;this.handleParentResize()},handleParentResize:function(){var a,e;0===this.zeroItemWidth&&(this.zeroItemWidth=
dojo.marginBox(this.rootDiv).w);a=dojo.marginBox(this.rootDiv.parentNode).w;e=this.zeroItemWidth+this.numItems*this.itemWidth;0!==this.numItems&&(e>a?(this.leftArrow.style.visibility="visible",this.rightArrow.style.visibility="visible",this.numItemsToDisplay=Math.max(Math.floor((a-this.zeroItemWidth)/this.itemWidth),1)):(this.leftArrow.style.visibility="hidden",this.rightArrow.style.visibility="hidden",this.numItemsToDisplay=this.numItems),this.iFirstItem=Math.min(this.iFirstItem,this.numItems-this.numItemsToDisplay),
this.drawGallery())},shiftLeft:function(){this.iFirstItem=Math.min(this.iFirstItem+1,this.numItems-this.numItemsToDisplay);this.drawGallery()},shiftRight:function(){this.iFirstItem=Math.max(this.iFirstItem-1,0);this.drawGallery()},drawGallery:function(){var a,e=this.iFirstItem,f=this.iFirstItem+this.numItemsToDisplay,d=this.firstItem;this.leftArrow.style.visibility="hidden";this.rightArrow.style.visibility="hidden";for(a=0;a<e;)this.rightArrow.style.visibility="visible",d.style.display="none",d=d.nextSibling,
a+=1;for(;a<f;)d.style.display="",d=d.nextSibling,a+=1;for(;a<this.numItems;)this.leftArrow.style.visibility="visible",d.style.display="none",d=d.nextSibling,a+=1;this.handleWindowResize()}});dojo.declare("js.LGTitleBar",js.LGGraphic,{constructor:function(){var a;this.iconUrl&&0<this.iconUrl.length&&(a={src:this.iconUrl},this.iconClass&&(a.className=this.iconClass),h.create("img",a,this.rootDiv));this.title&&0<this.title.length&&(a={innerHTML:this.title},this.titleClass&&(a.className=this.titleClass),
h.create("span",a,this.rootDiv),document.title=this.title);this.handleWindowResize()}})})},"js/lgonlineMap":function(){define("js/lgonlineMap","dojo/dom-construct dojo/dom dojo/on dojo/_base/lang dojo/_base/array dojo/Deferred dojo/dom-class dojo/dom-attr esri/arcgis/utils esri/dijit/Popup esri/layers/GraphicsLayer esri/tasks/ProjectParameters js/lgonlineBase".split(" "),function(h,s,l,n,r,a,e,f,d,c,v,u){dojo.declare("js.LGMapDependency",js.LGDependency,{onDependencyPrep:function(a){this.mapObj=a;
this.inherited(arguments)}});dojo.declare("js.LGMap",js.LGGraphic,{constructor:function(c){var d=null;c=null;var p=this,q,r;this.ready=new a;q=this.appConfig.map;r=q.extent;h.destroy(this.rootDiv);this.rootDiv=s.byId("mapDiv");h.place(this.rootDiv,this.parentDiv);e.add(this.rootDiv,this.rootClass);f.set(this.rootDiv,"id",this.rootId);this.rootDiv.getLGObject=function(){return p};this.handleWindowResize();q.resize(!0);q.reposition();if(this.xmin&&this.ymin&&this.xmax&&this.ymax)try{d={xmin:this.xmin,
ymin:this.ymin,xmax:this.xmax,ymax:this.ymax,spatialReference:{}},d.spatialReference.wkid=this.wkid?Number(this.wkid):102100,d=new esri.geometry.Extent(d)}catch(v){d=null}this.appConfig.urlValues.ex&&(c=this.getExtentsFromString(this.appConfig.urlValues.ex))&&(d=c);d?d.spatialReference.wkid!==q.spatialReference.wkid?esri.config.defaults.geometryService?(c=new u,c.geometries=[d],c.outSR=q.spatialReference,esri.config.defaults.geometryService.project(c).then(function(a){d=a[0];q.setExtent(d)})):this.log("LGMap_1: Need geometry service to convert extent from wkid "+
d.spatialReference.wkid+" to map's "+q.spatialReference.wkid):q.setExtent(d):q.setExtent(r);q.spatialReference||(q.spatialReference=new esri.SpatialReference(102100));l(window,"resize",n.hitch(this,function(){q.resize();q.reposition()}));this.tempGraphicsLayer=this.createGraphicsLayer("tempGraphicsLayer");this.positionHandle=this.subscribeToMessage("position",function(a){var c;a.spatialReference.wkid===p.appConfig.map.spatialReference.wkid?p.publishMessage("highlightItem",a):4326===a.spatialReference.wkid&&
102100===p.appConfig.map.spatialReference.wkid?(a=esri.geometry.geographicToWebMercator(a),p.publishMessage("highlightItem",a)):esri.config.defaults.geometryService?(c=new esri.tasks.ProjectParameters,c.geometries=[a],c.outSR=p.appConfig.map.spatialReference,esri.config.defaults.geometryService.project(c).then(function(c){a=c[0];p.publishMessage("highlightItem",a)})):p.log("LGMap_1: Need geometry service to convert position from wkid "+a.spatialReference.wkid+" to map's "+p.appConfig.map.spatialReference.wkid)});
this.showFeatureHandle=this.subscribeToMessage("showFeature",function(a){p.publishMessage("highlightItem",a)});this.clickHandle=l(q,"click",function(a){p.publishMessage("mapClick",a)});this.ready.resolve(this)},showPopupWithFeature:function(a,c){var d=this.appConfig.map.infoWindow;d.clearFeatures();d.setContent(c.getContent());d.show(a)},hidePopup:function(){this.appConfig.map.infoWindow.hide()},setExtent:function(a){return this.appConfig.map.setExtent(a)},centerAt:function(a){return this.appConfig.map.centerAt(a)},
setZoom:function(a){var c=this.appConfig.map.getMinZoom(),d=this.appConfig.map.getMaxZoom();0<=c&&0<=d&&(a=Math.max(c,Math.min(d,a)));return this.appConfig.map.setZoom(a)},getMapExtentsAsString:function(){var a="";this.appConfig.map&&(a=this.getStringFromExtents(this.appConfig.map.extent));return a},getStringFromExtents:function(a){var c=a.xmin.toFixed().toString()+","+a.ymin.toFixed().toString()+","+a.xmax.toFixed().toString()+","+a.ymax.toFixed().toString();(a=a.spatialReference)&&(a.wkid?c=c+","+
a.wkid.toString():a.wkt&&(c=c+","+encodeURIComponent(a.wkt)));return c},getExtentsFromString:function(a){var c,d=null,e,f;c=a.split(",");1===c.length&&(f=a.indexOf("PROJCS"),0<f?(c=a.substr(0,f).split("%2C"),c[4]=a.substr(f)):c=a.split("%2C"));try{d={xmin:Number(c[0]),ymin:Number(c[1]),xmax:Number(c[2]),ymax:Number(c[3]),spatialReference:{}},4<c.length?(e=Number(c[4]),isNaN(e)?d.spatialReference.wkt=decodeURIComponent(c[4]):d.spatialReference.wkid=e):d.spatialReference.wkid=102100,d=new esri.geometry.Extent(d)}catch(h){d=
null}return d},getLayer:function(a){var c;r.some(this.appConfig.itemInfo.itemData.operationalLayers,function(d){return d.title===a?(c=d.layerObject,!0):!1});return c},getLayerNameList:function(){var a=[];r.forEach(this.appConfig.itemInfo.itemData.operationalLayers,function(c){a.push(c.title)});return a},getOperationalLayers:function(){return this.appConfig.itemInfo.itemData.operationalLayers},createGraphicsLayer:function(a){var c=new v;c.id=a;l(c,"graphic-add",function(){c.disableMouseEvents()});
return this.appConfig.map.addLayer(c)},enablePopups:function(){this.appConfig.mapInfo.clickEventListener&&(this.appConfig.mapInfo.clickEventHandle=l(this.appConfig.map,"click",this.appConfig.mapInfo.clickEventListener))},disablePopups:function(){this.appConfig.mapInfo.clickEventHandle&&this.appConfig.mapInfo.clickEventHandle.remove()}})})},"js/lgonlineOutput":function(){define("js/lgonlineOutput","dojo/dom-construct dojo/dom-class dojo/_base/array dojo/_base/lang dojo/topic js/lgonlineBase".split(" "),
function(h,s,l,n,r){dojo.declare("js.LGNotes",js.LGObject,{constructor:function(){console&&this.notes&&l.forEach(this.notes,function(a){console.log(a)})}});dojo.declare("js.LGBusy",js.LGGraphic,{constructor:function(){this.busyImageClass&&s.add(this.rootDiv,this.busyImageClass)}});dojo.declare("js.LGLogBox",js.LGDropdownBox,{constructor:function(){window.gLogMessageBox=this;touchScroll(this.rootDiv)},append:function(a){"string"===typeof a?h.create("div",{innerHTML:a,style:"margin:2px"},this.rootDiv):
"object"===typeof a&&null!==a&&this.rootDiv.appendChild(a)}});dojo.declare("js.LGMessageBox",js.LGDropdownBox,{constructor:function(){this.content=this.content?this.checkForSubstitution(this.content):"";this.rootDiv.innerHTML=this.content;touchScroll(this.rootDiv)},setMessage:function(a){this.show();this.content=a;this.rootDiv.innerHTML=this.content}});dojo.declare("js.LGSelfHidingMessageBox",js.LGMessageBox,{constructor:function(){this.timeoutSeconds=this.toNumber(this.timeoutSeconds,5)},setUpListeningForCommands:function(){},
handleTrigger:function(){this.getIsVisible()||(this.pendingClosure&&(clearTimeout(this.pendingClosure),this.pendingClosure=null),this.show(),this.pendingClosure=setTimeout(n.hitch(this,function(){this.hide();this.pendingClosure=null}),1E3*this.timeoutSeconds))}});dojo.declare("js.LGPublishEcho",js.LGDropdownBox,{handleTrigger:function(a){this.rootDiv.innerHTML=a.toString();this.setIsVisible(!0)}});dojo.declare("js.LGMessageWatch",js.LGObject,{constructor:function(){var a=this;r.subscribe("publish",
function(e){a.showMessage("message from",e)});r.subscribe("receive",function(e){a.showMessage("received by",e)})},showMessage:function(a,e){var f="";if(e.data)try{f=JSON.stringify(e.data)}catch(d){f="<data>"}this.log(a+" "+e.id+': "'+e.tag+'" '+(f||""))}})})}}});
