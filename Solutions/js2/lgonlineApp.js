/* 
This source is a compressed form of part of the git commit 
703d9eb9dad7c2b1 2014-02-08 15:37:49 -0500
Uncompressed source is available from https://github.com/Esri/local-government-online-apps 
*/ 
/*

 | ArcGIS Solutions
 | Version 10.2
 | Copyright 2012 Esri
 |
 | Licensed under the Apache License, Version 2.0 (the "License");
 | you may not use this file except in compliance with the License.
 | You may obtain a copy of the License at
 |
 |    http://www.apache.org/licenses/LICENSE-2.0
 |
 | Unless required by applicable law or agreed to in writing, software
 | distributed under the License is distributed on an "AS IS" BASIS,
 | WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 | See the License for the specific language governing permissions and
 | limitations under the License.
*/
define("js/lgonlineApp","js/lgonlineBase js/lgonlineCommand js/lgonlineDrawing js/lgonlineEditing js/lgonlineFrame js/lgonlineMap js/lgonlineOutput".split(" "),function(){return{}});
require({cache:{"js/lgonlineBase":function(){define("js/lgonlineBase","dojo/dom-construct dojo/dom dojo/on dojo/dom-style dojo/dom-class dojo/_base/array dojo/topic dojo/_base/lang".split(" "),function(h,m,n,k,g,d,e,f){dojo.declare("js.LGObject",null,{constructor:function(b){var a,f,d=this;void 0!==b&&dojo.safeMixin(this,b);this.checkPrerequisites&&this.checkPrerequisites();b={};this.rootId&&(b.id=this.rootId);this.rootClass?b.className=this.rootClass:b.style="display:none";void 0!==this.parentDiv?
(a=this.parentDiv,(f=m.byId(a))||(a=null)):a=null;f&&f.getLGObject&&f.getLGObject().addItem?(this.rootDiv=h.create("div",b),f.getLGObject().addItem(this.rootDiv)):this.rootDiv=h.create("div",b,a);this.rootDiv.getLGObject=function(){return d}},getRootDiv:function(){return this.rootDiv},lgById:function(b){var a=null;(b=m.byId(b))&&b.getLGObject&&(a=b.getLGObject());return a},deleteDivFromDom:function(){this.rootDiv&&this.rootDiv.parentNode.removeChild(this.rootDiv)},injectCSS:function(b){var a;a=document.createElement("style");
a.setAttribute("type","text/css");a.styleSheet?a.styleSheet.cssText=b:(b=document.createTextNode(b),a.appendChild(b));document.body.appendChild(a);return a},checkForSubstitution:function(b){var a,f=b;b&&1<b.length&&(a=b.substring(0,1),"@"===a?this.i18n&&(f=this.followAttributePath(this.i18n,b.substring(1))):"."===a&&(f=this.followAttributePath(null,b.substring(1))));return f},followAttributePath:function(b,a){var f,d=b,e;try{e=a.split(".");for(f=0;f<e.length;f+=1)d=null===d?this.lgById(e[f]):d[e[f]]}catch(h){d=
null}return d},toBoolean:function(b,a){var f;if(!0===b)return!0;if(!1===b)return!1;if("string"===typeof b){f=b.toLowerCase();if("true"===f)return!0;if("false"===f)return!1}return void 0===a?!0:a},toNumber:function(b,a){if("number"===typeof b)return b;b=parseFloat(b);return!isNaN(b)?b:void 0===a?0:a},log:function(b,a){console&&console.log(b);a&&this.publishMessage("error",b);window.gLogMessageBox&&window.gLogMessageBox.append(b)},publishMessage:function(b,a){e.publish("publish",{id:this.rootId,tag:b,
data:a});e.publish(b,a)},subscribeToMessage:function(b,a){var f=this;e.subscribe(b,function(a){e.publish("receive",{id:f.rootId,tag:b,data:a})});e.subscribe(b,a)}});dojo.declare("js.LGGraphic",js.LGObject,{constructor:function(){n(window,"resize",f.hitch(this,this.handleWindowResize));this.handleWindowResize()},setIsVisible:function(b,a){a?(k.set(this.getRootDiv(),"display","block"),k.set(this.getRootDiv(),"visibility",b?"visible":"hidden")):(k.set(this.getRootDiv(),"display",b?"block":"none"),k.set(this.getRootDiv(),
"visibility","visible"))},getIsVisible:function(){return"none"!==k.get(this.getRootDiv(),"display")},toggleVisibility:function(){k.set(this.getRootDiv(),"display",this.getIsVisible()?"none":"block")},handleWindowResize:function(){void 0!==this.fill&&!0===this.fill?this.fillParentDiv():void 0!==this.horizOffset&&void 0!==this.vertOffset&&this.alignOver(this.rootDiv,this.rootDiv.parentNode,this.horizOffset,this.vertOffset)},fillParentDiv:function(){var b;this.rootDiv.parentNode&&(b={left:"0px",top:"0px",
width:this.rootDiv.parentNode.clientWidth+"px",height:this.rootDiv.parentNode.clientHeight+"px"},dojo.style(this.rootDiv,b))},alignOver:function(b,a,f,e){var h,k,g,m=this;b&&a&&(h=dojo.marginBox(b),k=dojo.marginBox(a),g={},"number"===typeof f?g=this.insertHorizPositioningStyle(g,f,h,k):"object"===typeof f&&d.forEach(f,function(a){g=m.insertHorizPositioningStyle(g,a,h,k)}),"number"===typeof e?g=this.insertVertPositioningStyle(g,e,h,k):"object"===typeof e&&d.forEach(e,function(a){g=m.insertVertPositioningStyle(g,
a,h,k)}),dojo.style(b,g))},insertHorizPositioningStyle:function(b,a,f,d){0<a?b.left=a+"px":0===a?b.left=Math.round((d.w-f.w)/2)+"px":b.right=-a+"px";return b},insertVertPositioningStyle:function(b,a,f,d){0<a?b.top=a+"px":0===a?b.top=Math.round((d.h-f.h)/2)+"px":b.bottom=-a+"px";return b},applyTheme:function(b,a){g.remove(a||this.rootDiv,"appTheme2");g.add(a||this.rootDiv,"appTheme");b&&g.add(a||this.rootDiv,"appThemeHover")},applyThemeAltBkgd:function(b,a){g.remove(a||this.rootDiv,"appTheme");g.add(a||
this.rootDiv,"appTheme2");b&&g.add(a||this.rootDiv,"appThemeHover")}});dojo.declare("js.LGDependency",null,{constructor:function(){var b,a=this;this.dependencyId&&(b=this.lgById(this.dependencyId),this.onDependencyPrep(b),b.ready.then(function(){a.onDependencyReady()}))},onDependencyPrep:function(){return null},onDependencyReady:function(){return null}});dojo.declare("js.LGDefaults",null,{constructor:function(){this.defaultValues={};this.listenForDefaultsTrigger&&this.listenForDefaultsUpdate()},listenForDefaultsUpdate:function(){var b=
this;this.subscribeToMessage(this.listenForDefaultsTrigger,function(a){b.defaultValues=a;b.onDefaultsUpdate()})},onDefaultsUpdate:function(){return null},changeDefaults:function(){this.broadcastDefaultsUpdate()},broadcastDefaultsUpdate:function(){this.broadcastDefaultsPublish&&this.publishMessage(this.broadcastDefaultsPublish,this.defaultValues)}})})},"js/lgonlineCommand":function(){define("js/lgonlineCommand","dojo/dom-construct dojo/dom dojo/on dojo/Deferred dojo/DeferredList dojo/dom-style dojo/dom-class dojo/_base/array dojo/_base/lang dojo/string dijit/form/TextBox dijit/layout/ContentPane esri/dijit/BasemapGallery esri/dijit/Basemap esri/tasks/PrintTask esri/tasks/PrintParameters esri/tasks/PrintTemplate esri/tasks/LegendLayer esri/dijit/PopupTemplate js/lgonlineBase js/lgonlineMap".split(" "),
function(h,m,n,k,g,d,e,f,b,a,p,l,q,r,s,t,u,v,w){dojo.declare("js.LGDropdownBox",js.LGGraphic,{constructor:function(){var c=this;this.applyTheme(!1);this.isShowable=!0;this.trigger&&(this.subscribeToMessage("command",function(a){a!==c.trigger&&c.setIsVisible(!1)}),this.subscribeToMessage(this.trigger,function(a){c.handleTrigger(a)}))},setShowable:function(c){this.isShowable=c;!this.isShowable&&this.getIsVisible()&&this.toggleVisibility()},handleTrigger:function(){this.isShowable&&this.toggleVisibility()}});
dojo.declare("js.LGMapBasedMenuBox",[js.LGDropdownBox,js.LGMapDependency],{constructor:function(){this.ready=new k},onDependencyReady:function(){this.ready.resolve(this);this.inherited(arguments)}});dojo.declare("js.LGBasemapBox",js.LGMapBasedMenuBox,{onDependencyReady:function(){var c,a,b=this.getBasemapGroup();c=this.rootId+"_gallery";a=(new l({id:c,className:this.galleryClass})).placeAt(this.rootDiv);touchScroll(c);c=(new q({basemaps:[new r({layers:this.mapObj.mapInfo.itemInfo.itemData.baseMap.baseMapLayers,
title:this.mapObj.mapInfo.itemInfo.itemData.baseMap.title,thumbnailUrl:this.webmapThumbnail||"images/webmap.png"})],showArcGISBasemaps:!0,basemapsGroup:b,bingMapsKey:this.mapObj.commonConfig.bingMapsKey,map:this.mapObj.mapInfo.map},h.create("div"))).placeAt(this.rootDiv);a.set("content",c.domNode);c.startup();this.inherited(arguments)},getBasemapGroup:function(){var c=null;this.basemapgroupTitle&&(this.basemapgroupOwner&&0<this.basemapgroupTitle.length&&0<this.basemapgroupOwner.length)&&(c={title:this.basemapgroupTitle,
owner:this.basemapgroupOwner});return c}});dojo.declare("js.LGCallMethods",js.LGObject,{constructor:function(){var c,a=this;this.todo&&f.forEach(this.todo,function(b){try{if(c=m.byId(b.rootId))if(c=c.getLGObject())c[b.method](b.arg)}catch(f){a.log("LGCallMethods_1: "+f.toString())}})}});dojo.declare("js.LGButton",js.LGGraphic,{constructor:function(){var c;this.applyTheme(!0);this.iconUrl&&(c={src:this.iconUrl},this.iconClass&&(c.className=this.iconClass),this.iconImg=h.create("img",c,this.rootDiv));
this.displayText&&(c={innerHTML:this.checkForSubstitution(this.displayText)},this.displayTextClass&&(c.className=this.displayTextClass),h.create("div",c,this.rootDiv));this.tooltip&&(this.rootDiv.title=this.checkForSubstitution(this.tooltip))}});dojo.declare("js.LGRadioButton",js.LGButton,{constructor:function(){this.isOn=this.toBoolean(this.isOn,!1);this.setIsOn(this.isOn);this.controller=null;n(this.rootDiv,"click",this.handleClick)},setController:function(c){this.controller=c},setIsOn:function(c){(this.isOn=
c)?this.applyThemeAltBkgd(!0):this.applyTheme(!0)},handleClick:function(c){c=c.currentTarget.getLGObject();c.controller&&c.controller.selectMember(c)}});dojo.declare("js.LGRadioButtonController",js.LGObject,{constructor:function(){this.members=[];this.currentMember=null},addMember:function(c){this.members.push(c);c.setController(this)},selectMember:function(c){var a,b=this;this.currentMember&&(this.currentMember.setIsOn(!1),this.currentMember=null);"number"===typeof c?0<this.members.length&&(c=Math.max(0,
Math.min(c,b.members.length-1)),b.currentMember=b.members[c],b.currentMember.setIsOn(!0)):"string"===typeof c?f.some(this.members,function(a){return a.value===c?(b.currentMember=a,b.currentMember.setIsOn(!0),!0):!1}):c&&(a=c.rootId,f.some(this.members,function(c){return c.rootId===a?(b.currentMember=c,b.currentMember.setIsOn(!0),!0):!1}))},getCurrentMember:function(){return this.currentMember}});dojo.declare("js.LGCommand",[js.LGButton,js.LGDependency],{constructor:function(){this.publish&&(this.clickHandler=
n(this.rootDiv,"click",this.handleClick))},onDependencyPrep:function(){this.setIsVisible(!1);this.inherited(arguments)},onDependencyReady:function(){this.setIsVisible(!0);this.inherited(arguments)},handleClick:function(c){c=c.currentTarget.getLGObject();c.publishMessage("command",c.publish);c.publishMessage(c.publish,c.publishArg)}});dojo.declare("js.LGCommandToggle",js.LGCommand,{constructor:function(){var c=this;this.iconDisabledUrl=this.iconDisabledUrl||this.iconUrl;this.isEnabled=this.toBoolean(this.isEnabled,
!0);c.setIsEnabled(this.isEnabled);this.isVisible=this.toBoolean(this.isVisible,!0);c.setIsVisible(this.isVisible);this.triggerEnable&&this.subscribeToMessage(this.triggerEnable,function(){c.isEnabled=!0;c.setIsEnabled(c.isEnabled)});this.triggerDisable&&this.subscribeToMessage(this.triggerDisable,function(){c.isEnabled=!1;c.setIsEnabled(c.isEnabled)});this.triggerVisible&&this.subscribeToMessage(this.triggerVisible,function(){c.isVisible=!0;c.setIsVisible(c.isVisible)});this.triggerInvisible&&this.subscribeToMessage(this.triggerInvisible,
function(){c.isVisible=!1;c.setIsVisible(c.isVisible)})},setIsEnabled:function(c){(this.isEnabled=c)?(this.iconImg.src=this.iconUrl,e.add(this.rootDiv,"appThemeHover")):(this.iconImg.src=this.iconDisabledUrl,e.remove(this.rootDiv,"appThemeHover"))},handleClick:function(c){var a=c.currentTarget.getLGObject();a.isEnabled&&a.inherited("handleClick",arguments)}});dojo.declare("js.LGLaunchUrl",js.LGObject,{constructor:function(){this.subscribeToMessage(this.sameWinTrigger,function(c){c&&window.open(c,
"_parent")});this.subscribeToMessage(this.newWinTrigger,function(c){c&&window.open(c,"_blank")})}});dojo.declare("js.LGPrintMap",js.LGMapBasedMenuBox,{constructor:function(){var c,a=this;this.radioButtonController=new js.LGRadioButtonController;c=new js.LGRadioButton({rootId:this.rootId+"_landscape",parentDiv:this.rootId,iconUrl:this.landscapeButtonIconUrl,rootClass:this.orientationButtonClass,iconClass:this.orientationButtonIconClass,tooltip:this.checkForSubstitution(this.landscapeButtonTooltip),
value:this.landscapeServerSpec});c.setIsVisible(!0);this.radioButtonController.addMember(c);d.set(c.rootDiv,"display","inline-block");c=new js.LGRadioButton({rootId:this.rootId+"_portrait",parentDiv:this.rootId,iconUrl:this.portraitButtonIconUrl,rootClass:this.orientationButtonClass,iconClass:this.orientationButtonIconClass,tooltip:this.checkForSubstitution(this.portraitButtonTooltip),value:this.portraitServerSpec});c.setIsVisible(!0);this.radioButtonController.addMember(c);d.set(c.rootDiv,"display",
"inline-block");this.titleEntryTextBox=(new p({id:this.rootId+"_titleEntry",value:this.title,trim:!0,placeHolder:this.titleHint||this.checkForSubstitution(this.titleHintDefault)||""})).placeAt(this.rootId);d.set(this.titleEntryTextBox.domNode,"width","97%");e.add(this.titleEntryTextBox.domNode,this.titleClass);this.authorEntryTextBox=(new p({id:this.rootId+"_authorEntry",value:this.author,trim:!0,placeHolder:this.authorHint||this.checkForSubstitution(this.authorHintDefault)||""})).placeAt(this.rootId);
d.set(this.authorEntryTextBox.domNode,"width","97%");e.add(this.authorEntryTextBox.domNode,this.authorClass);c=new js.LGButton({rootId:this.rootId+"_doPrint",parentDiv:this.rootId,iconUrl:this.printButtonIconUrl,rootClass:this.printButtonClass,iconClass:this.printButtonIconClass,tooltip:this.checkForSubstitution(this.printButtonTooltip)});c.setIsVisible(!0);d.set(c.rootDiv,"display","inline-block");this.radioButtonController.selectMember(0);n(c.rootDiv,"click",function(){var c,b,d=[],e;a.publishMessage(a.publishWorking);
a.setIsVisible(!1);c=a.mapObj.getOperationalLayers();f.forEach(c,function(c){b=new v;b.layerId=c.id;d.push(b)});c=(c=a.radioButtonController.getCurrentMember())?c.value:null;e=new t;e.map=a.mapObj.mapInfo.map;e.outSpatialReference=a.mapObj.mapInfo.map.spatialReference;e.template=new u;e.template.format=a.format||"PDF";e.template.layout=c||a.layout||"Letter ANSI A Landscape";e.template.layoutOptions={titleText:a.titleEntryTextBox.value,authorText:a.authorEntryTextBox.value,copyrightText:a.copyrightText,
legendLayers:d};e.template.preserveScale=a.toBoolean(a.preserveScale,!1);e.template.showAttribution=!0;a.printTask.execute(e,function(c){a.publishMessage(a.publishReady);a.publishMessage(a.publishPrintUrl,c.url)},function(c){a.publishMessage(a.publishReady);a.log("Print failed: "+c.message,!0)})})},checkPrerequisites:function(){if(this.commonConfig.helperServices&&this.commonConfig.helperServices.printTask&&this.commonConfig.helperServices.printTask.url)this.printTask=new s(this.commonConfig.helperServices.printTask.url,
{async:!1});else throw this.log("no print task configured"),"no print task configured";}});dojo.declare("js.LGFetchPrintedMap",[js.LGObject,js.LGMapDependency],{constructor:function(){this.fetchPrintUrl=null;this.printAvailabilityTimeoutMinutes=this.toNumber(this.printAvailabilityTimeoutMinutes,10);this.printTimeouter=null},onDependencyReady:function(){var c=this;this.subscribeToMessage(this.triggerPrintUrl,function(a){clearTimeout(c.printTimeouter);c.fetchPrintUrl=a;c.publishMessage(c.publishPrintAvailable);
0<c.printAvailabilityTimeoutMinutes&&(c.printTimeouter=setTimeout(function(){c.publishMessage(c.publishPrintNotAvailable)},6E4*c.printAvailabilityTimeoutMinutes))});this.subscribeToMessage(this.trigger,function(){null!==c.fetchPrintUrl&&c.publishMessage(c.publish,c.fetchPrintUrl)})}});dojo.declare("js.LGLocate",js.LGObject,{constructor:function(){var c=this,a;this.ready=new k;Modernizr.geolocation?(this.subscribeToMessage(this.trigger,function(){a=setTimeout(function(){alert(c.checkForSubstitution("@messages.geolocationTimeout"))},
16E3);navigator.geolocation.getCurrentPosition(function(b){clearTimeout(a);c.log("go to "+b.coords.latitude+" "+b.coords.longitude);c.publishMessage(c.publish,new esri.geometry.Point(b.coords.longitude,b.coords.latitude,new esri.SpatialReference({wkid:4326})))},function(b){clearTimeout(a);switch(b.code){case b.PERMISSION_DENIED:b=c.checkForSubstitution("@messages.geolocationDenied");break;case b.TIMEOUT:b=c.checkForSubstitution("@messages.geolocationTimeout");break;default:b=c.checkForSubstitution("@messages.geolocationUnavailable")}alert(b)},
{timeout:8E3})}),this.ready.resolve(c)):this.ready.reject(c)}});dojo.declare("js.LGSearch",js.LGObject,{constructor:function(){this.busyIndicator&&(this.busyIndicator=this.lgById(this.busyIndicator))},search:function(){return null},toList:function(){return[]},publish:function(c,a){this.publishMessage(c,a)},sortByLabel:function(c,a){var b=0;c&&(a&&c.label&&a.label)&&(b=c.label.localeCompare(a.label));return b},getRepresentativePoint:function(c){var a;"point"===c.type?a=c:"polygon"===c.type?(a=c.getExtent().getCenter(),
c.contains(a)||(a=c.getPoint(0,0))):"polyline"===c.type&&(a=c.getPoint(0,0));return a}});dojo.declare("js.LGSearchAddress",[js.LGSearch,js.LGMapDependency],{constructor:function(){this.searcher=new esri.tasks.Locator(this.searchUrl);this.searcher.outSpatialReference=new esri.SpatialReference({wkid:this.outWkid});this.params={};this.params.outFields=this.outFields;this.ready=new k},onDependencyReady:function(){this.params.searchExtent=this.mapObj.mapInfo.map.extent;this.ready.resolve(this);this.inherited(arguments)},
search:function(c,a,b){this.params.address={};this.params.address[this.addressParamName]=c;this.searcher.addressToLocations(this.params,a,b)},toList:function(c){var a,b=this,d=[];c&&f.forEach(c,function(c){a=!1;c.score>=b.minimumScore&&(b.validLocators?f.some(b.validLocators,function(b){if(c.attributes.Loc_name===b)return a=!0}):a=!0);a&&d.push({label:c.address,data:new esri.geometry.Point(c.location.x,c.location.y,new esri.SpatialReference({wkid:102100}))})});return d},publish:function(c,a){this.publishMessage(c,
a)}});dojo.declare("js.LGSearchFeatureLayer",[js.LGSearch,js.LGMapDependency],{constructor:function(){if(!this.searchPattern||0>this.searchPattern.indexOf("${1}"))this.searchPattern="%${1}%";this.caseInsensitiveSearch=this.toBoolean(this.caseInsensitiveSearch,!0);this.ready=new k;this.displayField=this.displayField?this.displayField.split(",")[0].trim():""},onDependencyReady:function(){var c,a,b,d=",",e,g=this,h=[],k;try{if(c=this.mapObj.getLayer(this.searchLayerName),!c||!c.url)a=this.checkForSubstitution("@messages.searchLayerMissing");
else{this.searchURL=c.url;f.forEach(c.fields,function(c){d+=c.name+","});f.forEach(this.searchFields,function(c){0<=d.indexOf(","+c+",")&&h.push(c)});if(0===h.length){this.showSearchLayerFieldError(this.searchFields,this.searchLayerName,c);this.ready.reject(this);this.inherited(arguments);return}""!==this.displayField&&0>d.indexOf(","+this.displayField+",")&&(this.showSearchLayerFieldError([this.displayField],this.searchLayerName,c),this.displayField="");this.searchFields=h;this.objectIdField=c.objectIdField;
this.publishPointsOnly="boolean"===typeof this.publishPointsOnly?this.publishPointsOnly:!0;this.searcher=new esri.tasks.QueryTask(this.searchURL);this.generalSearchParams=new esri.tasks.Query;this.generalSearchParams.returnGeometry=!1;this.generalSearchParams.outSpatialReference=this.mapObj.mapInfo.map.spatialReference;k=[c.objectIdField];""!==this.displayField&&(k=k.concat(this.displayField));this.generalSearchParams.outFields=k.concat(this.searchFields);this.objectSearchParams=new esri.tasks.Query;
this.objectSearchParams.returnGeometry=!0;this.objectSearchParams.outSpatialReference=this.mapObj.mapInfo.map.spatialReference;this.objectSearchParams.outFields=["*"];e=this.mapObj.mapInfo.itemInfo.itemData.operationalLayers;f.some(e,function(c){return c.title===g.searchLayerName?(g.popupTemplate=new w(c.popupInfo),!0):!1});this.log("Search layer "+this.searchLayerName+" set up for queries");this.ready.resolve(this);this.inherited(arguments);return}}catch(l){a=l.toString()}b='"'+(this.searchLayerName||
"")+'"<br>';b+=a+"<br><hr>";b+=this.checkForSubstitution("@prompts.mapLayers")+"<br><ul>";f.forEach(this.mapObj.getLayerNameList(),function(c){b+='<li>"'+c+'"</li>'});b+="</ul>";this.log(b,!0);this.ready.reject(this);this.inherited(arguments)},checkPrerequisites:function(){var c,a=this;if(this.searchFields&&0<this.searchFields.length)c=this.searchFields.split(","),this.searchFields=[],f.forEach(c,function(c){a.searchFields.push(c.trim())});else throw this.log("missing search fields"),"missing search fields";
},showSearchLayerFieldError:function(c,a,b){var d="",e;f.forEach(c,function(c){0<d.length&&(d+=",");d+=c});e='"'+d+'"<br>';e=1<c.length?e+this.checkForSubstitution("@messages.allSearchFieldsMissing"):e+this.checkForSubstitution("@messages.searchFieldMissing");e+='<br><hr>"'+a+'"<br>';e+=this.checkForSubstitution("@prompts.layerFields")+"<br><ul>";f.forEach(b.fields,function(c){e+='<li>"'+c.name+'"</li>'});e+="</ul>";this.log(e,!0)},search:function(c,a,b){var d,e="",g,h="";!0===this.caseInsensitiveSearch?
(d=c.toUpperCase(),g="UPPER(${0}) LIKE '"+this.searchPattern+"'"):(d=c,g="${0} LIKE '"+this.searchPattern+"'");d=d.replace(/'/g,"''");f.forEach(this.searchFields,function(c){e=e+h+dojo.string.substitute(g,[c,d]);h="  OR  "});0<e.length&&(this.generalSearchParams.where=e,this.searcher.execute(this.generalSearchParams,a,b))},toList:function(c,a){var b=this,d=[],e,g,h=a.toUpperCase();c&&(c.features&&0<c.features.length)&&(f.forEach(c.features,function(c){g="";c.attributes[b.displayField]?g=c.attributes[b.displayField].toString():
f.some(b.searchFields,function(a){return c.attributes[a]&&(e=c.attributes[a].toString(),0<=e.toUpperCase().indexOf(h))?(g=e,!0):!1});""===g&&(g="result");d.push({label:g,data:c.attributes[b.objectIdField]})}),d.sort(b.sortByLabel));return d},publish:function(c,a){var b,f,d=this;this.busyIndicator&&this.busyIndicator.setIsVisible(!0);this.objectSearchParams.where=this.objectIdField+"="+a;this.searcher.execute(this.objectSearchParams,function(a){a&&a.features&&0<a.features.length?(b=a.features[0],b.infoTemplate=
d.popupTemplate,f=d.publishPointsOnly?d.getRepresentativePoint(b.geometry):b,d.publishMessage(c,f)):d.log("LGSearchFeatureLayer_1: no results");d.busyIndicator&&d.busyIndicator.setIsVisible(!1)},function(c){d.log("LGSearchFeatureLayer_2: "+c.message);d.busyIndicator&&d.busyIndicator.setIsVisible(!1)})}});dojo.declare("js.LGSearchMultiplexer",js.LGSearch,{constructor:function(){var c=this,a;this.ready=new k;a=this.createSearchersList();(new g(a)).then(function(a){f.every(a,function(c){return c[0]})?
c.ready.resolve(c):c.ready.reject(c)})},createSearchersList:function(){var c=this,a=[];this.searchers=[];this.searchers=[];this.searcherNames&&f.forEach(this.searcherNames,function(b){if(b=c.lgById(b))c.searchers.push(b),a.push(b.ready)});return a},search:function(c,a,b){var d=[],e=[];f.forEach(this.searchers,function(a,b){var g=new k;e.push(g);a.search(c,function(e){e=a.toList(e,c);e=f.map(e,function(c){return{data:{iSearcher:b,itemData:c.data},label:c.label}});d=d.concat(e);g.resolve()},function(c){g.reject(c)})});
(new g(e)).then(function(c){var e=!0;b&&(e=!f.some(c,function(c){return!c[0]?(b(c[1]),!0):!1}));e&&a&&a(d)})},toList:function(c){return c},publish:function(c,a){this.searchers[a.iSearcher].publish(c,a.itemData)}});dojo.declare("js.LGSearchFeatureLayerMultiplexer",js.LGSearchMultiplexer,{createSearchersList:function(){var c=[],a=[],b=[],d,f;this.searchers=[];this.searchLayerName&&(a=this.searchLayerName.split(","));this.displayFields&&(b=this.displayFields.split(","));for(d=0;d<a.length;d+=1)f=this.rootId+
"_"+this.searchers.length,f=new js.LGSearchFeatureLayer({app:this.app,commonConfig:this.commonConfig,i18n:this.i18n,webmap:this.webmap,rootId:f,parentDiv:this.parentDiv,dependencyId:this.dependencyId,busyIndicator:this.busyIndicator,publishPointsOnly:this.publishPointsOnly,searchPattern:this.searchPattern,caseInsensitiveSearch:this.caseInsensitiveSearch,searchLayerName:a[d].trim(),searchFields:this.searchFields,displayField:b[d]}),this.searchers.push(f),c.push(f.ready);return c}});dojo.declare("js.LGSearchBoxByText",
js.LGDropdownBox,{constructor:function(){var c=this,a,b,e,g,k,l,q;a=this.rootId+"_entry";h.create("label",{"for":a,innerHTML:this.checkForSubstitution(this.showPrompt)},this.rootId);this.searchEntryTextBox=(new p({id:a,value:"",trim:!0,placeHolder:this.hint,intermediateChanges:!0})).placeAt(this.rootId);d.set(this.searchEntryTextBox.domNode,"width","99%");a=h.create("div",{className:this.resultsListBoxClass},this.rootId);b=h.create("table",{className:this.resultsListTableClass},a);e=h.create("tbody",
{className:this.resultsListBodyClass},b);touchScroll(a);g=this.lgById(this.searcher);k="";l=0;q=null;n(this.searchEntryTextBox,"change",function(){var a=c.searchEntryTextBox.get("value");k!==a&&(k=a,h.empty(e),clearTimeout(q),0<a.length&&(q=setTimeout(function(){var b,d,q;b=h.create("tr",null,e);h.create("td",{className:c.resultsListSearchingClass},b);d=l=(new Date).getTime();g.search(a,function(b){d<l||(h.empty(e),b=g.toList(b,a),q=(new Date).getTime(),c.log("retd "+b.length+" items in "+(q-d)/1E3+
" secs"),0<b.length&&f.forEach(b,function(a){var b;b=h.create("tr",null,e);b=h.create("td",{className:c.resultsListEntryClass,innerHTML:a.label},b);c.applyTheme(!0,b);n(b,"click",function(){g.publish(c.publish,a.data)})}))},function(a){c.log("LGSearchBoxByText_1: "+a.message);k="";h.empty(e)})},1E3)))})},toggleVisibility:function(){this.inherited(arguments);this.getIsVisible()&&this.searchEntryTextBox.focus()}});dojo.declare("js.LGShare",js.LGObject,{constructor:function(){var a=this;this.busyIndicator&&
(this.busyIndicator=this.lgById(this.busyIndicator));this.subscribeToMessage(this.trigger,function(){a.share()})},share:function(){var a=this,b,d;b=encodeURIComponent(this.getSubject());d=encodeURIComponent(this.getUrlToShare());this.tinyURLServiceURL&&0<this.tinyURLServiceURL.length?(this.busyIndicator&&this.busyIndicator.setIsVisible(!0),d=esri.substitute({url:d},this.tinyURLServiceURL),esri.request({url:d,handleAs:"json"},{useProxy:!1}).then(function(d){var f,e;try{if(f=a.followAttributePath(d,
a.tinyURLResponseAttribute))e=esri.substitute({subject:b,url:f},a.shareUrl),a.publishMessage(a.publish,e)}catch(g){a.log("LGShare_1: "+g.toString())}a.busyIndicator&&a.busyIndicator.setIsVisible(!1)},function(b){a.log("LGShare_2: "+b.toString());a.busyIndicator&&a.busyIndicator.setIsVisible(!1)})):(d=esri.substitute({subject:b,url:d},this.shareUrl),this.publishMessage(this.publish,d))},getSubject:function(){return""},getUrlToShare:function(){return this.getAppUrl()},getAppUrl:function(){return window.location.toString()}});
dojo.declare("js.LGShareAppExtents",[js.LGShare,js.LGMapDependency],{getSubject:function(){var a="";this.subject&&(a=this.checkForSubstitution(this.subject));return a},getUrlToShare:function(){var a=this.getAppUrl();return a+(0>a.indexOf("?")?"?":"&")+this.getMapExtentsArg()},getMapExtentsArg:function(){return"ex="+this.mapObj.getMapExtentsAsString()}});dojo.declare("js.LGFilterLayers1",js.LGMapBasedMenuBox,{constructor:function(){this.layers=[];this.switchDelayTimer=null;this.busyIndicator&&(this.busyIndicator=
this.lgById(this.busyIndicator));this.ieSwitchDelayMs=1E3*this.toNumber(this.ieSwitchDelaySecs,2)},onDependencyReady:function(){var a;this.fieldname1&&(f.forEach(this.mapObj.mapInfo.itemInfo.itemData.operationalLayers,b.hitch(this,function(a){var b;if(a.layerObject&&"Feature Layer"===a.layerObject.type)for(b=0;b<a.layerObject.fields.length;b+=1)if(a.layerObject.fields[b].name===this.fieldname1){a={layerObject:a.layerObject,fieldType:a.layerObject.fields[b].type};this.layers.push(a);break}})),this.applyFilter(),
h.create("label",{innerHTML:this.hint1},h.create("div",{},this.rootId)),a=(new p({id:this.rootId+"_field1",value:this.value1,trim:!0,placeHolder:this.hint1,intermediateChanges:!0})).placeAt(this.rootId),d.set(a.domNode,"width","99%"),this.tooltip&&a.set("title",this.checkForSubstitution(this.tooltip)),n(a,"change",b.hitch(this,function(){this.value1=a.value.trim();this.onValueChanged()})))},onValueChanged:function(){this.applyFilter()},applyFilter:function(){this.applyFilterCore()},applyFilterCore:function(){f.forEach(this.layers,
b.hitch(this,function(a){this.setLayerDefinitionExpression(a.layerObject,a.fieldType);a.layerObject.clearSelection()}))},setLayerDefinitionExpression:function(b,d){var f=b.defaultDefinitionExpression;try{this.value1&&""!==this.value1&&("esriFieldTypeString"===d?f=a.substitute(this.defnExpression,{fieldname1:this.fieldname1,value1:"'"+this.value1+"'"}):"esriFieldTypeInteger"===d&&(f=a.substitute(this.defnExpression,{fieldname1:this.fieldname1,value1:this.value1}))),b.setDefinitionExpression(f)}catch(e){}}});
dojo.declare("js.LGFilterLayers1WithDefaults",[js.LGFilterLayers1,js.LGDefaults],{constructor:function(){this.changeDefaults()},onValueChanged:function(){this.inherited(arguments);this.changeDefaults()},changeDefaults:function(){this.defaultValues.value1=this.value1;this.defaultValues.fieldname1=this.fieldname1;this.inherited(arguments)}})})},"js/lgonlineDrawing":function(){define("js/lgonlineDrawing",["dojo/Deferred","dojo/_base/Color","esri/lang","js/lgonlineMap"],function(h,m,n){dojo.declare("js.LGHighlighter",
[js.LGObject,js.LGMapDependency],{constructor:function(){this.showFeaturePopup=this.toBoolean(this.showFeaturePopup,!0)},onDependencyReady:function(){var h,g,d=this;this.highlighterLayer=d.mapObj.createGraphicsLayer("highlighterLayer");this.lineHiliteColor=new m(this.lineHiliteColor||"#0000ff");this.fillHiliteColor=new m(this.fillHiliteColor||[0,0,255,0.1]);this.intervalID=this.intervalTerminator=null;this.subscribeToMessage("highlightItem",function(e){var f,b,a;e&&(f=e.geometry?e.geometry:e,e.attributes&&
(b=e.attributes),e.infoTemplate&&(a=e.infoTemplate),e=d.createHighlightGraphics(f,b,a),0<e.length&&(g=(h=f.getExtent())?h.getCenter():f,d.showHighlight(e,g,d.highlightZoomLevel,n.isDefined(b)&&n.isDefined(a)&&d.showFeaturePopup)))})},createHighlightGraphics:function(h,g,d){var e,f=[];if("polyline"===h.type)f.push(new esri.Graphic(h,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,this.lineHiliteColor,3),g,d));else if("point"===h.type){if(!h.x||!h.y||isNaN(h.x)||isNaN(h.y))return f;
for(e=0;4>=e;++e)f.push(new esri.Graphic(h,new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,2.5*(e+16),new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new dojo.Color(this.lineHiliteColor),3),new dojo.Color([0,0,0,0])),g,d))}else h.type&&f.push(new esri.Graphic(h,new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,this.lineHiliteColor,3),this.fillHiliteColor),
g,d));return f},showHighlight:function(k,g,d,e){var f,b,a,p,l=this;g?f=this.mapObj.centerAt(g):(f=new h,f.resolve());f.then(function(){d?b=l.mapObj.setZoom(d):(b=new h,b.resolve());b.then(function(){l.intervalTerminator&&(clearTimeout(l.intervalTerminator),clearInterval(l.intervalID));l.highlighterLayer.clear();l.mapObj.hidePopup();1<k.length?(a=0,p=!0,l.intervalID=setInterval(function(){l.highlighterLayer.clear();l.highlighterLayer.add(k[a]);p?++a:--a;a===k.length?(p=!1,--a):0>a&&(p=!0,a=0)},120),
l.intervalTerminator=setTimeout(function(){clearInterval(l.intervalID);l.intervalTerminator=null;l.intervalID=null;l.highlighterLayer.clear()},5E3)):l.highlighterLayer.add(k[0]);e&&l.mapObj.showPopupWithFeature(g,k[0])})})}})})},"js/lgonlineEditing":function(){define("js/lgonlineEditing","dojo/dom-construct dojo/_base/array dojo/_base/lang dojo/aspect dojo/dom-style esri/dijit/editing/TemplatePicker esri/dijit/editing/Editor esri/toolbars/draw esri/graphic js/lgonlineBase js/lgonlineMap js/lgonlineCommand".split(" "),
function(h,m,n,k,g,d,e,f,b){dojo.declare("js.LGEditTemplatePicker",js.LGMapBasedMenuBox,{constructor:function(){var a;a=dojo.byId(this.colorizerId).getLGObject();a=".templatePicker{border:1px solid transparent!important;}.templatePicker .dojoxGrid{background-color:transparent;}.templatePicker .dojoxGrid .dojoxGridScrollbox{background-color:transparent;}.templatePicker .dojoxGrid .dojoxGridRow{background-color:transparent;}.templatePicker .dojoxGrid .dojoxGridCell{border:1px solid transparent}.templatePicker .dojoxGrid .dojoxGridRow{border:1px solid transparent}.templatePicker .grid .dojoxGridRowOver{background-color:transparent;color:inherit;}.templatePicker .grid .dojoxGridRowOver .dojoxGridCell{background-color:transparent;color:inherit;}.templatePicker .dojoxGrid .dojoxGridCellFocus{border:1px solid transparent!important;}.templatePicker .dojoxGrid .dojoxGridRowOdd{background-color:transparent;}.templatePicker .dojoxGrid .selectedItem{border:1px solid transparent!important;color:"+
a.foregroundColor()+"!important;background-color:"+a.alternateBackgroundColor()+"!important}";this.injectCSS(a)},onDependencyReady:function(){var a=this,b,f,g;b=this.mapObj.mapInfo;this.layerInfos=[];this.layers=[];m.forEach(b.itemInfo.itemData.operationalLayers,n.hitch(this,function(a){a=a.layerObject;a instanceof esri.layers.FeatureLayer&&a.isEditable()&&(a.capabilities&&"Query"!==a.capabilities)&&(this.layerInfos.push({featureLayer:a}),this.layers.push(a))}));0===this.layers.length?this.setShowable(!1):
(f=b.map,this.setIsVisible(!1,!0),b=h.create("div",{className:this.templatePickerHolderClass}),h.place(b,this.rootId),g=h.create("div"),h.place(g,b),g=new d({featureLayers:this.layers,rows:"auto",columns:2,grouping:!0},g),g.startup(),touchScroll(b),this.setIsVisible(!1,!1),f={map:f,templatePicker:g,toolbarVisible:!1,layerInfos:this.layerInfos},g=h.create("div"),h.place(g,b),b=new e({settings:f},g),b.startup(),k.before(b,"_applyEdits",function(b){m.forEach(b,function(b){b.adds&&a.preprocessEditAdds(b);
b.updates&&a.preprocessEditUpdates(b);b.deletes&&a.preprocessEditDeletes(b)})}));this.inherited(arguments)},preprocessEditAdds:function(a){return a},preprocessEditUpdates:function(a){return a},preprocessEditDeletes:function(a){return a}});dojo.declare("js.LGEditTemplatePickerWithDefaults",[js.LGEditTemplatePicker,js.LGDefaults],{preprocessEditAdds:function(a){a.adds[0].attributes[this.defaultValues.fieldname1]=this.defaultValues.value1;return a}});dojo.declare("js.LGFeatureByClick",[js.LGObject,js.LGMapDependency],
{onDependencyReady:function(){var a=this;this.inherited(arguments);this.clickHandle=this.subscribeToMessage("mapClick",function(b){a.handleClick(b)})},handleClick:function(a){}});dojo.declare("js.LGAddFeatureByClick",js.LGFeatureByClick,{onDependencyReady:function(){this.inherited(arguments);esri.bundle.toolbars.draw.addPoint=this.checkForSubstitution("@tooltips.collect");this.drawingToolbar=new f(this.mapObj.mapInfo.map,{});this.drawingToolbarActive=!1;this.drawingToolbar.on("draw-end",n.hitch(this,
this.handleDrawEnd))},handleClick:function(a){this.drawingToolbarActive||(this.drawingToolbarActive=!0,this.drawingToolbar.activate(f.POINT),this.drawingToolbar._updateTooltip(a))},handleDrawEnd:function(a){var d=this;this.drawingToolbarActive=!1;this.drawingToolbar.deactivate();var f=new b(a.geometry,new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_SQUARE,10,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new dojo.Color([255,0,0]),1),new dojo.Color([0,
255,0,0.25])));this.mapObj.mapInfo.map.graphics.add(f);setTimeout(function(){alert(d.checkForSubstitution("@messages.yourContentSubmitted"));d.mapObj.mapInfo.map.graphics.remove(f)},2E3)}})})},"js/lgonlineFrame":function(){define("js/lgonlineFrame","dojo/dom-construct dojo/on dojo/dom-style dojo/_base/array dojo/_base/lang js/lgonlineBase".split(" "),function(h,m,n,k,g){dojo.declare("js.LGColorizer",js.LGObject,{constructor:function(){var d,e="",f=this,b=["#fff","#333333","#5d5d5d","#5d5d5d"];this.colors=
[];k.some(this.colorTable,function(a){return f.theme===a.theme?(f.colors=a.colors,!0):!1});if(this.colors.length<b.length)for(d=this.colors.length;d<b.length;d+=1)this.colors.push(b[d]);e+=".appTheme{color:"+this.colors[0]+";background-color:"+this.colors[1]+"}";e+=".appTheme2{color:"+this.colors[0]+";background-color:"+this.colors[3]+"}";e+=".appThemeHover:hover{background-color:"+this.colors[2]+"}";this.injectCSS(e)},foregroundColor:function(){return this.colors[0]},backgroundColor:function(){return this.colors[1]},
hoverColor:function(){return this.colors[2]},alternateBackgroundColor:function(){return this.colors[3]}});dojo.declare("js.LGFrame",js.LGGraphic,{constructor:function(){var d;d={};this.headerDivId&&(d.id=this.headerDivId);this.headerDivClass&&(d.className=this.headerDivClass);this.headerDiv=h.create("div",d,this.rootDiv);this.applyTheme(!1,this.headerDiv);d={};this.contentDivId&&(d.id=this.contentDivId);this.contentDivClass&&(d.className=this.contentDivClass);this.contentDiv=h.create("div",d,this.rootDiv);
this.handleWindowResize()},handleWindowResize:function(){this.inherited(arguments);this.resizeContentDiv()},resizeContentDiv:function(){var d,e,f;this.headerDiv&&this.contentDiv&&(d=dojo.marginBox(this.rootDiv),e=dojo.marginBox(this.headerDiv),f=d.h-e.h,0<f&&(f={},f.top=e.h+"px",f.height=d.h-e.h+"px",n.set(this.contentDiv,f)))}});dojo.declare("js.LGGallery",js.LGGraphic,{constructor:function(){var d,e=this;d=h.create("table",null,this.rootDiv);this.applyTheme(!1,d);m(window,"resize",g.hitch(this,
this.handleParentResize));this.rootDiv.getContentDiv=function(){return e.addItem()};d=h.create("tbody",null,d);this.galleryRow=h.create("tr",null,d);d={innerHTML:"&lt;",style:{visibility:"hidden"}};this.arrowClass&&(d.className=this.arrowClass);this.leftArrow=h.create("td",d,this.galleryRow);this.applyTheme(!0,this.leftArrow);m(this.leftArrow,"click",g.hitch(this,this.shiftLeft));d.innerHTML="&gt;";this.rightArrow=h.create("td",d,this.galleryRow);this.applyTheme(!0,this.rightArrow);m(this.rightArrow,
"click",g.hitch(this,this.shiftRight));this.zeroItemWidth=dojo.marginBox(this.rootDiv).w;this.numItemsToDisplay=this.iFirstItem=this.numItems=this.itemWidth=0;this.firstItem=null;this.handleParentResize()},addItem:function(d){var e;e={};"string"===typeof d&&(e.innerHTML=d);this.itemClass&&(e.className=this.itemClass);e=h.create("td",e);"string"!==typeof d&&e.appendChild(d);this.galleryRow.insertBefore(e,this.rightArrow);this.numItems+=1;this.firstItem||(this.firstItem=e,this.itemWidth=dojo.marginBox(e).w);
this.handleParentResize();return e},clearItems:function(){for(;2<this.galleryRow.childNodes.length;)this.galleryRow.removeChild(this.galleryRow.childNodes[1]);this.numItemsToDisplay=this.iFirstItem=this.numItems=0;this.firstItem=null;this.handleParentResize()},handleParentResize:function(){var d,e;0===this.zeroItemWidth&&(this.zeroItemWidth=dojo.marginBox(this.rootDiv).w);d=dojo.marginBox(this.rootDiv.parentNode).w;e=this.zeroItemWidth+this.numItems*this.itemWidth;0!==this.numItems&&(e>d?(this.leftArrow.style.visibility=
"visible",this.rightArrow.style.visibility="visible",this.numItemsToDisplay=Math.max(Math.floor((d-this.zeroItemWidth)/this.itemWidth),1)):(this.leftArrow.style.visibility="hidden",this.rightArrow.style.visibility="hidden",this.numItemsToDisplay=this.numItems),this.iFirstItem=Math.min(this.iFirstItem,this.numItems-this.numItemsToDisplay),this.drawGallery())},shiftLeft:function(){this.iFirstItem=Math.min(this.iFirstItem+1,this.numItems-this.numItemsToDisplay);this.drawGallery()},shiftRight:function(){this.iFirstItem=
Math.max(this.iFirstItem-1,0);this.drawGallery()},drawGallery:function(){var d,e=this.iFirstItem,f=this.iFirstItem+this.numItemsToDisplay,b=this.firstItem;this.leftArrow.style.visibility="hidden";this.rightArrow.style.visibility="hidden";for(d=0;d<e;)this.rightArrow.style.visibility="visible",b.style.display="none",b=b.nextSibling,d+=1;for(;d<f;)b.style.display="",b=b.nextSibling,d+=1;for(;d<this.numItems;)this.leftArrow.style.visibility="visible",b.style.display="none",b=b.nextSibling,d+=1;this.handleWindowResize()}});
dojo.declare("js.LGTitleBar",js.LGGraphic,{constructor:function(){var d;this.iconUrl&&0<this.iconUrl.length&&(d={src:this.iconUrl},this.iconClass&&(d.className=this.iconClass),h.create("img",d,this.rootDiv));this.title&&0<this.title.length&&(d={innerHTML:this.title},this.titleClass&&(d.className=this.titleClass),h.create("span",d,this.rootDiv),document.title=this.title);this.handleWindowResize()}})})},"js/lgonlineMap":function(){define("js/lgonlineMap","dojo/dom-construct dojo/on dojo/_base/lang dojo/_base/array dojo/Deferred esri/arcgis/utils esri/dijit/Popup js/lgonlineBase".split(" "),
function(h,m,n,k,g,d,e){dojo.declare("js.LGMapDependency",js.LGDependency,{onDependencyPrep:function(d){this.mapObj=d;this.inherited(arguments)}});dojo.declare("js.LGMap",js.LGGraphic,{constructor:function(){var f,b=null,a=this;this.ready=new g;f={ignorePopups:this.toBoolean(this.ignorePopups,!1)};f.mapOptions=this.mapOptions||{};f.mapOptions.showAttribution=!0;this.popup=new e(null,h.create("div"));f.mapOptions.infoWindow=this.popup;if(this.xmin&&this.ymin&&this.xmax&&this.ymax)try{b={xmin:this.xmin,
ymin:this.ymin,xmax:this.xmax,ymax:this.ymax,spatialReference:{}},b.spatialReference.wkid=this.wkid?Number(this.wkid):102100,b=new esri.geometry.Extent(b)}catch(k){b=null}this.ex&&(b=this.getExtentsFromString(this.ex));this.commonConfig&&this.commonConfig.bingMapsKey&&(f.bingMapsKey=this.commonConfig.bingMapsKey);this.webmap&&(this.mapId=this.webmap);d.createMap(this.mapId,this.rootDiv,f).then(function(d){a.mapInfo=d;d.map.spatialReference||(a.mapInfo.map.spatialReference=new esri.SpatialReference(102100));
m(window,"resize",n.hitch(a.mapInfo.map,function(){a.mapInfo.map.resize();a.mapInfo.map.reposition()}));b&&(b.spatialReference.wkid!==a.mapInfo.map.spatialReference.wkid?esri.config.defaults.geometryService?(d=new esri.tasks.ProjectParameters,d.geometries=[b],d.outSR=a.mapInfo.map.spatialReference,esri.config.defaults.geometryService.project(d).then(function(d){b=d[0];a.mapInfo.map.setExtent(b)})):a.log("LGMap_1: Need geometry service to convert extents from wkid "+b.spatialReference.wkid+" to map's "+
a.mapInfo.map.spatialReference.wkid):a.mapInfo.map.setExtent(b));a.tempGraphicsLayer=a.createGraphicsLayer("tempGraphicsLayer");a.positionHandle=a.subscribeToMessage("position",function(b){var d;b.spatialReference.wkid===a.mapInfo.map.spatialReference.wkid?a.publishMessage("highlightItem",b):4326===b.spatialReference.wkid&&102100===a.mapInfo.map.spatialReference.wkid?(b=esri.geometry.geographicToWebMercator(b),a.publishMessage("highlightItem",b)):esri.config.defaults.geometryService?(d=new esri.tasks.ProjectParameters,
d.geometries=[b],d.outSR=a.mapInfo.map.spatialReference,esri.config.defaults.geometryService.project(d).then(function(d){b=d[0];a.publishMessage("highlightItem",b)})):a.log("LGMap_1: Need geometry service to convert position from wkid "+b.spatialReference.wkid+" to map's "+a.mapInfo.map.spatialReference.wkid)});a.showFeatureHandle=a.subscribeToMessage("showFeature",function(b){a.publishMessage("highlightItem",b)});a.clickHandle=m(a.mapInfo.map,"click",function(b){a.publishMessage("mapClick",b)});
a.ready.resolve(a)},function(){a.ready.reject(a)})},mapInfo:function(){return this.mapInfo},showPopupWithFeature:function(d,b){this.popup.clearFeatures();this.popup.setContent(b.getContent());this.mapInfo.map.infoWindow.show(this.mapInfo.map.toScreen(d))},hidePopup:function(){this.mapInfo.map.infoWindow.hide()},setExtent:function(d){return this.mapInfo.map.setExtent(d)},centerAt:function(d){return this.mapInfo.map.centerAt(d)},setZoom:function(d){var b=this.mapInfo.map.getMinZoom(),a=this.mapInfo.map.getMaxZoom();
0<=b&&0<=a&&(d=Math.max(b,Math.min(a,d)));return this.mapInfo.map.setZoom(d)},getMapExtentsAsString:function(){var d="";this.mapInfo&&this.mapInfo.map&&(d=this.getStringFromExtents(this.mapInfo.map.extent));return d},getStringFromExtents:function(d){var b=d.xmin.toFixed().toString()+","+d.ymin.toFixed().toString()+","+d.xmax.toFixed().toString()+","+d.ymax.toFixed().toString();(d=d.spatialReference)&&(d.wkid?b=b+","+d.wkid.toString():d.wkt&&(b=b+","+encodeURIComponent(d.wkt)));return b},getExtentsFromString:function(d){var b,
a=null,e,g;b=d.split(",");1===b.length&&(g=d.indexOf("PROJCS"),0<g?(b=d.substr(0,g).split("%2C"),b[4]=d.substr(g)):b=d.split("%2C"));try{a={xmin:Number(b[0]),ymin:Number(b[1]),xmax:Number(b[2]),ymax:Number(b[3]),spatialReference:{}},4<b.length?(e=Number(b[4]),isNaN(e)?a.spatialReference.wkt=decodeURIComponent(b[4]):a.spatialReference.wkid=e):a.spatialReference.wkid=102100,a=new esri.geometry.Extent(a)}catch(h){a=null}return a},getLayer:function(d){var b;k.some(this.mapInfo.itemInfo.itemData.operationalLayers,
function(a){return a.title===d?(b=a.layerObject,!0):!1});return b},getLayerNameList:function(){var d=[];k.forEach(this.mapInfo.itemInfo.itemData.operationalLayers,function(b){d.push(b.title)});return d},getOperationalLayers:function(){return this.mapInfo.itemInfo.itemData.operationalLayers},createGraphicsLayer:function(d){var b=new esri.layers.GraphicsLayer;b.id=d;return this.mapInfo.map.addLayer(b)},enablePopups:function(){this.mapInfo&&this.mapInfo.clickEventListener&&(this.mapInfo.clickEventHandle=
m(this.mapInfo.map,"click",this.mapInfo.clickEventListener))},disablePopups:function(){this.mapInfo&&this.mapInfo.clickEventHandle&&this.mapInfo.clickEventHandle.remove()}})})},"js/lgonlineOutput":function(){define("js/lgonlineOutput",["dojo/dom-construct","dojo/dom-class","dojo/_base/array","dojo/topic","js/lgonlineBase"],function(h,m,n,k){dojo.declare("js.LGNotes",js.LGObject,{constructor:function(){console&&this.notes&&n.forEach(this.notes,function(g){console.log(g)})}});dojo.declare("js.LGBusy",
js.LGGraphic,{constructor:function(){this.busyImageClass&&m.add(this.rootDiv,this.busyImageClass)}});dojo.declare("js.LGLogBox",js.LGDropdownBox,{constructor:function(){window.gLogMessageBox=this;touchScroll(this.rootDiv)},append:function(g){"string"===typeof g?h.create("div",{innerHTML:g,style:"margin:2px"},this.rootDiv):"object"===typeof g&&null!==g&&this.rootDiv.appendChild(g)}});dojo.declare("js.LGMessageBox",js.LGDropdownBox,{constructor:function(){this.content&&0<this.content.length&&(this.rootDiv.innerHTML=
this.content);touchScroll(this.rootDiv)}});dojo.declare("js.LGPublishEcho",js.LGDropdownBox,{handleTrigger:function(g){this.rootDiv.innerHTML=g.toString();this.setIsVisible(!0)}});dojo.declare("js.LGMessageWatch",js.LGObject,{constructor:function(){var g=this;k.subscribe("publish",function(d){g.showMessage("message from",d)});k.subscribe("receive",function(d){g.showMessage("received by",d)})},showMessage:function(g,d){var e="";if(d.data)try{e=JSON.stringify(d.data)}catch(f){e="<data>"}this.log(g+
" "+d.id+': "'+d.tag+'" '+(e||""))}})})}}});
