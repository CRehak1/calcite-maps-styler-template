/* 
This source is a compressed form of part of the git commit 
18232b2a1e72a7eb 2014-05-27 10:37:02 -0700
Uncompressed source is available from https://github.com/Esri/local-government-online-apps 
*/ 
/*

 | Copyright 2012 Esri
 |
 | Licensed under the Apache License, Version 2.0 (the "License");
 | you may not use this file except in compliance with the License.
 | You may obtain a copy of the License at
 |
 |    http://www.apache.org/licenses/LICENSE-2.0
 |
 | Unless required by applicable law or agreed to in writing, software
 | distributed under the License is distributed on an "AS IS" BASIS,
 | WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 | See the License for the specific language governing permissions and
 | limitations under the License.
*/
define("js/lgonlineApp","js/lgonlineBase js/lgonlineCommand js/lgonlineDijit js/lgonlineDrawing js/lgonlineEditing js/lgonlineFrame js/lgonlineMap js/lgonlineOutput".split(" "),function(){return{}});
require({cache:{"js/lgonlineBase":function(){define("js/lgonlineBase","dojo/dom-construct dojo/dom dojo/on dojo/dom-style dojo/dom-class dojo/_base/array dojo/topic dojo/_base/lang".split(" "),function(k,q,r,p,h,b,f,g){dojo.declare("js.LGObject",null,{constructor:function(a){var d,b,l=this;void 0!==a&&dojo.safeMixin(this,a);this.checkPrerequisites&&this.checkPrerequisites();a={};this.rootId&&(a.id=this.rootId);this.rootClass?a.className=this.rootClass:a.style="display:none";void 0!==this.parentDiv?
(d=this.parentDiv,(b=q.byId(d))||(d=null)):d=null;b&&b.getLGObject&&b.getLGObject().addItem?(this.rootDiv=k.create("div",a),b.getLGObject().addItem(this.rootDiv)):this.rootDiv=k.create("div",a,d);this.rootDiv.getLGObject=function(){return l}},getRootDiv:function(){return this.rootDiv},lgById:function(a){var d=null;(a=q.byId(a))&&a.getLGObject&&(d=a.getLGObject());return d},deleteDivFromDom:function(){this.rootDiv&&this.rootDiv.parentNode.removeChild(this.rootDiv)},injectCSS:function(a){var d;d=document.createElement("style");
d.setAttribute("type","text/css");d.styleSheet?d.styleSheet.cssText=a:(a=document.createTextNode(a),d.appendChild(a));document.body.appendChild(d);return d},checkForSubstitution:function(a){var d,b=a;a&&1<a.length&&(d=a.substring(0,1),"@"===d?this.appConfig.i18n&&(b=this.followAttributePath(this.appConfig.i18n,a.substring(1))):"."===d&&(b=this.followAttributePath(null,a.substring(1))));return b},followAttributePath:function(a,d){var b,l=a,e;try{e=d.split(".");for(b=0;b<e.length;b+=1)l=null===l?this.lgById(e[b]):
l[e[b]]}catch(n){l=null}return l},toBoolean:function(a,d){var b;if(!0===a)return!0;if(!1===a)return!1;if("string"===typeof a){b=a.toLowerCase();if("true"===b)return!0;if("false"===b)return!1}return void 0===d?!0:d},toNumber:function(a,d){if("number"===typeof a)return a;a=parseFloat(a);return!isNaN(a)?a:void 0===d?0:d},log:function(a,d){console&&console.log(a);d&&this.publishMessage(this.appConfig.errorPublishingFlag,a);window.gLogMessageBox&&window.gLogMessageBox.append(a)},publishMessage:function(a,
d){f.publish("publish",{id:this.rootId,tag:a,data:d});f.publish(a,d)},subscribeToMessage:function(a,d){var b=this;f.subscribe(a,function(d){f.publish("receive",{id:b.rootId,tag:a,data:d})});f.subscribe(a,d)}});dojo.declare("js.LGGraphic",js.LGObject,{constructor:function(){r(window,"resize",g.hitch(this,this.handleWindowResize));this.handleWindowResize()},setIsVisible:function(a,d){d?(p.set(this.getRootDiv(),"display","block"),p.set(this.getRootDiv(),"visibility",a?"visible":"hidden")):(a?this.show():
this.hide(),p.set(this.getRootDiv(),"visibility","visible"))},getIsVisible:function(){return"none"!==p.get(this.getRootDiv(),"display")},toggleVisibility:function(){this.getIsVisible()?this.hide():this.show()},show:function(){p.set(this.getRootDiv(),"display","block")},hide:function(){p.set(this.getRootDiv(),"display","none")},handleWindowResize:function(){void 0!==this.fill&&!0===this.fill?this.fillParentDiv():void 0!==this.horizOffset&&void 0!==this.vertOffset&&this.alignOver(this.rootDiv,this.rootDiv.parentNode,
this.horizOffset,this.vertOffset)},fillParentDiv:function(){var a;this.rootDiv.parentNode&&(a={left:"0px",top:"0px",width:this.rootDiv.parentNode.clientWidth+"px",height:this.rootDiv.parentNode.clientHeight+"px"},dojo.style(this.rootDiv,a))},alignOver:function(a,d,f,l){var e,n,m,g=this;a&&d&&(e=dojo.marginBox(a),n=dojo.marginBox(d),m={},"number"===typeof f?m=this.insertHorizPositioningStyle(m,f,e,n):"object"===typeof f&&b.forEach(f,function(a){m=g.insertHorizPositioningStyle(m,a,e,n)}),"number"===
typeof l?m=this.insertVertPositioningStyle(m,l,e,n):"object"===typeof l&&b.forEach(l,function(a){m=g.insertVertPositioningStyle(m,a,e,n)}),dojo.style(a,m))},insertHorizPositioningStyle:function(a,d,b,f){0<d?a.left=d+"px":0===d?a.left=Math.round((f.w-b.w)/2)+"px":a.right=-d+"px";return a},insertVertPositioningStyle:function(a,b,f,g){0<b?a.top=b+"px":0===b?a.top=Math.round((g.h-f.h)/2)+"px":a.bottom=-b+"px";return a},applyTheme:function(a,b){h.remove(b||this.rootDiv,"appTheme2");h.add(b||this.rootDiv,
"appTheme");a&&h.add(b||this.rootDiv,"appThemeHover")},applyThemeAltBkgd:function(a,b){h.remove(b||this.rootDiv,"appTheme");h.add(b||this.rootDiv,"appTheme2");a&&h.add(b||this.rootDiv,"appThemeHover")}});dojo.declare("js.LGDependency",null,{setUpWaitForDependency:function(a){var b=this;this.dependencyId&&this.declaredClass===a&&(a=this.lgById(this.dependencyId),this.onDependencyPrep(a),a.ready.then(function(){b.onDependencyReady()}))},onDependencyPrep:function(){return null},onDependencyReady:function(){return null}});
dojo.declare("js.LGDefaults",null,{constructor:function(){this.defaultValues={};this.listenForDefaultsTrigger&&this.listenForDefaultsUpdate()},listenForDefaultsUpdate:function(){var a=this;this.subscribeToMessage(this.listenForDefaultsTrigger,function(b){a.defaultValues=b;a.onDefaultsUpdate()})},onDefaultsUpdate:function(){return null},changeDefaults:function(){this.broadcastDefaultsUpdate()},broadcastDefaultsUpdate:function(){this.broadcastDefaultsPublish&&this.publishMessage(this.broadcastDefaultsPublish,
this.defaultValues)}})})},"js/lgonlineCommand":function(){define("js/lgonlineCommand","dojo/dom-construct dojo/dom dojo/on dojo/Deferred dojo/DeferredList dojo/dom-style dojo/dom-class dojo/_base/array dojo/_base/lang dojo/string dijit/form/TextBox dijit/layout/ContentPane esri/dijit/Legend esri/dijit/BasemapGallery esri/dijit/Basemap esri/tasks/locator esri/tasks/PrintTask esri/tasks/PrintParameters esri/tasks/PrintTemplate esri/tasks/LegendLayer esri/dijit/PopupTemplate js/lgonlineBase js/lgonlineMap".split(" "),
function(k,q,r,p,h,b,f,g,a,d,t,l,e,n,m,v,u,w,x,y,z){dojo.declare("js.LGDropdownBox",js.LGGraphic,{constructor:function(){var c=this;this.applyTheme(!1);this.isShowable=!0;this.trigger&&(this.subscribeToMessage("command",function(s){s!==c.trigger&&c.setIsVisible(!1)}),this.subscribeToMessage(this.trigger,function(s){c.handleTrigger(s)}))},setShowable:function(c){this.isShowable=c;!this.isShowable&&this.getIsVisible()&&this.toggleVisibility()},handleTrigger:function(){this.isShowable&&this.toggleVisibility()}});
dojo.declare("js.LGMapBasedMenuBox",[js.LGDropdownBox,js.LGMapDependency],{constructor:function(){this.ready=new p;this.setUpWaitForDependency("js.LGMapBasedMenuBox")},onDependencyReady:function(){this.ready.resolve(this);this.inherited(arguments)}});dojo.declare("js.LGBasemapBox",js.LGMapBasedMenuBox,{constructor:function(){this.setUpWaitForDependency("js.LGBasemapBox")},onDependencyReady:function(){var c,s,b=this.getBasemapGroup(),a=this.webmapThumbnail;c=this.rootId+"_gallery";s=(new l({id:c,className:this.galleryClass})).placeAt(this.rootDiv);
touchScroll(c);if(!a)try{a=this.appConfig.itemInfo.item.thumbnail?this.appConfig.sharinghost+"/sharing/rest/content/items/"+this.appConfig.itemInfo.item.id+"/info/"+this.appConfig.itemInfo.item.thumbnail:"images/webmap.png"}catch(d){a="images/webmap.png"}c=(new n({basemaps:[new m({layers:this.appConfig.itemInfo.itemData.baseMap.baseMapLayers,title:this.appConfig.itemInfo.itemData.baseMap.title,thumbnailUrl:a})],showArcGISBasemaps:!0,basemapsGroup:b,bingMapsKey:this.appConfig.bingKey,map:this.appConfig.map},
k.create("div"))).placeAt(this.rootDiv);s.set("content",c.domNode);c.startup();this.inherited(arguments)},getBasemapGroup:function(){var c=null;this.basemapgroupTitle&&(this.basemapgroupOwner&&0<this.basemapgroupTitle.length&&0<this.basemapgroupOwner.length)&&(c={title:this.basemapgroupTitle,owner:this.basemapgroupOwner});return c}});dojo.declare("js.LGDijitLegendBox",js.LGMapBasedMenuBox,{constructor:function(){this.setUpWaitForDependency("js.LGDijitLegendBox")},onDependencyReady:function(){try{var c,
s,a,b=this.rootId+"_legend";c=(new l({id:b,className:this.dijitLegendClass})).placeAt(this.rootDiv);touchScroll(b);s=esri.arcgis.utils.getLegendLayers({map:this.appConfig.map,itemInfo:this.appConfig.itemInfo});a=(new e({map:this.appConfig.map,layerInfos:s},k.create("legendDiv"))).placeAt(this.rootDiv);c.set("content",a.domNode);a.startup();this.inherited(arguments)}catch(d){this.log("LGDijitLegendBox_1: "+d.toString())}}});dojo.declare("js.LGCallMethods",js.LGObject,{constructor:function(){var c,
s=this;this.todo&&g.forEach(this.todo,function(a){try{if(c=q.byId(a.rootId))if(c=c.getLGObject())c[a.method](a.arg)}catch(b){s.log("LGCallMethods_1: "+b.toString())}})}});dojo.declare("js.LGButton",js.LGGraphic,{constructor:function(){var c;this.applyTheme(!0);this.iconUrl&&(c={src:this.iconUrl},this.iconClass&&(c.className=this.iconClass),this.iconImg=k.create("img",c,this.rootDiv));this.displayText&&(c={innerHTML:this.checkForSubstitution(this.displayText)},this.displayTextClass&&(c.className=this.displayTextClass),
k.create("div",c,this.rootDiv));this.tooltip&&(this.rootDiv.title=this.checkForSubstitution(this.tooltip))}});dojo.declare("js.LGRadioButton",js.LGButton,{constructor:function(){this.isOn=this.toBoolean(this.isOn,!1);this.setIsOn(this.isOn);this.controller=null;r(this.rootDiv,"click",this.handleClick)},setController:function(c){this.controller=c},setIsOn:function(c){(this.isOn=c)?this.applyThemeAltBkgd(!0):this.applyTheme(!0)},handleClick:function(c){c=c.currentTarget.getLGObject();c.controller&&
c.controller.selectMember(c)}});dojo.declare("js.LGRadioButtonController",js.LGObject,{constructor:function(){this.members=[];this.currentMember=null},addMember:function(c){this.members.push(c);c.setController(this)},selectMember:function(c){var a,b=this;this.currentMember&&(this.currentMember.setIsOn(!1),this.currentMember=null);"number"===typeof c?0<this.members.length&&(c=Math.max(0,Math.min(c,b.members.length-1)),b.currentMember=b.members[c],b.currentMember.setIsOn(!0)):"string"===typeof c?g.some(this.members,
function(a){return a.value===c?(b.currentMember=a,b.currentMember.setIsOn(!0),!0):!1}):c&&(a=c.rootId,g.some(this.members,function(c){return c.rootId===a?(b.currentMember=c,b.currentMember.setIsOn(!0),!0):!1}))},getCurrentMember:function(){return this.currentMember}});dojo.declare("js.LGCommand",[js.LGButton,js.LGDependency],{constructor:function(){this.publish&&(this.clickHandler=r(this.rootDiv,"click",this.handleClick));this.setUpWaitForDependency("js.LGCommand")},onDependencyPrep:function(){this.setIsVisible(!1);
this.inherited(arguments)},onDependencyReady:function(){this.setIsVisible(!0);this.inherited(arguments)},handleClick:function(c){c=c.currentTarget.getLGObject();c.publishMessage("command",c.publish);c.publishMessage(c.publish,c.publishArg)}});dojo.declare("js.LGCommandToggle",js.LGCommand,{constructor:function(){var c=this;this.iconDisabledUrl=this.iconDisabledUrl||this.iconUrl;this.isEnabled=this.toBoolean(this.isEnabled,!0);c.setIsEnabled(this.isEnabled);this.isVisible=this.toBoolean(this.isVisible,
!0);c.setIsVisible(this.isVisible);this.triggerEnable&&this.subscribeToMessage(this.triggerEnable,function(){c.isEnabled=!0;c.setIsEnabled(c.isEnabled)});this.triggerDisable&&this.subscribeToMessage(this.triggerDisable,function(){c.isEnabled=!1;c.setIsEnabled(c.isEnabled)});this.triggerVisible&&this.subscribeToMessage(this.triggerVisible,function(){c.isVisible=!0;c.setIsVisible(c.isVisible)});this.triggerInvisible&&this.subscribeToMessage(this.triggerInvisible,function(){c.isVisible=!1;c.setIsVisible(c.isVisible)});
this.setUpWaitForDependency("js.LGCommandToggle")},setIsEnabled:function(c){(this.isEnabled=c)?(this.iconImg.src=this.iconUrl,f.add(this.rootDiv,"appThemeHover")):(this.iconImg.src=this.iconDisabledUrl,f.remove(this.rootDiv,"appThemeHover"))},handleClick:function(c){var a=c.currentTarget.getLGObject();a.isEnabled&&a.inherited("handleClick",arguments)}});dojo.declare("js.LGLaunchUrl",js.LGObject,{constructor:function(){this.subscribeToMessage(this.sameWinTrigger,function(c){c&&window.open(c,"_parent")});
this.subscribeToMessage(this.newWinTrigger,function(c){c&&window.open(c,"_blank")})}});dojo.declare("js.LGPrintMap",js.LGMapBasedMenuBox,{constructor:function(){var c,a=this;this.radioButtonController=new js.LGRadioButtonController;c=new js.LGRadioButton({rootId:this.rootId+"_landscape",parentDiv:this.rootId,iconUrl:this.landscapeButtonIconUrl,rootClass:this.orientationButtonClass,iconClass:this.orientationButtonIconClass,tooltip:this.checkForSubstitution(this.landscapeButtonTooltip),value:this.landscapeServerSpec});
c.setIsVisible(!0);this.radioButtonController.addMember(c);b.set(c.rootDiv,"display","inline-block");c=new js.LGRadioButton({rootId:this.rootId+"_portrait",parentDiv:this.rootId,iconUrl:this.portraitButtonIconUrl,rootClass:this.orientationButtonClass,iconClass:this.orientationButtonIconClass,tooltip:this.checkForSubstitution(this.portraitButtonTooltip),value:this.portraitServerSpec});c.setIsVisible(!0);this.radioButtonController.addMember(c);b.set(c.rootDiv,"display","inline-block");this.titleEntryTextBox=
(new t({id:this.rootId+"_titleEntry",value:this.title,trim:!0,placeHolder:this.titleHint||this.checkForSubstitution(this.titleHintDefault)||""})).placeAt(this.rootId);b.set(this.titleEntryTextBox.domNode,"width","97%");f.add(this.titleEntryTextBox.domNode,this.titleClass);this.authorEntryTextBox=(new t({id:this.rootId+"_authorEntry",value:this.author,trim:!0,placeHolder:this.authorHint||this.checkForSubstitution(this.authorHintDefault)||""})).placeAt(this.rootId);b.set(this.authorEntryTextBox.domNode,
"width","97%");f.add(this.authorEntryTextBox.domNode,this.authorClass);c=new js.LGButton({rootId:this.rootId+"_doPrint",parentDiv:this.rootId,iconUrl:this.printButtonIconUrl,rootClass:this.printButtonClass,iconClass:this.printButtonIconClass,tooltip:this.checkForSubstitution(this.printButtonTooltip)});c.setIsVisible(!0);b.set(c.rootDiv,"display","inline-block");this.radioButtonController.selectMember(0);r(c.rootDiv,"click",function(){var c,b,d=[],e;a.publishMessage(a.publishWorking);a.setIsVisible(!1);
c=a.mapObj.getOperationalLayers();g.forEach(c,function(c){b=new y;b.layerId=c.id;d.push(b)});c=(c=a.radioButtonController.getCurrentMember())?c.value:null;e=new w;e.map=a.appConfig.map;e.outSpatialReference=a.appConfig.map.spatialReference;e.template=new x;e.template.format=a.format||"PDF";e.template.layout=c||a.layout||"Letter ANSI A Landscape";e.template.layoutOptions={titleText:a.titleEntryTextBox.value,authorText:a.authorEntryTextBox.value,copyrightText:a.copyrightText,legendLayers:d};e.template.preserveScale=
a.toBoolean(a.preserveScale,!1);e.template.showAttribution=!0;a.printTask.execute(e,function(c){a.publishMessage(a.publishReady);a.publishMessage(a.publishPrintUrl,c.url)},function(c){a.publishMessage(a.publishReady);a.log("Print failed: "+c.message,!0)})});this.setUpWaitForDependency("js.LGPrintMap")},checkPrerequisites:function(){if(this.appConfig.helperServices&&this.appConfig.helperServices.printTask&&this.appConfig.helperServices.printTask.url)this.printTask=new u(this.appConfig.helperServices.printTask.url,
{async:!1});else throw this.log("no print task configured"),"no print task configured";}});dojo.declare("js.LGFetchPrintedMap",[js.LGObject,js.LGMapDependency],{constructor:function(){this.fetchPrintUrl=null;this.printAvailabilityTimeoutMinutes=this.toNumber(this.printAvailabilityTimeoutMinutes,10);this.printTimeouter=null;this.setUpWaitForDependency("js.LGFetchPrintedMap")},onDependencyReady:function(){var c=this;this.subscribeToMessage(this.triggerPrintUrl,function(a){clearTimeout(c.printTimeouter);
c.fetchPrintUrl=a;c.publishMessage(c.publishPrintAvailable);0<c.printAvailabilityTimeoutMinutes&&(c.printTimeouter=setTimeout(function(){c.publishMessage(c.publishPrintNotAvailable)},6E4*c.printAvailabilityTimeoutMinutes))});this.subscribeToMessage(this.trigger,function(){null!==c.fetchPrintUrl&&c.publishMessage(c.publish,c.fetchPrintUrl)})}});dojo.declare("js.LGLocate",js.LGObject,{constructor:function(){var c=this,a;this.ready=new p;Modernizr.geolocation?(this.subscribeToMessage(this.trigger,function(){a=
setTimeout(function(){alert(c.checkForSubstitution("@messages.geolocationTimeout"))},16E3);navigator.geolocation.getCurrentPosition(function(b){clearTimeout(a);c.log("go to "+b.coords.latitude+" "+b.coords.longitude);c.publishMessage(c.publish,new esri.geometry.Point(b.coords.longitude,b.coords.latitude,new esri.SpatialReference({wkid:4326})))},function(b){clearTimeout(a);switch(b.code){case b.PERMISSION_DENIED:b=c.checkForSubstitution("@messages.geolocationDenied");break;case b.TIMEOUT:b=c.checkForSubstitution("@messages.geolocationTimeout");
break;default:b=c.checkForSubstitution("@messages.geolocationUnavailable")}alert(b)},{timeout:8E3})}),this.ready.resolve(c)):this.ready.reject(c)}});dojo.declare("js.LGSearch",js.LGObject,{constructor:function(){this.busyIndicator&&(this.busyIndicator=this.lgById(this.busyIndicator))},search:function(){return null},toList:function(){return[]},publish:function(c,a){this.publishMessage(c,a)},sortByLabel:function(c,a){var b=0;c&&(a&&c.label&&a.label)&&(b=c.label.localeCompare(a.label));return b},getRepresentativePoint:function(c){var a;
"point"===c.type?a=c:"polygon"===c.type?(a=c.getExtent().getCenter(),c.contains(a)||(a=c.getPoint(0,0))):"polyline"===c.type&&(a=c.getPoint(0,0));return a}});dojo.declare("js.LGSearchAddress",[js.LGSearch,js.LGMapDependency],{constructor:function(){this.searcher=new v(this.searchUrl);this.searcher.outSpatialReference=new esri.SpatialReference({wkid:this.outWkid});this.params={};this.params.outFields=this.outFields;this.ready=new p;this.setUpWaitForDependency("js.LGSearchAddress")},onDependencyReady:function(){this.params.searchExtent=
this.appConfig.map.extent;this.ready.resolve(this);this.inherited(arguments)},search:function(c,a,b){this.params.address={};this.params.address[this.addressParamName]=c;this.searcher.addressToLocations(this.params,a,b)},toList:function(c){var a,b=this,d=[];c&&g.forEach(c,function(c){a=!1;c.score>=b.minimumScore&&(b.validLocators?g.some(b.validLocators,function(b){if(c.attributes.Loc_name===b)return a=!0}):a=!0);a&&d.push({label:c.address,data:new esri.geometry.Point(c.location.x,c.location.y,new esri.SpatialReference({wkid:102100}))})});
return d},publish:function(c,a){this.publishMessage(c,a)}});dojo.declare("js.LGSearchFeatureLayer",[js.LGSearch,js.LGMapDependency],{constructor:function(){if(!this.searchPattern||0>this.searchPattern.indexOf("${1}"))this.searchPattern="%${1}%";this.caseInsensitiveSearch=this.toBoolean(this.caseInsensitiveSearch,!0);this.ready=new p;this.displayField=this.displayField?this.displayField.split(",")[0].trim():"";this.setUpWaitForDependency("js.LGSearchFeatureLayer")},onDependencyReady:function(){var c,
a,b,d=",",e,n=this,f=[],m;if(this.searchLayerName)try{if((c=this.mapObj.getLayer(this.searchLayerName))&&c.url){this.searchURL=c.url;g.forEach(c.fields,function(c){d+=c.name+","});this.searchFields&&0<this.searchFields.length?(b=this.searchFields.split(","),this.searchFields=[],g.forEach(b,function(c){n.searchFields.push(c.trim())}),g.forEach(this.searchFields,function(c){0<=d.indexOf(","+c+",")&&f.push(c)})):this.searchFields=[];if(0===f.length){this.showSearchLayerFieldError(this.searchFields,this.searchLayerName,
c);this.ready.reject(this);this.inherited(arguments);return}""!==this.displayField&&0>d.indexOf(","+this.displayField+",")&&(this.showSearchLayerFieldError([this.displayField],this.searchLayerName,c),this.displayField="");this.searchFields=f;this.objectIdField=c.objectIdField;this.publishPointsOnly="boolean"===typeof this.publishPointsOnly?this.publishPointsOnly:!0;this.searcher=new esri.tasks.QueryTask(this.searchURL);this.generalSearchParams=new esri.tasks.Query;this.generalSearchParams.returnGeometry=
!1;this.generalSearchParams.outSpatialReference=this.appConfig.map.spatialReference;m=[c.objectIdField];""!==this.displayField&&(m=m.concat(this.displayField));this.generalSearchParams.outFields=m.concat(this.searchFields);this.objectSearchParams=new esri.tasks.Query;this.objectSearchParams.returnGeometry=!0;this.objectSearchParams.outSpatialReference=this.appConfig.map.spatialReference;this.objectSearchParams.outFields=["*"];e=this.appConfig.itemInfo.itemData.operationalLayers;g.some(e,function(c){return c.title===
n.searchLayerName?(n.popupTemplate=new z(c.popupInfo),!0):!1});this.log("Search layer "+this.searchLayerName+" set up for queries");this.ready.resolve(this);this.inherited(arguments);return}}catch(l){a=l.toString()}this.showSearchLayerError(this.searchLayerName,a);this.ready.reject(this);this.inherited(arguments)},showSearchLayerError:function(c,a){var b;a||(a=this.checkForSubstitution("@messages.searchLayerMissing"));b='"'+(c||"")+'"<br>';b+=a+"<br><hr>";b+=this.checkForSubstitution("@prompts.mapLayers")+
"<br><ul>";g.forEach(this.mapObj.getLayerNameList(),function(c){b+='<li>"'+c+'"</li>'});b+="</ul>";this.log(b,!0)},showSearchLayerFieldError:function(c,a,b){var d="",e;g.forEach(c,function(c){0<d.length&&(d+=",");d+=c});e='"'+d+'"<br>';e=1<c.length?e+this.checkForSubstitution("@messages.allSearchFieldsMissing"):e+this.checkForSubstitution("@messages.searchFieldMissing");e+='<br><hr>"'+a+'"<br>';e+=this.checkForSubstitution("@prompts.layerFields")+"<br><ul>";g.forEach(b.fields,function(c){e+='<li>"'+
c.name+'"</li>'});e+="</ul>";this.log(e,!0)},search:function(c,a,b){var d,e="",n,f="";!0===this.caseInsensitiveSearch?(d=c.toUpperCase(),n="UPPER(${0}) LIKE '"+this.searchPattern+"'"):(d=c,n="${0} LIKE '"+this.searchPattern+"'");d=d.replace(/'/g,"''");g.forEach(this.searchFields,function(c){e=e+f+dojo.string.substitute(n,[c,d]);f="  OR  "});0<e.length&&(this.generalSearchParams.where=e,this.searcher.execute(this.generalSearchParams,a,b))},toList:function(c,a){var b=this,d=[],e,n,f=a.toUpperCase();
c&&(c.features&&0<c.features.length)&&(g.forEach(c.features,function(c){n="";c.attributes[b.displayField]?n=c.attributes[b.displayField].toString():g.some(b.searchFields,function(a){return c.attributes[a]&&(e=c.attributes[a].toString(),0<=e.toUpperCase().indexOf(f))?(n=e,!0):!1});""===n&&(n="result");d.push({label:n,data:c.attributes[b.objectIdField]})}),d.sort(b.sortByLabel));return d},publish:function(c,a){var b,d,e=this;this.busyIndicator&&this.busyIndicator.setIsVisible(!0);this.objectSearchParams.where=
this.objectIdField+"="+a;this.searcher.execute(this.objectSearchParams,function(a){a&&a.features&&0<a.features.length?(b=a.features[0],b.infoTemplate=e.popupTemplate,d=e.publishPointsOnly?e.getRepresentativePoint(b.geometry):b,e.publishMessage(c,d)):e.log("LGSearchFeatureLayer_1: no results");e.busyIndicator&&e.busyIndicator.setIsVisible(!1)},function(c){e.log("LGSearchFeatureLayer_2: "+c.message);e.busyIndicator&&e.busyIndicator.setIsVisible(!1)})}});dojo.declare("js.LGSearchMultiplexer",js.LGSearch,
{constructor:function(){var c=this,a;this.ready=new p;a=this.createSearchersList();(new h(a)).then(function(a){g.every(a,function(c){return c[0]})?c.ready.resolve(c):c.ready.reject(c)})},createSearchersList:function(){var c=this,a=[];this.searchers=[];this.searchers=[];this.searcherNames&&g.forEach(this.searcherNames,function(b){if(b=c.lgById(b))c.searchers.push(b),a.push(b.ready)});return a},search:function(c,a,b){var e=[],d=[];g.forEach(this.searchers,function(a,b){var n=new p;d.push(n);a.search(c,
function(d){d=a.toList(d,c);d=g.map(d,function(c){return{data:{iSearcher:b,itemData:c.data},label:c.label}});e=e.concat(d);n.resolve()},function(c){n.reject(c)})});(new h(d)).then(function(c){var d=!0;b&&(d=!g.some(c,function(c){return!c[0]?(b(c[1]),!0):!1}));d&&a&&a(e)})},toList:function(c){return c},publish:function(c,a){this.searchers[a.iSearcher].publish(c,a.itemData)}});dojo.declare("js.LGSearchFeatureLayerMultiplexer",[js.LGSearchMultiplexer,js.LGMapDependency],{constructor:function(){this.setUpWaitForDependency("js.LGSearchFeatureLayerMultiplexer")},
createSearchersList:function(){var c=[],a=[],b=[],d,e;this.searchers=[];this.searchLayerName&&(a=this.searchLayerName.split(","));this.displayFields&&(b=this.displayFields.split(","));for(d=0;d<a.length;d+=1)e=this.rootId+"_"+this.searchers.length,e=new js.LGSearchFeatureLayer({appConfig:this.appConfig,rootId:e,parentDiv:this.parentDiv,dependencyId:this.dependencyId,busyIndicator:this.busyIndicator,publishPointsOnly:this.publishPointsOnly,searchPattern:this.searchPattern,caseInsensitiveSearch:this.caseInsensitiveSearch,
searchLayerName:a[d].trim(),searchFields:this.searchFields,displayField:b[d]}),this.searchers.push(e),c.push(e.ready);return c},onDependencyReady:function(){0===this.searchers.length&&this.showSearchLayerError("")},showSearchLayerError:function(c,a){var b;a||(a=this.checkForSubstitution("@messages.searchLayerMissing"));b='"'+(c||"")+'"<br>';b+=a+"<br><hr>";b+=this.checkForSubstitution("@prompts.mapLayers")+"<br><ul>";g.forEach(this.mapObj.getLayerNameList(),function(c){b+='<li>"'+c+'"</li>'});b+=
"</ul>";this.log(b,!0)}});dojo.declare("js.LGSearchBoxByText",js.LGDropdownBox,{constructor:function(){var c=this,a,d,e,n,f,m,l;a=this.rootId+"_entry";k.create("label",{"for":a,innerHTML:this.checkForSubstitution(this.showPrompt)},this.rootId);this.searchEntryTextBox=(new t({id:a,value:"",trim:!0,placeHolder:this.hint,intermediateChanges:!0})).placeAt(this.rootId);b.set(this.searchEntryTextBox.domNode,"width","99%");a=k.create("div",{className:this.resultsListBoxClass},this.rootId);d=k.create("table",
{className:this.resultsListTableClass},a);e=k.create("tbody",{className:this.resultsListBodyClass},d);touchScroll(a);n=this.lgById(this.searcher);f="";m=0;l=null;r(this.searchEntryTextBox,"change",function(){var a=c.searchEntryTextBox.get("value");f!==a&&(f=a,k.empty(e),clearTimeout(l),0<a.length&&(l=setTimeout(function(){var b,d,l;b=k.create("tr",null,e);k.create("td",{className:c.resultsListSearchingClass},b);d=m=(new Date).getTime();n.search(a,function(b){d<m||(k.empty(e),b=n.toList(b,a),l=(new Date).getTime(),
c.log("retd "+b.length+" items in "+(l-d)/1E3+" secs"),0<b.length&&g.forEach(b,function(a){var b;b=k.create("tr",null,e);b=k.create("td",{className:c.resultsListEntryClass,innerHTML:a.label},b);c.applyTheme(!0,b);r(b,"click",function(){n.publish(c.publish,a.data)})}))},function(a){c.log("LGSearchBoxByText_1: "+a.message);f="";k.empty(e)})},1E3)))})},toggleVisibility:function(){this.inherited(arguments);this.getIsVisible()&&this.searchEntryTextBox.focus()}});dojo.declare("js.LGShare",js.LGObject,{constructor:function(){var c=
this;this.busyIndicator&&(this.busyIndicator=this.lgById(this.busyIndicator));this.subscribeToMessage(this.trigger,function(){c.share()})},share:function(){var c=this,a,b;a=encodeURIComponent(this.getSubject());b=encodeURIComponent(this.getUrlToShare());this.tinyURLServiceURL&&0<this.tinyURLServiceURL.length?(this.busyIndicator&&this.busyIndicator.setIsVisible(!0),b=esri.substitute({url:b},this.tinyURLServiceURL),esri.request({url:b,handleAs:"json"},{useProxy:!1}).then(function(b){var d,e;try{if(d=
c.followAttributePath(b,c.tinyURLResponseAttribute))e=esri.substitute({subject:a,url:d},c.shareUrl),c.publishMessage(c.publish,e)}catch(n){c.log("LGShare_1: "+n.toString())}c.busyIndicator&&c.busyIndicator.setIsVisible(!1)},function(a){c.log("LGShare_2: "+a.toString());c.busyIndicator&&c.busyIndicator.setIsVisible(!1)})):(b=esri.substitute({subject:a,url:b},this.shareUrl),this.publishMessage(this.publish,b))},getSubject:function(){return""},getUrlToShare:function(){return this.getAppUrl()},getAppUrl:function(){return window.location.toString()}});
dojo.declare("js.LGShareAppExtents",[js.LGShare,js.LGMapDependency],{constructor:function(){this.setUpWaitForDependency("js.LGShareAppExtents")},getSubject:function(){var c="";this.subject&&(c=this.checkForSubstitution(this.subject));return c},getUrlToShare:function(){var c=this.getAppUrl();return c+(0>c.indexOf("?")?"?":"&")+this.getMapExtentsArg()},getMapExtentsArg:function(){return"ex="+this.mapObj.getMapExtentsAsString()}});dojo.declare("js.LGFilterLayers1",js.LGMapBasedMenuBox,{constructor:function(){this.layers=
[];this.switchDelayTimer=null;this.busyIndicator&&(this.busyIndicator=this.lgById(this.busyIndicator));this.switchDelayTimer=null;this.switchDelaySecs=1E3*this.toNumber(this.nonieSwitchDelaySecs,1.5);this.switchDelayMultiplier=1;this.setUpWaitForDependency("js.LGFilterLayers1")},onDependencyReady:function(){var c;this.fieldname1&&(g.forEach(this.appConfig.itemInfo.itemData.operationalLayers,a.hitch(this,function(c){var a;if(c.layerObject&&"Feature Layer"===c.layerObject.type)for(a=0;a<c.layerObject.fields.length;a+=
1)if(c.layerObject.fields[a].name===this.fieldname1){c={layerObject:c.layerObject,fieldType:c.layerObject.fields[a].type};this.layers.push(c);break}})),k.create("label",{innerHTML:this.hint1},k.create("div",{},this.rootId)),c=(new t({id:this.rootId+"_field1",value:this.value1,trim:!0,placeHolder:this.hint1,intermediateChanges:!0})).placeAt(this.rootId),b.set(c.domNode,"width","99%"),this.tooltip&&c.set("title",this.checkForSubstitution(this.tooltip)),r(c,"change",a.hitch(this,function(){this.value1=
c.value;this.onValueChanged()})));0===this.layers.length?(this.setShowable(!1),this.showFieldError(this.fieldname1)):this.applyFilter()},showFieldError:function(c){var b;b='"'+c+'"<br>';b+=this.checkForSubstitution("@messages.fieldNotFound")+"<br><hr>";b+=this.checkForSubstitution("@prompts.mapLayers")+"<br><ul>";g.forEach(this.appConfig.itemInfo.itemData.operationalLayers,a.hitch(this,function(c){var a;if(c.layerObject&&"Feature Layer"===c.layerObject.type){b+='<li>"'+c.title+'"<ul>';for(a=0;a<c.layerObject.fields.length;a+=
1)b+='<li>"'+c.layerObject.fields[a].name+'"</li>';b+="</ul></li>"}}));b+="</ul>";this.log(b,!0)},onValueChanged:function(){this.applyFilter()},applyFilter:function(){var c=this;this.busyIndicator&&this.busyIndicator.setIsVisible(!0);null!==this.switchDelayTimer&&clearTimeout(this.switchDelayTimer);this.switchDelayTimer=setTimeout(function(){c.switchDelayTimer=null;c.applyFilterCore();c.busyIndicator&&c.busyIndicator.setIsVisible(!1)},this.switchDelaySecs*this.switchDelayMultiplier);this.switchDelayMultiplier=
1},applyFilterCore:function(){g.forEach(this.layers,a.hitch(this,function(c){this.setLayerDefinitionExpression(c.layerObject,c.fieldType);c.layerObject.clearSelection()}))},setLayerDefinitionExpression:function(c,a){var b=c.defaultDefinitionExpression;try{this.value1&&""!==this.value1&&("esriFieldTypeString"===a?b=d.substitute(this.defnExpression,{fieldname1:this.fieldname1,value1:"'"+this.value1+"'"}):"esriFieldTypeInteger"===a&&(b=d.substitute(this.defnExpression,{fieldname1:this.fieldname1,value1:this.value1}))),
c.setDefinitionExpression(b)}catch(e){}}});dojo.declare("js.LGFilterLayers1WithDefaults",[js.LGFilterLayers1,js.LGDefaults],{constructor:function(){this.changeDefaults();this.setUpWaitForDependency("js.LGFilterLayers1WithDefaults")},onValueChanged:function(){this.inherited(arguments);this.changeDefaults()},changeDefaults:function(){this.defaultValues.value1=this.value1;this.defaultValues.fieldname1=this.fieldname1;this.inherited(arguments)}})})},"js/lgonlineDijit":function(){define("js/lgonlineDijit",
["dojo/Deferred","dojo/dom-construct","js/lgonlineMap"],function(k,q){dojo.declare("js.LGMapDijitContainer",[js.LGGraphic,js.LGMapDependency],{constructor:function(){this.ready=new k;this.setUpWaitForDependency("js.LGMapDijitContainer")},onDependencyReady:function(){this.createDijit()},createDijit:function(){var k=this;require([this.dijitAmd],function(p){k.dijit=(new p({map:k.appConfig.map},q.create("div",null,k.rootDiv))).startup();k.ready.resolve(k)})}})})},"js/lgonlineDrawing":function(){define("js/lgonlineDrawing",
"dojo/Deferred dojo/_base/Color dojo/on esri/lang esri/graphic esri/symbols/SimpleLineSymbol esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleFillSymbol js/lgonlineMap".split(" "),function(k,q,r,p,h,b,f,g){dojo.declare("js.LGHighlighter",[js.LGObject,js.LGMapDependency],{constructor:function(){this.showFeaturePopup=this.toBoolean(this.showFeaturePopup,!0);this.setUpWaitForDependency("js.LGHighlighter")},onDependencyReady:function(){var a,b,f=this;this.highlighterLayer=f.mapObj.createGraphicsLayer("highlighterLayer");
this.lineHiliteColor=new q(this.lineHiliteColor||"#0000ff");this.fillHiliteColor=new q(this.fillHiliteColor||[0,0,255,0.1]);this.concentricCircleFillColor=new q([0,0,0,0]);this.intervalID=this.intervalTerminator=null;this.subscribeToMessage("highlightItem",function(l){var e,n,m;l&&(e=l.geometry?l.geometry:l,l.attributes&&(n=l.attributes),l.infoTemplate&&(m=l.infoTemplate),l=f.createHighlightGraphics(e,n,m),0<l.length&&(b=(a=e.getExtent())?a.getCenter():e,f.showHighlight(l,b,f.highlightZoomLevel,p.isDefined(n)&&
p.isDefined(m)&&f.showFeaturePopup)))});this.appConfig.map.infoWindow&&r(this.appConfig.map.infoWindow,"hide",function(){f.highlighterLayer.clear()});this.showFeaturePopup||this.appConfig.map.infoWindow&&r(this.appConfig.map.infoWindow,"show",function(){f.highlighterLayer.clear()})},createHighlightGraphics:function(a,d,k){var l,e=[];if("polyline"===a.type)e.push(new h(a,new b(esri.symbol.SimpleLineSymbol.STYLE_SOLID,this.lineHiliteColor,3),d,k));else if("point"===a.type){if(!a.x||!a.y||isNaN(a.x)||
isNaN(a.y))return e;for(l=0;4>=l;++l)e.push(new h(a,new f(f.STYLE_CIRCLE,2.5*(l+16),new b(b.STYLE_SOLID,this.lineHiliteColor,3),this.concentricCircleFillColor),d,k))}else a.type&&e.push(new esri.Graphic(a,new g(g.STYLE_SOLID,new b(b.STYLE_SOLID,this.lineHiliteColor,3),this.fillHiliteColor),d,k));return e},showHighlight:function(a,b,f,l){var e,n,m,g,h=this;b?e=this.mapObj.centerAt(b):(e=new k,e.resolve());e.then(function(){f?n=h.mapObj.setZoom(f):(n=new k,n.resolve());n.then(function(){h.intervalTerminator&&
(clearTimeout(h.intervalTerminator),clearInterval(h.intervalID));h.mapObj.hidePopup();1<a.length?(m=0,g=!0,h.intervalID=setInterval(function(){h.highlighterLayer.clear();h.highlighterLayer.add(a[m]);g?++m:--m;m===a.length?(g=!1,--m):0>m&&(g=!0,m=0)},120),h.intervalTerminator=setTimeout(function(){clearInterval(h.intervalID);h.intervalTerminator=null;h.intervalID=null;h.highlighterLayer.clear()},5E3)):h.highlighterLayer.add(a[0]);l&&h.mapObj.showPopupWithFeature(b,a[0])})})}})})},"js/lgonlineEditing":function(){define("js/lgonlineEditing",
"dojo/dom-construct dojo/_base/array dojo/_base/lang dojo/_base/Color dojo/aspect esri/dijit/editing/TemplatePicker esri/dijit/editing/Editor esri/toolbars/draw esri/graphic js/lgonlineBase js/lgonlineMap js/lgonlineCommand".split(" "),function(k,q,r,p,h,b,f,g,a){dojo.declare("js.LGEditTemplatePicker",js.LGMapBasedMenuBox,{constructor:function(){var a;a=dojo.byId(this.colorizerId).getLGObject();a=".templatePicker{border:1px solid transparent!important;}.templatePicker .dojoxGrid{background-color:transparent;}.templatePicker .dojoxGrid .dojoxGridScrollbox{background-color:transparent;}.templatePicker .dojoxGrid .dojoxGridRow{background-color:transparent;}.templatePicker .dojoxGrid .dojoxGridCell{border:1px solid transparent}.templatePicker .dojoxGrid .dojoxGridRow{border:1px solid transparent}.templatePicker .grid .dojoxGridRowOver{background-color:transparent;color:inherit;}.templatePicker .grid .dojoxGridRowOver .dojoxGridCell{background-color:transparent;color:inherit;}.templatePicker .dojoxGrid .dojoxGridCellFocus{border:1px solid transparent!important;}.templatePicker .dojoxGrid .dojoxGridRowOdd{background-color:transparent;}.templatePicker .dojoxGrid .selectedItem{border:1px solid transparent!important;color:"+
a.foregroundColor()+"!important;background-color:"+a.alternateBackgroundColor()+"!important}";this.injectCSS(a);this.setUpWaitForDependency("js.LGEditTemplatePicker")},onDependencyReady:function(){var a,b,f,e=!0;this.appConfig.userPrivileges&&(e=!1,q.some(this.appConfig.userPrivileges,function(a){return"features:user:edit"===a?e=!0:!1}));e?(a=this.appConfig.itemInfo.itemData.operationalLayers,this.layerInfos=[],this.layers=[],q.forEach(a,r.hitch(this,function(a){var e,d=a.layerObject;if(d instanceof
esri.layers.FeatureLayer&&d.isEditable()&&(null===a.capabilities||"Query"!==a.capabilities)&&(null===d.capabilities||"Query"!==d.capabilities))f={featureLayer:d},b=null,a.popupInfo&&a.popupInfo.fieldInfos?b=a.popupInfo.fieldInfos:d.infoTemplate&&(d.infoTemplate.info&&d.infoTemplate.info.fieldInfos)&&(b=d.infoTemplate.info.fieldInfos),b&&(e=[],q.forEach(b,function(a){a.visible&&e.push(a)}),f.fieldInfos=e),this.layerInfos.push(f),this.layers.push(d)})),0===this.layers.length?this.setShowable(!1):(this.templatePickerHolder=
k.create("div",{className:this.templatePickerHolderClass}),k.place(this.templatePickerHolder,this.rootId),touchScroll(this.templatePickerHolder))):this.setShowable(!1);this.inherited(arguments)},createEditor:function(){var a=this,g,l;this.templatePickerHolder&&(this.setIsVisible(!1,!0),g=k.create("div"),k.place(g,this.templatePickerHolder),l=new b({featureLayers:this.layers,rows:"auto",columns:2,grouping:!0},g),l.startup(),this.setIsVisible(!1,!1),g=k.create("div"),k.place(g,this.templatePickerHolder),
l={map:this.appConfig.map,templatePicker:l,toolbarVisible:!1,layerInfos:this.layerInfos},this.editor=new f({settings:l},g),this.editor.startup(),h.before(this.editor,"_applyEdits",function(b){q.forEach(b,function(b){b.adds&&a.preprocessEditAdds(b);b.updates&&a.preprocessEditUpdates(b);b.deletes&&a.preprocessEditDeletes(b)})}),this.mapObj.disablePopups())},destroyEditor:function(){this.editor&&(this.editor.destroy(),this.editor=null,this.mapObj.enablePopups())},show:function(){this.createEditor();
this.inherited(arguments)},hide:function(){this.destroyEditor();this.inherited(arguments)},preprocessEditAdds:function(a){return a},preprocessEditUpdates:function(a){return a},preprocessEditDeletes:function(a){return a}});dojo.declare("js.LGEditTemplatePickerWithDefaults",[js.LGEditTemplatePicker,js.LGDefaults],{constructor:function(){this.changeDefaults();this.setUpWaitForDependency("js.LGEditTemplatePickerWithDefaults")},preprocessEditAdds:function(a){a.adds[0].attributes[this.defaultValues.fieldname1]=
this.defaultValues.value1;return a}});dojo.declare("js.LGFeatureByClick",[js.LGObject,js.LGMapDependency],{constructor:function(){this.setUpWaitForDependency("js.LGFeatureByClick")},onDependencyReady:function(){var a=this;this.inherited(arguments);this.clickHandle=this.subscribeToMessage("mapClick",function(b){a.handleClick(b)})},handleClick:function(){return null}});dojo.declare("js.LGAddFeatureByClick",js.LGFeatureByClick,{constructor:function(){this.setUpWaitForDependency("js.LGAddFeatureByClick")},
onDependencyReady:function(){this.inherited(arguments);esri.bundle.toolbars.draw.addPoint=this.checkForSubstitution("@tooltips.collect");this.drawingToolbar=new g(this.appConfig.map,{});this.drawingToolbarActive=!1;this.drawingToolbar.on("draw-end",r.hitch(this,this.handleDrawEnd))},handleClick:function(a){this.drawingToolbarActive||(this.drawingToolbarActive=!0,this.drawingToolbar.activate(g.POINT),this.drawingToolbar._updateTooltip(a))},handleDrawEnd:function(b){var f=this,g;this.drawingToolbarActive=
!1;this.drawingToolbar.deactivate();g=new a(b.geometry,new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_SQUARE,10,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new p([255,0,0]),1),new p([0,255,0,0.25])));this.appConfig.map.graphics.add(g);setTimeout(function(){alert(f.checkForSubstitution("@messages.yourContentSubmitted"));f.appConfig.map.graphics.remove(g)},2E3)}})})},"js/lgonlineFrame":function(){define("js/lgonlineFrame","dojo/dom-construct dojo/on dojo/dom-style dojo/_base/array dojo/_base/lang js/lgonlineBase".split(" "),
function(k,q,r,p,h){dojo.declare("js.LGColorizer",js.LGObject,{constructor:function(){var b,f="",g=this,a=["#fff","#333333","#5d5d5d","#5d5d5d"];this.colors=[];p.some(this.colorTable,function(a){return g.theme===a.theme?(g.colors=a.colors,!0):!1});if(this.colors.length<a.length)for(b=this.colors.length;b<a.length;b+=1)this.colors.push(a[b]);f+=".appTheme{color:"+this.colors[0]+";background-color:"+this.colors[1]+"}";f+=".appTheme2{color:"+this.colors[0]+";background-color:"+this.colors[3]+"}";f+=
".appThemeHover:hover{background-color:"+this.colors[2]+"}";this.injectCSS(f)},foregroundColor:function(){return this.colors[0]},backgroundColor:function(){return this.colors[1]},hoverColor:function(){return this.colors[2]},alternateBackgroundColor:function(){return this.colors[3]}});dojo.declare("js.LGFrame",js.LGGraphic,{constructor:function(){var b;b={};this.headerDivId&&(b.id=this.headerDivId);this.headerDivClass&&(b.className=this.headerDivClass);this.headerDiv=k.create("div",b,this.rootDiv);
this.applyTheme(!1,this.headerDiv);b={};this.contentDivId&&(b.id=this.contentDivId);this.contentDivClass&&(b.className=this.contentDivClass);this.contentDiv=k.create("div",b,this.rootDiv);this.handleWindowResize()},handleWindowResize:function(){this.inherited(arguments);this.resizeContentDiv()},resizeContentDiv:function(){var b,f,g;this.headerDiv&&this.contentDiv&&(b=dojo.marginBox(this.rootDiv),f=dojo.marginBox(this.headerDiv),g=b.h-f.h,0<g&&(g={},g.top=f.h+"px",g.height=b.h-f.h+"px",r.set(this.contentDiv,
g)))}});dojo.declare("js.LGGallery",js.LGGraphic,{constructor:function(){var b,f=this;b=k.create("table",null,this.rootDiv);this.applyTheme(!1,b);q(window,"resize",h.hitch(this,this.handleParentResize));this.rootDiv.getContentDiv=function(){return f.addItem()};b=k.create("tbody",null,b);this.galleryRow=k.create("tr",null,b);b={innerHTML:"&lt;",style:{visibility:"hidden"}};this.arrowClass&&(b.className=this.arrowClass);this.leftArrow=k.create("td",b,this.galleryRow);this.applyTheme(!0,this.leftArrow);
q(this.leftArrow,"click",h.hitch(this,this.shiftLeft));b.innerHTML="&gt;";this.rightArrow=k.create("td",b,this.galleryRow);this.applyTheme(!0,this.rightArrow);q(this.rightArrow,"click",h.hitch(this,this.shiftRight));this.zeroItemWidth=dojo.marginBox(this.rootDiv).w;this.numItemsToDisplay=this.iFirstItem=this.numItems=this.itemWidth=0;this.firstItem=null;this.handleParentResize()},addItem:function(b){var f;f={};"string"===typeof b&&(f.innerHTML=b);this.itemClass&&(f.className=this.itemClass);f=k.create("td",
f);"string"!==typeof b&&f.appendChild(b);this.galleryRow.insertBefore(f,this.rightArrow);this.numItems+=1;this.firstItem||(this.firstItem=f,this.itemWidth=dojo.marginBox(f).w);this.handleParentResize();return f},clearItems:function(){for(;2<this.galleryRow.childNodes.length;)this.galleryRow.removeChild(this.galleryRow.childNodes[1]);this.numItemsToDisplay=this.iFirstItem=this.numItems=0;this.firstItem=null;this.handleParentResize()},handleParentResize:function(){var b,f;0===this.zeroItemWidth&&(this.zeroItemWidth=
dojo.marginBox(this.rootDiv).w);b=dojo.marginBox(this.rootDiv.parentNode).w;f=this.zeroItemWidth+this.numItems*this.itemWidth;0!==this.numItems&&(f>b?(this.leftArrow.style.visibility="visible",this.rightArrow.style.visibility="visible",this.numItemsToDisplay=Math.max(Math.floor((b-this.zeroItemWidth)/this.itemWidth),1)):(this.leftArrow.style.visibility="hidden",this.rightArrow.style.visibility="hidden",this.numItemsToDisplay=this.numItems),this.iFirstItem=Math.min(this.iFirstItem,this.numItems-this.numItemsToDisplay),
this.drawGallery())},shiftLeft:function(){this.iFirstItem=Math.min(this.iFirstItem+1,this.numItems-this.numItemsToDisplay);this.drawGallery()},shiftRight:function(){this.iFirstItem=Math.max(this.iFirstItem-1,0);this.drawGallery()},drawGallery:function(){var b,f=this.iFirstItem,g=this.iFirstItem+this.numItemsToDisplay,a=this.firstItem;this.leftArrow.style.visibility="hidden";this.rightArrow.style.visibility="hidden";for(b=0;b<f;)this.rightArrow.style.visibility="visible",a.style.display="none",a=a.nextSibling,
b+=1;for(;b<g;)a.style.display="",a=a.nextSibling,b+=1;for(;b<this.numItems;)this.leftArrow.style.visibility="visible",a.style.display="none",a=a.nextSibling,b+=1;this.handleWindowResize()}});dojo.declare("js.LGTitleBar",js.LGGraphic,{constructor:function(){var b;this.iconUrl&&0<this.iconUrl.length&&(b={src:this.iconUrl},this.iconClass&&(b.className=this.iconClass),k.create("img",b,this.rootDiv));this.title&&0<this.title.length&&(b={innerHTML:this.title},this.titleClass&&(b.className=this.titleClass),
k.create("span",b,this.rootDiv),document.title=this.title);this.handleWindowResize()}})})},"js/lgonlineMap":function(){define("js/lgonlineMap","dojo/dom-construct dojo/dom dojo/on dojo/_base/lang dojo/_base/array dojo/Deferred dojo/dom-class dojo/dom-attr esri/arcgis/utils esri/dijit/Popup esri/layers/GraphicsLayer esri/tasks/ProjectParameters js/lgonlineBase".split(" "),function(k,q,r,p,h,b,f,g,a,d,t,l){dojo.declare("js.LGMapDependency",js.LGDependency,{onDependencyPrep:function(a){this.mapObj=a;
this.inherited(arguments)}});dojo.declare("js.LGMap",js.LGGraphic,{constructor:function(a){var d=null;a=null;var m=this,h,u;this.ready=new b;h=this.appConfig.map;u=h.extent;k.destroy(this.rootDiv);this.rootDiv=q.byId("mapDiv");k.place(this.rootDiv,this.parentDiv);f.add(this.rootDiv,this.rootClass);g.set(this.rootDiv,"id",this.rootId);this.rootDiv.getLGObject=function(){return m};this.handleWindowResize();h.resize(!0);h.reposition();if(this.xmin&&this.ymin&&this.xmax&&this.ymax)try{d={xmin:this.xmin,
ymin:this.ymin,xmax:this.xmax,ymax:this.ymax,spatialReference:{}},d.spatialReference.wkid=this.wkid?Number(this.wkid):102100,d=new esri.geometry.Extent(d)}catch(t){d=null}this.appConfig.urlValues.ex&&(a=this.getExtentsFromString(this.appConfig.urlValues.ex))&&(d=a);d?d.spatialReference.wkid!==h.spatialReference.wkid?esri.config.defaults.geometryService?(a=new l,a.geometries=[d],a.outSR=h.spatialReference,esri.config.defaults.geometryService.project(a).then(function(a){d=a[0];h.setExtent(d)})):this.log("LGMap_1: Need geometry service to convert extent from wkid "+
d.spatialReference.wkid+" to map's "+h.spatialReference.wkid):h.setExtent(d):h.setExtent(u);h.spatialReference||(h.spatialReference=new esri.SpatialReference(102100));r(window,"resize",p.hitch(this,function(){h.resize();h.reposition()}));this.tempGraphicsLayer=this.createGraphicsLayer("tempGraphicsLayer");this.positionHandle=this.subscribeToMessage("position",function(a){var b;a.spatialReference.wkid===m.appConfig.map.spatialReference.wkid?m.publishMessage("highlightItem",a):4326===a.spatialReference.wkid&&
102100===m.appConfig.map.spatialReference.wkid?(a=esri.geometry.geographicToWebMercator(a),m.publishMessage("highlightItem",a)):esri.config.defaults.geometryService?(b=new esri.tasks.ProjectParameters,b.geometries=[a],b.outSR=m.appConfig.map.spatialReference,esri.config.defaults.geometryService.project(b).then(function(b){a=b[0];m.publishMessage("highlightItem",a)})):m.log("LGMap_1: Need geometry service to convert position from wkid "+a.spatialReference.wkid+" to map's "+m.appConfig.map.spatialReference.wkid)});
this.showFeatureHandle=this.subscribeToMessage("showFeature",function(a){m.publishMessage("highlightItem",a)});this.clickHandle=r(h,"click",function(a){m.publishMessage("mapClick",a)});this.ready.resolve(this)},showPopupWithFeature:function(a,b){var d=this.appConfig.map.infoWindow;d.clearFeatures();d.setContent(b.getContent());this.appConfig.map.infoWindow.show(a)},hidePopup:function(){this.appConfig.map.infoWindow.hide()},setExtent:function(a){return this.appConfig.map.setExtent(a)},centerAt:function(a){return this.appConfig.map.centerAt(a)},
setZoom:function(a){var b=this.appConfig.map.getMinZoom(),d=this.appConfig.map.getMaxZoom();0<=b&&0<=d&&(a=Math.max(b,Math.min(d,a)));return this.appConfig.map.setZoom(a)},getMapExtentsAsString:function(){var a="";this.appConfig.map&&(a=this.getStringFromExtents(this.appConfig.map.extent));return a},getStringFromExtents:function(a){var b=a.xmin.toFixed().toString()+","+a.ymin.toFixed().toString()+","+a.xmax.toFixed().toString()+","+a.ymax.toFixed().toString();(a=a.spatialReference)&&(a.wkid?b=b+","+
a.wkid.toString():a.wkt&&(b=b+","+encodeURIComponent(a.wkt)));return b},getExtentsFromString:function(a){var b,d=null,f,g;b=a.split(",");1===b.length&&(g=a.indexOf("PROJCS"),0<g?(b=a.substr(0,g).split("%2C"),b[4]=a.substr(g)):b=a.split("%2C"));try{d={xmin:Number(b[0]),ymin:Number(b[1]),xmax:Number(b[2]),ymax:Number(b[3]),spatialReference:{}},4<b.length?(f=Number(b[4]),isNaN(f)?d.spatialReference.wkt=decodeURIComponent(b[4]):d.spatialReference.wkid=f):d.spatialReference.wkid=102100,d=new esri.geometry.Extent(d)}catch(h){d=
null}return d},getLayer:function(a){var b;h.some(this.appConfig.itemInfo.itemData.operationalLayers,function(d){return d.title===a?(b=d.layerObject,!0):!1});return b},getLayerNameList:function(){var a=[];h.forEach(this.appConfig.itemInfo.itemData.operationalLayers,function(b){a.push(b.title)});return a},getOperationalLayers:function(){return this.appConfig.itemInfo.itemData.operationalLayers},createGraphicsLayer:function(a){var b=new t;b.id=a;r(b,"graphic-add",function(){b.disableMouseEvents()});
return this.appConfig.map.addLayer(b)},enablePopups:function(){this.appConfig.mapInfo.clickEventListener&&(this.appConfig.mapInfo.clickEventHandle=r(this.appConfig.map,"click",this.appConfig.mapInfo.clickEventListener))},disablePopups:function(){this.appConfig.mapInfo.clickEventHandle&&this.appConfig.mapInfo.clickEventHandle.remove()}})})},"js/lgonlineOutput":function(){define("js/lgonlineOutput",["dojo/dom-construct","dojo/dom-class","dojo/_base/array","dojo/topic","js/lgonlineBase"],function(k,
q,r,p){dojo.declare("js.LGNotes",js.LGObject,{constructor:function(){console&&this.notes&&r.forEach(this.notes,function(h){console.log(h)})}});dojo.declare("js.LGBusy",js.LGGraphic,{constructor:function(){this.busyImageClass&&q.add(this.rootDiv,this.busyImageClass)}});dojo.declare("js.LGLogBox",js.LGDropdownBox,{constructor:function(){window.gLogMessageBox=this;touchScroll(this.rootDiv)},append:function(h){"string"===typeof h?k.create("div",{innerHTML:h,style:"margin:2px"},this.rootDiv):"object"===
typeof h&&null!==h&&this.rootDiv.appendChild(h)}});dojo.declare("js.LGMessageBox",js.LGDropdownBox,{constructor:function(){this.content&&0<this.content.length&&(this.rootDiv.innerHTML=this.content);touchScroll(this.rootDiv)}});dojo.declare("js.LGPublishEcho",js.LGDropdownBox,{handleTrigger:function(h){this.rootDiv.innerHTML=h.toString();this.setIsVisible(!0)}});dojo.declare("js.LGMessageWatch",js.LGObject,{constructor:function(){var h=this;p.subscribe("publish",function(b){h.showMessage("message from",
b)});p.subscribe("receive",function(b){h.showMessage("received by",b)})},showMessage:function(h,b){var f="";if(b.data)try{f=JSON.stringify(b.data)}catch(g){f="<data>"}this.log(h+" "+b.id+': "'+b.tag+'" '+(f||""))}})})}}});
